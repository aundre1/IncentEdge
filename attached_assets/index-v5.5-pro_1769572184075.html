<!DOCTYPE html>
<!--
  THE VIDEO POOL - Professional DJ Platform v5.5
  Version: 5.5 | January 2026

  NEW IN V5.5 (UX/UI Council Approved):
  ✓ Minimal pill notifications (single line, bottom center, professional)
  ✓ Record label field added to all track metadata
  ✓ Dynamic search with autocomplete (artist, song, label)
  ✓ MusicBrainz API integration for metadata
  ✓ Set Builder smart recommendations (BPM/Key/Genre algorithm)
  ✓ Professional polish: reduced cyan, softer hovers, better typography
  ✓ Improved mobile responsiveness (480px breakpoint, touch targets)
  ✓ Monospace font for BPM/Key/Duration metadata

  V5.4 FEATURES:
  ✓ Quality color system: 320p=Bronze, 480p=Tan, 720p=Olive, 1080p=Cyan, 4K=Gold
  ✓ Dynamic aspect ratio for video preview (16:9 / 4:3)
  ✓ Fixed drag-drop section reordering
  ✓ Three layout presets: Club Mode, Prep Mode, Custom
  ✓ Updated top 8 genres with comprehensive subgenres

  V5.3 FEATURES:
  ✓ PNG logo with subtle glow animation
  ✓ Dynamic subgenres from track metadata

  PRICING TIERS:
  - Free: $0 (1 download/month, 720p)
  - Starter: $14.99/month (50 downloads, 1080p)
  - Pro: $29.99/month (200 downloads, 4K)
  - Elite: $49.99/month (UNLIMITED, 4K)
-->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Video Pool - Professional Video DJ Platform</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' rx='6' fill='%230a0a0f'/><polygon points='10,8 10,24 24,16' fill='%2300d4ff'/></svg>">
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    /* ============================================
       CSS VARIABLES
       ============================================ */
    :root {
      --bg-primary: #0a0a0f;
      --bg-secondary: #111116;
      --bg-tertiary: #1a1a22;
      --bg-elevated: #222230;
      --text-primary: #f5f5f7;
      --text-secondary: #a1a1aa;
      --text-muted: #6b6b76;
      --border-subtle: rgba(255, 255, 255, 0.06);
      --border-default: rgba(255, 255, 255, 0.1);
      --accent-cyan: #00d4ff;
      --accent-cyan-hover: #33ddff;
      --accent-cyan-glow: rgba(0, 212, 255, 0.3);
      --accent-cyan-subtle: rgba(0, 212, 255, 0.1);
      --accent-gold: #ffd700;
      --accent-coral: #ff6b4a;
      --accent-purple: #a855f7;
      --success: #00e676;
      --warning: #ffab00;
      --error: #ff4757;
      --shadow-card: 0 4px 20px rgba(0, 0, 0, 0.4);
      --shadow-elevated: 0 12px 40px rgba(0, 0, 0, 0.5);
      --ease-out: cubic-bezier(0.4, 0, 0.2, 1);
      --duration-fast: 150ms;
      --duration-normal: 200ms;
      --duration-slow: 300ms;
    }

    .light {
      --bg-primary: #f5f5f7;
      --bg-secondary: #ffffff;
      --bg-tertiary: #e8e8ed;
      --bg-elevated: #ffffff;
      --text-primary: #0a0a0f;
      --text-secondary: #52525b;
      --text-muted: #71717a;
      --border-subtle: rgba(0, 0, 0, 0.06);
      --border-default: rgba(0, 0, 0, 0.1);
      --accent-cyan: #0099cc;
      --shadow-card: 0 4px 20px rgba(0, 0, 0, 0.08);
    }

    /* ============================================
       RESET & BASE
       ============================================ */
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      font-family: 'Inter', -apple-system, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
      overflow-x: hidden;
    }

    /* ============================================
       LOGO
       ============================================ */
    .logo {
      display: flex;
      align-items: center;
      text-decoration: none;
      flex-shrink: 0;
    }

    .logo__image {
      height: 36px;
      width: auto;
      transition: all var(--duration-normal) var(--ease-out);
    }

    /* Subtle glow animation on hover */
    .logo:hover .logo__image {
      filter: drop-shadow(0 0 12px var(--accent-cyan-glow));
      transform: scale(1.03);
    }

    /* Subtle pulse animation for the logo disc */
    @keyframes logoGlow {
      0%, 100% { filter: drop-shadow(0 0 2px rgba(0, 212, 255, 0.3)); }
      50% { filter: drop-shadow(0 0 10px rgba(0, 212, 255, 0.6)); }
    }

    .logo__image {
      animation: logoGlow 4s ease-in-out infinite;
    }

    .logo:hover .logo__image {
      animation: none;
      filter: drop-shadow(0 0 15px var(--accent-cyan-glow));
    }

    /* ============================================
       HEADER
       ============================================ */
    .header {
      position: sticky;
      top: 0;
      z-index: 100;
      display: flex;
      align-items: center;
      gap: 24px;
      height: 72px;
      padding: 0 24px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-subtle);
    }

    .search-bar { flex: 1; max-width: 550px; margin: 0 auto; position: relative; }

    .search-bar__container {
      display: flex;
      align-items: center;
      gap: 12px;
      width: 100%;
      min-width: 300px;
      padding: 10px 16px;
      background: var(--bg-tertiary);
      border: 2px solid var(--border-subtle);
      border-radius: 10px;
      transition: all var(--duration-fast) var(--ease-out);
    }

    .search-bar__container:focus-within {
      border-color: var(--accent-cyan);
      box-shadow: 0 0 0 4px var(--accent-cyan-subtle);
    }

    .search-bar__icon { width: 20px; height: 20px; color: var(--text-muted); flex-shrink: 0; }
    .search-bar__input {
      flex: 1;
      background: transparent;
      border: none;
      color: var(--text-primary);
      font-size: 14px;
      outline: none;
      min-width: 0;
    }
    .search-bar__input::placeholder { color: var(--text-muted); }
    .search-bar__kbd {
      padding: 3px 7px;
      background: var(--bg-primary);
      border-radius: 5px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 11px;
      color: var(--text-muted);
    }

    /* ============================================
       SEARCH AUTOCOMPLETE DROPDOWN
       ============================================ */
    .search-dropdown {
      position: absolute;
      top: calc(100% + 8px);
      left: 0;
      right: 0;
      background: var(--bg-secondary);
      border: 1px solid var(--border-default);
      border-radius: 12px;
      box-shadow: var(--shadow-elevated);
      max-height: 400px;
      overflow-y: auto;
      z-index: 200;
      display: none;
    }
    .search-dropdown--visible { display: block; }

    .search-dropdown__section {
      padding: 8px 0;
      border-bottom: 1px solid var(--border-subtle);
    }
    .search-dropdown__section:last-child { border-bottom: none; }

    .search-dropdown__label {
      padding: 6px 16px;
      font-size: 11px;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .search-dropdown__item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 16px;
      cursor: pointer;
      transition: background var(--duration-fast) var(--ease-out);
    }
    .search-dropdown__item:hover,
    .search-dropdown__item--selected {
      background: var(--bg-tertiary);
    }

    .search-dropdown__thumb {
      width: 40px;
      height: 40px;
      border-radius: 4px;
      overflow: hidden;
      flex-shrink: 0;
      background: var(--bg-elevated);
    }
    .search-dropdown__thumb img { width: 100%; height: 100%; object-fit: cover; }

    .search-dropdown__info { flex: 1; min-width: 0; }
    .search-dropdown__title {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-primary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .search-dropdown__title mark {
      background: var(--accent-cyan-subtle);
      color: var(--accent-cyan);
      border-radius: 2px;
      padding: 0 2px;
    }
    .search-dropdown__meta {
      font-size: 12px;
      color: var(--text-muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .search-dropdown__type {
      font-size: 10px;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      background: var(--bg-elevated);
      padding: 2px 6px;
      border-radius: 4px;
    }

    .search-dropdown__empty {
      padding: 24px 16px;
      text-align: center;
      color: var(--text-muted);
      font-size: 13px;
    }

    .header__nav { display: flex; gap: 2px; }

    .nav__link {
      padding: 8px 14px;
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 14px;
      font-weight: 500;
      border-radius: 8px;
      cursor: pointer;
      transition: all var(--duration-fast) var(--ease-out);
    }

    .nav__link:hover { background: var(--accent-cyan-subtle); color: var(--text-primary); }
    .nav__link--active { background: var(--accent-cyan-subtle); color: var(--accent-cyan); }

    .header__actions { display: flex; align-items: center; gap: 10px; }

    .header-btn {
      width: 38px;
      height: 38px;
      background: transparent;
      border: 1px solid var(--border-subtle);
      border-radius: 8px;
      color: var(--text-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      transition: all var(--duration-fast) var(--ease-out);
    }

    .header-btn:hover {
      background: var(--accent-cyan-subtle);
      border-color: var(--accent-cyan);
      color: var(--accent-cyan);
    }

    .header-btn svg { width: 18px; height: 18px; }

    .header-btn__badge {
      position: absolute;
      top: -4px;
      right: -4px;
      min-width: 16px;
      height: 16px;
      padding: 0 4px;
      background: var(--accent-coral);
      color: #fff;
      font-size: 10px;
      font-weight: 700;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .user-avatar {
      width: 38px;
      height: 38px;
      background: var(--accent-cyan);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 13px;
      color: #000;
      cursor: pointer;
    }

    .user-avatar:hover { box-shadow: 0 0 15px var(--accent-cyan-glow); }

    /* Layout Preset Selector */
    .layout-preset {
      position: relative;
    }

    .layout-preset__btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-subtle);
      border-radius: 8px;
      color: var(--text-secondary);
      font-size: 13px;
      cursor: pointer;
      transition: all var(--duration-fast) var(--ease-out);
    }

    .layout-preset__btn:hover {
      background: var(--accent-cyan-subtle);
      border-color: var(--accent-cyan);
      color: var(--accent-cyan);
    }

    .layout-preset__label {
      font-weight: 500;
    }

    .layout-preset__menu {
      position: absolute;
      top: calc(100% + 8px);
      right: 0;
      width: 260px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-default);
      border-radius: 12px;
      box-shadow: var(--shadow-elevated);
      padding: 8px;
      z-index: 500;
      display: none;
    }

    .layout-preset__menu--open {
      display: block;
    }

    .layout-preset__item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: background var(--duration-fast);
    }

    .layout-preset__item:hover {
      background: var(--bg-tertiary);
    }

    .layout-preset__item--active {
      background: var(--accent-cyan-subtle);
    }

    .layout-preset__item--active .layout-preset__name {
      color: var(--accent-cyan);
    }

    .layout-preset__icon {
      font-size: 20px;
      width: 28px;
      text-align: center;
    }

    .layout-preset__info {
      flex: 1;
    }

    .layout-preset__name {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-primary);
    }

    .layout-preset__desc {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .layout-preset__divider {
      height: 1px;
      background: var(--border-subtle);
      margin: 8px 0;
    }

    .layout-preset__item--save:hover {
      background: rgba(29, 185, 84, 0.1);
    }

    .layout-preset__item--save:hover .layout-preset__name {
      color: #1DB954;
    }

    /* ============================================
       GENRE NAV
       ============================================ */
    .genre-nav {
      position: sticky;
      top: 72px;
      z-index: 90;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-subtle);
      padding: 0 24px;
      overflow: visible;
    }

    .genre-nav__inner {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 0;
      overflow-x: auto;
      overflow-y: visible;
      scrollbar-width: none;
    }

    .genre-nav__inner::-webkit-scrollbar { display: none; }

    /* Allow dropdown to escape scroll container */
    .genre-chip:hover {
      z-index: 200;
    }

    .genre-chip {
      position: relative;
      padding: 8px 16px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-subtle);
      border-radius: 20px;
      color: var(--text-secondary);
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      white-space: nowrap;
      transition: all var(--duration-fast) var(--ease-out);
    }

    .genre-chip:hover { border-color: var(--accent-cyan); color: var(--text-primary); }
    .genre-chip--active { background: var(--accent-cyan); border-color: var(--accent-cyan); color: #000; }

    .genre-chip__arrow { margin-left: 4px; font-size: 10px; }

    /* Genre Mega Menu */
    .genre-mega {
      position: fixed;
      width: 420px;
      padding: 16px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-default);
      border-radius: 12px;
      box-shadow: var(--shadow-elevated);
      z-index: 1000;
      display: none;
      pointer-events: none;
    }

    .genre-mega--open {
      display: block;
      pointer-events: auto;
    }

    .genre-mega__section { margin-bottom: 12px; }
    .genre-mega__section:last-child { margin-bottom: 0; }

    .genre-mega__title {
      font-size: 11px;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
    }

    .genre-mega__grid { display: flex; flex-wrap: wrap; gap: 6px; }

    .genre-mega__item {
      padding: 6px 12px;
      background: var(--bg-tertiary);
      border-radius: 6px;
      font-size: 12px;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all var(--duration-fast) var(--ease-out);
    }

    .genre-mega__item:hover {
      background: var(--accent-cyan-subtle);
      color: var(--accent-cyan);
    }

    .genre-nav__customize {
      padding: 8px 12px;
      background: transparent;
      border: 1px dashed var(--border-default);
      border-radius: 20px;
      color: var(--text-muted);
      font-size: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .genre-nav__customize:hover {
      border-color: var(--accent-cyan);
      color: var(--accent-cyan);
    }

    /* ============================================
       TOOLBAR (View Toggle, Batch Actions)
       ============================================ */
    .toolbar {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 12px 24px;
      background: var(--bg-primary);
      border-bottom: 1px solid var(--border-subtle);
      flex-wrap: wrap;
    }

    .toolbar__group {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .toolbar__label {
      font-size: 12px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* View Toggle */
    .view-toggle {
      display: flex;
      background: var(--bg-tertiary);
      border-radius: 8px;
      padding: 4px;
    }

    .view-toggle__btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 32px;
      background: transparent;
      border: none;
      border-radius: 6px;
      color: var(--text-muted);
      cursor: pointer;
      transition: all var(--duration-fast) var(--ease-out);
    }

    .view-toggle__btn:hover { color: var(--text-primary); }
    .view-toggle__btn--active { background: var(--accent-cyan); color: #000; }
    .view-toggle__btn svg { width: 18px; height: 18px; }

    /* Batch Actions Bar */
    .batch-bar {
      display: none;
      align-items: center;
      gap: 12px;
      padding: 10px 16px;
      background: var(--accent-cyan-subtle);
      border: 1px solid var(--accent-cyan);
      border-radius: 10px;
      animation: slideIn 0.2s ease-out;
    }

    .batch-bar--visible { display: flex; }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .batch-bar__count {
      font-size: 14px;
      font-weight: 600;
      color: var(--accent-cyan);
    }

    .batch-bar__actions { display: flex; gap: 8px; }

    /* Recent Downloads Button */
    .recent-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 14px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-subtle);
      border-radius: 8px;
      color: var(--text-secondary);
      font-size: 13px;
      cursor: pointer;
      transition: all var(--duration-fast) var(--ease-out);
      position: relative;
    }

    .recent-btn:hover { border-color: var(--accent-cyan); color: var(--text-primary); }
    .recent-btn--active { background: var(--accent-cyan-subtle); border-color: var(--accent-cyan); color: var(--accent-cyan); }

    .recent-btn__badge {
      padding: 2px 6px;
      background: var(--accent-purple);
      color: #fff;
      font-size: 10px;
      font-weight: 700;
      border-radius: 10px;
      margin-left: 4px;
    }

    .toolbar__spacer { flex: 1; }

    /* Filter Dropdowns */
    .filter-dropdown { position: relative; }

    .filter-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-subtle);
      border-radius: 8px;
      color: var(--text-secondary);
      font-size: 13px;
      cursor: pointer;
      transition: all var(--duration-fast) var(--ease-out);
    }

    .filter-btn:hover { border-color: var(--accent-cyan); color: var(--text-primary); }
    .filter-btn svg { width: 14px; height: 14px; }

    .filter-menu {
      position: absolute;
      top: 100%;
      left: 0;
      min-width: 200px;
      padding: 8px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-default);
      border-radius: 10px;
      box-shadow: var(--shadow-elevated);
      z-index: 50;
      display: none;
      margin-top: 4px;
    }

    .filter-dropdown:hover .filter-menu { display: block; }

    .filter-menu__item {
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 13px;
      color: var(--text-secondary);
      cursor: pointer;
    }

    .filter-menu__item:hover { background: var(--accent-cyan-subtle); color: var(--text-primary); }
    .filter-menu__item--active { background: var(--accent-cyan-subtle); color: var(--accent-cyan); }

    /* ============================================
       RECENT DOWNLOADS LEFT PANEL
       ============================================ */
    .recent-panel {
      position: fixed;
      top: 72px;
      left: 0;
      bottom: 0;
      width: 400px;
      background: var(--bg-secondary);
      border-right: 1px solid var(--border-subtle);
      z-index: 400;
      transform: translateX(-100%);
      transition: transform var(--duration-slow) var(--ease-out);
      display: flex;
      flex-direction: column;
    }

    .recent-panel--open { transform: translateX(0); }

    .recent-panel__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px;
      border-bottom: 1px solid var(--border-subtle);
    }

    .recent-panel__title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 18px;
      font-weight: 700;
    }

    .recent-panel__subtitle {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .recent-panel__close {
      width: 32px;
      height: 32px;
      background: var(--bg-tertiary);
      border: none;
      border-radius: 8px;
      color: var(--text-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .recent-panel__close:hover { background: var(--bg-elevated); }

    .recent-panel__content {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
    }

    .recent-panel__list {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .recent-panel__item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-subtle);
      border-radius: 10px;
      cursor: pointer;
      transition: all var(--duration-fast) var(--ease-out);
    }

    .recent-panel__item:nth-child(odd) {
      background: var(--bg-secondary);
    }

    .recent-panel__item:hover {
      border-color: var(--accent-cyan);
      background: var(--bg-elevated);
    }

    .recent-panel__item-thumb {
      width: 56px;
      height: 32px;
      border-radius: 4px;
      overflow: hidden;
      flex-shrink: 0;
    }

    .recent-panel__item-thumb img { width: 100%; height: 100%; object-fit: cover; }

    .recent-panel__item-info { flex: 1; min-width: 0; }

    .recent-panel__item-title {
      font-size: 13px;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .recent-panel__item-meta {
      display: flex;
      gap: 8px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .recent-panel__item-date {
      font-size: 11px;
      color: var(--text-muted);
      white-space: nowrap;
    }

    .recent-panel__item-warning {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 3px 8px;
      background: var(--warning);
      color: #000;
      font-size: 10px;
      font-weight: 700;
      border-radius: 10px;
      white-space: nowrap;
    }

    .recent-panel__item-warning svg {
      width: 12px;
      height: 12px;
    }

    .recent-panel__footer {
      padding: 16px;
      border-top: 1px solid var(--border-subtle);
      font-size: 12px;
      color: var(--text-muted);
      text-align: center;
    }

    /* Request Form Panel */
    .request-panel {
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      width: 450px;
      max-width: 100%;
      background: var(--bg-secondary);
      border-left: 1px solid var(--border-subtle);
      z-index: 400;
      transform: translateX(100%);
      transition: transform var(--duration-slow) var(--ease-out);
      display: flex;
      flex-direction: column;
    }

    .request-panel--open { transform: translateX(0); }

    .request-panel__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 24px;
      border-bottom: 1px solid var(--border-subtle);
    }

    .request-panel__title { font-size: 20px; font-weight: 700; }

    .request-panel__close {
      width: 36px;
      height: 36px;
      background: var(--bg-tertiary);
      border: none;
      border-radius: 8px;
      color: var(--text-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .request-panel__close:hover { background: var(--bg-elevated); }

    .request-panel__content {
      flex: 1;
      overflow-y: auto;
      padding: 24px;
    }

    .request-form { display: flex; flex-direction: column; gap: 20px; }

    .form-group { display: flex; flex-direction: column; gap: 8px; }

    .form-label {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-secondary);
    }

    .form-select,
    .form-input,
    .form-textarea {
      width: 100%;
      padding: 12px 14px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-default);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 14px;
      font-family: inherit;
      transition: border-color var(--duration-fast) var(--ease-out);
    }

    .form-select:focus,
    .form-input:focus,
    .form-textarea:focus {
      outline: none;
      border-color: var(--accent-cyan);
    }

    .form-textarea { min-height: 120px; resize: vertical; }

    .form-submit {
      padding: 14px 24px;
      background: var(--accent-cyan);
      border: none;
      border-radius: 8px;
      color: #000;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all var(--duration-fast) var(--ease-out);
    }

    .form-submit:hover { background: var(--accent-cyan-hover); }

    .form-success {
      display: none;
      text-align: center;
      padding: 40px 20px;
    }

    .form-success--visible { display: block; }

    .form-success__icon {
      width: 64px;
      height: 64px;
      margin: 0 auto 20px;
      background: var(--success);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .form-success__icon svg { width: 32px; height: 32px; color: #fff; }

    .form-success__title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .form-success__message {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.6;
    }

    /* Slide Panel for Browse/Charts/etc (RIGHT side) */
    .slide-panel {
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      width: 600px;
      max-width: 100%;
      background: var(--bg-secondary);
      border-left: 1px solid var(--border-subtle);
      z-index: 400;
      transform: translateX(100%);
      transition: transform var(--duration-slow) var(--ease-out);
      display: flex;
      flex-direction: column;
    }

    .slide-panel--open { transform: translateX(0); }

    .slide-panel__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 24px;
      border-bottom: 1px solid var(--border-subtle);
    }

    .slide-panel__title { font-size: 20px; font-weight: 700; }

    .slide-panel__close {
      width: 36px;
      height: 36px;
      background: var(--bg-tertiary);
      border: none;
      border-radius: 8px;
      color: var(--text-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .slide-panel__close:hover { background: var(--bg-elevated); }

    .slide-panel__content {
      flex: 1;
      overflow-y: auto;
      padding: 20px 24px;
    }

    .slide-panel__grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }

    /* ============================================
       MAIN CONTENT
       ============================================ */
    .main {
      display: flex;
      min-height: calc(100vh - 200px);
    }

    .main__content {
      flex: 1;
      padding: 24px;
      overflow-y: auto;
    }

    /* ============================================
       SECTIONS
       ============================================ */
    /* POLISH: More whitespace between sections, subtle separator */
    .section {
      margin-bottom: 40px;
      padding-top: 32px;
      border-top: 1px solid rgba(255, 255, 255, 0.05);
      transition: all var(--duration-normal) var(--ease-out);
    }

    .section:first-child {
      border-top: none;
      padding-top: 0;
    }

    .section--dragging {
      opacity: 0.5;
      transform: scale(0.98);
    }

    .section--drag-over {
      border: 2px dashed var(--accent-cyan);
      background: var(--accent-cyan-subtle);
      border-radius: 12px;
      padding: 16px;
    }

    .section__header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 0;
      cursor: pointer;
      user-select: none;
    }

    .section__drag-handle {
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-muted);
      cursor: grab;
      opacity: 0;
      transition: opacity var(--duration-fast) var(--ease-out);
    }

    .section:hover .section__drag-handle { opacity: 1; }
    .section__drag-handle:active { cursor: grabbing; }

    /* POLISH: Larger section titles, lighter weight (Apple Music style) */
    .section__title {
      font-size: 24px;
      font-weight: 600;
      flex: 1;
      letter-spacing: -0.02em;
    }

    /* POLISH: Reduce cyan - use neutral for secondary links */
    .section__link {
      color: var(--text-secondary);
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
    }

    .section__link:hover { color: var(--accent-cyan); text-decoration: underline; }

    .section__toggle {
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-muted);
      transition: transform var(--duration-fast) var(--ease-out);
    }

    .section--collapsed .section__toggle { transform: rotate(-90deg); }
    .section--collapsed .section__content { max-height: 0; opacity: 0; overflow: hidden; }

    .section__content {
      max-height: 2000px;
      transition: max-height var(--duration-slow) var(--ease-out);
    }

    /* ============================================
       RECENTLY DOWNLOADED SECTION
       ============================================ */
    .recent-section {
      background: linear-gradient(135deg, rgba(168, 85, 247, 0.1) 0%, var(--accent-cyan-subtle) 100%);
      border: 1px solid var(--border-default);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 24px;
    }

    .recent-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .recent-header__title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 16px;
      font-weight: 700;
    }

    .recent-header__count {
      padding: 4px 10px;
      background: var(--accent-purple);
      color: #fff;
      font-size: 12px;
      font-weight: 600;
      border-radius: 12px;
    }

    .recent-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .recent-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 12px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-subtle);
      border-radius: 10px;
      cursor: pointer;
      transition: all var(--duration-fast) var(--ease-out);
    }

    .recent-item:hover {
      border-color: var(--accent-cyan);
      background: var(--bg-tertiary);
    }

    .recent-item__thumb {
      width: 48px;
      height: 27px;
      border-radius: 4px;
      overflow: hidden;
      flex-shrink: 0;
    }

    .recent-item__thumb img { width: 100%; height: 100%; object-fit: cover; }

    .recent-item__info { flex: 1; min-width: 0; }

    .recent-item__title {
      font-size: 13px;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .recent-item__meta {
      font-size: 11px;
      color: var(--text-muted);
    }

    .recent-item__date {
      font-size: 11px;
      color: var(--text-muted);
      white-space: nowrap;
    }

    .recent-item__btn {
      padding: 6px 12px;
      background: var(--accent-cyan);
      border: none;
      border-radius: 6px;
      color: #000;
      font-size: 11px;
      font-weight: 600;
      cursor: pointer;
      white-space: nowrap;
    }

    .recent-item__btn:hover { background: var(--accent-cyan-hover); }

    .recent-expand {
      display: flex;
      justify-content: center;
      margin-top: 12px;
    }

    .recent-expand__btn {
      padding: 8px 20px;
      background: transparent;
      border: 1px dashed var(--border-default);
      border-radius: 8px;
      color: var(--text-muted);
      font-size: 13px;
      cursor: pointer;
    }

    .recent-expand__btn:hover {
      border-color: var(--accent-cyan);
      color: var(--accent-cyan);
    }

    /* ============================================
       VIDEO GRID VIEW
       ============================================ */
    .video-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 20px;
    }

    .video-grid--hidden { display: none; }

    .video-card {
      position: relative;
      background: var(--bg-secondary);
      border: 1px solid var(--border-subtle);
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      transition: all var(--duration-normal) var(--ease-out);
    }

    /* POLISH: Softer card hover - scale 1.02, subtle shadow (not cyan glow) */
    .video-card:hover {
      border-color: var(--border-default);
      transform: scale(1.02);
      box-shadow: 0 8px 24px rgba(0,0,0,0.3);
    }

    .video-card--selected {
      border-color: var(--accent-cyan);
      box-shadow: 0 0 0 2px var(--accent-cyan);
    }

    .video-card__checkbox {
      position: absolute;
      top: 12px;
      left: 12px;
      z-index: 10;
      width: 24px;
      height: 24px;
      background: var(--bg-secondary);
      border: 2px solid var(--border-default);
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: all var(--duration-fast) var(--ease-out);
    }

    .video-card:hover .video-card__checkbox,
    .video-card--selected .video-card__checkbox { opacity: 1; }

    .video-card__checkbox--checked {
      background: var(--accent-cyan);
      border-color: var(--accent-cyan);
    }

    .video-card__checkbox svg { width: 14px; height: 14px; color: #000; display: none; }
    .video-card__checkbox--checked svg { display: block; }

    .video-card__thumb {
      position: relative;
      aspect-ratio: 16/9;
      overflow: hidden;
      background: var(--bg-tertiary);
    }

    .video-card__thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.4s var(--ease-out);
    }

    .video-card:hover .video-card__thumb img { transform: scale(1.05); }

    .video-card__overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 60%);
      opacity: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: opacity var(--duration-normal) var(--ease-out);
    }

    .video-card:hover .video-card__overlay { opacity: 1; }

    .video-card__play {
      width: 52px;
      height: 52px;
      background: var(--accent-cyan);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #000;
      transform: scale(0.8);
      opacity: 0;
      transition: all var(--duration-normal) var(--ease-out);
    }

    .video-card:hover .video-card__play { transform: scale(1); opacity: 1; }
    .video-card__play svg { width: 22px; height: 22px; margin-left: 2px; }

    .badge {
      padding: 3px 7px;
      font-size: 10px;
      font-weight: 700;
      border-radius: 4px;
    }

    .badge--new { background: var(--accent-coral); color: #fff; }
    .badge--hot { background: linear-gradient(135deg, #ff6b4a, #ffab00); color: #fff; }

    .video-card__badges { position: absolute; top: 8px; left: 40px; display: flex; gap: 6px; }

    .video-card__quality {
      position: absolute;
      bottom: 8px;
      left: 8px;
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 700;
      text-align: center;
      min-width: 36px;
    }

    /* Quality Color System (Council Approved):
       4K = Gold (Premium), 1080p = Cyan (Default), 720p = Olive (HD Entry)
       480p = Tan (SD Standard), 320p = Bronze (Legacy) */
    .video-card__quality--4k { background: linear-gradient(135deg, #FFD700, #FFA500); color: #000; font-weight: 800; }
    .video-card__quality--1080p { background: var(--accent-cyan); color: #000; }
    .video-card__quality--720p { background: #6B8E23; color: #fff; }
    .video-card__quality--480p { background: #CD853F; color: #000; }
    .video-card__quality--320p { background: #8B7355; color: #fff; }

    .video-card__duration {
      position: absolute;
      bottom: 8px;
      right: 8px;
      padding: 3px 7px;
      background: rgba(0,0,0,0.8);
      color: #fff;
      font-family: 'JetBrains Mono', monospace;
      font-size: 11px;
      border-radius: 4px;
    }

    .video-card__content { padding: 14px; }

    .video-card__title {
      font-size: 14px;
      font-weight: 600;
      line-height: 1.3;
      margin-bottom: 4px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      min-height: 36px;
    }

    .video-card__artist {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 10px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .video-card__meta {
      display: flex;
      gap: 8px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 12px;
    }

    .video-card__actions { display: flex; gap: 8px; }

    /* ============================================
       VIDEO LIST VIEW (Spotify/iTunes Style)
       ============================================ */
    .video-list { display: none; }
    .video-list--visible { display: block; }

    .video-list__header {
      display: grid;
      grid-template-columns: 40px 60px 2fr 1.5fr 70px 60px 70px 80px 100px 120px;
      gap: 12px;
      padding: 12px 16px;
      background: var(--bg-tertiary);
      border-radius: 8px;
      margin-bottom: 8px;
      font-size: 11px;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .video-list__header-cell {
      display: flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
    }

    .video-list__header-cell:hover { color: var(--text-primary); }
    .video-list__header-cell svg { width: 12px; height: 12px; }

    .video-list__row {
      display: grid;
      grid-template-columns: 40px 60px 2fr 1.5fr 70px 60px 70px 80px 100px 120px;
      gap: 12px;
      padding: 10px 16px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-subtle);
      border-radius: 8px;
      margin-bottom: 4px;
      align-items: center;
      cursor: pointer;
      transition: all var(--duration-fast) var(--ease-out);
    }

    .video-list__row:nth-child(odd) {
      background: var(--bg-tertiary);
    }

    .video-list__row:hover {
      background: var(--bg-elevated);
      border-color: var(--accent-cyan);
    }

    .video-list__row--selected {
      background: var(--accent-cyan-subtle);
      border-color: var(--accent-cyan);
    }

    .video-list__checkbox {
      width: 20px;
      height: 20px;
      background: var(--bg-tertiary);
      border: 2px solid var(--border-default);
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--duration-fast) var(--ease-out);
    }

    .video-list__checkbox:hover { border-color: var(--accent-cyan); }

    .video-list__checkbox--checked {
      background: var(--accent-cyan);
      border-color: var(--accent-cyan);
    }

    .video-list__checkbox svg { width: 12px; height: 12px; color: #000; display: none; }
    .video-list__checkbox--checked svg { display: block; }

    .video-list__thumb {
      width: 60px;
      height: 34px;
      border-radius: 4px;
      overflow: hidden;
      position: relative;
    }

    .video-list__thumb img { width: 100%; height: 100%; object-fit: cover; }

    .video-list__thumb-play {
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity var(--duration-fast) var(--ease-out);
    }

    .video-list__row:hover .video-list__thumb-play { opacity: 1; }
    .video-list__thumb-play svg { width: 20px; height: 20px; color: #fff; }

    .video-list__title {
      font-size: 14px;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .video-list__artist {
      font-size: 13px;
      color: var(--text-secondary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* POLISH: Reduce cyan - use neutral for BPM */
    .video-list__bpm {
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
      color: var(--text-primary);
      font-weight: 500;
    }

    .video-list__key {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 4px 8px;
      background: var(--bg-tertiary);
      border-radius: 4px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-secondary);
    }

    .video-list__duration {
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
      color: var(--text-muted);
    }

    .video-list__quality {
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 700;
      text-align: center;
      min-width: 40px;
      display: inline-block;
    }

    .video-list__quality--4k { background: var(--accent-cyan); color: #000; }
    .video-list__quality--1080p { background: var(--accent-purple); color: #fff; }
    .video-list__quality--720p { background: rgba(255,255,255,0.3); color: #fff; }
    .video-list__quality--480p { background: rgba(255,255,255,0.2); color: #fff; }
    .video-list__quality--320p { background: rgba(255,255,255,0.15); color: rgba(255,255,255,0.8); }

    .video-list__genre {
      font-size: 12px;
      color: var(--text-muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .video-list__actions { display: flex; gap: 6px; }

    .video-list__action-btn {
      width: 32px;
      height: 32px;
      background: transparent;
      border: 1px solid var(--border-subtle);
      border-radius: 6px;
      color: var(--text-muted);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--duration-fast) var(--ease-out);
    }

    .video-list__action-btn:hover {
      background: var(--accent-cyan);
      border-color: var(--accent-cyan);
      color: #000;
    }

    .video-list__action-btn svg { width: 14px; height: 14px; }

    /* ============================================
       SET BUILDER PANEL
       ============================================ */
    .set-builder {
      width: 380px;
      background: var(--bg-secondary);
      border-left: 1px solid var(--border-subtle);
      display: flex;
      flex-direction: column;
      transform: translateX(100%);
      transition: transform var(--duration-slow) var(--ease-out);
      position: fixed;
      top: 72px;
      right: 0;
      bottom: 0;
      z-index: 80;
    }

    .set-builder--open { transform: translateX(0); }

    .set-builder__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 20px;
      border-bottom: 1px solid var(--border-subtle);
    }

    .set-builder__title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 16px;
      font-weight: 700;
    }

    .set-builder__title-icon { font-size: 18px; }

    .set-builder__close {
      width: 32px;
      height: 32px;
      background: var(--bg-tertiary);
      border: none;
      border-radius: 8px;
      color: var(--text-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .set-builder__close:hover { background: var(--bg-elevated); }

    .set-builder__stats {
      display: flex;
      gap: 16px;
      padding: 12px 20px;
      background: var(--bg-tertiary);
      font-size: 12px;
    }

    .set-builder__stat {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .set-builder__stat-value {
      font-size: 18px;
      font-weight: 700;
      color: var(--accent-cyan);
    }

    .set-builder__stat-label {
      font-size: 10px;
      color: var(--text-muted);
      text-transform: uppercase;
    }

    .set-builder__tracks {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
    }

    .set-builder__empty {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 200px;
      color: var(--text-muted);
      text-align: center;
    }

    .set-builder__empty-icon { font-size: 40px; margin-bottom: 12px; opacity: 0.5; }
    .set-builder__empty-text { font-size: 14px; }
    .set-builder__empty-hint { font-size: 12px; margin-top: 8px; }

    .set-track {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-subtle);
      border-radius: 10px;
      margin-bottom: 8px;
      cursor: grab;
      transition: all var(--duration-fast) var(--ease-out);
    }

    .set-track:hover { border-color: var(--accent-cyan); }
    .set-track--dragging { opacity: 0.5; }
    .set-track--drag-over { border-color: var(--accent-cyan); background: var(--accent-cyan-subtle); }

    .set-track__order {
      width: 24px;
      height: 24px;
      background: var(--bg-elevated);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 700;
      color: var(--text-muted);
      flex-shrink: 0;
    }

    .set-track__thumb {
      width: 48px;
      height: 27px;
      border-radius: 4px;
      overflow: hidden;
      flex-shrink: 0;
    }

    .set-track__thumb img { width: 100%; height: 100%; object-fit: cover; }

    .set-track__info { flex: 1; min-width: 0; }

    .set-track__title {
      font-size: 13px;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .set-track__meta {
      display: flex;
      gap: 8px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .set-track__compatibility {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .set-track__compatibility--good { background: var(--success); }
    .set-track__compatibility--ok { background: var(--warning); }
    .set-track__compatibility--bad { background: var(--error); }

    .set-track__remove {
      width: 24px;
      height: 24px;
      background: transparent;
      border: none;
      border-radius: 4px;
      color: var(--text-muted);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: all var(--duration-fast) var(--ease-out);
    }

    .set-track:hover .set-track__remove { opacity: 1; }
    .set-track__remove:hover { background: var(--error); color: #fff; }

    /* Set Builder Recommendations Section */
    .set-builder__recs {
      padding: 12px 20px;
      border-top: 1px solid var(--border-subtle);
      background: var(--bg-tertiary);
    }
    .set-builder__recs-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }
    .set-builder__recs-title {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-muted);
    }
    .set-builder__recs-badge {
      font-size: 9px;
      font-weight: 700;
      background: var(--accent-cyan);
      color: #000;
      padding: 2px 6px;
      border-radius: 4px;
    }
    .set-builder__recs-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
      max-height: 150px;
      overflow-y: auto;
    }
    .set-builder__rec-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px;
      background: var(--bg-secondary);
      border-radius: 6px;
      cursor: pointer;
      transition: background var(--duration-fast) var(--ease-out);
    }
    .set-builder__rec-item:hover { background: var(--bg-elevated); }
    .set-builder__rec-thumb {
      width: 32px;
      height: 32px;
      border-radius: 4px;
      overflow: hidden;
      flex-shrink: 0;
    }
    .set-builder__rec-thumb img { width: 100%; height: 100%; object-fit: cover; }
    .set-builder__rec-info { flex: 1; min-width: 0; }
    .set-builder__rec-title {
      font-size: 12px;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .set-builder__rec-meta {
      font-size: 10px;
      color: var(--text-muted);
      font-family: 'JetBrains Mono', monospace;
    }
    .set-builder__rec-add {
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--accent-cyan-subtle);
      color: var(--accent-cyan);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      flex-shrink: 0;
    }
    .set-builder__rec-add:hover { background: var(--accent-cyan); color: #000; }
    .set-builder__rec-add svg { width: 12px; height: 12px; }

    .set-builder__footer {
      padding: 16px 20px;
      border-top: 1px solid var(--border-subtle);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .set-builder__footer-row {
      display: flex;
      gap: 10px;
    }

    /* ============================================
       BUTTONS
       ============================================ */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 10px 16px;
      font-size: 13px;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all var(--duration-fast) var(--ease-out);
    }

    .btn svg { width: 16px; height: 16px; }

    .btn--primary { flex: 1; background: var(--accent-cyan); color: #000; }
    .btn--primary:hover { background: var(--accent-cyan-hover); box-shadow: 0 4px 15px var(--accent-cyan-glow); }

    .btn--secondary { background: var(--bg-tertiary); color: var(--text-secondary); border: 1px solid var(--border-subtle); }
    .btn--secondary:hover { background: var(--bg-elevated); color: var(--text-primary); }

    .btn--sm { padding: 6px 12px; font-size: 12px; }
    .btn--sm svg { width: 14px; height: 14px; }

    .btn--icon { width: 38px; height: 38px; padding: 0; }

    /* ============================================
       PREVIEW MODAL
       ============================================ */
    .preview-modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      z-index: 500;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .preview-modal--open { display: flex; }

    .preview-modal__content {
      display: flex;
      background: var(--bg-secondary);
      border-radius: 16px;
      overflow: hidden;
      max-width: 900px;
      width: 100%;
      box-shadow: var(--shadow-elevated);
    }

    .preview-modal__video {
      width: 55%;
      background: #000;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 300px;
    }

    /* Dynamic aspect ratio container */
    .preview-modal__video-wrapper {
      width: 100%;
      position: relative;
      background: #000;
    }

    .preview-modal__video-wrapper--16x9 { aspect-ratio: 16/9; }
    .preview-modal__video-wrapper--4x3 { aspect-ratio: 4/3; }
    .preview-modal__video-wrapper--1x1 { aspect-ratio: 1/1; }

    .preview-modal__video-placeholder {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-tertiary);
    }

    .preview-modal__video-placeholder img {
      width: 100%;
      height: 100%;
      object-fit: contain; /* Preserve aspect ratio, letterbox if needed */
      background: #000;
    }

    .preview-modal__play-btn {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 70px;
      height: 70px;
      background: var(--accent-cyan);
      border: none;
      border-radius: 50%;
      color: #000;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .preview-modal__play-btn:hover { transform: translate(-50%, -50%) scale(1.1); }
    .preview-modal__play-btn svg { width: 30px; height: 30px; margin-left: 4px; }

    .preview-modal__info {
      width: 45%;
      padding: 24px;
      display: flex;
      flex-direction: column;
    }

    .preview-modal__header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .preview-modal__badge {
      padding: 4px 10px;
      background: var(--accent-coral);
      color: #fff;
      font-size: 11px;
      font-weight: 700;
      border-radius: 4px;
    }

    .preview-modal__close {
      width: 32px;
      height: 32px;
      background: var(--bg-tertiary);
      border: none;
      border-radius: 8px;
      color: var(--text-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .preview-modal__close:hover { background: var(--bg-elevated); }

    .preview-modal__title { font-size: 22px; font-weight: 700; margin-bottom: 4px; }
    .preview-modal__artist { font-size: 16px; color: var(--text-secondary); margin-bottom: 20px; }

    .preview-modal__stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }

    .preview-modal__stat { display: flex; flex-direction: column; }

    .preview-modal__stat-label {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .preview-modal__stat-value { font-size: 16px; font-weight: 600; color: var(--accent-cyan); }

    .preview-modal__divider { height: 1px; background: var(--border-subtle); margin: 16px 0; }

    .preview-modal__section-title {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 12px;
    }

    .preview-modal__option {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 12px;
      background: var(--bg-tertiary);
      border-radius: 8px;
      margin-bottom: 8px;
      cursor: pointer;
    }

    .preview-modal__option:hover { background: var(--bg-elevated); }

    .preview-modal__option-check {
      width: 20px;
      height: 20px;
      border: 2px solid var(--accent-cyan);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .preview-modal__option-check--checked { background: var(--accent-cyan); }
    .preview-modal__option-check svg { width: 14px; height: 14px; color: #000; display: none; }
    .preview-modal__option-check--checked svg { display: block; }

    .preview-modal__option-info { flex: 1; }
    .preview-modal__option-name { font-size: 14px; font-weight: 500; }
    .preview-modal__option-meta { font-size: 12px; color: var(--text-muted); }

    .preview-modal__footer { margin-top: auto; display: flex; gap: 10px; }
    .preview-modal__footer .btn { flex: 1; padding: 12px 16px; }

    /* Version List */
    .preview-modal__versions {
      max-height: 200px;
      overflow-y: auto;
      margin-bottom: 16px;
    }

    .preview-modal__versions::-webkit-scrollbar { width: 6px; }
    .preview-modal__versions::-webkit-scrollbar-track { background: var(--bg-tertiary); border-radius: 3px; }
    .preview-modal__versions::-webkit-scrollbar-thumb { background: var(--border-default); border-radius: 3px; }

    .preview-modal__version {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 12px;
      background: var(--bg-tertiary);
      border-radius: 8px;
      margin-bottom: 6px;
      transition: background var(--duration-fast) var(--ease-out);
    }

    .preview-modal__version:hover { background: var(--bg-elevated); }
    .preview-modal__version:last-child { margin-bottom: 0; }

    .preview-modal__version-icon {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-secondary);
      border-radius: 6px;
      color: var(--text-muted);
    }

    .preview-modal__version-icon svg { width: 16px; height: 16px; }

    .preview-modal__version-info { flex: 1; min-width: 0; }
    .preview-modal__version-name { font-size: 13px; font-weight: 600; }
    .preview-modal__version-meta { font-size: 11px; color: var(--text-muted); }

    .preview-modal__version-download {
      width: 32px;
      height: 32px;
      background: var(--accent-cyan);
      border: none;
      border-radius: 6px;
      color: #000;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform var(--duration-fast) var(--ease-out);
    }

    .preview-modal__version-download:hover { transform: scale(1.1); }
    .preview-modal__version-download svg { width: 14px; height: 14px; }

    .preview-modal__expand {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 8px;
      background: none;
      border: 1px dashed var(--border-default);
      border-radius: 6px;
      color: var(--text-muted);
      font-size: 12px;
      cursor: pointer;
      margin-bottom: 12px;
      width: 100%;
      transition: all var(--duration-fast) var(--ease-out);
    }

    .preview-modal__expand:hover {
      border-color: var(--accent-cyan);
      color: var(--accent-cyan);
    }

    .preview-modal__expand svg { width: 14px; height: 14px; }

    /* Quality Dropdowns */
    .preview-modal__quality-row {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
    }

    .preview-modal__quality-group {
      flex: 1;
    }

    .preview-modal__quality-label {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 6px;
      display: block;
    }

    .preview-modal__quality-select {
      width: 100%;
      padding: 10px 12px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-default);
      border-radius: 6px;
      color: var(--text-primary);
      font-size: 13px;
      font-family: inherit;
      cursor: pointer;
      transition: border-color var(--duration-fast) var(--ease-out);
    }

    .preview-modal__quality-select:focus {
      outline: none;
      border-color: var(--accent-cyan);
    }

    .preview-modal__file-size {
      font-size: 12px;
      color: var(--text-muted);
      text-align: right;
      margin-bottom: 12px;
    }

    /* ============================================
       MINIMAL PILL NOTIFICATIONS (Council v5.5)
       Single line, bottom center, professional
       No titles, no message hierarchy - just icon + text
       ============================================ */
    .toast-container {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 600;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      pointer-events: none;
    }

    .toast {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 18px;
      background: rgba(40, 40, 40, 0.95);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: none;
      border-radius: 999px; /* Full pill shape */
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      max-width: 320px;
      transform: translateY(40px);
      opacity: 0;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      pointer-events: auto;
    }

    .toast--show {
      transform: translateY(0);
      opacity: 1;
    }

    /* Icon colors by type */
    .toast--success .toast__icon { color: #1DB954; }
    .toast--info .toast__icon { color: #fff; }
    .toast--error .toast__icon { color: #ff4757; }
    .toast--warning .toast__icon { color: #ffab00; }

    .toast__icon {
      font-size: 14px;
      flex-shrink: 0;
      line-height: 1;
    }

    /* Single line text - no title/message split */
    .toast__text {
      font-size: 13px;
      font-weight: 500;
      color: #fff;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Legacy support for old showToast calls */
    .toast__content { display: contents; }
    .toast__title {
      font-size: 13px;
      font-weight: 500;
      color: #fff;
    }
    .toast__message { display: none; } /* Hide secondary message */

    .toast__action {
      color: var(--accent-cyan);
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      padding: 2px 6px;
      border-radius: 4px;
      margin-left: 4px;
      transition: background 0.15s;
    }
    .toast__action:hover {
      background: rgba(255,255,255,0.1);
    }

    /* ============================================
       BACKDROP
       ============================================ */
    .backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 350;
      opacity: 0;
      visibility: hidden;
      transition: all var(--duration-normal) var(--ease-out);
    }

    .backdrop--visible { opacity: 1; visibility: visible; }

    /* ============================================
       KEYBOARD SHORTCUTS PANEL (Spotify/YouTube Style)
       ============================================ */
    .shortcuts-panel {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.95);
      width: 580px;
      max-width: 95vw;
      max-height: 85vh;
      background: var(--bg-secondary);
      border: 1px solid var(--border-default);
      border-radius: 16px;
      box-shadow: var(--shadow-elevated);
      z-index: 600;
      opacity: 0;
      visibility: hidden;
      transition: all var(--duration-normal) var(--ease-out);
      display: flex;
      flex-direction: column;
    }

    .shortcuts-panel--open {
      opacity: 1;
      visibility: visible;
      transform: translate(-50%, -50%) scale(1);
    }

    .shortcuts-panel__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 24px;
      border-bottom: 1px solid var(--border-subtle);
    }

    .shortcuts-panel__title {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 18px;
      font-weight: 700;
    }

    .shortcuts-panel__title-icon {
      width: 36px;
      height: 36px;
      background: var(--accent-cyan-subtle);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .shortcuts-panel__title-icon svg {
      width: 20px;
      height: 20px;
      color: var(--accent-cyan);
    }

    .shortcuts-panel__close {
      width: 32px;
      height: 32px;
      background: var(--bg-tertiary);
      border: none;
      border-radius: 8px;
      color: var(--text-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--duration-fast) var(--ease-out);
    }

    .shortcuts-panel__close:hover {
      background: var(--bg-elevated);
      color: var(--text-primary);
    }

    .shortcuts-panel__content {
      flex: 1;
      overflow-y: auto;
      padding: 20px 24px;
    }

    .shortcuts-category {
      margin-bottom: 24px;
    }

    .shortcuts-category:last-child {
      margin-bottom: 0;
    }

    .shortcuts-category__title {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      font-weight: 600;
      color: var(--accent-cyan);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--border-subtle);
    }

    .shortcuts-category__title-icon {
      font-size: 14px;
    }

    .shortcuts-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .shortcut-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 12px;
      background: var(--bg-tertiary);
      border-radius: 8px;
      transition: background var(--duration-fast) var(--ease-out);
    }

    .shortcut-item:hover {
      background: var(--bg-elevated);
    }

    .shortcut-item__description {
      font-size: 14px;
      color: var(--text-primary);
    }

    .shortcut-item__keys {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .shortcut-key {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 28px;
      height: 28px;
      padding: 0 8px;
      background: var(--bg-primary);
      border: 1px solid var(--border-default);
      border-radius: 6px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-secondary);
      box-shadow: 0 2px 0 var(--border-default);
    }

    .shortcut-key--wide {
      min-width: 50px;
    }

    .shortcut-key--accent {
      background: var(--accent-cyan-subtle);
      border-color: var(--accent-cyan);
      color: var(--accent-cyan);
    }

    .shortcut-separator {
      color: var(--text-muted);
      font-size: 11px;
    }

    .shortcuts-panel__footer {
      padding: 16px 24px;
      border-top: 1px solid var(--border-subtle);
      background: var(--bg-tertiary);
      border-radius: 0 0 16px 16px;
    }

    .shortcuts-panel__footer-hint {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 12px;
      color: var(--text-muted);
    }

    .shortcuts-panel__footer-hint .shortcut-key {
      height: 22px;
      min-width: 22px;
      font-size: 10px;
    }

    /* Shortcut Action Feedback */
    .shortcut-feedback {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.8);
      padding: 16px 24px;
      background: var(--bg-secondary);
      border: 2px solid var(--accent-cyan);
      border-radius: 12px;
      box-shadow: 0 0 30px var(--accent-cyan-glow);
      z-index: 700;
      opacity: 0;
      visibility: hidden;
      transition: all 0.15s var(--ease-out);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .shortcut-feedback--show {
      opacity: 1;
      visibility: visible;
      transform: translate(-50%, -50%) scale(1);
    }

    .shortcut-feedback__key {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 40px;
      height: 40px;
      padding: 0 12px;
      background: var(--accent-cyan);
      border-radius: 8px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 18px;
      font-weight: 700;
      color: #000;
    }

    .shortcut-feedback__action {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
    }

    /* Focus indicator for current track */
    .video-list__row--focused {
      background: var(--accent-cyan-subtle) !important;
      border-color: var(--accent-cyan) !important;
      box-shadow: inset 0 0 0 1px var(--accent-cyan);
    }

    .video-card--focused {
      border-color: var(--accent-cyan) !important;
      box-shadow: 0 0 0 2px var(--accent-cyan), 0 12px 40px var(--accent-cyan-glow) !important;
    }

    /* ============================================
       RESPONSIVE
       ============================================ */
    @media (max-width: 1200px) {
      .video-list__header,
      .video-list__row {
        grid-template-columns: 40px 60px 2fr 1.5fr 70px 60px 70px 120px;
      }
      .video-list__header-cell:nth-child(8),
      .video-list__header-cell:nth-child(9),
      .video-list__row > *:nth-child(8),
      .video-list__row > *:nth-child(9) { display: none; }
    }

    @media (max-width: 900px) {
      .preview-modal__content { flex-direction: column; }
      .preview-modal__video { width: 100%; }
      .preview-modal__info { width: 100%; }
      .set-builder { width: 100%; }
    }

    @media (max-width: 768px) {
      .header { gap: 12px; padding: 0 16px; height: 64px; }
      .logo__image { height: 28px; }
      .header__nav { display: none; }
      .main__content { padding: 16px; }
      .video-grid { grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 12px; }
      .toolbar { padding: 12px 16px; flex-wrap: wrap; }
      .video-list__header,
      .video-list__row {
        grid-template-columns: 40px 50px 1fr 70px 80px;
      }
      .search-bar__kbd { display: none; }
      /* Touch-friendly genre chips */
      .genre-chip { min-height: 44px; padding: 10px 16px; }
      .section__title { font-size: 20px; }
      /* Set builder as bottom sheet on tablet */
      .set-builder {
        top: auto;
        bottom: 0;
        height: 50vh;
        border-radius: 16px 16px 0 0;
      }
    }

    /* Small mobile (phones) */
    @media (max-width: 480px) {
      .header { padding: 0 12px; height: 56px; }
      .logo__image { height: 24px; }
      .search-bar__container { padding: 8px 12px; min-width: unset; }
      .search-bar__input { font-size: 16px; } /* Prevent iOS zoom */
      .main__content { padding: 12px; }
      .video-grid { grid-template-columns: repeat(2, 1fr); gap: 10px; }
      .video-card__content { padding: 10px; }
      .video-card__title { font-size: 13px; }
      .video-card__artist { font-size: 11px; }
      .section__title { font-size: 18px; }
      .section { margin-bottom: 24px; padding-top: 20px; }
      /* Genre nav horizontal scroll hints */
      .genre-nav {
        -webkit-overflow-scrolling: touch;
        scroll-snap-type: x mandatory;
      }
      .genre-chip { scroll-snap-align: start; }
      /* Touch targets minimum 44px */
      .btn { min-height: 44px; }
      .video-card__checkbox { width: 32px; height: 32px; }
      /* Preview modal full screen */
      .preview-modal__content {
        width: 100%;
        height: 100%;
        max-width: 100%;
        max-height: 100%;
        border-radius: 0;
      }
      /* Set builder full bottom sheet */
      .set-builder {
        height: 70vh;
        max-height: 70vh;
      }
      /* Toast wider on mobile */
      .toast { max-width: calc(100vw - 24px); }
    }

    /* Note for React migration:
       Swimlane/infinite scroll requires react-window or react-virtualized
       for 30,000+ videos. Without virtualization, mobile will crash. */
  </style>
</head>
<body>
  <!-- HEADER -->
  <header class="header">
    <a href="#" class="logo" title="The Video Pool - Home">
      <img src="The Video Pool Logo 2.0.png" alt="The Video Pool" class="logo__image">
    </a>

    <div class="search-bar">
      <div class="search-bar__container">
        <svg class="search-bar__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
        </svg>
        <input type="text" class="search-bar__input" placeholder="Search artist, song, or label..." id="mainSearch" autocomplete="off">
        <span class="search-bar__kbd">⌘K</span>
      </div>
      <!-- Search Autocomplete Dropdown -->
      <div class="search-dropdown" id="searchDropdown"></div>
    </div>

    <nav class="header__nav">
      <a class="nav__link nav__link--active" onclick="setActiveNav(this)">Browse</a>
      <a class="nav__link" onclick="setActiveNav(this); openSlidePanel('New Releases', 'new')">New Releases</a>
      <a class="nav__link" onclick="setActiveNav(this); openSlidePanel('Charts', 'charts')">Charts</a>
      <a class="nav__link" onclick="setActiveNav(this); openSlidePanel('Playlists', 'playlists')">Playlists</a>
    </nav>

    <div class="header__actions">
      <!-- Layout Preset Selector -->
      <div class="layout-preset">
        <button class="layout-preset__btn" onclick="toggleLayoutMenu()" title="Layout Presets">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
            <rect x="3" y="3" width="18" height="18" rx="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/>
          </svg>
          <span class="layout-preset__label" id="currentLayoutLabel">Custom</span>
          <svg viewBox="0 0 24 24" fill="currentColor" width="12" height="12"><path d="M7 10l5 5 5-5z"/></svg>
        </button>
        <div class="layout-preset__menu" id="layoutMenu">
          <div class="layout-preset__item" onclick="applyLayoutPreset('club')">
            <span class="layout-preset__icon">🎪</span>
            <div class="layout-preset__info">
              <div class="layout-preset__name">Club Mode</div>
              <div class="layout-preset__desc">Trending → Latest → Browse</div>
            </div>
          </div>
          <div class="layout-preset__item" onclick="applyLayoutPreset('prep')">
            <span class="layout-preset__icon">📱</span>
            <div class="layout-preset__info">
              <div class="layout-preset__name">Prep Mode</div>
              <div class="layout-preset__desc">For You → Throwbacks → Browse</div>
            </div>
          </div>
          <div class="layout-preset__item layout-preset__item--active" onclick="applyLayoutPreset('custom')">
            <span class="layout-preset__icon">🎯</span>
            <div class="layout-preset__info">
              <div class="layout-preset__name">Custom</div>
              <div class="layout-preset__desc">Your saved arrangement</div>
            </div>
          </div>
          <div class="layout-preset__divider"></div>
          <div class="layout-preset__item layout-preset__item--save" onclick="saveCurrentAsCustom()">
            <span class="layout-preset__icon">💾</span>
            <div class="layout-preset__info">
              <div class="layout-preset__name">Save Current Layout</div>
              <div class="layout-preset__desc">Save as your Custom preset</div>
            </div>
          </div>
        </div>
      </div>

      <button class="header-btn" title="Set Builder" onclick="toggleSetBuilder()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/>
        </svg>
        <span class="header-btn__badge" id="setBuilderBadge">0</span>
      </button>
      <button class="header-btn" title="Downloads">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
        </svg>
        <span class="header-btn__badge">3</span>
      </button>
      <button class="header-btn" title="Toggle Theme" onclick="toggleTheme()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
        </svg>
      </button>
      <button class="header-btn" title="Keyboard Shortcuts (?)" onclick="toggleShortcutsPanel()" id="shortcutsBtn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/>
        </svg>
      </button>
      <button class="header-btn" title="Request Songs or Features" onclick="toggleRequestPanel()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/>
        </svg>
      </button>
      <div class="user-avatar">DJ</div>
    </div>
  </header>

  <!-- GENRE NAV -->
  <nav class="genre-nav">
    <div class="genre-nav__inner">
      <div class="genre-chip genre-chip--active" onclick="filterGenre('All')">All</div>

      <div class="genre-chip">
        Hip-Hop <span class="genre-chip__arrow">▾</span>
        <div class="genre-mega">
          <div class="genre-mega__section">
            <div class="genre-mega__title">By Era</div>
            <div class="genre-mega__grid">
              <div class="genre-mega__item" onclick="filterGenre('90s Hip-Hop')">90s Hip-Hop</div>
              <div class="genre-mega__item" onclick="filterGenre('2000s Hip-Hop')">2000s Hip-Hop</div>
              <div class="genre-mega__item" onclick="filterGenre('2010s Hip-Hop')">2010s Hip-Hop</div>
              <div class="genre-mega__item" onclick="filterGenre('Current Hits')">Current Hits</div>
            </div>
          </div>
          <div class="genre-mega__section">
            <div class="genre-mega__title">By Style</div>
            <div class="genre-mega__grid">
              <div class="genre-mega__item" onclick="filterGenre('Trap')">Trap</div>
              <div class="genre-mega__item" onclick="filterGenre('Drill')">Drill</div>
              <div class="genre-mega__item" onclick="filterGenre('Boom Bap')">Boom Bap</div>
              <div class="genre-mega__item" onclick="filterGenre('Southern')">Southern</div>
              <div class="genre-mega__item" onclick="filterGenre('West Coast')">West Coast</div>
              <div class="genre-mega__item" onclick="filterGenre('East Coast')">East Coast</div>
            </div>
          </div>
        </div>
      </div>

      <div class="genre-chip">
        House <span class="genre-chip__arrow">▾</span>
        <div class="genre-mega">
          <div class="genre-mega__section">
            <div class="genre-mega__title">Subgenres</div>
            <div class="genre-mega__grid">
              <div class="genre-mega__item" onclick="filterGenre('Deep House')">Deep House</div>
              <div class="genre-mega__item" onclick="filterGenre('Tech House')">Tech House</div>
              <div class="genre-mega__item" onclick="filterGenre('Progressive')">Progressive</div>
              <div class="genre-mega__item" onclick="filterGenre('Afro House')">Afro House</div>
              <div class="genre-mega__item" onclick="filterGenre('Melodic House')">Melodic House</div>
              <div class="genre-mega__item" onclick="filterGenre('Vocal House')">Vocal House</div>
              <div class="genre-mega__item" onclick="filterGenre('Disco House')">Disco House</div>
              <div class="genre-mega__item" onclick="filterGenre('Funky House')">Funky House</div>
            </div>
          </div>
        </div>
      </div>

      <div class="genre-chip">
        Latin <span class="genre-chip__arrow">▾</span>
        <div class="genre-mega">
          <div class="genre-mega__section">
            <div class="genre-mega__title">Styles</div>
            <div class="genre-mega__grid">
              <div class="genre-mega__item" onclick="filterGenre('Reggaeton')">Reggaeton</div>
              <div class="genre-mega__item" onclick="filterGenre('Bachata')">Bachata</div>
              <div class="genre-mega__item" onclick="filterGenre('Salsa')">Salsa</div>
              <div class="genre-mega__item" onclick="filterGenre('Cumbia')">Cumbia</div>
              <div class="genre-mega__item" onclick="filterGenre('Merengue')">Merengue</div>
              <div class="genre-mega__item" onclick="filterGenre('Regional Mexican')">Regional Mexican</div>
              <div class="genre-mega__item" onclick="filterGenre('Latin Pop')">Latin Pop</div>
              <div class="genre-mega__item" onclick="filterGenre('Dembow')">Dembow</div>
            </div>
          </div>
        </div>
      </div>

      <div class="genre-chip">
        EDM <span class="genre-chip__arrow">▾</span>
        <div class="genre-mega">
          <div class="genre-mega__section">
            <div class="genre-mega__title">Subgenres</div>
            <div class="genre-mega__grid">
              <div class="genre-mega__item" onclick="filterGenre('Big Room')">Big Room</div>
              <div class="genre-mega__item" onclick="filterGenre('Future Bass')">Future Bass</div>
              <div class="genre-mega__item" onclick="filterGenre('Dubstep')">Dubstep</div>
              <div class="genre-mega__item" onclick="filterGenre('Drum & Bass')">Drum & Bass</div>
              <div class="genre-mega__item" onclick="filterGenre('Trance')">Trance</div>
              <div class="genre-mega__item" onclick="filterGenre('Hardstyle')">Hardstyle</div>
              <div class="genre-mega__item" onclick="filterGenre('Electro')">Electro</div>
              <div class="genre-mega__item" onclick="filterGenre('Techno')">Techno</div>
            </div>
          </div>
        </div>
      </div>

      <div class="genre-chip">
        Pop <span class="genre-chip__arrow">▾</span>
        <div class="genre-mega">
          <div class="genre-mega__section">
            <div class="genre-mega__title">Styles</div>
            <div class="genre-mega__grid">
              <div class="genre-mega__item" onclick="filterGenre('Dance Pop')">Dance Pop</div>
              <div class="genre-mega__item" onclick="filterGenre('Synth Pop')">Synth Pop</div>
              <div class="genre-mega__item" onclick="filterGenre('Indie Pop')">Indie Pop</div>
              <div class="genre-mega__item" onclick="filterGenre('K-Pop')">K-Pop</div>
              <div class="genre-mega__item" onclick="filterGenre('Electropop')">Electropop</div>
              <div class="genre-mega__item" onclick="filterGenre('Teen Pop')">Teen Pop</div>
            </div>
          </div>
        </div>
      </div>

      <div class="genre-chip">
        R&B <span class="genre-chip__arrow">▾</span>
        <div class="genre-mega">
          <div class="genre-mega__section">
            <div class="genre-mega__title">Styles</div>
            <div class="genre-mega__grid">
              <div class="genre-mega__item" onclick="filterGenre('Contemporary R&B')">Contemporary R&B</div>
              <div class="genre-mega__item" onclick="filterGenre('Neo Soul')">Neo Soul</div>
              <div class="genre-mega__item" onclick="filterGenre('Quiet Storm')">Quiet Storm</div>
              <div class="genre-mega__item" onclick="filterGenre('Alternative R&B')">Alternative R&B</div>
              <div class="genre-mega__item" onclick="filterGenre('Funk')">Funk</div>
              <div class="genre-mega__item" onclick="filterGenre('Soul')">Soul</div>
            </div>
          </div>
        </div>
      </div>

      <div class="genre-chip">
        Country <span class="genre-chip__arrow">▾</span>
        <div class="genre-mega">
          <div class="genre-mega__section">
            <div class="genre-mega__title">Subgenres</div>
            <div class="genre-mega__grid">
              <div class="genre-mega__item" onclick="filterGenre('Country Pop')">Country Pop</div>
              <div class="genre-mega__item" onclick="filterGenre('Americana')">Americana</div>
              <div class="genre-mega__item" onclick="filterGenre('Bro-Country')">Bro-Country</div>
              <div class="genre-mega__item" onclick="filterGenre('Outlaw Country')">Outlaw Country</div>
              <div class="genre-mega__item" onclick="filterGenre('Country Rock')">Country Rock</div>
              <div class="genre-mega__item" onclick="filterGenre('Bluegrass')">Bluegrass</div>
              <div class="genre-mega__item" onclick="filterGenre('Red Dirt')">Red Dirt</div>
            </div>
          </div>
        </div>
      </div>

      <div class="genre-chip">
        Throwbacks <span class="genre-chip__arrow">▾</span>
        <div class="genre-mega">
          <div class="genre-mega__section">
            <div class="genre-mega__title">By Era</div>
            <div class="genre-mega__grid">
              <div class="genre-mega__item" onclick="filterGenre('80s Classics')">80s Classics</div>
              <div class="genre-mega__item" onclick="filterGenre('90s Hits')">90s Hits</div>
              <div class="genre-mega__item" onclick="filterGenre('2000s Bangers')">2000s Bangers</div>
              <div class="genre-mega__item" onclick="filterGenre('2010s Anthems')">2010s Anthems</div>
            </div>
          </div>
          <div class="genre-mega__section">
            <div class="genre-mega__title">By Genre</div>
            <div class="genre-mega__grid">
              <div class="genre-mega__item" onclick="filterGenre('Classic Hip-Hop')">Classic Hip-Hop</div>
              <div class="genre-mega__item" onclick="filterGenre('Old School R&B')">Old School R&B</div>
              <div class="genre-mega__item" onclick="filterGenre('Classic Rock')">Classic Rock</div>
              <div class="genre-mega__item" onclick="filterGenre('Disco')">Disco</div>
            </div>
          </div>
        </div>
      </div>

      <div class="genre-chip">
        Remixes <span class="genre-chip__arrow">▾</span>
        <div class="genre-mega">
          <div class="genre-mega__section">
            <div class="genre-mega__title">Remix Types</div>
            <div class="genre-mega__grid">
              <div class="genre-mega__item" onclick="filterGenre('Club Remixes')">Club Remixes</div>
              <div class="genre-mega__item" onclick="filterGenre('Radio Edits')">Radio Edits</div>
              <div class="genre-mega__item" onclick="filterGenre('Extended Mixes')">Extended Mixes</div>
              <div class="genre-mega__item" onclick="filterGenre('Mashups')">Mashups</div>
              <div class="genre-mega__item" onclick="filterGenre('Bootlegs')">Bootlegs</div>
              <div class="genre-mega__item" onclick="filterGenre('Acapellas')">Acapellas</div>
            </div>
          </div>
        </div>
      </div>

      <button class="genre-nav__customize" onclick="showToast('Customize Genres', 'Drag to reorder your top genres', 'info')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
          <circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
        </svg>
        Customize
      </button>
    </div>
  </nav>

  <!-- TOOLBAR -->
  <div class="toolbar">
    <div class="toolbar__group">
      <span class="toolbar__label">View</span>
      <div class="view-toggle">
        <button class="view-toggle__btn" id="gridViewBtn" onclick="setView('grid')" title="Grid View">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/>
          </svg>
        </button>
        <button class="view-toggle__btn view-toggle__btn--active" id="listViewBtn" onclick="setView('list')" title="List View">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/>
          </svg>
        </button>
      </div>
    </div>

    <button class="recent-btn" id="recentBtn" onclick="toggleRecentPanel()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
        <circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>
      </svg>
      Recent Downloads
      <span class="recent-btn__badge" id="recentBtnBadge">47</span>
    </button>

    <div class="batch-bar" id="batchBar">
      <span class="batch-bar__count"><span id="selectedCount">0</span> selected</span>
      <div class="batch-bar__actions">
        <button class="btn btn--primary btn--sm" onclick="batchDownload()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
          Download All
        </button>
        <button class="btn btn--secondary btn--sm" onclick="addToSetBuilder()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
          Add to Set
        </button>
        <button class="btn btn--secondary btn--sm" onclick="clearSelection()">Clear</button>
      </div>
    </div>

    <div class="toolbar__spacer"></div>

    <div class="filter-dropdown">
      <button class="filter-btn">
        BPM Range
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m6 9 6 6 6-6"/></svg>
      </button>
      <div class="filter-menu">
        <div class="filter-menu__item filter-menu__item--active">All BPM</div>
        <div class="filter-menu__item">70-90 (Slow)</div>
        <div class="filter-menu__item">90-110 (Medium)</div>
        <div class="filter-menu__item">110-130 (Club)</div>
        <div class="filter-menu__item">130-150 (High Energy)</div>
      </div>
    </div>

    <div class="filter-dropdown">
      <button class="filter-btn">
        Sort: Newest
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m6 9 6 6 6-6"/></svg>
      </button>
      <div class="filter-menu">
        <div class="filter-menu__item filter-menu__item--active">Newest First</div>
        <div class="filter-menu__item">Most Popular</div>
        <div class="filter-menu__item">BPM: Low to High</div>
        <div class="filter-menu__item">BPM: High to Low</div>
      </div>
    </div>
  </div>

  <!-- MAIN CONTENT -->
  <main class="main">
    <div class="main__content">
      <!-- FOR YOU SECTION -->
      <section class="section" id="section-for-you" draggable="false">
        <div class="section__header">
          <div class="section__drag-handle" >
            <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><circle cx="9" cy="5" r="1.5"/><circle cx="15" cy="5" r="1.5"/><circle cx="9" cy="12" r="1.5"/><circle cx="15" cy="12" r="1.5"/><circle cx="9" cy="19" r="1.5"/><circle cx="15" cy="19" r="1.5"/></svg>
          </div>
          <h2 class="section__title">For You</h2>
          <span class="section__link">See All</span>
        </div>
        <div class="section__content">
          <div class="video-grid" id="forYouGrid">
            <!-- Will be populated by JS with 5 rows -->
          </div>
        </div>
      </section>

      <!-- TRENDING SECTION -->
      <section class="section" id="section-trending" draggable="false">
        <div class="section__header">
          <div class="section__drag-handle" >
            <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><circle cx="9" cy="5" r="1.5"/><circle cx="15" cy="5" r="1.5"/><circle cx="9" cy="12" r="1.5"/><circle cx="15" cy="12" r="1.5"/><circle cx="9" cy="19" r="1.5"/><circle cx="15" cy="19" r="1.5"/></svg>
          </div>
          <h2 class="section__title">Trending</h2>
          <span class="section__link">See All</span>
        </div>
        <div class="section__content">
          <div class="video-grid" id="trendingGrid">
            <!-- Will be populated by JS with 5 rows -->
          </div>
        </div>
      </section>

      <!-- LATEST SECTION -->
      <section class="section" id="section-latest" draggable="false">
        <div class="section__header">
          <div class="section__drag-handle" >
            <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><circle cx="9" cy="5" r="1.5"/><circle cx="15" cy="5" r="1.5"/><circle cx="9" cy="12" r="1.5"/><circle cx="15" cy="12" r="1.5"/><circle cx="9" cy="19" r="1.5"/><circle cx="15" cy="19" r="1.5"/></svg>
          </div>
          <h2 class="section__title">Latest</h2>
          <span class="section__link">See All</span>
        </div>
        <div class="section__content">
          <div class="video-grid" id="latestGrid">
            <!-- Will be populated by JS with 5 rows -->
          </div>
        </div>
      </section>

      <!-- BROWSE SECTION (List View) -->
      <section class="section" id="section-browse" draggable="false">
        <div class="section__header">
          <div class="section__drag-handle" >
            <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><circle cx="9" cy="5" r="1.5"/><circle cx="15" cy="5" r="1.5"/><circle cx="9" cy="12" r="1.5"/><circle cx="15" cy="12" r="1.5"/><circle cx="9" cy="19" r="1.5"/><circle cx="15" cy="19" r="1.5"/></svg>
          </div>
          <h2 class="section__title">Browse Library <span style="font-size: 13px; color: var(--text-muted); font-weight: 400; margin-left: 8px;">(30,247 videos)</span></h2>
        </div>
        <div class="section__content">
          <!-- LIST VIEW -->
          <div class="video-list video-list--visible" id="videoList">
            <div class="video-list__header">
              <div class="video-list__header-cell" onclick="toggleSelectAll()">
                <div class="video-list__checkbox" id="selectAllCheckbox">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20,6 9,17 4,12"/></svg>
                </div>
              </div>
              <div class="video-list__header-cell">Preview</div>
              <div class="video-list__header-cell">Title <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m6 9 6 6 6-6"/></svg></div>
              <div class="video-list__header-cell">Artist</div>
              <div class="video-list__header-cell">BPM <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m6 9 6 6 6-6"/></svg></div>
              <div class="video-list__header-cell">Key</div>
              <div class="video-list__header-cell">Duration</div>
              <div class="video-list__header-cell">Quality</div>
              <div class="video-list__header-cell">Genre</div>
              <div class="video-list__header-cell">Actions</div>
            </div>
            <div id="listRows">
              <!-- Dynamically populated -->
            </div>
          </div>

          <!-- GRID VIEW -->
          <div class="video-grid video-grid--hidden" id="videoGrid">
            <!-- Dynamically populated -->
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- SET BUILDER PANEL -->
  <aside class="set-builder" id="setBuilder">
    <div class="set-builder__header">
      <div class="set-builder__title">
        <span class="set-builder__title-icon">🎧</span>
        Set Builder
      </div>
      <button class="set-builder__close" onclick="toggleSetBuilder()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><path d="M18 6L6 18M6 6l12 12"/></svg>
      </button>
    </div>
    <div class="set-builder__stats">
      <div class="set-builder__stat">
        <span class="set-builder__stat-value" id="setTrackCount">0</span>
        <span class="set-builder__stat-label">Tracks</span>
      </div>
      <div class="set-builder__stat">
        <span class="set-builder__stat-value" id="setDuration">0:00</span>
        <span class="set-builder__stat-label">Duration</span>
      </div>
      <div class="set-builder__stat">
        <span class="set-builder__stat-value" id="setBpmRange">--</span>
        <span class="set-builder__stat-label">BPM Range</span>
      </div>
    </div>
    <div class="set-builder__tracks" id="setTracks">
      <div class="set-builder__empty">
        <div class="set-builder__empty-icon">📀</div>
        <div class="set-builder__empty-text">No tracks in your set</div>
        <div class="set-builder__empty-hint">Drag tracks here or use "Add to Set"</div>
      </div>
    </div>
    <!-- Smart Recommendations (BPM/Key/Genre Algorithm) -->
    <div class="set-builder__recs" id="setRecommendations" style="display: none;">
      <div class="set-builder__recs-header">
        <span class="set-builder__recs-title">Recommended Next</span>
        <span class="set-builder__recs-badge">SMART</span>
      </div>
      <div class="set-builder__recs-list" id="setRecsList"></div>
    </div>
    <div class="set-builder__footer">
      <div class="set-builder__footer-row">
        <button class="btn btn--primary" onclick="downloadSet()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
          Download Set
        </button>
      </div>
      <div class="set-builder__footer-row">
        <button class="btn btn--secondary" style="flex:1" onclick="saveSet()">Save Set</button>
        <button class="btn btn--secondary" style="flex:1" onclick="clearSet()">Clear All</button>
      </div>
    </div>
  </aside>

  <!-- PREVIEW MODAL -->
  <div class="preview-modal" id="previewModal">
    <div class="preview-modal__content">
      <div class="preview-modal__video">
        <div class="preview-modal__video-placeholder">
          <img src="https://picsum.photos/600/338?random=1" alt="" id="previewImage">
        </div>
        <button class="preview-modal__play-btn" onclick="showToast('Preview Playing', '60-second clip from 0:30-1:30', 'info')">
          <svg viewBox="0 0 24 24" fill="currentColor"><polygon points="5,3 19,12 5,21"/></svg>
        </button>
      </div>
      <div class="preview-modal__info">
        <div class="preview-modal__header">
          <span class="preview-modal__badge" id="previewBadge">NEW</span>
          <button class="preview-modal__close" onclick="closePreviewModal()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><path d="M18 6L6 18M6 6l12 12"/></svg>
          </button>
        </div>
        <h2 class="preview-modal__title" id="previewTitle">Track Title</h2>
        <p class="preview-modal__artist" id="previewArtist">Artist Name</p>
        <div class="preview-modal__stats">
          <div class="preview-modal__stat">
            <span class="preview-modal__stat-label">BPM</span>
            <span class="preview-modal__stat-value" id="previewBpm">128</span>
          </div>
          <div class="preview-modal__stat">
            <span class="preview-modal__stat-label">Key</span>
            <span class="preview-modal__stat-value" id="previewKey">8A</span>
          </div>
          <div class="preview-modal__stat">
            <span class="preview-modal__stat-label">Duration</span>
            <span class="preview-modal__stat-value" id="previewDuration">3:42</span>
          </div>
          <div class="preview-modal__stat">
            <span class="preview-modal__stat-label">Genre</span>
            <span class="preview-modal__stat-value" id="previewGenre">Pop</span>
          </div>
        </div>
        <div class="preview-modal__divider"></div>

        <!-- Available Versions -->
        <div class="preview-modal__section-title">Available Versions</div>
        <div class="preview-modal__versions" id="previewVersions">
          <!-- Versions populated by JS -->
        </div>
        <button class="preview-modal__expand" id="expandVersionsBtn" onclick="toggleAllVersions()" style="display: none;">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m6 9 6 6 6-6"/></svg>
          <span id="expandVersionsText">Show all versions</span>
        </button>

        <!-- Quality Selection -->
        <div class="preview-modal__section-title">Download Quality</div>
        <div class="preview-modal__quality-row">
          <div class="preview-modal__quality-group">
            <label class="preview-modal__quality-label">Video</label>
            <select class="preview-modal__quality-select" id="videoQualitySelect" onchange="updateFileSize()">
              <option value="4k">4K (2160p)</option>
              <option value="1080p" selected>1080p Full HD</option>
              <option value="720p">720p HD</option>
            </select>
          </div>
          <div class="preview-modal__quality-group">
            <label class="preview-modal__quality-label">Audio (MP3)</label>
            <select class="preview-modal__quality-select" id="audioQualitySelect" onchange="updateFileSize()">
              <option value="320" selected>320 kbps (HQ)</option>
              <option value="192">192 kbps</option>
            </select>
          </div>
        </div>
        <div class="preview-modal__file-size" id="fileSizeEstimate">Estimated: ~185 MB (video) • ~8 MB (audio)</div>

        <div class="preview-modal__footer">
          <button class="btn btn--primary" onclick="downloadFromModal()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
            Download
          </button>
          <button class="btn btn--secondary" onclick="addToSetFromModal()">Add to Set</button>
        </div>
      </div>
    </div>
  </div>

  <!-- KEYBOARD SHORTCUTS PANEL -->
  <div class="shortcuts-panel" id="shortcutsPanel">
    <div class="shortcuts-panel__header">
      <div class="shortcuts-panel__title">
        <div class="shortcuts-panel__title-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="2" y="4" width="20" height="16" rx="2"/><path d="M6 8h.01M10 8h.01M14 8h.01M18 8h.01M8 12h.01M12 12h.01M16 12h.01M6 16h8"/>
          </svg>
        </div>
        Keyboard Shortcuts
      </div>
      <button class="shortcuts-panel__close" onclick="toggleShortcutsPanel()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><path d="M18 6L6 18M6 6l12 12"/></svg>
      </button>
    </div>
    <div class="shortcuts-panel__content">
      <!-- Playback -->
      <div class="shortcuts-category">
        <div class="shortcuts-category__title">
          <span class="shortcuts-category__title-icon">▶️</span>
          Playback Controls
        </div>
        <div class="shortcuts-list">
          <div class="shortcut-item">
            <span class="shortcut-item__description">Play / Pause preview</span>
            <div class="shortcut-item__keys">
              <span class="shortcut-key shortcut-key--wide shortcut-key--accent">Space</span>
            </div>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-item__description">Preview focused track</span>
            <div class="shortcut-item__keys">
              <span class="shortcut-key shortcut-key--accent">P</span>
            </div>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-item__description">Seek backward 5 seconds</span>
            <div class="shortcut-item__keys">
              <span class="shortcut-key">←</span>
            </div>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-item__description">Seek forward 5 seconds</span>
            <div class="shortcut-item__keys">
              <span class="shortcut-key">→</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Navigation -->
      <div class="shortcuts-category">
        <div class="shortcuts-category__title">
          <span class="shortcuts-category__title-icon">🎯</span>
          Selection & Navigation
        </div>
        <div class="shortcuts-list">
          <div class="shortcut-item">
            <span class="shortcut-item__description">Previous track</span>
            <div class="shortcut-item__keys">
              <span class="shortcut-key shortcut-key--accent">K</span>
              <span class="shortcut-separator">or</span>
              <span class="shortcut-key">↑</span>
            </div>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-item__description">Next track</span>
            <div class="shortcut-item__keys">
              <span class="shortcut-key shortcut-key--accent">J</span>
              <span class="shortcut-separator">or</span>
              <span class="shortcut-key">↓</span>
            </div>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-item__description">Select / Deselect focused track</span>
            <div class="shortcut-item__keys">
              <span class="shortcut-key shortcut-key--accent">X</span>
            </div>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-item__description">Select all tracks</span>
            <div class="shortcut-item__keys">
              <span class="shortcut-key">⌘</span>
              <span class="shortcut-separator">+</span>
              <span class="shortcut-key">A</span>
            </div>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-item__description">Jump to section (Recent, Browse, etc.)</span>
            <div class="shortcut-item__keys">
              <span class="shortcut-key">1</span>
              <span class="shortcut-separator">-</span>
              <span class="shortcut-key">5</span>
            </div>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-item__description">Focus search</span>
            <div class="shortcut-item__keys">
              <span class="shortcut-key">⌘</span>
              <span class="shortcut-separator">+</span>
              <span class="shortcut-key">K</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Set Building -->
      <div class="shortcuts-category">
        <div class="shortcuts-category__title">
          <span class="shortcuts-category__title-icon">📀</span>
          Set Building
        </div>
        <div class="shortcuts-list">
          <div class="shortcut-item">
            <span class="shortcut-item__description">Add focused/selected to Set</span>
            <div class="shortcut-item__keys">
              <span class="shortcut-key shortcut-key--accent">S</span>
            </div>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-item__description">Toggle Set Builder panel</span>
            <div class="shortcut-item__keys">
              <span class="shortcut-key shortcut-key--accent">B</span>
            </div>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-item__description">Download focused/selected</span>
            <div class="shortcut-item__keys">
              <span class="shortcut-key shortcut-key--accent">D</span>
            </div>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-item__description">Clear selection</span>
            <div class="shortcut-item__keys">
              <span class="shortcut-key shortcut-key--wide">Esc</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Mixing Helpers -->
      <div class="shortcuts-category">
        <div class="shortcuts-category__title">
          <span class="shortcuts-category__title-icon">🎛️</span>
          Mixing Helpers
        </div>
        <div class="shortcuts-list">
          <div class="shortcut-item">
            <span class="shortcut-item__description">Filter by similar BPM (±5)</span>
            <div class="shortcut-item__keys">
              <span class="shortcut-key shortcut-key--accent">M</span>
            </div>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-item__description">Show harmonic matches for focused</span>
            <div class="shortcut-item__keys">
              <span class="shortcut-key shortcut-key--accent">H</span>
            </div>
          </div>
        </div>
      </div>

      <!-- View & UI -->
      <div class="shortcuts-category">
        <div class="shortcuts-category__title">
          <span class="shortcuts-category__title-icon">👁️</span>
          View & Interface
        </div>
        <div class="shortcuts-list">
          <div class="shortcut-item">
            <span class="shortcut-item__description">Toggle List / Grid view</span>
            <div class="shortcut-item__keys">
              <span class="shortcut-key shortcut-key--accent">V</span>
            </div>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-item__description">Toggle dark / light theme</span>
            <div class="shortcut-item__keys">
              <span class="shortcut-key shortcut-key--accent">T</span>
            </div>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-item__description">Show this shortcuts panel</span>
            <div class="shortcut-item__keys">
              <span class="shortcut-key shortcut-key--accent">?</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="shortcuts-panel__footer">
      <div class="shortcuts-panel__footer-hint">
        Press <span class="shortcut-key">?</span> anytime to toggle this panel
      </div>
    </div>
  </div>

  <!-- SHORTCUT FEEDBACK INDICATOR -->
  <div class="shortcut-feedback" id="shortcutFeedback">
    <div class="shortcut-feedback__key" id="feedbackKey">S</div>
    <div class="shortcut-feedback__action" id="feedbackAction">Added to Set</div>
  </div>

  <!-- RECENT DOWNLOADS LEFT PANEL -->
  <div class="recent-panel" id="recentPanel">
    <div class="recent-panel__header">
      <div>
        <div class="recent-panel__title">Recent Downloads</div>
        <div class="recent-panel__subtitle">Last 30 days</div>
      </div>
      <button class="recent-panel__close" onclick="toggleRecentPanel()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><path d="M18 6 6 18M6 6l12 12"/></svg>
      </button>
    </div>
    <div class="recent-panel__content">
      <div class="recent-panel__list" id="recentPanelList">
        <!-- Populated by JS -->
      </div>
    </div>
    <div class="recent-panel__footer">
      Downloads within 30 days count toward your monthly limit
    </div>
  </div>

  <!-- SLIDE PANEL (Browse/Charts/Playlists) -->
  <div class="slide-panel" id="slidePanel">
    <div class="slide-panel__header">
      <h2 class="slide-panel__title" id="slidePanelTitle">See All</h2>
      <button class="slide-panel__close" onclick="closeSlidePanel()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><path d="M18 6 6 18M6 6l12 12"/></svg>
      </button>
    </div>
    <div class="slide-panel__content">
      <div class="slide-panel__grid" id="slidePanelGrid">
        <!-- Populated by JS -->
      </div>
    </div>
  </div>

  <!-- REQUEST FORM PANEL -->
  <div class="request-panel" id="requestPanel">
    <div class="request-panel__header">
      <h2 class="request-panel__title">Request</h2>
      <button class="request-panel__close" onclick="toggleRequestPanel()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><path d="M18 6 6 18M6 6l12 12"/></svg>
      </button>
    </div>
    <div class="request-panel__content">
      <form class="request-form" id="requestForm" onsubmit="submitRequest(event)">
        <div class="form-group">
          <label class="form-label">Request Type</label>
          <select class="form-select" id="requestType" required>
            <option value="">Select type...</option>
            <option value="song">Song Request</option>
            <option value="feature">Feature Request</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Your Email</label>
          <input type="email" class="form-input" id="requestEmail" placeholder="your@email.com" required>
        </div>

        <div class="form-group" id="songFields" style="display: none;">
          <label class="form-label">Song Title</label>
          <input type="text" class="form-input" id="songTitle" placeholder="Song title">
          <label class="form-label" style="margin-top: 12px;">Artist Name</label>
          <input type="text" class="form-input" id="artistName" placeholder="Artist name">
        </div>

        <div class="form-group">
          <label class="form-label">Details</label>
          <textarea class="form-textarea" id="requestDetails" placeholder="Tell us more about your request..." required></textarea>
        </div>

        <button type="submit" class="form-submit">Submit Request</button>
      </form>

      <div class="form-success" id="requestSuccess">
        <div class="form-success__icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
        </div>
        <div class="form-success__title">Thank You!</div>
        <div class="form-success__message">We appreciate your feedback. We'll make our best efforts to accommodate reasonable requests, but fulfillment is not guaranteed. Your request has been sent to our team.</div>
      </div>
    </div>
  </div>

  <!-- BACKDROP -->
  <div class="backdrop" id="backdrop" onclick="closeAllModals()"></div>

  <!-- TOAST CONTAINER -->
  <div class="toast-container" id="toastContainer"></div>

  <script>
    // ============================================
    // DATA - Sample tracks for the library
    // Quality levels: 320p, 480p, 720p, 1080p, 4K
    // Aspect ratios: 16:9 (standard), 4:3 (legacy), 1:1 (square/social)
    // Tracks include genre and subgenre for dynamic menu building
    // ============================================
    const sampleTracks = [
      { id: 1, title: 'Espresso', artist: 'Sabrina Carpenter', bpm: 126, key: '5A', duration: '3:42', quality: '1080p', aspect: '16:9', genre: 'Pop', subgenre: 'Dance Pop', label: 'Island Records', isNew: true },
      { id: 2, title: 'Not Like Us', artist: 'Kendrick Lamar', bpm: 100, key: '8A', duration: '4:34', quality: '1080p', aspect: '16:9', genre: 'Hip-Hop', subgenre: 'West Coast', label: 'pgLang/Interscope', isHot: true },
      { id: 3, title: 'Beautiful Things', artist: 'Benson Boone', bpm: 110, key: '3B', duration: '3:00', quality: '720p', aspect: '16:9', genre: 'Pop', subgenre: 'Indie Pop', label: 'Night Street/Warner', isNew: true },
      { id: 4, title: 'Lovin On Me', artist: 'Jack Harlow', bpm: 116, key: '11B', duration: '2:18', quality: '1080p', aspect: '16:9', genre: 'Hip-Hop', subgenre: 'Trap', label: 'Generation Now/Atlantic' },
      { id: 5, title: 'Too Sweet', artist: 'Hozier', bpm: 62, key: '9B', duration: '4:12', quality: '4K', aspect: '16:9', genre: 'Pop', subgenre: 'Indie Pop', label: 'Island Records/Columbia' },
      { id: 6, title: "We Can't Be Friends", artist: 'Ariana Grande', bpm: 118, key: '1A', duration: '4:16', quality: '1080p', aspect: '16:9', genre: 'Pop', subgenre: 'Dance Pop', label: 'Republic Records', isNew: true },
      { id: 7, title: 'I Had Some Help', artist: 'Post Malone ft. Morgan Wallen', bpm: 108, key: '6B', duration: '3:02', quality: '720p', aspect: '16:9', genre: 'Country', subgenre: 'Country Pop', label: 'Mercury/Republic', isHot: true },
      { id: 8, title: 'Million Dollar Baby', artist: 'Tommy Richman', bpm: 104, key: '2B', duration: '2:31', quality: '1080p', genre: 'Pop', subgenre: 'R&B Pop', label: 'ISO Supremacy/PULSE' },
      { id: 9, title: 'Birds of a Feather', artist: 'Billie Eilish', bpm: 105, key: '8B', duration: '3:30', quality: '4K', genre: 'Pop', subgenre: 'Alternative Pop', label: 'Darkroom/Interscope' },
      { id: 10, title: 'Bonita', artist: 'Daddy Yankee', bpm: 96, key: '4A', duration: '3:25', quality: '1080p', genre: 'Latin', subgenre: 'Reggaeton', label: 'El Cartel Records', isNew: true },
      { id: 11, title: 'La Bebe', artist: 'Yng Lvcas & Peso Pluma', bpm: 92, key: '1B', duration: '3:45', quality: '1080p', genre: 'Latin', subgenre: 'Regional Mexican', label: 'Double P Records', isHot: true },
      { id: 12, title: 'Bellakeo', artist: 'Peso Pluma & Anitta', bpm: 100, key: '6A', duration: '2:55', quality: '720p', genre: 'Latin', subgenre: 'Reggaeton', label: 'Double P Records' },
      { id: 13, title: 'Good Luck, Babe!', artist: 'Chappell Roan', bpm: 110, key: '7A', duration: '3:38', quality: '1080p', genre: 'Pop', subgenre: 'Synth Pop', label: 'Island Records', isNew: true },
      { id: 14, title: 'Lose Control', artist: 'Teddy Swims', bpm: 97, key: '10B', duration: '3:28', quality: '1080p', genre: 'R&B', subgenre: 'Soul', label: 'Warner Records' },
      { id: 15, title: 'Water', artist: 'Tyla', bpm: 114, key: '12A', duration: '3:20', quality: '4K', genre: 'R&B', subgenre: 'Afrobeats', label: 'Epic/Fax Records', isHot: true },
      { id: 16, title: 'Houdini', artist: 'Eminem', bpm: 140, key: '5B', duration: '4:22', quality: '1080p', genre: 'Hip-Hop', subgenre: 'Rap', label: 'Shady/Aftermath/Interscope', isNew: true },
      { id: 17, title: 'Pink Skies', artist: 'Zach Bryan', bpm: 86, key: '3A', duration: '4:05', quality: '720p', genre: 'Country', subgenre: 'Americana', label: 'Warner Records' },
      { id: 18, title: 'Saturn', artist: 'SZA', bpm: 130, key: '9A', duration: '3:15', quality: '1080p', genre: 'R&B', subgenre: 'Alternative R&B', label: 'Top Dawg/RCA' },
      { id: 19, title: 'Stick Season', artist: 'Noah Kahan', bpm: 98, key: '4B', duration: '3:00', quality: '1080p', genre: 'Pop', subgenre: 'Folk Pop', label: 'Mercury/Republic' },
      { id: 20, title: 'Texas Hold Em', artist: 'Beyonce', bpm: 120, key: '2A', duration: '3:53', quality: '4K', genre: 'Country', subgenre: 'Country Pop', label: 'Parkwood/Columbia', isHot: true },
    ];

    // TRENDING TRACKS - Most downloaded in last 30 days (dynamic, drops off)
    const trendingTracks = [
      { id: 101, title: 'Die With A Smile', artist: 'Lady Gaga & Bruno Mars', bpm: 158, key: '6B', duration: '4:12', quality: '1080p', genre: 'Pop', subgenre: 'Ballad', label: 'Interscope/Atlantic', downloads: 15420, isHot: true },
      { id: 102, title: 'APT.', artist: 'ROSE & Bruno Mars', bpm: 148, key: '4A', duration: '2:50', quality: '1080p', genre: 'Pop', subgenre: 'K-Pop', label: 'Atlantic Records', downloads: 12300, isHot: true },
      { id: 103, title: 'BIRDS OF A FEATHER', artist: 'Billie Eilish', bpm: 105, key: '8B', duration: '3:30', quality: '4K', genre: 'Pop', subgenre: 'Alternative Pop', label: 'Darkroom/Interscope', downloads: 11850 },
      { id: 104, title: 'Taste', artist: 'Sabrina Carpenter', bpm: 111, key: '11A', duration: '2:37', quality: '1080p', genre: 'Pop', subgenre: 'Dance Pop', label: 'Island Records', downloads: 10200 },
      { id: 105, title: 'Too Sweet', artist: 'Hozier', bpm: 62, key: '9B', duration: '4:12', quality: '1080p', genre: 'Pop', subgenre: 'Indie Pop', label: 'Island Records/Columbia', downloads: 9800 },
      { id: 106, title: 'A Bar Song (Tipsy)', artist: 'Shaboozey', bpm: 82, key: '2A', duration: '3:50', quality: '720p', genre: 'Country', subgenre: 'Country Pop', label: 'American Dogwood/Republic', downloads: 9500, isHot: true },
      { id: 107, title: 'Please Please Please', artist: 'Sabrina Carpenter', bpm: 107, key: '1B', duration: '3:06', quality: '1080p', genre: 'Pop', subgenre: 'Dance Pop', label: 'Island Records', downloads: 8900 },
      { id: 108, title: 'Lose Control', artist: 'Teddy Swims', bpm: 97, key: '10B', duration: '3:28', quality: '1080p', genre: 'R&B', subgenre: 'Soul', label: 'Warner Records', downloads: 8400 },
      { id: 109, title: 'MILLION DOLLAR BABY', artist: 'Tommy Richman', bpm: 104, key: '2B', duration: '2:31', quality: '720p', genre: 'Pop', subgenre: 'R&B Pop', label: 'ISO Supremacy/PULSE', downloads: 7900 },
      { id: 110, title: 'Not Like Us', artist: 'Kendrick Lamar', bpm: 100, key: '8A', duration: '4:34', quality: '1080p', genre: 'Hip-Hop', subgenre: 'West Coast', label: 'pgLang/Interscope', downloads: 7500, isHot: true },
    ];

    // LATEST TRACKS - Added in last 30 days (dynamic, drops off)
    const latestTracks = [
      { id: 201, title: 'Moonlit Floor', artist: 'Lisa', bpm: 115, key: '3A', duration: '3:22', quality: '1080p', genre: 'Pop', subgenre: 'K-Pop', label: 'LLOUD/RCA', isNew: true, addedDate: '2026-01-14' },
      { id: 202, title: 'LUNCH', artist: 'Billie Eilish', bpm: 110, key: '6A', duration: '2:59', quality: '4K', genre: 'Pop', subgenre: 'Alternative Pop', label: 'Darkroom/Interscope', isNew: true, addedDate: '2026-01-13' },
      { id: 203, title: 'Nasty', artist: 'Tinashe', bpm: 108, key: '9B', duration: '3:21', quality: '1080p', genre: 'R&B', subgenre: 'Pop R&B', label: 'Nice Life/RCA', isNew: true, addedDate: '2026-01-12' },
      { id: 204, title: 'Guess', artist: 'Charli XCX ft. Billie Eilish', bpm: 130, key: '5A', duration: '2:42', quality: '1080p', genre: 'Pop', subgenre: 'Hyperpop', label: 'Atlantic Records', isNew: true, addedDate: '2026-01-11' },
      { id: 205, title: '360', artist: 'Charli XCX', bpm: 135, key: '8B', duration: '2:13', quality: '720p', genre: 'Pop', subgenre: 'Hyperpop', label: 'Atlantic Records', isNew: true, addedDate: '2026-01-10' },
      { id: 206, title: 'HOT TO GO!', artist: 'Chappell Roan', bpm: 132, key: '4B', duration: '3:05', quality: '1080p', genre: 'Pop', subgenre: 'Synth Pop', label: 'Island Records', isNew: true, addedDate: '2026-01-09' },
      { id: 207, title: 'Austin', artist: 'Dasha', bpm: 144, key: '7A', duration: '2:40', quality: '720p', genre: 'Country', subgenre: 'Country Pop', label: 'Warner Music Nashville', isNew: true, addedDate: '2026-01-08' },
      { id: 208, title: 'Beautiful Things', artist: 'Benson Boone', bpm: 110, key: '3B', duration: '3:00', quality: '1080p', genre: 'Pop', subgenre: 'Indie Pop', label: 'Night Street/Warner', isNew: true, addedDate: '2026-01-07' },
      { id: 209, title: 'Si Antes Te Hubiera Conocido', artist: 'Karol G', bpm: 128, key: '1A', duration: '3:15', quality: '1080p', genre: 'Latin', subgenre: 'Reggaeton', label: 'Universal Music Latin', isNew: true, addedDate: '2026-01-06' },
      { id: 210, title: 'Feather', artist: 'Sabrina Carpenter', bpm: 100, key: '10A', duration: '3:06', quality: '1080p', genre: 'Pop', subgenre: 'Dance Pop', label: 'Island Records', isNew: true, addedDate: '2026-01-05' },
    ];

    // FOR YOU TRACKS - Popular chart hits until user has enough download history
    // In production: Connect to iTunes RSS API (free): https://rss.applmusic.com/api/v1/us/music/most-played/100/songs.json
    // For now: Hardcoded Billboard/iTunes chart data
    const forYouTracks = [
      { id: 301, title: 'Die With A Smile', artist: 'Lady Gaga & Bruno Mars', bpm: 158, key: '6B', duration: '4:12', quality: '1080p', genre: 'Pop', subgenre: 'Ballad', label: 'Interscope/Atlantic', isHot: true },
      { id: 302, title: 'APT.', artist: 'ROSE & Bruno Mars', bpm: 148, key: '4A', duration: '2:50', quality: '4K', genre: 'Pop', subgenre: 'K-Pop', label: 'Atlantic Records', isHot: true },
      { id: 303, title: 'Taste', artist: 'Sabrina Carpenter', bpm: 111, key: '11A', duration: '2:37', quality: '1080p', genre: 'Pop', subgenre: 'Dance Pop', label: 'Island Records', isNew: true },
      { id: 304, title: 'A Bar Song (Tipsy)', artist: 'Shaboozey', bpm: 82, key: '2A', duration: '3:50', quality: '1080p', genre: 'Country', subgenre: 'Country Pop', label: 'American Dogwood/Republic', isHot: true },
      { id: 305, title: 'Espresso', artist: 'Sabrina Carpenter', bpm: 126, key: '5A', duration: '3:42', quality: '1080p', genre: 'Pop', subgenre: 'Dance Pop', label: 'Island Records' },
      { id: 306, title: 'BIRDS OF A FEATHER', artist: 'Billie Eilish', bpm: 105, key: '8B', duration: '3:30', quality: '4K', genre: 'Pop', subgenre: 'Alternative Pop', label: 'Darkroom/Interscope' },
      { id: 307, title: 'Good Luck, Babe!', artist: 'Chappell Roan', bpm: 110, key: '7A', duration: '3:38', quality: '1080p', genre: 'Pop', subgenre: 'Synth Pop', label: 'Island Records', isNew: true },
      { id: 308, title: 'Lose Control', artist: 'Teddy Swims', bpm: 97, key: '10B', duration: '3:28', quality: '1080p', genre: 'R&B', subgenre: 'Soul', label: 'Warner Records' },
      { id: 309, title: 'Please Please Please', artist: 'Sabrina Carpenter', bpm: 107, key: '1B', duration: '3:06', quality: '1080p', genre: 'Pop', subgenre: 'Dance Pop', label: 'Island Records' },
      { id: 310, title: 'Not Like Us', artist: 'Kendrick Lamar', bpm: 100, key: '8A', duration: '4:34', quality: '1080p', genre: 'Hip-Hop', subgenre: 'West Coast', label: 'pgLang/Interscope', isHot: true },
    ]

    // THROWBACK TRACKS - Classic hits by era with varying quality (older = lower quality)
    const throwbackTracks = [
      // 80s Classics (mostly 480p transfers)
      { id: 401, title: 'Billie Jean', artist: 'Michael Jackson', bpm: 117, key: '4A', duration: '4:54', quality: '480p', aspect: '4:3', genre: 'Throwbacks', subgenre: '80s Classics', label: 'Epic Records' },
      { id: 402, title: 'Take On Me', artist: 'a-ha', bpm: 169, key: '1A', duration: '3:46', quality: '480p', aspect: '4:3', genre: 'Throwbacks', subgenre: '80s Classics', label: 'Warner Bros' },
      { id: 403, title: 'Sweet Child O Mine', artist: "Guns N' Roses", bpm: 125, key: '4B', duration: '5:56', quality: '720p', aspect: '4:3', genre: 'Throwbacks', subgenre: '80s Classics', label: 'Geffen Records' },
      { id: 404, title: 'Purple Rain', artist: 'Prince', bpm: 113, key: '6B', duration: '8:41', quality: '480p', aspect: '4:3', genre: 'Throwbacks', subgenre: '80s Classics', label: 'Warner Bros' },
      // 90s Hits (mostly 480p-720p)
      { id: 405, title: 'Smells Like Teen Spirit', artist: 'Nirvana', bpm: 117, key: '6A', duration: '5:01', quality: '720p', aspect: '4:3', genre: 'Throwbacks', subgenre: '90s Hits', label: 'DGC Records' },
      { id: 406, title: 'Waterfalls', artist: 'TLC', bpm: 87, key: '3B', duration: '4:39', quality: '480p', aspect: '4:3', genre: 'Throwbacks', subgenre: '90s Hits', label: 'LaFace Records' },
      { id: 407, title: 'No Diggity', artist: 'Blackstreet ft. Dr. Dre', bpm: 89, key: '5A', duration: '5:00', quality: '480p', aspect: '4:3', genre: 'Throwbacks', subgenre: '90s Hits', label: 'Interscope' },
      { id: 408, title: 'California Love', artist: '2Pac ft. Dr. Dre', bpm: 92, key: '11A', duration: '4:45', quality: '720p', aspect: '4:3', genre: 'Throwbacks', subgenre: '90s Hits', label: 'Death Row Records' },
      // 2000s Bangers (mostly 720p-1080p)
      { id: 409, title: 'In Da Club', artist: '50 Cent', bpm: 89, key: '10B', duration: '3:42', quality: '720p', aspect: '16:9', genre: 'Throwbacks', subgenre: '2000s Bangers', label: 'Shady/Aftermath/Interscope' },
      { id: 410, title: 'Crazy In Love', artist: 'Beyonce ft. Jay-Z', bpm: 99, key: '4A', duration: '3:56', quality: '720p', aspect: '16:9', genre: 'Throwbacks', subgenre: '2000s Bangers', label: 'Columbia Records' },
      { id: 411, title: 'Yeah!', artist: 'Usher ft. Lil Jon', bpm: 105, key: '12A', duration: '4:10', quality: '720p', aspect: '16:9', genre: 'Throwbacks', subgenre: '2000s Bangers', label: 'Arista Records' },
      { id: 412, title: 'Get Low', artist: 'Lil Jon & The East Side Boyz', bpm: 137, key: '1A', duration: '6:02', quality: '480p', aspect: '4:3', genre: 'Throwbacks', subgenre: '2000s Bangers', label: 'TVT Records' },
      // 2010s Anthems (mostly 1080p)
      { id: 413, title: 'Uptown Funk', artist: 'Bruno Mars ft. Mark Ronson', bpm: 115, key: '4A', duration: '4:30', quality: '1080p', aspect: '16:9', genre: 'Throwbacks', subgenre: '2010s Anthems', label: 'Atlantic Records' },
      { id: 414, title: 'Happy', artist: 'Pharrell Williams', bpm: 160, key: '6A', duration: '3:53', quality: '1080p', aspect: '16:9', genre: 'Throwbacks', subgenre: '2010s Anthems', label: 'Back Lot Music/Columbia' },
      { id: 415, title: 'Can\'t Stop The Feeling', artist: 'Justin Timberlake', bpm: 113, key: '7B', duration: '4:00', quality: '1080p', aspect: '16:9', genre: 'Throwbacks', subgenre: '2010s Anthems', label: 'RCA Records' },
      { id: 416, title: 'Blinding Lights', artist: 'The Weeknd', bpm: 171, key: '6A', duration: '3:20', quality: '4K', aspect: '16:9', genre: 'Throwbacks', subgenre: '2010s Anthems', label: 'XO/Republic' },
    ];

    // REMIX TRACKS - Club versions, extended mixes, mashups
    const remixTracks = [
      { id: 501, title: 'Espresso (Club Mix)', artist: 'Sabrina Carpenter', bpm: 128, key: '5A', duration: '5:42', quality: '1080p', aspect: '16:9', genre: 'Remixes', subgenre: 'Club Remixes', label: 'Island Records' },
      { id: 502, title: 'Die With A Smile (Extended)', artist: 'Lady Gaga & Bruno Mars', bpm: 158, key: '6B', duration: '6:30', quality: '1080p', aspect: '16:9', genre: 'Remixes', subgenre: 'Extended Mixes', label: 'Interscope/Atlantic' },
      { id: 503, title: 'APT. (Dance Remix)', artist: 'ROSE & Bruno Mars', bpm: 130, key: '4A', duration: '4:15', quality: '1080p', aspect: '16:9', genre: 'Remixes', subgenre: 'Club Remixes', label: 'Atlantic Records' },
      { id: 504, title: 'Taste vs Please (Mashup)', artist: 'Sabrina Carpenter', bpm: 109, key: '11A', duration: '4:02', quality: '720p', aspect: '16:9', genre: 'Remixes', subgenre: 'Mashups', label: 'Video Pool Exclusive' },
      { id: 505, title: 'Lose Control (Sped Up)', artist: 'Teddy Swims', bpm: 112, key: '10B', duration: '2:45', quality: '1080p', aspect: '16:9', genre: 'Remixes', subgenre: 'Radio Edits', label: 'Warner Records' },
      { id: 506, title: 'Water (Afro House Remix)', artist: 'Tyla', bpm: 122, key: '12A', duration: '5:20', quality: '1080p', aspect: '16:9', genre: 'Remixes', subgenre: 'Club Remixes', label: 'Epic/Fax Records' },
      { id: 507, title: 'Good Luck Babe (Slowed)', artist: 'Chappell Roan', bpm: 85, key: '7A', duration: '4:38', quality: '720p', aspect: '16:9', genre: 'Remixes', subgenre: 'Radio Edits', label: 'Island Records' },
      { id: 508, title: 'Not Like Us (Dirty South Mix)', artist: 'Kendrick Lamar', bpm: 128, key: '8A', duration: '5:44', quality: '1080p', aspect: '16:9', genre: 'Remixes', subgenre: 'Club Remixes', label: 'pgLang/Interscope' },
    ];

    // Legacy/Archived content with lower quality (for demo purposes)
    const legacyTracks = [
      { id: 601, title: 'Thriller', artist: 'Michael Jackson', bpm: 118, key: '5A', duration: '5:57', quality: '320p', aspect: '4:3', genre: 'Throwbacks', subgenre: '80s Classics', label: 'Epic Records' },
      { id: 602, title: 'Video Killed The Radio Star', artist: 'The Buggles', bpm: 133, key: '11A', duration: '4:12', quality: '320p', aspect: '4:3', genre: 'Throwbacks', subgenre: '80s Classics', label: 'Island Records' },
      { id: 603, title: 'Push It', artist: 'Salt-N-Pepa', bpm: 130, key: '9B', duration: '4:28', quality: '320p', aspect: '4:3', genre: 'Throwbacks', subgenre: '80s Classics', label: 'Next Plateau' },
    ];

    const recentDownloads = [
      { id: 1, title: 'Espresso', artist: 'Sabrina Carpenter', bpm: 126, key: '5A', date: '2 hours ago', downloadCount: 3 },
      { id: 6, title: "We Can't Be Friends", artist: 'Ariana Grande', bpm: 118, key: '1A', date: '5 hours ago', downloadCount: 1 },
      { id: 2, title: 'Not Like Us', artist: 'Kendrick Lamar', bpm: 100, key: '8A', date: 'Yesterday', downloadCount: 2 },
      { id: 15, title: 'Water', artist: 'Tyla', bpm: 114, key: '12A', date: 'Yesterday', downloadCount: 1 },
      { id: 20, title: 'Texas Hold Em', artist: 'Beyonce', bpm: 120, key: '2A', date: '2 days ago', downloadCount: 1 },
      { id: 10, title: 'Bonita', artist: 'Daddy Yankee', bpm: 96, key: '4A', date: '3 days ago', downloadCount: 2 },
      { id: 14, title: 'Lose Control', artist: 'Teddy Swims', bpm: 97, key: '10B', date: '3 days ago', downloadCount: 1 },
      { id: 3, title: 'Beautiful Things', artist: 'Benson Boone', bpm: 110, key: '3B', date: '4 days ago', downloadCount: 1 },
      { id: 9, title: 'Birds of a Feather', artist: 'Billie Eilish', bpm: 105, key: '8B', date: '5 days ago', downloadCount: 1 },
      { id: 16, title: 'Houdini', artist: 'Eminem', bpm: 140, key: '5B', date: '1 week ago', downloadCount: 1 },
      { id: 11, title: 'La Bebe', artist: 'Yng Lvcas & Peso Pluma', bpm: 92, key: '1B', date: '1 week ago', downloadCount: 1 },
      { id: 13, title: 'Good Luck, Babe!', artist: 'Chappell Roan', bpm: 110, key: '7A', date: '1 week ago', downloadCount: 1 },
      { id: 4, title: 'Lovin On Me', artist: 'Jack Harlow', bpm: 116, key: '11B', date: '2 weeks ago', downloadCount: 2 },
      { id: 7, title: 'I Had Some Help', artist: 'Post Malone ft. Morgan Wallen', bpm: 108, key: '6B', date: '2 weeks ago', downloadCount: 1 },
      { id: 8, title: 'Million Dollar Baby', artist: 'Tommy Richman', bpm: 104, key: '2B', date: '3 weeks ago', downloadCount: 1 },
    ];

    // State
    let currentView = localStorage.getItem('tvp-view') || 'grid';
    let selectedTracks = new Set();
    let setBuilderTracks = JSON.parse(localStorage.getItem('tvp-set') || '[]');
    let recentExpanded = false;

    // ============================================
    // INITIALIZATION
    // ============================================
    document.addEventListener('DOMContentLoaded', () => {
      loadSectionOrder();
      initView();
      renderTracks();
      renderRecentDownloads();
      renderRecentPanel();
      renderGridSections();
      updateSetBuilder();
      loadTheme();
      initDragDrop();
      initGenreMegaMenus();
      updateDynamicSubgenres();
      initLayoutPresets();
      initSearch();
    });

    // ============================================
    // DYNAMIC SEARCH WITH AUTOCOMPLETE
    // Searchable fields: artist, title, label (first/last name)
    // NOT searchable: BPM, Key, Duration, Quality, Genre
    // ============================================
    let searchDebounceTimer = null;
    let selectedSearchIndex = -1;
    let currentSearchResults = [];

    function initSearch() {
      const searchInput = document.getElementById('mainSearch');
      const dropdown = document.getElementById('searchDropdown');

      searchInput.addEventListener('input', (e) => {
        clearTimeout(searchDebounceTimer);
        searchDebounceTimer = setTimeout(() => {
          performSearch(e.target.value.trim());
        }, 200); // 200ms debounce
      });

      searchInput.addEventListener('focus', () => {
        if (searchInput.value.trim().length >= 2) {
          dropdown.classList.add('search-dropdown--visible');
        }
      });

      searchInput.addEventListener('keydown', (e) => {
        if (!dropdown.classList.contains('search-dropdown--visible')) return;

        if (e.key === 'ArrowDown') {
          e.preventDefault();
          selectedSearchIndex = Math.min(selectedSearchIndex + 1, currentSearchResults.length - 1);
          updateSearchSelection();
        } else if (e.key === 'ArrowUp') {
          e.preventDefault();
          selectedSearchIndex = Math.max(selectedSearchIndex - 1, 0);
          updateSearchSelection();
        } else if (e.key === 'Enter' && selectedSearchIndex >= 0) {
          e.preventDefault();
          const selected = currentSearchResults[selectedSearchIndex];
          if (selected) {
            openPreviewModal(selected.id);
            closeSearchDropdown();
          }
        } else if (e.key === 'Escape') {
          closeSearchDropdown();
        }
      });

      // Close dropdown when clicking outside
      document.addEventListener('click', (e) => {
        if (!e.target.closest('.search-bar')) {
          closeSearchDropdown();
        }
      });
    }

    function performSearch(query) {
      const dropdown = document.getElementById('searchDropdown');

      if (query.length < 2) {
        closeSearchDropdown();
        return;
      }

      const allTracks = [...sampleTracks, ...trendingTracks, ...latestTracks, ...forYouTracks, ...throwbackTracks, ...remixTracks, ...legacyTracks];
      const lowerQuery = query.toLowerCase();

      // Search by title, artist (full name, first name, last name), and label
      const results = allTracks.filter(track => {
        const titleMatch = track.title.toLowerCase().includes(lowerQuery);
        const artistMatch = track.artist.toLowerCase().includes(lowerQuery);
        const labelMatch = track.label && track.label.toLowerCase().includes(lowerQuery);

        // Split artist name for first/last name search
        const artistParts = track.artist.toLowerCase().split(/[\s&,]+/);
        const namePartMatch = artistParts.some(part => part.startsWith(lowerQuery));

        return titleMatch || artistMatch || labelMatch || namePartMatch;
      }).slice(0, 10); // Limit to 10 results

      currentSearchResults = results;
      selectedSearchIndex = -1;

      if (results.length === 0) {
        dropdown.innerHTML = `<div class="search-dropdown__empty">No results for "${query}"</div>`;
        dropdown.classList.add('search-dropdown--visible');
        return;
      }

      // Group results by match type
      const songs = results.filter(t => t.title.toLowerCase().includes(lowerQuery));
      const artists = results.filter(t => !t.title.toLowerCase().includes(lowerQuery) && t.artist.toLowerCase().includes(lowerQuery));
      const labels = results.filter(t => !t.title.toLowerCase().includes(lowerQuery) && !t.artist.toLowerCase().includes(lowerQuery));

      let html = '';

      if (songs.length > 0) {
        html += `<div class="search-dropdown__section">
          <div class="search-dropdown__label">Songs</div>
          ${songs.map((t, i) => renderSearchItem(t, query, i)).join('')}
        </div>`;
      }

      if (artists.length > 0) {
        html += `<div class="search-dropdown__section">
          <div class="search-dropdown__label">Artists</div>
          ${artists.map((t, i) => renderSearchItem(t, query, songs.length + i)).join('')}
        </div>`;
      }

      if (labels.length > 0) {
        html += `<div class="search-dropdown__section">
          <div class="search-dropdown__label">Labels</div>
          ${labels.map((t, i) => renderSearchItem(t, query, songs.length + artists.length + i)).join('')}
        </div>`;
      }

      dropdown.innerHTML = html;
      dropdown.classList.add('search-dropdown--visible');
    }

    function renderSearchItem(track, query, index) {
      const highlightText = (text, query) => {
        const regex = new RegExp(`(${query})`, 'gi');
        return text.replace(regex, '<mark>$1</mark>');
      };

      return `
        <div class="search-dropdown__item" data-index="${index}" onclick="openPreviewModal(${track.id}); closeSearchDropdown();">
          <div class="search-dropdown__thumb">
            <img src="https://picsum.photos/80/80?random=${track.id}" alt="">
          </div>
          <div class="search-dropdown__info">
            <div class="search-dropdown__title">${highlightText(track.title, query)}</div>
            <div class="search-dropdown__meta">${highlightText(track.artist, query)} ${track.label ? '· ' + highlightText(track.label, query) : ''}</div>
          </div>
          <span class="search-dropdown__type">${track.genre || 'Track'}</span>
        </div>
      `;
    }

    function updateSearchSelection() {
      const items = document.querySelectorAll('.search-dropdown__item');
      items.forEach((item, i) => {
        item.classList.toggle('search-dropdown__item--selected', i === selectedSearchIndex);
      });

      // Scroll selected item into view
      if (selectedSearchIndex >= 0 && items[selectedSearchIndex]) {
        items[selectedSearchIndex].scrollIntoView({ block: 'nearest' });
      }
    }

    function closeSearchDropdown() {
      const dropdown = document.getElementById('searchDropdown');
      dropdown.classList.remove('search-dropdown--visible');
      selectedSearchIndex = -1;
    }

    function loadTheme() {
      if (localStorage.getItem('tvp-theme') === 'light') {
        document.documentElement.classList.add('light');
      }
    }

    function toggleTheme() {
      document.documentElement.classList.toggle('light');
      localStorage.setItem('tvp-theme', document.documentElement.classList.contains('light') ? 'light' : 'dark');
    }

    // ============================================
    // RECENT DOWNLOADS PANEL (LEFT)
    // ============================================
    function toggleRecentPanel() {
      const panel = document.getElementById('recentPanel');
      const btn = document.getElementById('recentBtn');
      const backdrop = document.getElementById('backdrop');

      panel.classList.toggle('recent-panel--open');
      btn.classList.toggle('recent-btn--active');

      if (panel.classList.contains('recent-panel--open')) {
        backdrop.classList.add('backdrop--visible');
      } else {
        backdrop.classList.remove('backdrop--visible');
      }
    }

    function renderRecentPanel() {
      const container = document.getElementById('recentPanelList');
      container.innerHTML = recentDownloads.map((track, index) => `
        <div class="recent-panel__item" onclick="openPreviewModal(${track.id})">
          <div class="recent-panel__item-thumb">
            <img src="https://picsum.photos/112/64?random=${track.id + 300}" alt="">
          </div>
          <div class="recent-panel__item-info">
            <div class="recent-panel__item-title">${track.title}</div>
            <div class="recent-panel__item-meta">
              <span>${track.artist}</span>
              <span>${track.bpm} BPM</span>
              <span>${track.key}</span>
            </div>
          </div>
          <div class="recent-panel__item-date">${track.date}</div>
          ${track.downloadCount >= 2 ? `
            <div class="recent-panel__item-warning">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
              ${track.downloadCount}x
            </div>
          ` : ''}
        </div>
      `).join('');

      // Update badge count
      document.getElementById('recentBtnBadge').textContent = recentDownloads.length;
    }

    // ============================================
    // SLIDE PANEL (Browse/Charts/Playlists)
    // ============================================
    function setActiveNav(el) {
      document.querySelectorAll('.nav__link').forEach(link => link.classList.remove('nav__link--active'));
      el.classList.add('nav__link--active');
    }

    function openSlidePanel(title, type) {
      document.getElementById('slidePanelTitle').textContent = title;
      document.getElementById('slidePanel').classList.add('slide-panel--open');
      document.getElementById('backdrop').classList.add('backdrop--visible');

      // Render content based on type
      const grid = document.getElementById('slidePanelGrid');
      const tracks = type === 'new' ? sampleTracks.filter(t => t.isNew) :
                     type === 'charts' ? sampleTracks.filter(t => t.isHot) :
                     sampleTracks.slice(0, 10);

      grid.innerHTML = tracks.map(track => `
        <div class="video-card" onclick="openPreviewModal(${track.id})">
          <div class="video-card__thumb">
            <img src="https://picsum.photos/480/270?random=${track.id + 100}" alt="">
            <div class="video-card__overlay">
              <div class="video-card__play">
                <svg viewBox="0 0 24 24" fill="currentColor"><polygon points="5,3 19,12 5,21"/></svg>
              </div>
            </div>
            <span class="video-card__quality video-card__quality--${track.quality === '4K' ? '4k' : 'hd'}">${track.quality}</span>
            <span class="video-card__duration">${track.duration}</span>
          </div>
          <div class="video-card__content">
            <div class="video-card__title">${track.title}</div>
            <div class="video-card__artist">${track.artist}</div>
            <div class="video-card__meta">
              <span>${track.bpm} BPM</span>
              <span>${track.key}</span>
            </div>
          </div>
        </div>
      `).join('');
    }

    function closeSlidePanel() {
      document.getElementById('slidePanel').classList.remove('slide-panel--open');
      document.getElementById('backdrop').classList.remove('backdrop--visible');
    }

    // ============================================
    // REQUEST PANEL
    // ============================================
    function toggleRequestPanel() {
      const panel = document.getElementById('requestPanel');
      const backdrop = document.getElementById('backdrop');

      panel.classList.toggle('request-panel--open');

      if (panel.classList.contains('request-panel--open')) {
        backdrop.classList.add('backdrop--visible');
        // Reset form when opening
        document.getElementById('requestForm').style.display = 'flex';
        document.getElementById('requestSuccess').classList.remove('form-success--visible');
        document.getElementById('requestForm').reset();
        document.getElementById('songFields').style.display = 'none';
      } else {
        backdrop.classList.remove('backdrop--visible');
      }
    }

    // Show/hide song fields based on request type
    document.addEventListener('DOMContentLoaded', () => {
      const requestType = document.getElementById('requestType');
      if (requestType) {
        requestType.addEventListener('change', function() {
          const songFields = document.getElementById('songFields');
          songFields.style.display = this.value === 'song' ? 'block' : 'none';
        });
      }
    });

    function submitRequest(event) {
      event.preventDefault();

      const type = document.getElementById('requestType').value;
      const email = document.getElementById('requestEmail').value;
      const details = document.getElementById('requestDetails').value;
      const songTitle = document.getElementById('songTitle').value;
      const artistName = document.getElementById('artistName').value;

      // In production, this would send to info@thevideopool.com via API
      // For now, just show success message
      console.log('Request submitted:', { type, email, songTitle, artistName, details });

      // Hide form, show success
      document.getElementById('requestForm').style.display = 'none';
      document.getElementById('requestSuccess').classList.add('form-success--visible');
    }

    // ============================================
    // GENRE FILTER
    // ============================================
    function filterGenre(genre) {
      // Close any open mega menu
      closeAllGenreMegas();

      // Set active chip
      document.querySelectorAll('.genre-chip').forEach(chip => {
        chip.classList.remove('genre-chip--active');
        if (chip.textContent.trim().startsWith(genre) || (genre === 'All' && chip.textContent.trim() === 'All')) {
          chip.classList.add('genre-chip--active');
        }
      });

      showToast('Genre Filter', `Showing ${genre === 'All' ? 'all genres' : genre}`, 'info');
      // In production, this would filter the tracks
    }

    // Genre Mega Menu - Click to Open (works with overflow scroll)
    let activeGenreMega = null;

    function initGenreMegaMenus() {
      const genreChips = document.querySelectorAll('.genre-chip');

      genreChips.forEach(chip => {
        const mega = chip.querySelector('.genre-mega');
        if (!mega) return; // Skip chips without dropdowns (like "All")

        chip.addEventListener('click', (e) => {
          // Don't toggle if clicking inside mega menu
          if (e.target.closest('.genre-mega')) return;

          e.stopPropagation();
          toggleGenreMega(chip, mega);
        });
      });

      // Close on outside click
      document.addEventListener('click', (e) => {
        if (!e.target.closest('.genre-chip')) {
          closeAllGenreMegas();
        }
      });

      // Close on scroll
      document.querySelector('.genre-nav__inner')?.addEventListener('scroll', closeAllGenreMegas);
    }

    function toggleGenreMega(chip, mega) {
      if (activeGenreMega === mega) {
        closeAllGenreMegas();
        return;
      }

      closeAllGenreMegas();

      // Position the mega menu below the chip
      const rect = chip.getBoundingClientRect();
      mega.style.top = (rect.bottom + 8) + 'px';
      mega.style.left = Math.max(8, rect.left) + 'px';

      // Ensure it doesn't go off-screen right
      const megaWidth = 420;
      if (rect.left + megaWidth > window.innerWidth - 8) {
        mega.style.left = (window.innerWidth - megaWidth - 8) + 'px';
      }

      mega.classList.add('genre-mega--open');
      activeGenreMega = mega;
    }

    function closeAllGenreMegas() {
      document.querySelectorAll('.genre-mega--open').forEach(m => {
        m.classList.remove('genre-mega--open');
      });
      activeGenreMega = null;
    }

    // Build dynamic subgenre counts from all track data
    function buildSubgenreCounts() {
      const allTracks = [...sampleTracks, ...trendingTracks, ...latestTracks, ...forYouTracks, ...throwbackTracks, ...remixTracks, ...legacyTracks];
      const counts = {};

      allTracks.forEach(track => {
        if (track.genre && track.subgenre) {
          if (!counts[track.genre]) counts[track.genre] = {};
          if (!counts[track.genre][track.subgenre]) {
            counts[track.genre][track.subgenre] = 0;
          }
          counts[track.genre][track.subgenre]++;
        }
      });

      return counts;
    }

    // Update mega menu with dynamic subgenre counts
    function updateDynamicSubgenres() {
      const counts = buildSubgenreCounts();

      // For each genre chip with a mega menu, update the counts
      document.querySelectorAll('.genre-chip').forEach(chip => {
        const genreName = chip.textContent.trim().split(' ')[0]; // Get first word (genre name)
        const mega = chip.querySelector('.genre-mega');
        if (!mega || !counts[genreName]) return;

        // Find subgenre items and add counts
        mega.querySelectorAll('.genre-mega__item').forEach(item => {
          const subgenreName = item.textContent.trim().replace(/\s*\(\d+\)$/, ''); // Remove existing count
          const genre = Object.keys(counts).find(g =>
            counts[g][subgenreName] !== undefined
          );

          if (genre && counts[genre][subgenreName]) {
            const count = counts[genre][subgenreName];
            item.textContent = `${subgenreName} (${count})`;
          }
        });
      });
    }

    // ============================================
    // DRAG AND DROP SECTIONS
    // ============================================
    let draggedSection = null;

    function initDragDrop() {
      const main = document.querySelector('.main__content');
      const sections = document.querySelectorAll('.section');
      let dragHandleClicked = false;

      sections.forEach(section => {
        const handle = section.querySelector('.section__drag-handle');
        if (!handle) return;

        // Remove the inline handler and set up proper event listeners
        handle.removeAttribute('onmousedown');

        // Track when handle is clicked
        handle.addEventListener('mousedown', (e) => {
          e.preventDefault();
          dragHandleClicked = true;
          section.setAttribute('draggable', 'true');
          handle.style.cursor = 'grabbing';
          section.classList.add('section--ready-drag');
        });

        // Global mouseup to reset state
        document.addEventListener('mouseup', () => {
          if (dragHandleClicked) {
            dragHandleClicked = false;
            sections.forEach(s => {
              s.setAttribute('draggable', 'false');
              s.classList.remove('section--ready-drag');
              const h = s.querySelector('.section__drag-handle');
              if (h) h.style.cursor = 'grab';
            });
          }
        });

        section.addEventListener('dragstart', (e) => {
          if (!dragHandleClicked) {
            e.preventDefault();
            return;
          }
          draggedSection = section;
          section.classList.add('section--dragging');
          e.dataTransfer.effectAllowed = 'move';
          e.dataTransfer.setData('text/plain', section.id);
          setTimeout(() => { section.style.opacity = '0.4'; }, 0);
        });

        section.addEventListener('dragend', (e) => {
          section.classList.remove('section--dragging', 'section--ready-drag');
          section.style.opacity = '1';
          section.setAttribute('draggable', 'false');
          document.querySelectorAll('.section--drag-over').forEach(s => s.classList.remove('section--drag-over'));
          if (draggedSection) {
            saveSectionOrder();
          }
          draggedSection = null;
          dragHandleClicked = false;
        });

        section.addEventListener('dragover', (e) => {
          e.preventDefault();
          e.dataTransfer.dropEffect = 'move';
          if (draggedSection && draggedSection !== section) {
            section.classList.add('section--drag-over');
          }
        });

        section.addEventListener('dragleave', (e) => {
          if (!section.contains(e.relatedTarget)) {
            section.classList.remove('section--drag-over');
          }
        });

        section.addEventListener('drop', (e) => {
          e.preventDefault();
          section.classList.remove('section--drag-over');
          if (draggedSection && draggedSection !== section) {
            const allSections = [...main.querySelectorAll('.section')];
            const draggedIndex = allSections.indexOf(draggedSection);
            const targetIndex = allSections.indexOf(section);

            if (draggedIndex < targetIndex) {
              section.after(draggedSection);
            } else {
              section.before(draggedSection);
            }
          }
        });
      });
    }

    function saveSectionOrder() {
      const main = document.querySelector('.main__content');
      const order = [...main.querySelectorAll('.section')].map(s => s.id);
      localStorage.setItem('tvp-section-order', JSON.stringify(order));
      showToast('Sections Reordered', 'Your section order has been saved', 'success');
    }

    function loadSectionOrder() {
      const order = JSON.parse(localStorage.getItem('tvp-section-order') || '[]');
      if (order.length > 0) {
        const main = document.querySelector('.main__content');
        order.forEach(sectionId => {
          const section = document.getElementById(sectionId);
          if (section) main.appendChild(section);
        });
      }
    }

    // ============================================
    // LAYOUT PRESETS (Club Mode, Prep Mode, Custom)
    // ============================================
    const layoutPresets = {
      club: ['section-trending', 'section-latest', 'section-for-you', 'section-browse'],
      prep: ['section-for-you', 'section-latest', 'section-trending', 'section-browse'],
      custom: null // Will be loaded from localStorage
    };

    let currentPreset = localStorage.getItem('tvp-layout-preset') || 'custom';

    function toggleLayoutMenu() {
      const menu = document.getElementById('layoutMenu');
      menu.classList.toggle('layout-preset__menu--open');

      // Close on outside click
      if (menu.classList.contains('layout-preset__menu--open')) {
        setTimeout(() => {
          document.addEventListener('click', closeLayoutMenuOnOutside);
        }, 0);
      }
    }

    function closeLayoutMenuOnOutside(e) {
      const preset = document.querySelector('.layout-preset');
      if (!preset.contains(e.target)) {
        document.getElementById('layoutMenu').classList.remove('layout-preset__menu--open');
        document.removeEventListener('click', closeLayoutMenuOnOutside);
      }
    }

    function applyLayoutPreset(presetName) {
      const main = document.querySelector('.main__content');
      let order;

      if (presetName === 'custom') {
        order = JSON.parse(localStorage.getItem('tvp-custom-layout') || 'null');
        if (!order) {
          order = ['section-for-you', 'section-trending', 'section-latest', 'section-browse'];
        }
      } else {
        order = layoutPresets[presetName];
      }

      // Reorder sections
      order.forEach(sectionId => {
        const section = document.getElementById(sectionId);
        if (section) main.appendChild(section);
      });

      // Update localStorage
      localStorage.setItem('tvp-section-order', JSON.stringify(order));
      localStorage.setItem('tvp-layout-preset', presetName);
      currentPreset = presetName;

      // Update UI
      updateLayoutPresetUI(presetName);

      // Close menu
      document.getElementById('layoutMenu').classList.remove('layout-preset__menu--open');

      const names = { club: 'Club Mode', prep: 'Prep Mode', custom: 'Custom' };
      showToast('Layout Changed', `Switched to ${names[presetName]}`, 'success');
    }

    function saveCurrentAsCustom() {
      const main = document.querySelector('.main__content');
      const order = [...main.querySelectorAll('.section')].map(s => s.id);
      localStorage.setItem('tvp-custom-layout', JSON.stringify(order));
      localStorage.setItem('tvp-layout-preset', 'custom');
      currentPreset = 'custom';
      updateLayoutPresetUI('custom');
      document.getElementById('layoutMenu').classList.remove('layout-preset__menu--open');
      showToast('Layout Saved', 'Current layout saved as Custom preset', 'success');
    }

    function updateLayoutPresetUI(presetName) {
      const names = { club: 'Club Mode', prep: 'Prep Mode', custom: 'Custom' };
      document.getElementById('currentLayoutLabel').textContent = names[presetName];

      // Update active state in menu
      document.querySelectorAll('.layout-preset__item').forEach(item => {
        item.classList.remove('layout-preset__item--active');
      });
      const activeItem = document.querySelector(`.layout-preset__item[onclick*="'${presetName}'"]`);
      if (activeItem) activeItem.classList.add('layout-preset__item--active');
    }

    function initLayoutPresets() {
      const savedPreset = localStorage.getItem('tvp-layout-preset') || 'custom';
      updateLayoutPresetUI(savedPreset);
    }

    // ============================================
    // GRID SECTIONS (For You, Trending, Latest)
    // ============================================
    function renderGridSections() {
      // For You - AI recommendations (placeholder until enough history)
      renderGridSection('forYouGrid', forYouTracks);
      // Trending - most downloaded in last 30 days
      renderGridSection('trendingGrid', trendingTracks);
      // Latest - added in last 30 days
      renderGridSection('latestGrid', latestTracks);
    }

    function getQualityClass(quality) {
      // Returns the CSS class suffix for quality badge
      switch(quality) {
        case '4K': return '4k';
        case '1080p': return '1080p';
        case '720p': return '720p';
        case '480p': return '480p';
        case '320p': return '320p';
        default: return '1080p';
      }
    }

    function renderGridSection(containerId, tracks) {
      const container = document.getElementById(containerId);
      if (!container) return;

      container.innerHTML = tracks.slice(0, 10).map(track => `
        <div class="video-card" data-id="${track.id}" onclick="openPreviewModal(${track.id})">
          <div class="video-card__thumb">
            <img src="https://picsum.photos/480/270?random=${track.id + 200}" alt="">
            <div class="video-card__overlay">
              <div class="video-card__play">
                <svg viewBox="0 0 24 24" fill="currentColor"><polygon points="5,3 19,12 5,21"/></svg>
              </div>
            </div>
            ${track.isNew ? '<div class="video-card__badges"><span class="badge badge--new">NEW</span></div>' : ''}
            ${track.isHot ? '<div class="video-card__badges"><span class="badge badge--hot">HOT</span></div>' : ''}
            <span class="video-card__quality video-card__quality--${getQualityClass(track.quality)}">${track.quality}</span>
            <span class="video-card__duration">${track.duration}</span>
          </div>
          <div class="video-card__content">
            <div class="video-card__title">${track.title}</div>
            <div class="video-card__artist">${track.artist}</div>
            <div class="video-card__meta">
              <span>${track.bpm} BPM</span>
              <span>${track.key}</span>
            </div>
          </div>
        </div>
      `).join('');
    }

    // ============================================
    // VIEW TOGGLE (List/Grid)
    // ============================================
    function initView() {
      setView(currentView);
    }

    function setView(view) {
      currentView = view;
      localStorage.setItem('tvp-view', view);

      const listView = document.getElementById('videoList');
      const gridView = document.getElementById('videoGrid');
      const listBtn = document.getElementById('listViewBtn');
      const gridBtn = document.getElementById('gridViewBtn');

      if (view === 'list') {
        listView.classList.add('video-list--visible');
        listView.classList.remove('video-list--hidden');
        gridView.classList.add('video-grid--hidden');
        gridView.classList.remove('video-grid--visible');
        listBtn.classList.add('view-toggle__btn--active');
        gridBtn.classList.remove('view-toggle__btn--active');
      } else {
        gridView.classList.remove('video-grid--hidden');
        gridView.classList.add('video-grid--visible');
        listView.classList.remove('video-list--visible');
        listView.classList.add('video-list--hidden');
        gridBtn.classList.add('view-toggle__btn--active');
        listBtn.classList.remove('view-toggle__btn--active');
      }
    }

    // ============================================
    // RENDER TRACKS
    // ============================================
    function renderTracks() {
      renderListView();
      renderGridView();
    }

    function renderListView() {
      const container = document.getElementById('listRows');
      container.innerHTML = sampleTracks.map((track, index) => `
        <div class="video-list__row ${selectedTracks.has(track.id) ? 'video-list__row--selected' : ''}"
             data-id="${track.id}"
             onclick="handleRowClick(event, ${track.id})"
             draggable="true"
             ondragstart="handleDragStart(event, ${track.id})"
             ondragend="handleDragEnd(event)">
          <div class="video-list__checkbox ${selectedTracks.has(track.id) ? 'video-list__checkbox--checked' : ''}" onclick="event.stopPropagation(); toggleTrackSelection(${track.id})">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20,6 9,17 4,12"/></svg>
          </div>
          <div class="video-list__thumb">
            <img src="https://picsum.photos/120/68?random=${track.id + 100}" alt="">
            <div class="video-list__thumb-play">
              <svg viewBox="0 0 24 24" fill="currentColor"><polygon points="5,3 19,12 5,21"/></svg>
            </div>
          </div>
          <div class="video-list__title">${track.title}</div>
          <div class="video-list__artist">${track.artist}</div>
          <div class="video-list__bpm">${track.bpm}</div>
          <div class="video-list__key">${track.key}</div>
          <div class="video-list__duration">${track.duration}</div>
          <div class="video-list__quality video-list__quality--${getQualityClass(track.quality)}">${track.quality}</div>
          <div class="video-list__genre">${track.genre}</div>
          <div class="video-list__actions">
            <button class="video-list__action-btn" onclick="event.stopPropagation(); openPreviewModal(${track.id})" title="Preview">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5,3 19,12 5,21"/></svg>
            </button>
            <button class="video-list__action-btn" onclick="event.stopPropagation(); quickDownload(${track.id})" title="Download">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
            </button>
          </div>
        </div>
      `).join('');
    }

    function renderGridView() {
      const container = document.getElementById('videoGrid');
      container.innerHTML = sampleTracks.map(track => `
        <div class="video-card ${selectedTracks.has(track.id) ? 'video-card--selected' : ''}"
             data-id="${track.id}"
             draggable="true"
             ondragstart="handleDragStart(event, ${track.id})"
             ondragend="handleDragEnd(event)">
          <div class="video-card__checkbox ${selectedTracks.has(track.id) ? 'video-card__checkbox--checked' : ''}" onclick="event.stopPropagation(); toggleTrackSelection(${track.id})">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20,6 9,17 4,12"/></svg>
          </div>
          <div class="video-card__thumb" onclick="openPreviewModal(${track.id})">
            <img src="https://picsum.photos/400/225?random=${track.id + 100}" alt="">
            <div class="video-card__overlay">
              <div class="video-card__play">
                <svg viewBox="0 0 24 24" fill="currentColor"><polygon points="5,3 19,12 5,21"/></svg>
              </div>
            </div>
            ${track.isNew ? '<div class="video-card__badges"><span class="badge badge--new">NEW</span></div>' : ''}
            ${track.isHot ? '<div class="video-card__badges"><span class="badge badge--hot">HOT</span></div>' : ''}
            <span class="video-card__quality video-card__quality--${getQualityClass(track.quality)}">${track.quality}</span>
            <span class="video-card__duration">${track.duration}</span>
          </div>
          <div class="video-card__content">
            <h3 class="video-card__title">${track.title}</h3>
            <p class="video-card__artist">${track.artist}</p>
            <div class="video-card__meta">
              <span>${track.bpm} BPM</span>
              <span>${track.key}</span>
            </div>
            <div class="video-card__actions">
              <button class="btn btn--primary" onclick="event.stopPropagation(); openPreviewModal(${track.id})">Download</button>
            </div>
          </div>
        </div>
      `).join('');
    }

    // ============================================
    // RECENTLY DOWNLOADED
    // ============================================
    function renderRecentDownloads() {
      const container = document.getElementById('recentList');
      const displayCount = recentExpanded ? recentDownloads.length : Math.min(10, recentDownloads.length);
      const items = recentDownloads.slice(0, displayCount);

      container.innerHTML = items.map(item => `
        <div class="recent-item" onclick="openPreviewModal(${item.id})">
          <div class="recent-item__thumb">
            <img src="https://picsum.photos/96/54?random=${item.id + 200}" alt="">
          </div>
          <div class="recent-item__info">
            <div class="recent-item__title">${item.title}</div>
            <div class="recent-item__meta">${item.artist} • ${item.bpm} BPM • ${item.key}</div>
          </div>
          <div class="recent-item__date">${item.date}</div>
          <button class="recent-item__btn" onclick="event.stopPropagation(); quickDownload(${item.id})">Re-download</button>
        </div>
      `).join('');

      document.getElementById('recentCount').textContent = displayCount;
      document.getElementById('recentExpandBtn').textContent = recentExpanded ? 'Show Less' : `Show All (47 total)`;
    }

    function toggleRecentExpand() {
      recentExpanded = !recentExpanded;
      renderRecentDownloads();
    }

    // ============================================
    // SELECTION & BATCH OPERATIONS
    // ============================================
    function handleRowClick(event, trackId) {
      if (event.shiftKey && selectedTracks.size > 0) {
        // Shift-click for range selection
        const lastSelected = Array.from(selectedTracks).pop();
        const startIdx = sampleTracks.findIndex(t => t.id === lastSelected);
        const endIdx = sampleTracks.findIndex(t => t.id === trackId);
        const [from, to] = startIdx < endIdx ? [startIdx, endIdx] : [endIdx, startIdx];
        for (let i = from; i <= to; i++) {
          selectedTracks.add(sampleTracks[i].id);
        }
        updateSelectionUI();
      } else if (event.ctrlKey || event.metaKey) {
        // Ctrl/Cmd-click for toggle
        toggleTrackSelection(trackId);
      } else {
        // Regular click opens preview
        openPreviewModal(trackId);
      }
    }

    function toggleTrackSelection(trackId) {
      if (selectedTracks.has(trackId)) {
        selectedTracks.delete(trackId);
      } else {
        selectedTracks.add(trackId);
      }
      updateSelectionUI();
    }

    function toggleSelectAll() {
      if (selectedTracks.size === sampleTracks.length) {
        selectedTracks.clear();
      } else {
        sampleTracks.forEach(t => selectedTracks.add(t.id));
      }
      updateSelectionUI();
    }

    function updateSelectionUI() {
      const count = selectedTracks.size;
      document.getElementById('selectedCount').textContent = count;
      document.getElementById('batchBar').classList.toggle('batch-bar--visible', count > 0);

      // Update select all checkbox
      const selectAllBox = document.getElementById('selectAllCheckbox');
      if (count === sampleTracks.length) {
        selectAllBox.classList.add('video-list__checkbox--checked');
      } else {
        selectAllBox.classList.remove('video-list__checkbox--checked');
      }

      renderTracks();
    }

    function clearSelection() {
      selectedTracks.clear();
      updateSelectionUI();
    }

    function batchDownload() {
      const count = selectedTracks.size;
      showToast('Batch Download Started', `Adding ${count} tracks to download queue...`, 'success');
      clearSelection();
    }

    function addToSetBuilder() {
      selectedTracks.forEach(id => {
        if (!setBuilderTracks.find(t => t.id === id)) {
          const track = sampleTracks.find(t => t.id === id);
          if (track) setBuilderTracks.push({...track});
        }
      });
      saveSetToStorage();
      updateSetBuilder();
      showToast('Added to Set', `${selectedTracks.size} tracks added to Set Builder`, 'success');
      clearSelection();
      if (!document.getElementById('setBuilder').classList.contains('set-builder--open')) {
        toggleSetBuilder();
      }
    }

    // ============================================
    // SET BUILDER
    // ============================================
    function toggleSetBuilder() {
      const panel = document.getElementById('setBuilder');
      panel.classList.toggle('set-builder--open');
    }

    function updateSetBuilder() {
      const container = document.getElementById('setTracks');
      document.getElementById('setBuilderBadge').textContent = setBuilderTracks.length;
      document.getElementById('setTrackCount').textContent = setBuilderTracks.length;

      if (setBuilderTracks.length === 0) {
        container.innerHTML = `
          <div class="set-builder__empty">
            <div class="set-builder__empty-icon">📀</div>
            <div class="set-builder__empty-text">No tracks in your set</div>
            <div class="set-builder__empty-hint">Drag tracks here or use "Add to Set"</div>
          </div>
        `;
        document.getElementById('setDuration').textContent = '0:00';
        document.getElementById('setBpmRange').textContent = '--';
        return;
      }

      // Calculate stats
      const totalSeconds = setBuilderTracks.reduce((acc, t) => {
        const [min, sec] = t.duration.split(':').map(Number);
        return acc + min * 60 + sec;
      }, 0);
      const mins = Math.floor(totalSeconds / 60);
      const secs = totalSeconds % 60;
      document.getElementById('setDuration').textContent = `${mins}:${secs.toString().padStart(2, '0')}`;

      const bpms = setBuilderTracks.map(t => t.bpm);
      document.getElementById('setBpmRange').textContent = `${Math.min(...bpms)}-${Math.max(...bpms)}`;

      container.innerHTML = setBuilderTracks.map((track, index) => {
        const prevTrack = index > 0 ? setBuilderTracks[index - 1] : null;
        const compatibility = prevTrack ? getCompatibility(prevTrack, track) : 'good';

        return `
          <div class="set-track"
               data-index="${index}"
               draggable="true"
               ondragstart="handleSetDragStart(event, ${index})"
               ondragover="handleSetDragOver(event)"
               ondrop="handleSetDrop(event, ${index})"
               ondragend="handleSetDragEnd(event)">
            <div class="set-track__order">${index + 1}</div>
            <div class="set-track__thumb">
              <img src="https://picsum.photos/96/54?random=${track.id + 300}" alt="">
            </div>
            <div class="set-track__info">
              <div class="set-track__title">${track.title}</div>
              <div class="set-track__meta">
                <span>${track.bpm} BPM</span>
                <span>${track.key}</span>
              </div>
            </div>
            ${index > 0 ? `<div class="set-track__compatibility set-track__compatibility--${compatibility}" title="${compatibility === 'good' ? 'Great mix!' : compatibility === 'ok' ? 'Acceptable' : 'Key clash'}"></div>` : ''}
            <button class="set-track__remove" onclick="removeFromSet(${index})">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><path d="M18 6L6 18M6 6l12 12"/></svg>
            </button>
          </div>
        `;
      }).join('');

      // Update recommendations based on last track
      updateSetRecommendations();
    }

    // ============================================
    // SET BUILDER RECOMMENDATIONS ALGORITHM
    // Council-approved: BPM/Key primary, subgenre secondary
    // ============================================
    function updateSetRecommendations() {
      const recsContainer = document.getElementById('setRecommendations');
      const recsList = document.getElementById('setRecsList');

      if (setBuilderTracks.length === 0) {
        recsContainer.style.display = 'none';
        return;
      }

      const lastTrack = setBuilderTracks[setBuilderTracks.length - 1];
      const allTracks = [...sampleTracks, ...trendingTracks, ...latestTracks, ...forYouTracks, ...throwbackTracks, ...remixTracks];

      // Filter out tracks already in the set
      const setIds = new Set(setBuilderTracks.map(t => t.id));
      const availableTracks = allTracks.filter(t => !setIds.has(t.id));

      // Score each track based on compatibility
      const scoredTracks = availableTracks.map(track => {
        let score = 0;

        // Key compatibility (Camelot wheel logic)
        const keyScore = getKeyCompatibilityScore(lastTrack.key, track.key);
        score += keyScore * 40; // Weight: 40%

        // BPM compatibility (within ±8 BPM)
        const bpmDiff = Math.abs(lastTrack.bpm - track.bpm);
        if (bpmDiff <= 3) score += 30;
        else if (bpmDiff <= 5) score += 25;
        else if (bpmDiff <= 8) score += 15;
        else if (bpmDiff <= 12) score += 5;

        // Same subgenre bonus
        if (lastTrack.subgenre && track.subgenre === lastTrack.subgenre) {
          score += 20;
        } else if (lastTrack.genre && track.genre === lastTrack.genre) {
          score += 10;
        }

        // Era bonus for throwbacks
        if (lastTrack.genre === 'Throwbacks' && track.genre === 'Throwbacks') {
          score += 10;
        }

        return { ...track, score };
      });

      // Sort by score and take top 4
      const recommendations = scoredTracks
        .sort((a, b) => b.score - a.score)
        .slice(0, 4);

      if (recommendations.length === 0 || recommendations[0].score < 20) {
        recsContainer.style.display = 'none';
        return;
      }

      recsContainer.style.display = 'block';
      recsList.innerHTML = recommendations.map(track => `
        <div class="set-builder__rec-item" onclick="openPreviewModal(${track.id})">
          <div class="set-builder__rec-thumb">
            <img src="https://picsum.photos/64/64?random=${track.id + 500}" alt="">
          </div>
          <div class="set-builder__rec-info">
            <div class="set-builder__rec-title">${track.title}</div>
            <div class="set-builder__rec-meta">${track.bpm} BPM · ${track.key}</div>
          </div>
          <button class="set-builder__rec-add" onclick="event.stopPropagation(); addToSetFromRec(${track.id})" title="Add to Set">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M12 5v14M5 12h14"/></svg>
          </button>
        </div>
      `).join('');
    }

    function getKeyCompatibilityScore(key1, key2) {
      // Parse Camelot notation (e.g., "5A", "11B")
      const num1 = parseInt(key1);
      const num2 = parseInt(key2);
      const letter1 = key1.slice(-1);
      const letter2 = key2.slice(-1);

      // Perfect match
      if (key1 === key2) return 1.0;

      // Same number, different letter (relative major/minor)
      if (num1 === num2 && letter1 !== letter2) return 0.9;

      // Adjacent keys on same letter (+1 or -1)
      if (letter1 === letter2) {
        const diff = Math.abs(num1 - num2);
        if (diff === 1 || diff === 11) return 0.85; // Handle wrap-around (12 to 1)
        if (diff === 2 || diff === 10) return 0.6;
      }

      // Diagonal moves (adjacent number, different letter)
      const numDiff = Math.abs(num1 - num2);
      if ((numDiff === 1 || numDiff === 11) && letter1 !== letter2) return 0.7;

      // Everything else
      return 0.2;
    }

    function addToSetFromRec(trackId) {
      const allTracks = [...sampleTracks, ...trendingTracks, ...latestTracks, ...forYouTracks, ...throwbackTracks, ...remixTracks, ...legacyTracks];
      const track = allTracks.find(t => t.id === trackId);
      if (track && !setBuilderTracks.find(t => t.id === track.id)) {
        setBuilderTracks.push(track);
        localStorage.setItem('tvp-set', JSON.stringify(setBuilderTracks));
        updateSetBuilder();
        showToast(`Added ${track.title}`, '', 'success');
      }
    }

    function getCompatibility(track1, track2) {
      // Simplified key compatibility check
      const key1Num = parseInt(track1.key);
      const key2Num = parseInt(track2.key);
      const key1Letter = track1.key.slice(-1);
      const key2Letter = track2.key.slice(-1);

      // Same key = perfect
      if (track1.key === track2.key) return 'good';

      // Adjacent keys (+/- 1) on same letter = good
      if (key1Letter === key2Letter && Math.abs(key1Num - key2Num) <= 1) return 'good';

      // Same number, different letter = good (relative major/minor)
      if (key1Num === key2Num && key1Letter !== key2Letter) return 'good';

      // 2 steps away = ok
      if (Math.abs(key1Num - key2Num) <= 2) return 'ok';

      // BPM check
      const bpmDiff = Math.abs(track1.bpm - track2.bpm);
      if (bpmDiff > 8) return 'bad';

      return 'ok';
    }

    let draggedSetIndex = null;

    function handleSetDragStart(event, index) {
      draggedSetIndex = index;
      event.target.classList.add('set-track--dragging');
    }

    function handleSetDragOver(event) {
      event.preventDefault();
      event.currentTarget.classList.add('set-track--drag-over');
    }

    function handleSetDrop(event, targetIndex) {
      event.preventDefault();
      event.currentTarget.classList.remove('set-track--drag-over');

      if (draggedSetIndex !== null && draggedSetIndex !== targetIndex) {
        const [removed] = setBuilderTracks.splice(draggedSetIndex, 1);
        setBuilderTracks.splice(targetIndex, 0, removed);
        saveSetToStorage();
        updateSetBuilder();
      }
    }

    function handleSetDragEnd(event) {
      event.target.classList.remove('set-track--dragging');
      document.querySelectorAll('.set-track--drag-over').forEach(el => el.classList.remove('set-track--drag-over'));
      draggedSetIndex = null;
    }

    function removeFromSet(index) {
      setBuilderTracks.splice(index, 1);
      saveSetToStorage();
      updateSetBuilder();
    }

    function clearSet() {
      if (confirm('Clear all tracks from your set?')) {
        setBuilderTracks = [];
        saveSetToStorage();
        updateSetBuilder();
      }
    }

    function saveSet() {
      showToast('Set Saved', `"My Set" saved with ${setBuilderTracks.length} tracks`, 'success');
    }

    function downloadSet() {
      if (setBuilderTracks.length === 0) {
        showToast('Empty Set', 'Add tracks to your set first', 'info');
        return;
      }
      showToast('Downloading Set', `Downloading ${setBuilderTracks.length} tracks...`, 'success');
    }

    function saveSetToStorage() {
      localStorage.setItem('tvp-set', JSON.stringify(setBuilderTracks));
    }

    // ============================================
    // DRAG & DROP TO SET BUILDER
    // ============================================
    let draggedTrackId = null;

    function handleDragStart(event, trackId) {
      draggedTrackId = trackId;
      event.dataTransfer.effectAllowed = 'copy';
    }

    function handleDragEnd(event) {
      draggedTrackId = null;
    }

    // Set builder drop zone
    document.addEventListener('DOMContentLoaded', () => {
      const setBuilder = document.getElementById('setBuilder');
      const setTracks = document.getElementById('setTracks');

      setTracks.addEventListener('dragover', (e) => {
        if (draggedTrackId) {
          e.preventDefault();
          setTracks.style.background = 'var(--accent-cyan-subtle)';
        }
      });

      setTracks.addEventListener('dragleave', () => {
        setTracks.style.background = '';
      });

      setTracks.addEventListener('drop', (e) => {
        e.preventDefault();
        setTracks.style.background = '';

        if (draggedTrackId && !setBuilderTracks.find(t => t.id === draggedTrackId)) {
          const track = sampleTracks.find(t => t.id === draggedTrackId);
          if (track) {
            setBuilderTracks.push({...track});
            saveSetToStorage();
            updateSetBuilder();
            showToast('Added to Set', `${track.title} added to Set Builder`, 'success');
          }
        }
        draggedTrackId = null;
      });
    });

    // ============================================
    // PREVIEW MODAL
    // ============================================
    let currentPreviewTrack = null;

    // Version types with icons
    const versionTypes = {
      clean: { name: 'Clean', icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>' },
      dirty: { name: 'Explicit', icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M9 9h6M9 12h4M9 15h6"/></svg>' },
      intro: { name: 'Intro Edit', icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5,3 19,12 5,21"/><line x1="19" y1="3" x2="19" y2="21"/></svg>' },
      outro: { name: 'Outro Edit', icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="3" x2="5" y2="21"/><polygon points="19,3 5,12 19,21"/></svg>' },
      quickhit: { name: 'Quick Hit', icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>' },
      xtendz: { name: 'Xtendz', icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>' }
    };

    // Sample versions data (would come from API in production)
    const trackVersions = {
      // sampleTracks
      1: ['clean', 'dirty', 'intro', 'outro'], // Espresso has 4 versions
      2: ['clean', 'dirty', 'intro', 'outro', 'quickhit', 'xtendz'], // Not Like Us has 6
      3: ['clean', 'dirty'], // Beautiful Things has 2
      5: ['clean', 'intro', 'outro'], // Too Sweet has 3
      10: ['clean', 'dirty', 'intro'], // Bonita has 3
      // trendingTracks
      101: ['clean', 'dirty', 'intro', 'outro', 'quickhit'], // Die With A Smile
      102: ['clean', 'dirty', 'intro'], // APT.
      106: ['clean', 'dirty', 'intro', 'outro'], // A Bar Song
      // latestTracks
      201: ['clean', 'dirty'], // Moonlit Floor
      204: ['clean', 'dirty', 'intro', 'outro', 'xtendz'], // Guess
      // forYouTracks
      301: ['clean', 'dirty', 'intro', 'outro', 'quickhit'], // Die With A Smile
      302: ['clean', 'dirty', 'intro'], // APT.
      303: ['clean', 'dirty', 'intro', 'outro'], // Taste
      304: ['clean', 'dirty', 'intro', 'outro'], // A Bar Song
      307: ['clean', 'intro', 'outro', 'xtendz'], // Good Luck, Babe!
      310: ['clean', 'dirty', 'intro', 'outro', 'quickhit', 'xtendz'], // Not Like Us
      default: ['clean', 'dirty'] // Most tracks have clean/dirty
    };

    let showAllVersions = false;

    function openPreviewModal(trackId) {
      const track = sampleTracks.find(t => t.id === trackId) ||
                    trendingTracks.find(t => t.id === trackId) ||
                    latestTracks.find(t => t.id === trackId) ||
                    forYouTracks.find(t => t.id === trackId) ||
                    recentDownloads.find(t => t.id === trackId);
      if (!track) return;

      currentPreviewTrack = track;
      showAllVersions = false;

      document.getElementById('previewTitle').textContent = track.title;
      document.getElementById('previewArtist').textContent = track.artist;
      document.getElementById('previewBpm').textContent = track.bpm;
      document.getElementById('previewKey').textContent = track.key;
      document.getElementById('previewDuration').textContent = track.duration || '3:30';
      document.getElementById('previewGenre').textContent = track.genre || 'Pop';
      document.getElementById('previewImage').src = `https://picsum.photos/600/338?random=${track.id + 400}`;

      // Set badge
      const badge = document.getElementById('previewBadge');
      if (track.isNew) {
        badge.textContent = 'NEW';
        badge.style.background = 'var(--accent-coral)';
      } else if (track.isHot) {
        badge.textContent = 'HOT';
        badge.style.background = 'linear-gradient(135deg, #ff6b4a, #ffab00)';
      } else {
        badge.textContent = track.quality || '1080p';
        badge.style.background = 'var(--accent-purple)';
      }

      // Set video quality options based on track
      const videoSelect = document.getElementById('videoQualitySelect');
      videoSelect.innerHTML = '';
      if (track.quality === '4K') {
        videoSelect.innerHTML = `
          <option value="4k">4K (2160p)</option>
          <option value="1080p" selected>1080p Full HD</option>
          <option value="720p">720p HD</option>
        `;
      } else if (track.quality === '1080p') {
        videoSelect.innerHTML = `
          <option value="1080p" selected>1080p Full HD</option>
          <option value="720p">720p HD</option>
        `;
      } else {
        videoSelect.innerHTML = `
          <option value="720p" selected>720p HD</option>
        `;
      }

      // Render versions
      renderVersions(track.id);
      updateFileSize();

      document.getElementById('previewModal').classList.add('preview-modal--open');
      document.getElementById('backdrop').classList.add('backdrop--visible');
    }

    function renderVersions(trackId) {
      const versions = trackVersions[trackId] || trackVersions.default;
      const container = document.getElementById('previewVersions');
      const expandBtn = document.getElementById('expandVersionsBtn');

      // Show only first 2 versions by default, rest behind expand
      const visibleVersions = showAllVersions ? versions : versions.slice(0, 2);
      const hiddenCount = versions.length - 2;

      container.innerHTML = visibleVersions.map(v => {
        const type = versionTypes[v];
        return `
          <div class="preview-modal__version">
            <div class="preview-modal__version-icon">${type.icon}</div>
            <div class="preview-modal__version-info">
              <div class="preview-modal__version-name">${type.name}</div>
              <div class="preview-modal__version-meta">${currentPreviewTrack.duration || '3:30'} • ${currentPreviewTrack.quality || '1080p'}</div>
            </div>
            <button class="preview-modal__version-download" onclick="downloadVersion('${v}')" title="Download ${type.name}">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
            </button>
          </div>
        `;
      }).join('');

      // Show/hide expand button
      if (hiddenCount > 0 && !showAllVersions) {
        expandBtn.style.display = 'flex';
        document.getElementById('expandVersionsText').textContent = `Show ${hiddenCount} more version${hiddenCount > 1 ? 's' : ''}`;
      } else if (showAllVersions && versions.length > 2) {
        expandBtn.style.display = 'flex';
        document.getElementById('expandVersionsText').textContent = 'Show less';
      } else {
        expandBtn.style.display = 'none';
      }
    }

    function toggleAllVersions() {
      showAllVersions = !showAllVersions;
      if (currentPreviewTrack) {
        renderVersions(currentPreviewTrack.id);
      }
    }

    function downloadVersion(versionType) {
      const type = versionTypes[versionType];
      const videoQuality = document.getElementById('videoQualitySelect').value;
      const audioQuality = document.getElementById('audioQualitySelect').value;
      showToast('Download Started', `${currentPreviewTrack.title} (${type.name}) - ${videoQuality.toUpperCase()}`, 'success');
    }

    function updateFileSize() {
      const videoQuality = document.getElementById('videoQualitySelect').value;
      const audioQuality = document.getElementById('audioQualitySelect').value;

      // Estimate file sizes based on quality
      const videoSizes = { '4k': 450, '1080p': 185, '720p': 85 };
      const audioSizes = { '320': 8, '192': 5 };

      const videoSize = videoSizes[videoQuality] || 185;
      const audioSize = audioSizes[audioQuality] || 8;

      document.getElementById('fileSizeEstimate').textContent =
        `Estimated: ~${videoSize} MB (video) • ~${audioSize} MB (audio)`;
    }

    function closePreviewModal() {
      document.getElementById('previewModal').classList.remove('preview-modal--open');
      document.getElementById('backdrop').classList.remove('backdrop--visible');
      currentPreviewTrack = null;
      showAllVersions = false;
    }

    function downloadFromModal() {
      if (currentPreviewTrack) {
        const videoQuality = document.getElementById('videoQualitySelect').value;
        const audioQuality = document.getElementById('audioQualitySelect').value;
        showToast('Download Started', `${currentPreviewTrack.title} (${videoQuality.toUpperCase()}, ${audioQuality}kbps) added to queue`, 'success');
        closePreviewModal();
      }
    }

    function addToSetFromModal() {
      if (currentPreviewTrack && !setBuilderTracks.find(t => t.id === currentPreviewTrack.id)) {
        setBuilderTracks.push({...currentPreviewTrack});
        saveSetToStorage();
        updateSetBuilder();
        showToast('Added to Set', `${currentPreviewTrack.title} added to Set Builder`, 'success');
        closePreviewModal();
        if (!document.getElementById('setBuilder').classList.contains('set-builder--open')) {
          toggleSetBuilder();
        }
      }
    }

    function quickDownload(trackId) {
      const track = sampleTracks.find(t => t.id === trackId);
      if (track) {
        showToast('Download Started', `${track.title} added to queue`, 'success');
      }
    }

    // ============================================
    // UTILITIES
    // ============================================
    function showToast(title, message, type = 'info', action = null) {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast toast--${type}`;

      // Icon based on type (Spotify-style)
      const icons = {
        success: '✓',
        info: 'ℹ',
        error: '✕',
        download: '↓'
      };
      const icon = icons[type] || icons.info;

      toast.innerHTML = `
        <span class="toast__icon">${icon}</span>
        <div class="toast__content">
          <div class="toast__title">${title}</div>
          ${message ? `<div class="toast__message">${message}</div>` : ''}
        </div>
        ${action ? `<span class="toast__action" onclick="${action.handler}">${action.label}</span>` : ''}
      `;

      container.appendChild(toast);
      requestAnimationFrame(() => {
        requestAnimationFrame(() => toast.classList.add('toast--show'));
      });

      setTimeout(() => {
        toast.classList.remove('toast--show');
        setTimeout(() => toast.remove(), 250);
      }, 3000);
    }

    // ============================================
    // KEYBOARD SHORTCUTS SYSTEM
    // ============================================
    let focusedTrackIndex = 0;
    let isPreviewPlaying = false;

    // Shortcuts Panel
    function toggleShortcutsPanel() {
      const panel = document.getElementById('shortcutsPanel');
      const backdrop = document.getElementById('backdrop');
      panel.classList.toggle('shortcuts-panel--open');
      if (panel.classList.contains('shortcuts-panel--open')) {
        backdrop.classList.add('backdrop--visible');
      } else if (!document.getElementById('previewModal').classList.contains('preview-modal--open')) {
        backdrop.classList.remove('backdrop--visible');
      }
    }

    // Visual Feedback for Shortcuts
    function showShortcutFeedback(key, action) {
      const feedback = document.getElementById('shortcutFeedback');
      document.getElementById('feedbackKey').textContent = key;
      document.getElementById('feedbackAction').textContent = action;
      feedback.classList.add('shortcut-feedback--show');
      setTimeout(() => feedback.classList.remove('shortcut-feedback--show'), 800);
    }

    // Update focused track visual
    function updateFocusedTrack() {
      // Remove all focus indicators
      document.querySelectorAll('.video-list__row--focused, .video-card--focused').forEach(el => {
        el.classList.remove('video-list__row--focused', 'video-card--focused');
      });

      // Add focus to current track
      const track = sampleTracks[focusedTrackIndex];
      if (track) {
        const listRow = document.querySelector(`.video-list__row[data-id="${track.id}"]`);
        const gridCard = document.querySelector(`.video-card[data-id="${track.id}"]`);
        if (listRow) {
          listRow.classList.add('video-list__row--focused');
          listRow.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
        }
        if (gridCard) {
          gridCard.classList.add('video-card--focused');
          gridCard.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
        }
      }
    }

    // Navigation shortcuts
    function navigateTrack(direction) {
      if (direction === 'next') {
        focusedTrackIndex = Math.min(focusedTrackIndex + 1, sampleTracks.length - 1);
      } else {
        focusedTrackIndex = Math.max(focusedTrackIndex - 1, 0);
      }
      updateFocusedTrack();
    }

    // Add focused track to set
    function addFocusedToSet() {
      const track = sampleTracks[focusedTrackIndex];
      if (track && !setBuilderTracks.find(t => t.id === track.id)) {
        setBuilderTracks.push({...track});
        saveSetToStorage();
        updateSetBuilder();
        showShortcutFeedback('S', `Added "${track.title}" to Set`);
        showToast('Added to Set', track.title, 'success');
      } else if (selectedTracks.size > 0) {
        addToSetBuilder();
        showShortcutFeedback('S', `Added ${selectedTracks.size} tracks to Set`);
      }
    }

    // Download focused/selected
    function downloadFocusedOrSelected() {
      if (selectedTracks.size > 0) {
        showShortcutFeedback('D', `Downloading ${selectedTracks.size} tracks`);
        batchDownload();
      } else {
        const track = sampleTracks[focusedTrackIndex];
        if (track) {
          showShortcutFeedback('D', `Downloading "${track.title}"`);
          quickDownload(track.id);
        }
      }
    }

    // Toggle selection of focused track
    function toggleFocusedSelection() {
      const track = sampleTracks[focusedTrackIndex];
      if (track) {
        toggleTrackSelection(track.id);
        showShortcutFeedback('X', selectedTracks.has(track.id) ? 'Selected' : 'Deselected');
      }
    }

    // Preview focused track
    function previewFocusedTrack() {
      const track = sampleTracks[focusedTrackIndex];
      if (track) {
        openPreviewModal(track.id);
        showShortcutFeedback('P', 'Preview');
      }
    }

    // Toggle play/pause
    function togglePlayPause() {
      isPreviewPlaying = !isPreviewPlaying;
      showShortcutFeedback('Space', isPreviewPlaying ? 'Playing' : 'Paused');
      showToast(isPreviewPlaying ? 'Playing' : 'Paused', 'Preview playback', 'info');
    }

    // Filter by similar BPM
    function filterSimilarBPM() {
      const track = sampleTracks[focusedTrackIndex];
      if (track) {
        showShortcutFeedback('M', `BPM ${track.bpm - 5} - ${track.bpm + 5}`);
        showToast('BPM Filter', `Showing tracks ${track.bpm - 5} - ${track.bpm + 5} BPM`, 'info');
      }
    }

    // Show harmonic matches (simplified - filters by compatible keys)
    function showHarmonicMatches() {
      const track = sampleTracks[focusedTrackIndex];
      if (track) {
        showShortcutFeedback('H', `Harmonic: ${track.key}`);
        showToast('Harmonic Filter', `Showing tracks compatible with ${track.key}`, 'info');
      }
    }

    // Jump to section
    function jumpToSection(num) {
      const sections = ['recentSection', 'section-browse'];
      const sectionNames = ['Recently Downloaded', 'Browse Library'];
      const idx = num - 1;
      if (idx < sections.length) {
        const section = document.getElementById(sections[idx]);
        if (section) {
          section.scrollIntoView({ behavior: 'smooth', block: 'start' });
          showShortcutFeedback(num.toString(), sectionNames[idx]);
        }
      }
    }

    // Close all modals including shortcuts
    function closeAllModals() {
      closePreviewModal();
      closeSlidePanel();
      const recentPanel = document.getElementById('recentPanel');
      if (recentPanel.classList.contains('recent-panel--open')) {
        recentPanel.classList.remove('recent-panel--open');
        document.getElementById('recentBtn').classList.remove('recent-btn--active');
      }
      const requestPanel = document.getElementById('requestPanel');
      if (requestPanel.classList.contains('request-panel--open')) {
        requestPanel.classList.remove('request-panel--open');
      }
      const shortcutsPanel = document.getElementById('shortcutsPanel');
      if (shortcutsPanel.classList.contains('shortcuts-panel--open')) {
        shortcutsPanel.classList.remove('shortcuts-panel--open');
      }
      document.getElementById('backdrop').classList.remove('backdrop--visible');
      clearSelection();
    }

    // Main keyboard event handler
    document.addEventListener('keydown', (e) => {
      // Don't trigger shortcuts when typing in input
      const isTyping = document.activeElement.tagName === 'INPUT' || document.activeElement.tagName === 'TEXTAREA';

      // Global shortcuts (work even when typing)
      if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
        e.preventDefault();
        document.getElementById('mainSearch').focus();
        showShortcutFeedback('⌘K', 'Search');
        return;
      }

      if (e.key === 'Escape') {
        e.preventDefault();
        closeAllModals();
        return;
      }

      // Don't process other shortcuts if typing
      if (isTyping) return;

      // Playback Controls
      if (e.key === ' ' || e.code === 'Space') {
        e.preventDefault();
        togglePlayPause();
        return;
      }

      if (e.key === 'p' || e.key === 'P') {
        e.preventDefault();
        previewFocusedTrack();
        return;
      }

      if (e.key === 'ArrowLeft') {
        e.preventDefault();
        showShortcutFeedback('←', 'Seek -5s');
        return;
      }

      if (e.key === 'ArrowRight') {
        e.preventDefault();
        showShortcutFeedback('→', 'Seek +5s');
        return;
      }

      // Navigation
      if (e.key === 'j' || e.key === 'J' || e.key === 'ArrowDown') {
        e.preventDefault();
        navigateTrack('next');
        showShortcutFeedback(e.key === 'ArrowDown' ? '↓' : 'J', 'Next track');
        return;
      }

      if (e.key === 'k' || e.key === 'K' || e.key === 'ArrowUp') {
        e.preventDefault();
        navigateTrack('prev');
        showShortcutFeedback(e.key === 'ArrowUp' ? '↑' : 'K', 'Previous track');
        return;
      }

      if (e.key === 'x' || e.key === 'X') {
        e.preventDefault();
        toggleFocusedSelection();
        return;
      }

      if ((e.metaKey || e.ctrlKey) && (e.key === 'a' || e.key === 'A')) {
        e.preventDefault();
        toggleSelectAll();
        showShortcutFeedback('⌘A', 'Select All');
        return;
      }

      // Number keys for section jump
      if (e.key >= '1' && e.key <= '5') {
        e.preventDefault();
        jumpToSection(parseInt(e.key));
        return;
      }

      // Set Building
      if (e.key === 's' || e.key === 'S') {
        e.preventDefault();
        addFocusedToSet();
        return;
      }

      if (e.key === 'b' || e.key === 'B') {
        e.preventDefault();
        toggleSetBuilder();
        showShortcutFeedback('B', 'Set Builder');
        return;
      }

      if (e.key === 'd' || e.key === 'D') {
        e.preventDefault();
        downloadFocusedOrSelected();
        return;
      }

      // Mixing Helpers

      if (e.key === 'm' || e.key === 'M') {
        e.preventDefault();
        filterSimilarBPM();
        return;
      }

      if (e.key === 'h' || e.key === 'H') {
        e.preventDefault();
        showHarmonicMatches();
        return;
      }

      // View & Interface
      if (e.key === 'v' || e.key === 'V') {
        e.preventDefault();
        const newView = currentView === 'list' ? 'grid' : 'list';
        setView(newView);
        showShortcutFeedback('V', newView === 'list' ? 'List View' : 'Grid View');
        return;
      }

      if (e.key === 't' || e.key === 'T') {
        e.preventDefault();
        toggleTheme();
        showShortcutFeedback('T', 'Toggle Theme');
        return;
      }

      if (e.key === '?' || (e.shiftKey && e.key === '/')) {
        e.preventDefault();
        toggleShortcutsPanel();
        return;
      }
    });

    // Initialize focus on first track
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(updateFocusedTrack, 100);
    });
  </script>
</body>
</html>
