<!DOCTYPE html>
<!--
  IncentEdge V42 - FINAL CUT (Council + Bob White Unanimous)

  V42 Changes (Final Council Decisions):
  - NAVIGATION: 5 tabs - Portfolio, Discover, Matching (AI), Reports, More
  - MATCHING: AI-powered incentive matching in main nav (Category 40% > Location 35% > Eligibility 25%)
  - MORE DROPDOWN: Contains Green Incentives, Tools, Resources
  - SIDEBAR: Removed entirely per V40 approach
  - DATA FRESHNESS: Bloomberg-style indicators (live/fresh/recent/stale/outdated)
  - DESIGN SYNC: React app to match this styling

  Inherited from V40.1:
  - Center search bar (command palette style, Ctrl+K)
  - AUM moved to Portfolio section (not in header)
  - Teal "Ask Us" button with Supabase API integration
  - Blue + Teal only color palette (institutional)
  - Single blue category badges with opacity variations

  V41 Features Integrated:
  - P2: ROI Value Calculator (Incentive/TDC + Cash-on-cash)
  - P5: Incentive Matching Algorithm (weighted priorities)
  - P6: Green Incentives (IRA Tax Credits) - in More dropdown
  - P8: Ask Us with DB + Email backend
  - P10: Data Freshness Indicators

  Color Palette (V42):
  - Primary: Blue (#3b82f6, #2563eb, #1d4ed8)
  - Secondary: Teal (#14b8a6, #0d9488) - Ask Us, success states
  - Neutral: Slate (#64748b, #94a3b8) - text, borders
  - Category Badges: Blue only with opacity (Federal 100%, State 75%, Local 50%, Utility 25%)
  - Data Freshness: Emerald (live) > Teal (fresh) > Blue (recent) > Amber (stale) > Red (outdated)
-->
<html lang="en">
<head>
  <script>
    // V22: Light theme default with toggle - check user preference
    (function() {
      const theme = localStorage.getItem('incentedge-theme');
      if (theme === 'dark') {
        document.documentElement.classList.add('dark');
      }
    })();
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IncentEdge V42 Final Cut</title>
  <!-- V22: Navy/Blue institutional favicon -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' rx='6' fill='%230f172a'/><text x='16' y='22' text-anchor='middle' font-family='system-ui' font-weight='700' font-size='14' fill='%233b82f6'>IE</text></svg>">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=IBM+Plex+Sans:wght@400;500;600;700&family=Sora:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script>
    // V22: Navy/Blue Institutional Color Scheme (CoStar-inspired)
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sora: ['Sora', 'system-ui', 'sans-serif'],
            sans: ['IBM Plex Sans', 'system-ui', 'sans-serif'],
            mono: ['IBM Plex Mono', 'monospace']
          },
          colors: {
            // V22: Primary Navy palette
            navy: {
              50: '#f8fafc', 100: '#f1f5f9', 200: '#e2e8f0', 300: '#cbd5e1',
              400: '#94a3b8', 500: '#64748b', 600: '#475569', 700: '#334155',
              800: '#1e293b', 900: '#0f172a', 950: '#020617'
            },
            // V22: Primary accent - Blue
            accent: {
              50: '#eff6ff', 100: '#dbeafe', 200: '#bfdbfe', 300: '#93c5fd',
              400: '#60a5fa', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8',
              800: '#1e40af', 900: '#1e3a8a', 950: '#172554'
            },
            // V22: Secondary accent - Teal (used sparingly)
            teal: {
              50: '#f0fdfa', 100: '#ccfbf1', 200: '#99f6e4', 300: '#5eead4',
              400: '#2dd4bf', 500: '#14b8a6', 600: '#0d9488', 700: '#0f766e',
              800: '#115e59', 900: '#134e4a', 950: '#042f2e'
            },
            // V37: Cyan accent (used sparingly for key highlights)
            cyan: {
              50: '#ecfeff', 100: '#cffafe', 200: '#a5f3fc', 300: '#67e8f9',
              400: '#22d3ee', 500: '#06b6d4', 600: '#0891b2', 700: '#0e7490',
              800: '#155e75', 900: '#164e63', 950: '#083344'
            },
            // V40: Category colors - Single Blue with opacity variations (institutional)
            category: {
              federal: '#1d4ed8',
              state: '#2563eb',
              local: '#3b82f6',
              utility: '#60a5fa'
            }
          },
        },
      },
    }
  </script>
  <style>
    * { font-family: 'IBM Plex Sans', system-ui, sans-serif; }
    h1, h2, h3, .font-sora { font-family: 'Sora', system-ui, sans-serif; }
    .font-mono, .metric-value, [data-metric] { font-family: 'IBM Plex Mono', monospace; font-feature-settings: 'tnum' 1; }

    /* V30: Institutional Logo Animation - Refined 3-second fade-in */
    /* Inspired by Bloomberg/CoStar professional aesthetics */
    @keyframes logo-fade-in {
      0% {
        opacity: 0;
        transform: translateY(-8px) scale(0.98);
        filter: blur(4px);
      }
      30% {
        opacity: 0.4;
        transform: translateY(-3px) scale(0.995);
        filter: blur(2px);
      }
      60% {
        opacity: 0.8;
        transform: translateY(-1px) scale(0.998);
        filter: blur(0.5px);
      }
      100% {
        opacity: 1;
        transform: translateY(0) scale(1);
        filter: blur(0);
      }
    }

    /* Subtle shimmer effect after fade completes */
    @keyframes logo-shimmer {
      0% {
        filter: brightness(1);
      }
      50% {
        filter: brightness(1.08);
      }
      100% {
        filter: brightness(1);
      }
    }

    /* Elegant hover state - institutional restraint */
    .logo-animate {
      opacity: 0;
      animation: logo-fade-in 3s cubic-bezier(0.25, 0.1, 0.25, 1) forwards;
      cursor: pointer;
      transition: transform 0.4s cubic-bezier(0.25, 0.1, 0.25, 1),
                  filter 0.4s ease;
    }

    /* Post-animation shimmer - runs once after fade completes */
    .logo-animate.loaded {
      animation: logo-fade-in 3s cubic-bezier(0.25, 0.1, 0.25, 1) forwards,
                 logo-shimmer 1.5s ease-in-out 3s 1;
    }

    /* Institutional hover - subtle lift and soft glow */
    .logo-animate:hover {
      transform: translateY(-2px);
      filter: brightness(1.05) drop-shadow(0 4px 12px rgba(59, 130, 246, 0.15));
    }

    /* Active/click state - brief press feedback */
    .logo-animate:active {
      transform: translateY(0) scale(0.99);
      transition: transform 0.1s ease;
    }

    /* V22: Light Theme - Clean institutional */
    body {
      background: #f8fafc;
    }

    /* V22: Dark Theme - Navy institutional */
    .dark body {
      background: #0f172a;
    }

    /* V40: Top Navigation - Compact 100px height with 80px logo */
    .top-nav {
      height: 100px;
      position: sticky;
      top: 0;
      z-index: 40;
      background: #0f172a;
      border-bottom: 1px solid rgba(30, 58, 138, 0.5);
    }
    .dark .top-nav {
      background: #0f172a;
      border-bottom: 1px solid rgba(30, 58, 138, 0.5);
    }
    /* V40: Nav links - Institutional compact */
    .nav-link {
      padding: 8px 16px;
      font-size: 13px;
      color: #94a3b8;
      border-radius: 6px;
      transition: all 0.15s;
      cursor: pointer;
    }
    .nav-link:hover {
      background: rgba(59, 130, 246, 0.1);
      color: #e2e8f0;
    }
    .nav-link.active {
      background: rgba(59, 130, 246, 0.12);
      color: #ffffff;
      font-weight: 500;
    }
    @media (max-width: 1280px) { .desktop-nav { display: none; } }
    @media (min-width: 1281px) { #mobile-menu-btn { display: none !important; } }

    /* Main Content Area - Full Width */
    .main-content { min-height: 100vh; }

    /* V22: Navigation Items - Navy/Blue */
    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 16px;
      margin: 2px 12px;
      border-radius: 4px;
      color: #94a3b8;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.15s ease;
      cursor: pointer;
    }
    .nav-item:hover {
      background: rgba(59, 130, 246, 0.1);
      color: #e2e8f0;
    }
    .nav-item.active {
      background: rgba(59, 130, 246, 0.15);
      color: #fff;
      border-left: 2px solid #3b82f6;
      margin-left: 10px;
    }
    .dark .nav-item.active {
      box-shadow: 0 0 12px rgba(59, 130, 246, 0.15);
    }
    .nav-item svg { width: 20px; height: 20px; flex-shrink: 0; }

    /* V40: Sidebar removed for MVP - cleaner UX per Bob White's advice */

    /* V40: Cards - Clean institutional with subtle borders */
    .card {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      transition: all 0.2s ease;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);
    }
    .card:hover {
      border-color: #3b82f6;
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.08);
    }
    .dark .card {
      background: #1e293b;
      border: 1px solid rgba(59, 130, 246, 0.15);
    }
    .dark .card:hover {
      border-color: #3b82f6;
      box-shadow: 0 2px 12px rgba(59, 130, 246, 0.15);
    }

    /* V22: Section spacing and dividers */
    .section-gap { margin-bottom: 20px; }
    .section-divider {
      height: 1px;
      background: #1e3a8a;
      margin: 24px 0;
    }
    .dark .section-divider {
      background: #1e3a8a;
    }

    /* V22: Metric Cards - Blue accent */
    .metric-card { position: relative; overflow: hidden; }
    .metric-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; background: #3b82f6; opacity: 0; transition: opacity 0.2s; }
    .metric-card:hover::before { opacity: 1; }
    .metric-label { font-size: 11px; font-weight: 600; letter-spacing: 0.5px; text-transform: uppercase; color: #64748b; }
    .dark .metric-label { color: #94a3b8; }
    .metric-value { font-size: 24px; font-weight: 700; letter-spacing: -0.02em; color: #0f172a; }
    .dark .metric-value { color: #f1f5f9; }
    .metric-value.highlight { color: #3b82f6; }
    .dark .metric-value.highlight { color: #60a5fa; }
    .metric-delta { font-size: 12px; font-weight: 600; display: inline-flex; align-items: center; gap: 4px; padding: 2px 8px; border-radius: 4px; }
    .metric-delta.positive { background: rgba(16, 185, 129, 0.1); color: #059669; }
    .dark .metric-delta.positive { background: rgba(16, 185, 129, 0.2); color: #34d399; }
    .metric-delta.negative { background: rgba(239, 68, 68, 0.1); color: #dc2626; }
    .dark .metric-delta.negative { background: rgba(239, 68, 68, 0.2); color: #f87171; }

    /* Data Freshness - Bloomberg Style */
    .data-freshness { display: inline-flex; align-items: center; gap: 6px; font-size: 11px; font-weight: 500; color: #64748b; }
    .dark .data-freshness { color: #94a3b8; }
    .pulse-indicator { width: 8px; height: 8px; border-radius: 50%; background: #10b981; box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); animation: pulse-ring 2s infinite; }
    @keyframes pulse-ring { 0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); } 70% { box-shadow: 0 0 0 6px rgba(16, 185, 129, 0); } 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); } }

    /* Trust Badges - Institutional */
    .trust-badge { display: inline-flex; align-items: center; gap: 6px; padding: 4px 10px; background: #f1f5f9; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 10px; font-weight: 600; letter-spacing: 0.3px; text-transform: uppercase; color: #475569; }
    .dark .trust-badge { background: rgba(30, 58, 95, 0.5); border-color: rgba(14, 165, 233, 0.2); color: #94a3b8; }
    .trust-badge svg { width: 14px; height: 14px; }

    /* V40: Category Badges - Single Blue with Opacity Variations (Institutional) */
    /* Federal=100%, State=75%, Local=50%, Utility=25% opacity */
    .badge { display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 600; }
    .badge-federal { background: rgba(59, 130, 246, 0.15); color: #1d4ed8; border: 1px solid rgba(59, 130, 246, 0.3); }
    .badge-state { background: rgba(59, 130, 246, 0.11); color: #2563eb; border: 1px solid rgba(59, 130, 246, 0.22); }
    .badge-local { background: rgba(59, 130, 246, 0.08); color: #3b82f6; border: 1px solid rgba(59, 130, 246, 0.15); }
    .badge-utility { background: rgba(59, 130, 246, 0.04); color: #60a5fa; border: 1px solid rgba(59, 130, 246, 0.08); }
    .dark .badge-federal { background: rgba(59, 130, 246, 0.25); color: #93c5fd; border-color: rgba(59, 130, 246, 0.4); }
    .dark .badge-state { background: rgba(59, 130, 246, 0.18); color: #93c5fd; border-color: rgba(59, 130, 246, 0.3); }
    .dark .badge-local { background: rgba(59, 130, 246, 0.12); color: #60a5fa; border-color: rgba(59, 130, 246, 0.2); }
    .dark .badge-utility { background: rgba(59, 130, 246, 0.06); color: #60a5fa; border-color: rgba(59, 130, 246, 0.12); }

    /* V40: Status Badges - Blue/Teal institutional palette */
    .status-badge { padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: 600; }
    .status-success { background: rgba(20, 184, 166, 0.1); color: #0d9488; }
    .status-warning { background: rgba(59, 130, 246, 0.1); color: #2563eb; }
    .status-info { background: rgba(59, 130, 246, 0.08); color: #3b82f6; }
    .status-neutral { background: #f1f5f9; color: #64748b; }
    .dark .status-success { background: rgba(20, 184, 166, 0.2); color: #2dd4bf; }
    .dark .status-warning { background: rgba(59, 130, 246, 0.2); color: #60a5fa; }
    .dark .status-info { background: rgba(59, 130, 246, 0.15); color: #60a5fa; }
    .dark .status-neutral { background: rgba(100, 116, 139, 0.2); color: #94a3b8; }

    /* V22: Progress Bars - Blue accent */
    .progress-bar { height: 4px; background: #e2e8f0; border-radius: 2px; overflow: hidden; }
    .dark .progress-bar { background: #334155; }
    .progress-fill { height: 100%; background: #3b82f6; border-radius: 2px; transition: width 0.5s ease; }

    /* V22: Table Styles - Institutional with sort indicators */
    .data-table { width: 100%; border-collapse: collapse; }
    .data-table th { text-align: left; padding: 12px 16px; font-size: 11px; font-weight: 600; letter-spacing: 0.5px; text-transform: uppercase; color: #64748b; background: #f8fafc; border-bottom: 2px solid #e2e8f0; }
    .dark .data-table th { background: rgba(30, 58, 90, 0.7); color: #94a3b8; border-color: rgba(59, 130, 246, 0.15); }
    .data-table td { padding: 14px 16px; border-bottom: 1px solid #f1f5f9; font-size: 14px; color: #334155; }
    .dark .data-table td { border-color: rgba(59, 130, 246, 0.08); color: #e2e8f0; }
    .data-table tbody tr { transition: background 0.15s; }
    /* V22: Subtle zebra striping */
    .data-table tbody tr:nth-child(odd) { background: rgba(241, 245, 249, 0.5); }
    .data-table tbody tr:nth-child(even) { background: transparent; }
    .dark .data-table tbody tr:nth-child(odd) { background: rgba(30, 41, 59, 0.5); }
    .dark .data-table tbody tr:nth-child(even) { background: transparent; }
    .data-table tbody tr:hover { background: rgba(59, 130, 246, 0.08) !important; }
    .dark .data-table tbody tr:hover { background: rgba(59, 130, 246, 0.15) !important; }
    /* V22: Sort header with visual indicators */
    .sort-header { cursor: pointer; user-select: none; position: relative; padding-right: 24px !important; }
    .sort-header:hover { color: #3b82f6; }
    .sort-header::after {
      content: '▼';
      position: absolute;
      right: 8px;
      font-size: 8px;
      color: #cbd5e1;
      transition: all 0.15s;
    }
    .sort-header:hover::after { color: #3b82f6; }
    .sort-header.sort-asc::after { content: '▲'; color: #3b82f6; }
    .sort-header.sort-desc::after { content: '▼'; color: #3b82f6; }
    .sort-header.sort-asc, .sort-header.sort-desc {
      background: rgba(59, 130, 246, 0.1);
      color: #3b82f6;
    }
    .dark .sort-header::after { color: #475569; }
    .dark .sort-header.sort-asc::after, .dark .sort-header.sort-desc::after { color: #60a5fa; }
    .dark .sort-header.sort-asc, .dark .sort-header.sort-desc {
      background: rgba(59, 130, 246, 0.2);
      color: #60a5fa;
    }

    /* V22: Form Inputs - Blue accent */
    .form-input { width: 100%; height: 44px; padding: 0 14px; background: white; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 14px; color: #0f172a; transition: all 0.15s; }
    .form-input:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
    .dark .form-input { background: #1e293b; border-color: #334155; color: #f1f5f9; }
    .dark .form-input:focus { border-color: #3b82f6; }
    .dark .form-input::placeholder { color: #64748b; }
    .form-input.error { border-color: #ef4444; background: #fef2f2; }
    .dark .form-input.error { background: rgba(239, 68, 68, 0.1); }

    /* V22: Buttons - Navy/Blue institutional */
    .btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 10px 20px; border-radius: 6px; font-size: 14px; font-weight: 600; transition: all 0.15s; cursor: pointer; }
    .btn-primary { background: #3b82f6; color: white; box-shadow: 0 1px 4px rgba(59, 130, 246, 0.3); }
    .btn-primary:hover { background: #2563eb; box-shadow: 0 2px 8px rgba(59, 130, 246, 0.4); }
    .btn-secondary { background: #f1f5f9; color: #334155; border: 1px solid #cbd5e1; }
    .btn-secondary:hover { background: #e2e8f0; border-color: #94a3b8; }
    .dark .btn-secondary { background: #1e293b; color: #e2e8f0; border-color: #334155; }
    .dark .btn-secondary:hover { background: #334155; }

    /* V22: Tabs - Navy/Blue */
    .tab-list { display: flex; gap: 4px; padding: 4px; background: #f1f5f9; border-radius: 6px; }
    .dark .tab-list { background: #1e293b; }
    .tab-item { padding: 8px 16px; border-radius: 4px; font-size: 13px; font-weight: 500; color: #64748b; cursor: pointer; transition: all 0.15s; }
    .tab-item:hover { color: #334155; background: rgba(59, 130, 246, 0.05); }
    .tab-item.active { background: white; color: #0f172a; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); }
    .dark .tab-item { color: #94a3b8; }
    .dark .tab-item:hover { background: rgba(59, 130, 246, 0.1); color: #e2e8f0; }
    .dark .tab-item.active { background: #3b82f6; color: #ffffff; }

    /* Command Palette */
    .command-overlay { position: fixed; inset: 0; z-index: 100; background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(4px); opacity: 0; visibility: hidden; transition: all 0.2s; }
    .command-overlay.open { opacity: 1; visibility: visible; }
    .dark .command-overlay { background: rgba(0, 0, 0, 0.7); }
    .command-modal { position: fixed; top: 20%; left: 50%; transform: translateX(-50%) translateY(-20px); z-index: 101; width: 90%; max-width: 600px; background: white; border-radius: 16px; box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25); opacity: 0; visibility: hidden; transition: all 0.2s; }
    .command-overlay.open + .command-modal, .command-modal.open { opacity: 1; visibility: visible; transform: translateX(-50%) translateY(0); }
    .dark .command-modal { background: #115e59; border: 1px solid rgba(20, 184, 166, 0.2); }

    /* Toast Notifications */
    .toast-container { position: fixed; top: 20px; right: 20px; z-index: 200; display: flex; flex-direction: column; gap: 12px; }
    .toast { display: flex; align-items: flex-start; gap: 12px; padding: 16px 20px; background: white; border-radius: 12px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15); min-width: 320px; max-width: 420px; transform: translateX(120%); opacity: 0; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
    .toast.show { transform: translateX(0); opacity: 1; }
    .dark .toast { background: #115e59; border: 1px solid rgba(20, 184, 166, 0.2); }
    .toast-success { border-left: 4px solid #14b8a6; }
    .toast-error { border-left: 4px solid #ef4444; }
    .toast-warning { border-left: 4px solid #3b82f6; }
    .toast-info { border-left: 4px solid #60a5fa; }

    /* Comparison Modal */
    .modal-overlay { position: fixed; inset: 0; z-index: 150; background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(4px); opacity: 0; visibility: hidden; transition: all 0.2s; }
    .modal-overlay.open { opacity: 1; visibility: visible; }
    .modal-content { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.95); z-index: 151; width: 95%; max-width: 1200px; max-height: 90vh; background: white; border-radius: 16px; box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25); overflow: hidden; opacity: 0; visibility: hidden; transition: all 0.2s; }
    .modal-overlay.open + .modal-content, .modal-content.open { opacity: 1; visibility: visible; transform: translate(-50%, -50%) scale(1); }
    .dark .modal-content { background: #134e4a; border: 1px solid rgba(20, 184, 166, 0.2); }

    /* Section Headers */
    .section-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
    .section-title { font-family: 'Sora', sans-serif; font-size: 16px; font-weight: 600; color: #0f172a; }
    .dark .section-title { color: #f1f5f9; }
    .section-subtitle { font-size: 13px; color: #64748b; }
    .dark .section-subtitle { color: #94a3b8; }

    /* Responsive */
    @media (max-width: 1024px) {
      .sidebar { transform: translateX(-100%); }
      .sidebar.open { transform: translateX(0); }
      .main-content { margin-left: 0; }
      .mobile-menu-btn { display: flex !important; }
    }
    @media (max-width: 768px) {
      .metric-grid { grid-template-columns: repeat(2, 1fr) !important; }
      .hide-mobile { display: none !important; }
    }

    /* Print Styles */
    @media print {
      .sidebar, .toast-container, .command-overlay, .command-modal, .modal-overlay, .modal-content { display: none !important; }
      .main-content { margin-left: 0 !important; }
      body { background: white !important; }
      .dark body { background: white !important; }
      * { color: black !important; background: transparent !important; }
    }

    /* Timeline */
    .timeline { position: relative; padding-left: 28px; }
    .timeline::before { content: ''; position: absolute; left: 8px; top: 8px; bottom: 8px; width: 2px; background: #e2e8f0; }
    .dark .timeline::before { background: rgba(20, 184, 166, 0.2); }
    .timeline-item { position: relative; padding-bottom: 24px; }
    .timeline-item:last-child { padding-bottom: 0; }
    .timeline-dot { position: absolute; left: -28px; top: 4px; width: 18px; height: 18px; border-radius: 50%; background: white; border: 2px solid #e2e8f0; z-index: 1; }
    .dark .timeline-dot { background: #134e4a; border-color: rgba(20, 184, 166, 0.3); }
    .timeline-dot.completed { background: #10b981; border-color: #10b981; }
    .timeline-dot.active { background: #14b8a6; border-color: #14b8a6; box-shadow: 0 0 0 4px rgba(20, 184, 166, 0.2); }
    .timeline-dot.warning { background: #3b82f6; border-color: #3b82f6; }

    /* Animations */
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .animate-in { animation: fadeInUp 0.4s ease-out forwards; }
    .delay-1 { animation-delay: 0.1s; opacity: 0; }
    .delay-2 { animation-delay: 0.2s; opacity: 0; }
    .delay-3 { animation-delay: 0.3s; opacity: 0; }

    /* Spinner */
    @keyframes spin { to { transform: rotate(360deg); } }
    .spinner { width: 20px; height: 20px; border: 2px solid #e2e8f0; border-top-color: #14b8a6; border-radius: 50%; animation: spin 0.8s linear infinite; }

    /* V22: Ticker Bar - Navy institutional */
    .ticker-bar { height: 32px; background: #0f172a; border-bottom: 1px solid #1e3a8a; overflow: hidden; position: relative; }
    .ticker-content { display: flex; align-items: center; height: 100%; animation: ticker-scroll 60s linear infinite; white-space: nowrap; }
    .ticker-content:hover { animation-play-state: paused; }
    @keyframes ticker-scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
    .ticker-item { display: inline-flex; align-items: center; gap: 8px; padding: 0 24px; font-size: 12px; font-family: 'IBM Plex Mono', monospace; border-right: 1px solid rgba(59, 130, 246, 0.15); }
    .ticker-label { color: #94a3b8; font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px; }
    .ticker-value { color: #f1f5f9; font-weight: 600; }
    .ticker-value.positive { color: #34d399; }
    .ticker-value.negative { color: #f87171; }
    .ticker-value.urgent { color: #60a5fa; }
    .ticker-badge { padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: 700; text-transform: uppercase; }
    .ticker-badge.new { background: rgba(59, 130, 246, 0.3); color: #60a5fa; }
    .ticker-badge.deadline { background: rgba(20, 184, 166, 0.3); color: #2dd4bf; }
    .ticker-badge.alert { background: rgba(239, 68, 68, 0.3); color: #f87171; }

    /* V22: Prominent Scenario Selector Card Row (3x bigger) */
    .scenario-card-row {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      padding: 20px;
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      border: 1px solid #1e3a8a;
      border-radius: 8px;
      margin-top: 16px;
    }
    .dark .scenario-card-row {
      background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
      border-color: #1e3a8a;
    }
    .scenario-card-item {
      padding: 16px 20px;
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
    }
    .scenario-card-item:hover {
      border-color: #3b82f6;
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.15);
    }
    .scenario-card-item.active {
      border-color: #3b82f6;
      border-width: 2px;
      background: rgba(59, 130, 246, 0.05);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
    }
    .dark .scenario-card-item {
      background: #1e293b;
      border-color: #334155;
    }
    .dark .scenario-card-item:hover {
      border-color: #3b82f6;
    }
    .dark .scenario-card-item.active {
      background: rgba(59, 130, 246, 0.15);
      border-color: #3b82f6;
    }
    .scenario-card-label {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #64748b;
      margin-bottom: 4px;
    }
    .dark .scenario-card-label { color: #94a3b8; }
    .scenario-card-item.active .scenario-card-label { color: #3b82f6; }
    .dark .scenario-card-item.active .scenario-card-label { color: #60a5fa; }
    .scenario-card-value {
      font-size: 28px;
      font-weight: 700;
      font-family: 'IBM Plex Mono', monospace;
      color: #0f172a;
      line-height: 1.2;
    }
    .dark .scenario-card-value { color: #f1f5f9; }
    .scenario-card-item.active .scenario-card-value { color: #3b82f6; }
    .dark .scenario-card-item.active .scenario-card-value { color: #60a5fa; }
    .scenario-card-confidence {
      font-size: 12px;
      color: #64748b;
      margin-top: 4px;
    }
    .dark .scenario-card-confidence { color: #94a3b8; }
    .scenario-card-item.active .scenario-card-confidence { color: #3b82f6; }
    .scenario-methodology-link {
      grid-column: 1 / -1;
      text-align: center;
      padding-top: 8px;
      border-top: 1px solid #e2e8f0;
      margin-top: 4px;
    }
    .dark .scenario-methodology-link { border-top-color: #334155; }
    .scenario-methodology-link a {
      font-size: 11px;
      color: #64748b;
      text-decoration: none;
      transition: color 0.15s;
    }
    .scenario-methodology-link a:hover { color: #3b82f6; }
    .dark .scenario-methodology-link a { color: #94a3b8; }
    .dark .scenario-methodology-link a:hover { color: #60a5fa; }

    /* V23: Unified KPI Scenario Buttons */
    .scenario-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.15s ease;
      background: transparent;
      border: none;
      min-width: 70px;
    }
    .scenario-btn:hover {
      background: rgba(59, 130, 246, 0.1);
    }
    .scenario-btn.active {
      background: #3b82f6;
    }
    .dark .scenario-btn:hover {
      background: rgba(59, 130, 246, 0.2);
    }
    .dark .scenario-btn.active {
      background: #2563eb;
    }
    .scenario-btn .scenario-label {
      font-size: 9px;
      font-weight: 600;
      letter-spacing: 0.5px;
      color: #64748b;
      text-transform: uppercase;
    }
    .scenario-btn:hover .scenario-label,
    .scenario-btn.active .scenario-label {
      color: #3b82f6;
    }
    .scenario-btn.active .scenario-label {
      color: white;
    }
    .dark .scenario-btn .scenario-label {
      color: #94a3b8;
    }
    .dark .scenario-btn:hover .scenario-label {
      color: #60a5fa;
    }
    .dark .scenario-btn.active .scenario-label {
      color: white;
    }
    .scenario-btn .scenario-value {
      font-size: 12px;
      font-weight: 600;
      color: #334155;
      font-variant-numeric: tabular-nums;
      font-family: 'IBM Plex Mono', monospace;
      margin-top: 2px;
    }
    .scenario-btn:hover .scenario-value {
      color: #1e293b;
    }
    .scenario-btn.active .scenario-value {
      color: white;
      font-weight: 700;
    }
    .dark .scenario-btn .scenario-value {
      color: #e2e8f0;
    }
    .dark .scenario-btn:hover .scenario-value {
      color: #f8fafc;
    }
    .dark .scenario-btn.active .scenario-value {
      color: white;
    }

    /* V22: Hide old inline scenario selector */
    .scenario-inline-container {
      display: none;
    }
    .scenario-inline {
      display: flex;
      align-items: center;
      gap: 0;
    }
    .scenario-inline-item {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 3px 6px;
      border-radius: 3px;
      cursor: pointer;
      transition: all 0.1s ease;
      background: transparent;
      border: none;
    }
    .scenario-inline-item:hover {
      background: rgba(59, 130, 246, 0.1);
    }
    .scenario-inline-item.active {
      background: rgba(59, 130, 246, 0.15);
      border-top: 2px solid #3b82f6;
      padding-top: 1px;
    }
    .dark .scenario-inline-item:hover {
      background: rgba(59, 130, 246, 0.2);
    }
    .dark .scenario-inline-item.active {
      background: rgba(59, 130, 246, 0.25);
    }
    .scenario-inline-abbr {
      font-size: 9px;
      font-weight: 600;
      letter-spacing: 0.3px;
      color: #64748b;
      text-transform: uppercase;
    }
    .scenario-inline-item:hover .scenario-inline-abbr,
    .scenario-inline-item.active .scenario-inline-abbr {
      color: #3b82f6;
    }
    .dark .scenario-inline-abbr { color: #94a3b8; }
    .dark .scenario-inline-item:hover .scenario-inline-abbr,
    .dark .scenario-inline-item.active .scenario-inline-abbr {
      color: #60a5fa;
    }
    .scenario-inline-val {
      font-size: 11px;
      font-weight: 500;
      color: #334155;
      font-variant-numeric: tabular-nums;
    }
    .scenario-inline-item:hover .scenario-inline-val {
      color: #1e293b;
      font-weight: 600;
    }
    .scenario-inline-item.active .scenario-inline-val {
      color: #0f172a;
      font-weight: 700;
    }
    .dark .scenario-inline-val { color: #e2e8f0; }
    .dark .scenario-inline-item:hover .scenario-inline-val { color: #f8fafc; }
    .dark .scenario-inline-item.active .scenario-inline-val { color: #ffffff; }
    .scenario-inline-sep {
      color: #cbd5e1;
      font-size: 10px;
      padding: 0 2px;
    }
    .dark .scenario-inline-sep { color: #475569; }
    .scenario-info-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #e2e8f0;
      color: #64748b;
      border: none;
      cursor: pointer;
      transition: all 0.15s;
    }
    .scenario-info-btn:hover {
      background: #3b82f6;
      color: white;
    }
    .dark .scenario-info-btn {
      background: #475569;
      color: #94a3b8;
    }
    .dark .scenario-info-btn:hover {
      background: #60a5fa;
      color: white;
    }

    /* V21: Enhanced incentive row hover effects */
    .incentive-row {
      transition: all 0.15s ease;
    }
    .incentive-row:hover {
      background: rgba(59, 130, 246, 0.08) !important;
      transform: translateX(2px);
    }
    .dark .incentive-row:hover {
      background: rgba(59, 130, 246, 0.15) !important;
    }
    .incentive-row td {
      transition: all 0.15s ease;
    }
    .incentive-row:hover td:first-child p:first-child {
      color: #2563eb;
    }
    .dark .incentive-row:hover td:first-child p:first-child {
      color: #60a5fa;
    }
    .incentive-row:hover .text-blue-600,
    .incentive-row:hover .text-blue-300 {
      transform: scale(1.05);
    }

    /* V24: Actions Slide-out Panel */
    .actions-panel {
      position: fixed;
      top: 0;
      right: -420px;
      width: 420px;
      height: 100vh;
      background: white;
      box-shadow: -4px 0 20px rgba(0,0,0,0.15);
      z-index: 100;
      transition: right 0.3s ease;
      overflow-y: auto;
    }
    .dark .actions-panel {
      background: #1e293b;
      box-shadow: -4px 0 20px rgba(0,0,0,0.4);
    }
    .actions-panel.open {
      right: 0;
    }
    .actions-panel-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.3);
      z-index: 99;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    .actions-panel-overlay.open {
      opacity: 1;
      visibility: visible;
    }
    .action-item {
      padding: 16px;
      border-bottom: 1px solid #e2e8f0;
      transition: background 0.15s;
    }
    .dark .action-item {
      border-color: #334155;
    }
    .action-item:hover {
      background: #f8fafc;
    }
    .dark .action-item:hover {
      background: #334155;
    }
    .action-item.urgent {
      border-left: 4px solid #14b8a6;
    }
    .action-item.critical {
      border-left: 4px solid #ef4444;
    }

    /* V24: Scenario Tab Styling for KPI Header */
    .scenario-tab {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.15s ease;
      background: transparent;
      border: 1px solid transparent;
      min-width: 80px;
    }
    .scenario-tab:hover {
      background: rgba(59, 130, 246, 0.08);
      border-color: rgba(59, 130, 246, 0.2);
    }
    .scenario-tab.active {
      background: #3b82f6;
      border-color: #3b82f6;
    }
    .dark .scenario-tab:hover {
      background: rgba(59, 130, 246, 0.15);
    }
    .dark .scenario-tab.active {
      background: #2563eb;
      border-color: #2563eb;
    }
    .scenario-tab-label {
      font-size: 10px;
      font-weight: 600;
      letter-spacing: 0.5px;
      color: #64748b;
      text-transform: uppercase;
    }
    .scenario-tab:hover .scenario-tab-label {
      color: #3b82f6;
    }
    .scenario-tab.active .scenario-tab-label {
      color: white;
    }
    .dark .scenario-tab-label {
      color: #94a3b8;
    }
    .dark .scenario-tab:hover .scenario-tab-label {
      color: #60a5fa;
    }
    .scenario-tab-value {
      font-size: 14px;
      font-weight: 700;
      color: #1e293b;
      font-family: 'IBM Plex Mono', monospace;
      margin-top: 2px;
    }
    .scenario-tab:hover .scenario-tab-value {
      color: #0f172a;
    }
    .scenario-tab.active .scenario-tab-value {
      color: white;
    }
    .dark .scenario-tab-value {
      color: #e2e8f0;
    }
    .dark .scenario-tab.active .scenario-tab-value {
      color: white;
    }

    /* V27: Compact Scenario Cards for Horizontal Strip (1.5x larger) */
    .scenario-card-compact {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 12px 24px;
      min-width: 110px;
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.15s ease;
    }
    .scenario-card-compact:hover {
      border-color: #3b82f6;
      background: #f8fafc;
    }
    .scenario-card-compact.active {
      background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
      border-color: #1e3a8a;
      box-shadow: 0 2px 8px rgba(30, 58, 138, 0.25);
    }
    .dark .scenario-card-compact {
      background: #1e293b;
      border-color: #334155;
    }
    .dark .scenario-card-compact:hover {
      border-color: #3b82f6;
      background: #334155;
    }
    .dark .scenario-card-compact.active {
      background: linear-gradient(135deg, #1e40af 0%, #2563eb 100%);
      border-color: #3b82f6;
    }
    .scenario-compact-label {
      font-size: 10px;
      font-weight: 700;
      letter-spacing: 0.5px;
      color: #64748b;
      line-height: 1;
    }
    .scenario-card-compact:hover .scenario-compact-label {
      color: #3b82f6;
    }
    .scenario-card-compact.active .scenario-compact-label {
      color: rgba(255, 255, 255, 0.7);
    }
    .dark .scenario-compact-label {
      color: #94a3b8;
    }
    .scenario-compact-value {
      font-size: 18px;
      font-weight: 800;
      font-family: 'IBM Plex Mono', monospace;
      color: #0f172a;
      line-height: 1.3;
    }
    .scenario-card-compact:hover .scenario-compact-value {
      color: #1e3a8a;
    }
    .scenario-card-compact.active .scenario-compact-value {
      color: #ffffff;
    }
    .dark .scenario-compact-value {
      color: #f1f5f9;
    }
    .dark .scenario-card-compact.active .scenario-compact-value {
      color: #ffffff;
    }
    .scenario-compact-conf {
      font-size: 9px;
      font-weight: 600;
      color: #94a3b8;
      line-height: 1;
      margin-top: 2px;
    }
    .scenario-card-compact.active .scenario-compact-conf {
      color: rgba(255, 255, 255, 0.6);
    }

    /* V25: Prominent Centered Scenario Cards (Legacy - kept for compatibility) */
    .scenario-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px 32px;
      min-width: 160px;
      background: white;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .scenario-card:hover {
      border-color: #3b82f6;
      background: #f8fafc;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
    }
    .scenario-card.active {
      border-color: #1e3a8a;
      border-width: 3px;
      background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
      box-shadow: 0 8px 24px rgba(30, 58, 138, 0.25);
      transform: translateY(-2px);
    }
    .dark .scenario-card {
      background: #1e293b;
      border-color: #334155;
    }
    .dark .scenario-card:hover {
      border-color: #3b82f6;
      background: #334155;
    }
    .dark .scenario-card.active {
      background: linear-gradient(135deg, #1e40af 0%, #2563eb 100%);
      border-color: #3b82f6;
    }
    .scenario-card-header {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #64748b;
      margin-bottom: 8px;
    }
    .scenario-card:hover .scenario-card-header {
      color: #3b82f6;
    }
    .scenario-card.active .scenario-card-header {
      color: rgba(255, 255, 255, 0.85);
    }
    .dark .scenario-card-header {
      color: #94a3b8;
    }
    .dark .scenario-card:hover .scenario-card-header {
      color: #60a5fa;
    }
    .scenario-card-value {
      font-size: 28px;
      font-weight: 800;
      font-family: 'IBM Plex Mono', monospace;
      color: #0f172a;
      line-height: 1;
      margin-bottom: 10px;
    }
    .scenario-card:hover .scenario-card-value {
      color: #1e3a8a;
    }
    .scenario-card.active .scenario-card-value {
      color: #ffffff;
    }
    .dark .scenario-card-value {
      color: #f1f5f9;
    }
    .dark .scenario-card.active .scenario-card-value {
      color: #ffffff;
    }
    .scenario-card-confidence {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      width: 100%;
    }
    .scenario-confidence-bar {
      display: block;
      height: 4px;
      background: #3b82f6;
      border-radius: 2px;
      transition: width 0.3s ease;
    }
    .scenario-card.active .scenario-confidence-bar {
      background: rgba(255, 255, 255, 0.7);
    }
    .dark .scenario-confidence-bar {
      background: #60a5fa;
    }
    .scenario-confidence-text {
      font-size: 11px;
      font-weight: 500;
      color: #64748b;
    }
    .scenario-card.active .scenario-confidence-text {
      color: rgba(255, 255, 255, 0.75);
    }
    .dark .scenario-confidence-text {
      color: #94a3b8;
    }

    /* V24: Row Highlighting Based on Scenario Match - All Text Readable */
    .incentive-row.scenario-match {
      background: linear-gradient(90deg, rgba(59, 130, 246, 0.08) 0%, rgba(59, 130, 246, 0.04) 100%);
      border-left: 3px solid #3b82f6;
    }
    .dark .incentive-row.scenario-match {
      background: linear-gradient(90deg, rgba(59, 130, 246, 0.15) 0%, rgba(59, 130, 246, 0.08) 100%);
    }
    .incentive-row.scenario-partial {
      background: rgba(148, 163, 184, 0.05);
    }
    .incentive-row {
      transition: background 0.2s ease, border-left 0.2s ease;
      border-left: 3px solid transparent;
    }

    /* V24: Clickable Actions Badge */
    .actions-badge {
      cursor: pointer;
      transition: all 0.15s ease;
    }
    .actions-badge:hover {
      transform: scale(1.05);
      box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
    }

    /* V26: Table Enhancements - Mini Probability Bars */
    .prob-bar-container {
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: flex-end;
    }
    .prob-bar {
      width: 48px;
      height: 6px;
      background: #e2e8f0;
      border-radius: 3px;
      overflow: hidden;
    }
    .dark .prob-bar {
      background: #334155;
    }
    .prob-bar-fill {
      height: 100%;
      border-radius: 3px;
      transition: width 0.3s ease;
    }
    .prob-bar-fill.high { background: linear-gradient(90deg, #14b8a6, #0d9488); }
    .prob-bar-fill.medium { background: linear-gradient(90deg, #3b82f6, #2563eb); }
    .prob-bar-fill.low { background: linear-gradient(90deg, #64748b, #475569); }

    /* V26: Amount column with subtle trend indicator */
    .amount-cell {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
    }
    .amount-primary {
      font-family: 'IBM Plex Mono', monospace;
      font-weight: 600;
    }
    .amount-trend {
      font-size: 10px;
      color: #10b981;
    }
    .amount-trend.down {
      color: #ef4444;
    }

    /* V26: Tighter table density */
    .data-table.dense td {
      padding: 10px 12px;
    }
    .data-table.dense th {
      padding: 8px 12px;
      font-size: 10px;
    }

    /* V31: Guided Onboarding Flow */
    .onboarding-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.95);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.4s ease, visibility 0.4s ease;
    }
    .onboarding-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    .onboarding-modal {
      background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
      border: 1px solid #334155;
      border-radius: 16px;
      width: 90%;
      max-width: 720px;
      max-height: 85vh;
      overflow: hidden;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      transform: translateY(20px) scale(0.98);
      transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }
    .onboarding-overlay.active .onboarding-modal {
      transform: translateY(0) scale(1);
    }
    .onboarding-header {
      padding: 32px 40px 24px;
      border-bottom: 1px solid #334155;
    }
    .onboarding-progress {
      display: flex;
      gap: 8px;
      margin-top: 20px;
    }
    .onboarding-progress-step {
      flex: 1;
      height: 4px;
      background: #334155;
      border-radius: 2px;
      transition: background 0.3s ease;
    }
    .onboarding-progress-step.completed {
      background: #3b82f6;
    }
    .onboarding-progress-step.active {
      background: linear-gradient(90deg, #3b82f6, #60a5fa);
    }
    .onboarding-content {
      padding: 32px 40px;
      max-height: 400px;
      overflow-y: auto;
    }
    .onboarding-step {
      display: none;
      animation: onboardingFadeIn 0.4s ease forwards;
    }
    .onboarding-step.active {
      display: block;
    }
    @keyframes onboardingFadeIn {
      from { opacity: 0; transform: translateX(20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    .onboarding-option {
      display: flex;
      align-items: flex-start;
      gap: 16px;
      padding: 16px 20px;
      background: #1e293b;
      border: 2px solid #334155;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-bottom: 12px;
    }
    .onboarding-option:hover {
      border-color: #3b82f6;
      background: #1e3a5f;
    }
    .onboarding-option.selected {
      border-color: #3b82f6;
      background: rgba(59, 130, 246, 0.15);
    }
    .onboarding-option-radio {
      width: 22px;
      height: 22px;
      border: 2px solid #475569;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      margin-top: 2px;
      transition: all 0.2s ease;
    }
    .onboarding-option.selected .onboarding-option-radio {
      border-color: #3b82f6;
      background: #3b82f6;
    }
    .onboarding-option.selected .onboarding-option-radio::after {
      content: '';
      width: 8px;
      height: 8px;
      background: white;
      border-radius: 50%;
    }
    .onboarding-footer {
      padding: 24px 40px 32px;
      border-top: 1px solid #334155;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .onboarding-btn {
      padding: 12px 28px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s ease;
      cursor: pointer;
    }
    .onboarding-btn-secondary {
      background: transparent;
      color: #94a3b8;
      border: 1px solid #475569;
    }
    .onboarding-btn-secondary:hover {
      color: #e2e8f0;
      border-color: #64748b;
    }
    .onboarding-btn-primary {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      color: white;
      border: none;
      box-shadow: 0 4px 14px rgba(59, 130, 246, 0.4);
    }
    .onboarding-btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 20px rgba(59, 130, 246, 0.5);
    }
    .onboarding-btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* V31: Skeleton Loaders */
    .skeleton {
      background: linear-gradient(90deg, #1e293b 25%, #334155 50%, #1e293b 75%);
      background-size: 200% 100%;
      animation: skeletonShimmer 1.5s infinite;
      border-radius: 6px;
    }
    .skeleton-text {
      height: 14px;
      margin-bottom: 8px;
    }
    .skeleton-text.short { width: 40%; }
    .skeleton-text.medium { width: 70%; }
    .skeleton-text.long { width: 100%; }
    .skeleton-card {
      height: 120px;
      border-radius: 12px;
    }
    .skeleton-row {
      height: 48px;
      margin-bottom: 8px;
    }
    .skeleton-circle {
      width: 40px;
      height: 40px;
      border-radius: 50%;
    }
    @keyframes skeletonShimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    .skeleton-container {
      display: none;
    }
    .loading .skeleton-container {
      display: block;
    }
    .loading .content-container {
      display: none;
    }

    /* V31: Empty States */
    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 60px 40px;
      text-align: center;
    }
    .empty-state-icon {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 24px;
    }
    .empty-state-icon svg {
      width: 36px;
      height: 36px;
      color: #3b82f6;
    }
    .empty-state-title {
      font-size: 18px;
      font-weight: 600;
      color: #e2e8f0;
      margin-bottom: 8px;
    }
    .empty-state-description {
      font-size: 14px;
      color: #94a3b8;
      max-width: 360px;
      margin-bottom: 24px;
      line-height: 1.6;
    }
    .empty-state-action {
      padding: 12px 24px;
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      color: white;
      border-radius: 8px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      border: none;
    }
    .empty-state-action:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(59, 130, 246, 0.4);
    }

    /* V31: Error States */
    .error-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 48px 40px;
      text-align: center;
      background: rgba(239, 68, 68, 0.05);
      border: 1px solid rgba(239, 68, 68, 0.2);
      border-radius: 12px;
    }
    .error-state-icon {
      width: 64px;
      height: 64px;
      background: rgba(239, 68, 68, 0.1);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
    }
    .error-state-icon svg {
      width: 28px;
      height: 28px;
      color: #ef4444;
    }
    .error-state-title {
      font-size: 16px;
      font-weight: 600;
      color: #fca5a5;
      margin-bottom: 8px;
    }
    .error-state-description {
      font-size: 14px;
      color: #94a3b8;
      margin-bottom: 20px;
    }
    .error-state-retry {
      padding: 10px 20px;
      background: transparent;
      color: #f87171;
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 6px;
      font-weight: 500;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .error-state-retry:hover {
      background: rgba(239, 68, 68, 0.1);
      border-color: rgba(239, 68, 68, 0.5);
    }

    /* V31: Section Loading Transitions */
    .section-transition {
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.3s ease, transform 0.3s ease;
    }
    .section-transition.visible {
      opacity: 1;
      transform: translateY(0);
    }

    /* V31: Address Autocomplete (Google Places style) */
    .address-autocomplete-container {
      position: relative;
    }
    .address-autocomplete-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 8px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
      z-index: 100;
      max-height: 280px;
      overflow-y: auto;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-8px);
      transition: all 0.2s ease;
    }
    .address-autocomplete-dropdown.active {
      opacity: 1;
      visibility: visible;
      transform: translateY(4px);
    }
    .light .address-autocomplete-dropdown,
    body:not(.dark) .address-autocomplete-dropdown {
      background: white;
      border-color: #e2e8f0;
    }
    .address-autocomplete-item {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 12px 16px;
      cursor: pointer;
      transition: background 0.15s ease;
      border-bottom: 1px solid #334155;
    }
    body:not(.dark) .address-autocomplete-item {
      border-bottom-color: #f1f5f9;
    }
    .address-autocomplete-item:last-child {
      border-bottom: none;
    }
    .address-autocomplete-item:hover {
      background: #334155;
    }
    body:not(.dark) .address-autocomplete-item:hover {
      background: #f1f5f9;
    }
    .address-autocomplete-icon {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
      color: #3b82f6;
      margin-top: 2px;
    }
    .address-autocomplete-main {
      font-weight: 500;
      color: #e2e8f0;
      font-size: 14px;
    }
    body:not(.dark) .address-autocomplete-main {
      color: #1e293b;
    }
    .address-autocomplete-secondary {
      font-size: 12px;
      color: #94a3b8;
      margin-top: 2px;
    }
    .address-autocomplete-loading {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 16px;
      color: #94a3b8;
      font-size: 13px;
    }
    .address-autocomplete-loading svg {
      width: 16px;
      height: 16px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    .address-verified-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.3);
      border-radius: 4px;
      font-size: 11px;
      color: #10b981;
      margin-left: 8px;
    }

    /* V31: Probability Score Breakdown */
    .prob-breakdown {
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 12px;
      padding: 20px;
      margin-top: 16px;
    }
    body:not(.dark) .prob-breakdown {
      background: #f8fafc;
      border-color: #e2e8f0;
    }
    .prob-factor {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #334155;
    }
    body:not(.dark) .prob-factor {
      border-bottom-color: #e2e8f0;
    }
    .prob-factor:last-child {
      border-bottom: none;
    }
    .prob-factor-name {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: #e2e8f0;
    }
    body:not(.dark) .prob-factor-name {
      color: #334155;
    }
    .prob-factor-icon {
      width: 16px;
      height: 16px;
    }
    .prob-factor-icon.positive { color: #14b8a6; }
    .prob-factor-icon.negative { color: #64748b; }
    .prob-factor-icon.neutral { color: #3b82f6; }
    .prob-factor-value {
      font-family: 'IBM Plex Mono', monospace;
      font-weight: 600;
      font-size: 13px;
    }
    .prob-factor-value.positive { color: #14b8a6; }
    .prob-factor-value.negative { color: #64748b; }
    .prob-factor-value.neutral { color: #3b82f6; }

    /* V31: Self-Serve Signup Modal */
    .signup-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.95);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    .signup-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    .signup-modal {
      background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
      border: 1px solid #334155;
      border-radius: 16px;
      width: 90%;
      max-width: 480px;
      overflow: hidden;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      transform: scale(0.95);
      transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    }
    .signup-overlay.active .signup-modal {
      transform: scale(1);
    }
    .signup-input {
      width: 100%;
      padding: 12px 16px;
      background: #0f172a;
      border: 1px solid #334155;
      border-radius: 8px;
      color: #e2e8f0;
      font-size: 14px;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    .signup-input:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    .signup-input::placeholder {
      color: #64748b;
    }
    .signup-btn {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 15px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .signup-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
    }
    .signup-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    .signup-divider {
      display: flex;
      align-items: center;
      gap: 16px;
      color: #64748b;
      font-size: 12px;
    }
    .signup-divider::before, .signup-divider::after {
      content: '';
      flex: 1;
      height: 1px;
      background: #334155;
    }
    .signup-social-btn {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px;
      background: #0f172a;
      border: 1px solid #334155;
      border-radius: 8px;
      color: #e2e8f0;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .signup-social-btn:hover {
      background: #1e293b;
      border-color: #475569;
    }

    /* V31: Community Tier Toggle */
    .tier-toggle {
      display: flex;
      background: #1e293b;
      border-radius: 8px;
      padding: 4px;
      gap: 4px;
    }
    .tier-toggle-btn {
      flex: 1;
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      border: none;
      background: transparent;
      color: #94a3b8;
    }
    .tier-toggle-btn.active {
      background: #3b82f6;
      color: white;
    }
    .tier-toggle-btn:hover:not(.active) {
      color: #e2e8f0;
    }
    .community-mode .enterprise-only {
      display: none !important;
    }
    .community-mode .card {
      border-color: #10b981 !important;
    }
    .community-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 10px;
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.3);
      border-radius: 999px;
      font-size: 11px;
      font-weight: 600;
      color: #10b981;
    }

    /* V31: Portfolio Dashboard Styles */
    .portfolio-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 16px;
    }
    .portfolio-card {
      background: #0f172a;
      border: 1px solid #1e293b;
      border-radius: 12px;
      overflow: hidden;
      transition: all 0.2s ease;
    }
    .portfolio-card:hover {
      border-color: #3b82f6;
      transform: translateY(-2px);
      box-shadow: 0 8px 25px -5px rgba(59, 130, 246, 0.2);
    }
    .portfolio-card-header {
      padding: 16px;
      border-bottom: 1px solid #1e293b;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
    }
    .portfolio-card-body {
      padding: 16px;
    }
    .portfolio-metric {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #1e293b;
    }
    .portfolio-metric:last-child {
      border-bottom: none;
    }
    .portfolio-status-bar {
      display: flex;
      gap: 4px;
      margin-top: 12px;
    }
    .portfolio-status-segment {
      height: 6px;
      border-radius: 3px;
      flex: 1;
    }
    .portfolio-summary-card {
      background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
      border-radius: 16px;
      padding: 24px;
      color: white;
    }
    .portfolio-summary-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-top: 20px;
    }
    .portfolio-summary-stat {
      text-align: center;
    }
    .portfolio-summary-stat .value {
      font-size: 2rem;
      font-weight: 700;
      font-family: 'JetBrains Mono', monospace;
    }
    .portfolio-summary-stat .label {
      font-size: 0.75rem;
      opacity: 0.8;
      margin-top: 4px;
    }
    .portfolio-filter-bar {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .portfolio-filter-btn {
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      border: 1px solid #334155;
      background: transparent;
      color: #94a3b8;
    }
    .portfolio-filter-btn:hover {
      border-color: #3b82f6;
      color: #3b82f6;
    }
    .portfolio-filter-btn.active {
      background: #3b82f6;
      border-color: #3b82f6;
      color: white;
    }

    /* V31: Environmental Justice Map Styles */
    .ej-map-container {
      position: relative;
      height: 500px;
      border-radius: 12px;
      overflow: hidden;
      background: #0a1628;
    }
    .ej-map-placeholder {
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #0a1628 0%, #1e293b 100%);
      display: flex;
      flex-direction: column;
      position: relative;
    }
    .ej-map-grid {
      position: absolute;
      inset: 0;
      background-image:
        linear-gradient(rgba(59, 130, 246, 0.1) 1px, transparent 1px),
        linear-gradient(90deg, rgba(59, 130, 246, 0.1) 1px, transparent 1px);
      background-size: 40px 40px;
    }
    .ej-map-overlay {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      padding: 20px;
    }
    .ej-legend {
      position: absolute;
      bottom: 20px;
      left: 20px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid #334155;
      border-radius: 10px;
      padding: 16px;
      z-index: 10;
    }
    .ej-legend-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 6px 0;
      font-size: 13px;
      color: #e2e8f0;
    }
    .ej-legend-color {
      width: 16px;
      height: 16px;
      border-radius: 4px;
    }
    .ej-zone {
      position: absolute;
      border-radius: 50%;
      opacity: 0.6;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    .ej-zone:hover {
      opacity: 0.9;
      transform: scale(1.1);
      z-index: 20;
    }
    .ej-zone-dac {
      background: radial-gradient(circle, rgba(139, 92, 246, 0.8) 0%, rgba(139, 92, 246, 0.2) 70%);
      border: 2px solid rgba(139, 92, 246, 0.8);
    }
    .ej-zone-energy {
      background: radial-gradient(circle, rgba(16, 185, 129, 0.8) 0%, rgba(16, 185, 129, 0.2) 70%);
      border: 2px solid rgba(16, 185, 129, 0.8);
    }
    .ej-zone-lowincome {
      background: radial-gradient(circle, rgba(251, 191, 36, 0.8) 0%, rgba(251, 191, 36, 0.2) 70%);
      border: 2px solid rgba(251, 191, 36, 0.8);
    }
    .ej-zone-overlap {
      background: radial-gradient(circle, rgba(239, 68, 68, 0.8) 0%, rgba(239, 68, 68, 0.2) 70%);
      border: 2px dashed rgba(239, 68, 68, 0.8);
    }
    .ej-marker {
      position: absolute;
      width: 24px;
      height: 24px;
      background: #3b82f6;
      border: 3px solid white;
      border-radius: 50%;
      transform: translate(-50%, -50%);
      cursor: pointer;
      z-index: 25;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      transition: all 0.2s ease;
    }
    .ej-marker:hover {
      transform: translate(-50%, -50%) scale(1.2);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.5);
    }
    .ej-marker::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
      border-left: 6px solid transparent;
      border-right: 6px solid transparent;
      border-top: 8px solid white;
    }
    .ej-tooltip {
      position: absolute;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid #3b82f6;
      border-radius: 8px;
      padding: 12px 16px;
      z-index: 30;
      min-width: 200px;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.2s ease;
    }
    .ej-tooltip.visible {
      opacity: 1;
    }
    .ej-stats-overlay {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid #334155;
      border-radius: 10px;
      padding: 16px;
      z-index: 10;
    }
    .ej-stat-item {
      display: flex;
      justify-content: space-between;
      gap: 20px;
      padding: 8px 0;
      border-bottom: 1px solid #1e293b;
    }
    .ej-stat-item:last-child {
      border-bottom: none;
    }
    .ej-controls {
      position: absolute;
      top: 20px;
      left: 20px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      z-index: 10;
    }
    .ej-control-btn {
      width: 36px;
      height: 36px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid #334155;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #94a3b8;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .ej-control-btn:hover {
      background: #1e293b;
      color: white;
      border-color: #3b82f6;
    }

    /* V31: Enterprise API Documentation Styles */
    .api-endpoint {
      background: #0a1628;
      border: 1px solid #1e293b;
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 16px;
    }
    .api-endpoint-header {
      padding: 16px;
      border-bottom: 1px solid #1e293b;
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    .api-endpoint-header:hover {
      background: #0f172a;
    }
    .api-method {
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 700;
      font-family: 'JetBrains Mono', monospace;
      text-transform: uppercase;
    }
    .api-method-get { background: #10b981; color: white; }
    .api-method-post { background: #3b82f6; color: white; }
    .api-method-put { background: #14b8a6; color: white; }
    .api-method-delete { background: #64748b; color: white; }
    .api-path {
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
      color: #e2e8f0;
    }
    .api-endpoint-body {
      padding: 16px;
      display: none;
    }
    .api-endpoint.expanded .api-endpoint-body {
      display: block;
    }
    .api-code-block {
      background: #020617;
      border: 1px solid #1e293b;
      border-radius: 8px;
      padding: 16px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 12px;
      line-height: 1.6;
      overflow-x: auto;
      color: #e2e8f0;
    }
    .api-code-block .comment { color: #64748b; }
    .api-code-block .string { color: #5eead4; }
    .api-code-block .number { color: #60a5fa; }
    .api-code-block .key { color: #93c5fd; }
    .api-tab-nav {
      display: flex;
      border-bottom: 1px solid #1e293b;
      margin-bottom: 16px;
    }
    .api-tab-btn {
      padding: 10px 16px;
      font-size: 13px;
      font-weight: 500;
      color: #94a3b8;
      border-bottom: 2px solid transparent;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .api-tab-btn:hover {
      color: #e2e8f0;
    }
    .api-tab-btn.active {
      color: #3b82f6;
      border-bottom-color: #3b82f6;
    }
    .api-rate-limit {
      display: flex;
      gap: 24px;
      padding: 16px;
      background: #0f172a;
      border-radius: 10px;
    }
    .api-rate-item {
      flex: 1;
      text-align: center;
    }
    .api-rate-value {
      font-size: 1.5rem;
      font-weight: 700;
      font-family: 'JetBrains Mono', monospace;
    }

    /* V31: Energy Modeling Integration Styles */
    .energy-model-card {
      background: #0f172a;
      border: 1px solid #1e293b;
      border-radius: 12px;
      padding: 20px;
      transition: all 0.2s ease;
    }
    .energy-model-card:hover {
      border-color: #3b82f6;
    }
    .energy-model-logo {
      width: 48px;
      height: 48px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 14px;
    }
    .energy-upload-zone {
      border: 2px dashed #334155;
      border-radius: 12px;
      padding: 40px;
      text-align: center;
      transition: all 0.2s ease;
      cursor: pointer;
    }
    .energy-upload-zone:hover {
      border-color: #3b82f6;
      background: rgba(59, 130, 246, 0.05);
    }
    .energy-upload-zone.dragover {
      border-color: #10b981;
      background: rgba(16, 185, 129, 0.1);
    }

    /* V31: SOC 2 Compliance Styles */
    .compliance-card {
      background: #0f172a;
      border: 1px solid #1e293b;
      border-radius: 12px;
      overflow: hidden;
    }
    .compliance-card-header {
      padding: 20px;
      background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
    }
    .compliance-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
    }
    .compliance-badge-passed {
      background: rgba(16, 185, 129, 0.2);
      color: #10b981;
      border: 1px solid rgba(16, 185, 129, 0.3);
    }
    .compliance-badge-pending {
      background: rgba(251, 191, 36, 0.2);
      color: #fbbf24;
      border: 1px solid rgba(251, 191, 36, 0.3);
    }
    .compliance-checklist {
      padding: 20px;
    }
    .compliance-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 0;
      border-bottom: 1px solid #1e293b;
    }
    .compliance-item:last-child {
      border-bottom: none;
    }
    .compliance-check {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .compliance-check-pass {
      background: rgba(16, 185, 129, 0.2);
      color: #10b981;
    }
    .compliance-check-pending {
      background: rgba(251, 191, 36, 0.2);
      color: #fbbf24;
    }

    /* V31: Component Documentation Styles */
    .component-card {
      background: #0f172a;
      border: 1px solid #1e293b;
      border-radius: 10px;
      overflow: hidden;
      transition: all 0.2s ease;
    }
    .component-card:hover {
      border-color: #3b82f6;
      transform: translateY(-2px);
    }
    .component-preview {
      padding: 24px;
      background: #020617;
      border-bottom: 1px solid #1e293b;
      min-height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .component-info {
      padding: 16px;
    }
    .component-tag {
      display: inline-block;
      padding: 2px 8px;
      background: #1e293b;
      border-radius: 4px;
      font-size: 11px;
      font-family: 'JetBrains Mono', monospace;
      color: #94a3b8;
    }

    /* ==========================================
       V31: MOBILE RESPONSIVE DESIGN
       ========================================== */

    /* Mobile Navigation */
    @media (max-width: 1024px) {
      .top-nav {
        height: auto;
        min-height: 80px;
        padding: 12px 16px;
        flex-wrap: wrap;
      }
      .nav-links {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        border-top: 1px solid #334155;
        padding: 16px;
        flex-direction: column;
        gap: 8px;
        z-index: 100;
      }
      .nav-links.mobile-open {
        display: flex;
      }
      .nav-link {
        padding: 12px 16px;
        border-radius: 8px;
        width: 100%;
      }
      .nav-link:hover {
        background: rgba(59, 130, 246, 0.1);
      }
      .hide-mobile {
        display: none !important;
      }
      #incentedge-logo {
        height: 80px !important;
      }
    }

    /* Mobile Menu Button */
    .mobile-menu-btn {
      display: none;
      padding: 8px;
      background: transparent;
      border: 1px solid #334155;
      border-radius: 8px;
      color: #94a3b8;
      cursor: pointer;
    }
    @media (max-width: 1024px) {
      .mobile-menu-btn {
        display: flex;
        align-items: center;
        justify-content: center;
      }
    }

    /* Tablet & Mobile Grids */
    @media (max-width: 1024px) {
      .grid-cols-4 {
        grid-template-columns: repeat(2, 1fr) !important;
      }
      .grid-cols-3 {
        grid-template-columns: repeat(2, 1fr) !important;
      }
      .col-span-2 {
        grid-column: span 2 !important;
      }
    }

    @media (max-width: 768px) {
      .grid-cols-4, .grid-cols-3, .grid-cols-2 {
        grid-template-columns: 1fr !important;
      }
      .col-span-2, .col-span-3 {
        grid-column: span 1 !important;
      }
    }

    /* Mobile Sidebar */
    @media (max-width: 1024px) {
      .sidebar {
        position: fixed;
        left: -100%;
        width: 280px;
        z-index: 150;
        transition: left 0.3s ease;
        box-shadow: 4px 0 20px rgba(0, 0, 0, 0.5);
      }
      .sidebar.mobile-open {
        left: 0;
      }
      .sidebar-overlay {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 140;
      }
      .sidebar-overlay.active {
        display: block;
      }
      .main-content {
        margin-left: 0 !important;
        padding: 16px !important;
      }
    }

    /* Mobile Cards */
    @media (max-width: 768px) {
      .card {
        padding: 16px;
      }
      .card p.text-2xl, .card p.text-xl {
        font-size: 1.25rem;
      }
      .section-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }
      .section-header h1 {
        font-size: 1.5rem;
      }
    }

    /* Mobile Tables */
    @media (max-width: 768px) {
      .overflow-x-auto {
        margin: 0 -16px;
        padding: 0 16px;
      }
      table {
        font-size: 12px;
      }
      th, td {
        padding: 8px 4px;
      }
    }

    /* Mobile Forms */
    @media (max-width: 768px) {
      .form-input, select.form-input {
        font-size: 16px; /* Prevents zoom on iOS */
        padding: 12px 16px;
      }
      .btn {
        padding: 12px 20px;
        width: 100%;
        justify-content: center;
      }
      .flex.gap-3 button, .flex.gap-4 button {
        flex: 1;
      }
    }

    /* Mobile Portfolio Grid */
    @media (max-width: 768px) {
      .portfolio-grid {
        grid-template-columns: 1fr !important;
      }
      .portfolio-summary-grid {
        grid-template-columns: repeat(2, 1fr) !important;
      }
      .portfolio-filter-bar {
        flex-direction: column;
      }
      .portfolio-filter-bar select {
        width: 100%;
      }
    }

    /* Mobile EJ Map */
    @media (max-width: 768px) {
      .ej-map-container {
        height: 400px;
      }
      .ej-legend {
        position: relative;
        bottom: auto;
        left: auto;
        margin-top: 16px;
        width: 100%;
      }
      .ej-stats-overlay {
        position: relative;
        top: auto;
        right: auto;
        margin-bottom: 16px;
        width: 100%;
      }
      .ej-controls {
        flex-direction: row;
        top: auto;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
      }
    }

    /* Mobile API Documentation */
    @media (max-width: 768px) {
      .api-endpoint-header {
        flex-wrap: wrap;
        gap: 8px;
      }
      .api-path {
        width: 100%;
        order: 2;
        font-size: 11px;
      }
      .api-code-block {
        font-size: 10px;
        padding: 12px;
      }
      .api-tab-nav {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }
      .api-tab-btn {
        white-space: nowrap;
        padding: 8px 12px;
        font-size: 12px;
      }
    }

    /* Mobile Onboarding */
    @media (max-width: 768px) {
      .onboarding-modal {
        width: 95%;
        max-height: 90vh;
        margin: 20px auto;
      }
      .onboarding-option {
        padding: 12px;
      }
      .onboarding-options {
        gap: 8px;
      }
    }

    /* Mobile Component Grid */
    @media (max-width: 768px) {
      .component-preview {
        padding: 16px;
        min-height: 80px;
      }
    }

    /* Mobile Compliance Cards */
    @media (max-width: 768px) {
      .compliance-card-header {
        padding: 16px;
      }
      .compliance-checklist {
        padding: 16px;
      }
      .compliance-item {
        flex-wrap: wrap;
        gap: 8px;
      }
      .compliance-badge {
        margin-left: auto;
      }
    }

    /* Touch-friendly adjustments */
    @media (hover: none) and (pointer: coarse) {
      .btn, .nav-link, .portfolio-card, .api-endpoint-header {
        min-height: 44px; /* Apple's recommended touch target */
      }
      .portfolio-filter-btn {
        padding: 12px 20px;
      }
    }

    /* Bottom Navigation for Mobile */
    .mobile-bottom-nav {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      border-top: 1px solid #334155;
      padding: 8px 0;
      padding-bottom: env(safe-area-inset-bottom, 8px);
      z-index: 100;
    }
    @media (max-width: 768px) {
      .mobile-bottom-nav {
        display: flex;
        justify-content: space-around;
      }
      .main-content {
        padding-bottom: 80px !important;
      }
    }
    .mobile-nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 8px 16px;
      color: #94a3b8;
      font-size: 10px;
      cursor: pointer;
      transition: color 0.2s ease;
    }
    .mobile-nav-item.active {
      color: #3b82f6;
    }
    .mobile-nav-item svg {
      width: 24px;
      height: 24px;
    }

    /* Safe area padding for notched devices */
    @supports (padding: env(safe-area-inset-bottom)) {
      .mobile-bottom-nav {
        padding-bottom: calc(8px + env(safe-area-inset-bottom));
      }
    }
  </style>
</head>
<body class="text-slate-900 dark:text-slate-100">
  <!-- V31: Guided Onboarding Flow -->
  <div id="onboarding-overlay" class="onboarding-overlay">
    <div class="onboarding-modal">
      <div class="onboarding-header">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-blue-700 flex items-center justify-center">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
          </div>
          <div>
            <h2 class="text-xl font-bold text-white font-sora">Welcome to IncentEdge</h2>
            <p class="text-sm text-slate-400">Let's personalize your experience in 60 seconds</p>
          </div>
        </div>
        <div class="onboarding-progress">
          <div class="onboarding-progress-step active" data-step="1"></div>
          <div class="onboarding-progress-step" data-step="2"></div>
          <div class="onboarding-progress-step" data-step="3"></div>
          <div class="onboarding-progress-step" data-step="4"></div>
        </div>
      </div>
      <div class="onboarding-content">
        <!-- Step 1: Role Selection -->
        <div class="onboarding-step active" data-step="1">
          <h3 class="text-lg font-semibold text-white mb-2">What best describes your role?</h3>
          <p class="text-sm text-slate-400 mb-6">This helps us tailor incentive recommendations to your workflow</p>
          <div class="onboarding-option" onclick="selectOnboardingOption(this, 'role', 'developer')">
            <div class="onboarding-option-radio"></div>
            <div>
              <div class="text-white font-medium">Real Estate Developer</div>
              <div class="text-sm text-slate-400">I develop multifamily, commercial, or mixed-use projects</div>
            </div>
          </div>
          <div class="onboarding-option" onclick="selectOnboardingOption(this, 'role', 'investor')">
            <div class="onboarding-option-radio"></div>
            <div>
              <div class="text-white font-medium">Institutional Investor</div>
              <div class="text-sm text-slate-400">I evaluate and fund real estate investments</div>
            </div>
          </div>
          <div class="onboarding-option" onclick="selectOnboardingOption(this, 'role', 'consultant')">
            <div class="onboarding-option-radio"></div>
            <div>
              <div class="text-white font-medium">Tax / Energy Consultant</div>
              <div class="text-sm text-slate-400">I advise clients on tax credits and sustainability</div>
            </div>
          </div>
          <div class="onboarding-option" onclick="selectOnboardingOption(this, 'role', 'government')">
            <div class="onboarding-option-radio"></div>
            <div>
              <div class="text-white font-medium">Government / Economic Development</div>
              <div class="text-sm text-slate-400">I manage or administer incentive programs</div>
            </div>
          </div>
        </div>
        <!-- Step 2: Project Type -->
        <div class="onboarding-step" data-step="2">
          <h3 class="text-lg font-semibold text-white mb-2">What types of projects do you focus on?</h3>
          <p class="text-sm text-slate-400 mb-6">Select all that apply to see relevant incentives</p>
          <div class="onboarding-option" onclick="toggleOnboardingMulti(this, 'projectType', 'multifamily')">
            <div class="onboarding-option-radio"></div>
            <div>
              <div class="text-white font-medium">Multifamily Residential</div>
              <div class="text-sm text-slate-400">Apartments, condos, affordable housing</div>
            </div>
          </div>
          <div class="onboarding-option" onclick="toggleOnboardingMulti(this, 'projectType', 'commercial')">
            <div class="onboarding-option-radio"></div>
            <div>
              <div class="text-white font-medium">Commercial / Office</div>
              <div class="text-sm text-slate-400">Office buildings, retail, mixed-use</div>
            </div>
          </div>
          <div class="onboarding-option" onclick="toggleOnboardingMulti(this, 'projectType', 'industrial')">
            <div class="onboarding-option-radio"></div>
            <div>
              <div class="text-white font-medium">Industrial / Manufacturing</div>
              <div class="text-sm text-slate-400">Warehouses, factories, clean energy facilities</div>
            </div>
          </div>
          <div class="onboarding-option" onclick="toggleOnboardingMulti(this, 'projectType', 'hospitality')">
            <div class="onboarding-option-radio"></div>
            <div>
              <div class="text-white font-medium">Hospitality / Healthcare</div>
              <div class="text-sm text-slate-400">Hotels, hospitals, senior living</div>
            </div>
          </div>
        </div>
        <!-- Step 3: Geographic Focus -->
        <div class="onboarding-step" data-step="3">
          <h3 class="text-lg font-semibold text-white mb-2">Where are your projects located?</h3>
          <p class="text-sm text-slate-400 mb-6">We'll prioritize state and local incentives for these regions</p>
          <div class="onboarding-option" onclick="toggleOnboardingMulti(this, 'region', 'northeast')">
            <div class="onboarding-option-radio"></div>
            <div>
              <div class="text-white font-medium">Northeast</div>
              <div class="text-sm text-slate-400">NY, NJ, CT, MA, PA, and surrounding states</div>
            </div>
          </div>
          <div class="onboarding-option" onclick="toggleOnboardingMulti(this, 'region', 'southeast')">
            <div class="onboarding-option-radio"></div>
            <div>
              <div class="text-white font-medium">Southeast</div>
              <div class="text-sm text-slate-400">FL, GA, NC, VA, TX, and surrounding states</div>
            </div>
          </div>
          <div class="onboarding-option" onclick="toggleOnboardingMulti(this, 'region', 'midwest')">
            <div class="onboarding-option-radio"></div>
            <div>
              <div class="text-white font-medium">Midwest</div>
              <div class="text-sm text-slate-400">IL, OH, MI, MN, and surrounding states</div>
            </div>
          </div>
          <div class="onboarding-option" onclick="toggleOnboardingMulti(this, 'region', 'west')">
            <div class="onboarding-option-radio"></div>
            <div>
              <div class="text-white font-medium">West Coast & Mountain</div>
              <div class="text-sm text-slate-400">CA, WA, OR, CO, AZ, and surrounding states</div>
            </div>
          </div>
        </div>
        <!-- Step 4: Priority Goals -->
        <div class="onboarding-step" data-step="4">
          <h3 class="text-lg font-semibold text-white mb-2">What are your primary goals?</h3>
          <p class="text-sm text-slate-400 mb-6">We'll highlight the most relevant features for you</p>
          <div class="onboarding-option" onclick="toggleOnboardingMulti(this, 'goals', 'taxCredits')">
            <div class="onboarding-option-radio"></div>
            <div>
              <div class="text-white font-medium">Maximize Tax Credits</div>
              <div class="text-sm text-slate-400">ITC, PTC, 45L, 179D, LIHTC, NMTC optimization</div>
            </div>
          </div>
          <div class="onboarding-option" onclick="toggleOnboardingMulti(this, 'goals', 'sustainability')">
            <div class="onboarding-option-radio"></div>
            <div>
              <div class="text-white font-medium">Meet ESG / Sustainability Goals</div>
              <div class="text-sm text-slate-400">Carbon reduction, LEED, Energy Star certification</div>
            </div>
          </div>
          <div class="onboarding-option" onclick="toggleOnboardingMulti(this, 'goals', 'financing')">
            <div class="onboarding-option-radio"></div>
            <div>
              <div class="text-white font-medium">Access Project Financing</div>
              <div class="text-sm text-slate-400">DOE loans, PACE, green bonds, C-PACE</div>
            </div>
          </div>
          <div class="onboarding-option" onclick="toggleOnboardingMulti(this, 'goals', 'compliance')">
            <div class="onboarding-option-radio"></div>
            <div>
              <div class="text-white font-medium">IRA Compliance & Documentation</div>
              <div class="text-sm text-slate-400">Prevailing wage, apprenticeship, reporting</div>
            </div>
          </div>
        </div>
      </div>
      <div class="onboarding-footer">
        <button class="onboarding-btn onboarding-btn-secondary" onclick="skipOnboarding()">Skip for now</button>
        <div class="flex gap-3">
          <button id="onboarding-back" class="onboarding-btn onboarding-btn-secondary hidden" onclick="onboardingBack()">Back</button>
          <button id="onboarding-next" class="onboarding-btn onboarding-btn-primary" onclick="onboardingNext()" disabled>Continue</button>
        </div>
      </div>
    </div>
  </div>

  <!-- V31: Self-Serve Signup Modal -->
  <div id="signup-overlay" class="signup-overlay">
    <div class="signup-modal">
      <div class="p-6 border-b border-slate-700">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-blue-700 flex items-center justify-center">
              <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
            </div>
            <div>
              <h2 class="text-lg font-bold text-white font-sora">Get Started Free</h2>
              <p class="text-xs text-slate-400">No credit card required</p>
            </div>
          </div>
          <button onclick="hideSignup()" class="text-slate-400 hover:text-white p-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
          </button>
        </div>
      </div>
      <div class="p-6 space-y-4">
        <!-- Tier Selection -->
        <div class="tier-toggle mb-6">
          <button class="tier-toggle-btn active" onclick="selectSignupTier('enterprise')">Enterprise</button>
          <button class="tier-toggle-btn" onclick="selectSignupTier('community')">Community</button>
        </div>

        <!-- Enterprise Tier Info -->
        <div id="signup-enterprise-info" class="p-4 bg-blue-900/20 border border-blue-700/30 rounded-lg mb-4">
          <div class="flex items-center gap-2 mb-2">
            <span class="badge badge-federal">Enterprise</span>
            <span class="text-sm text-slate-300">Full platform access</span>
          </div>
          <ul class="text-xs text-slate-400 space-y-1">
            <li>• Unlimited incentive searches</li>
            <li>• Portfolio dashboard for 50+ projects</li>
            <li>• API access & integrations</li>
            <li>• Priority support & dedicated CSM</li>
          </ul>
        </div>

        <!-- Community Tier Info -->
        <div id="signup-community-info" class="hidden p-4 bg-green-900/20 border border-green-700/30 rounded-lg mb-4">
          <div class="flex items-center gap-2 mb-2">
            <span class="community-badge">Community</span>
            <span class="text-sm text-slate-300">For small developers & CDFIs</span>
          </div>
          <ul class="text-xs text-slate-400 space-y-1">
            <li>• 20 incentive searches/month</li>
            <li>• Basic project analysis</li>
            <li>• Community forum access</li>
            <li>• Educational resources</li>
          </ul>
        </div>

        <div>
          <label class="block text-sm font-medium text-slate-300 mb-2">Work Email</label>
          <input type="email" class="signup-input" id="signup-email" placeholder="you@company.com" oninput="validateSignupForm()">
        </div>
        <div>
          <label class="block text-sm font-medium text-slate-300 mb-2">Full Name</label>
          <input type="text" class="signup-input" id="signup-name" placeholder="John Smith" oninput="validateSignupForm()">
        </div>
        <div>
          <label class="block text-sm font-medium text-slate-300 mb-2">Company</label>
          <input type="text" class="signup-input" id="signup-company" placeholder="ABC Development" oninput="validateSignupForm()">
        </div>
        <!-- V32: Company Size Selector -->
        <div>
          <label class="block text-sm font-medium text-slate-300 mb-2">Company Size</label>
          <select class="signup-input" id="signup-company-size" oninput="validateSignupForm()">
            <option value="">Select company size</option>
            <option value="1-10">1-10 employees</option>
            <option value="11-50">11-50 employees</option>
            <option value="51-200">51-200 employees</option>
            <option value="201-500">201-500 employees</option>
            <option value="501+">501+ employees</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-slate-300 mb-2">Password</label>
          <input type="password" class="signup-input" id="signup-password" placeholder="Create a password" oninput="validateSignupForm()">
        </div>
        <button id="signup-submit-btn" class="signup-btn" onclick="submitSignup()" disabled>Create Account</button>

        <div class="signup-divider">or continue with</div>

        <div class="flex gap-3">
          <button class="signup-social-btn" onclick="socialSignup('google')">
            <svg class="w-5 h-5" viewBox="0 0 24 24"><path fill="currentColor" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="currentColor" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="currentColor" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="currentColor" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
            Google
          </button>
          <button class="signup-social-btn" onclick="socialSignup('microsoft')">
            <svg class="w-5 h-5" viewBox="0 0 24 24"><path fill="currentColor" d="M11.4 24H0V12.6h11.4V24zM24 24H12.6V12.6H24V24zM11.4 11.4H0V0h11.4v11.4zm12.6 0H12.6V0H24v11.4z"/></svg>
            Microsoft
          </button>
        </div>
      </div>
      <div class="px-6 py-4 bg-slate-800/50 text-center">
        <p class="text-xs text-slate-500">By signing up, you agree to our <a href="#" class="text-blue-400 hover:underline">Terms</a> and <a href="#" class="text-blue-400 hover:underline">Privacy Policy</a></p>
      </div>
    </div>
  </div>

  <!-- V40: Redesigned Top Navigation - Institutional Style with Center Search -->
  <!-- Structure: Logo | Nav Tabs | CENTER SEARCH | More | Ask Us | User -->
  <nav class="top-nav px-6">
    <!-- Row 1: Logo + Center Search + Utilities -->
    <div class="flex items-center justify-between h-full">
      <!-- Left: Logo -->
      <div class="flex items-center gap-6">
        <a href="homepage.html" class="flex items-center logo-link flex-shrink-0">
          <img id="incentedge-logo" src="../../IncentEdge Logo.png" alt="IncentEdge" class="h-[80px] logo-animate" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
          <div class="hidden items-center gap-2">
            <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-blue-600 to-blue-800 flex items-center justify-center">
              <span class="text-white font-bold text-sm">IE</span>
            </div>
            <span class="text-xl font-bold text-white tracking-tight">IncentEdge</span>
          </div>
        </a>
        <!-- V42: 5-Tab Navigation (Council Approved) -->
        <div class="desktop-nav nav-links hidden xl:flex items-center gap-1">
          <a class="nav-link active" data-section="portfolio" onclick="switchSection('portfolio')">Portfolio</a>
          <a class="nav-link" data-section="discover" onclick="switchSection('discover')">Discover</a>
          <a class="nav-link flex items-center gap-1.5" data-section="matching" onclick="switchSection('matching')">
            Matching
            <span class="px-1.5 py-0.5 text-[10px] font-bold bg-blue-500/20 text-blue-400 rounded">AI</span>
          </a>
          <a class="nav-link" data-section="reports" onclick="switchSection('reports')">Reports</a>
        </div>
      </div>

      <!-- Center: Prominent Search Bar (Command Palette Trigger) -->
      <div class="flex-1 max-w-xl mx-8 hidden md:block">
        <div class="relative" onclick="openCommandPalette()">
          <input type="text" readonly placeholder="Search incentives, programs, or enter an address..." class="w-full h-11 pl-11 pr-20 text-sm bg-slate-800/80 border border-slate-600/50 rounded-xl text-slate-200 placeholder-slate-400 cursor-pointer hover:border-blue-500/50 hover:bg-slate-800 transition-all focus:outline-none">
          <svg class="w-5 h-5 absolute left-4 top-3 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
          <kbd class="absolute right-3 top-2.5 px-2 py-1 bg-slate-700/80 text-slate-400 text-xs rounded border border-slate-600/50 font-mono">Ctrl+K</kbd>
        </div>
      </div>

      <!-- Right: Utilities -->
      <div class="flex items-center gap-3">
        <!-- V42: "More" Dropdown (Green Incentives + Tools + Resources) -->
        <div class="relative hidden lg:block">
          <button onclick="toggleMoreMenu()" class="nav-link flex items-center gap-1" id="more-menu-btn">
            More
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
          </button>
          <div id="more-dropdown" class="hidden absolute top-full right-0 mt-1 w-64 bg-slate-800 border border-slate-600/50 rounded-lg shadow-xl z-50">
            <!-- V42: Green Incentives Featured -->
            <a class="flex items-center gap-2 px-4 py-3 text-sm font-medium text-emerald-400 hover:bg-emerald-500/10 border-b border-slate-700/50" onclick="switchSection('green'); toggleMoreMenu();">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/></svg>
              Green Incentives (IRA)
            </a>
            <p class="px-4 py-2 text-xs text-slate-500 uppercase tracking-wider border-b border-slate-700/50">Tools</p>
            <a class="block px-4 py-2 text-sm text-slate-300 hover:bg-slate-700 hover:text-white" onclick="switchSection('calculator'); toggleMoreMenu();">ROI Calculator</a>
            <a class="block px-4 py-2 text-sm text-slate-300 hover:bg-slate-700 hover:text-white" onclick="switchSection('capitalstack'); toggleMoreMenu();">Capital Stack</a>
            <a class="block px-4 py-2 text-sm text-slate-300 hover:bg-slate-700 hover:text-white" onclick="switchSection('amicalc'); toggleMoreMenu();">AMI Calculator</a>
            <a class="block px-4 py-2 text-sm text-slate-300 hover:bg-slate-700 hover:text-white" onclick="switchSection('netzero'); toggleMoreMenu();">Triple Net Zero</a>
            <a class="block px-4 py-2 text-sm text-slate-300 hover:bg-slate-700 hover:text-white" onclick="switchSection('compliance'); toggleMoreMenu();">IRA Compliance</a>
            <p class="px-4 py-2 text-xs text-slate-500 uppercase tracking-wider border-t border-b border-slate-700/50 mt-1">Resources</p>
            <a class="block px-4 py-2 text-sm text-slate-300 hover:bg-slate-700 hover:text-white" onclick="switchSection('documents'); toggleMoreMenu();">Document Generator</a>
            <a class="block px-4 py-2 text-sm text-slate-300 hover:bg-slate-700 hover:text-white" onclick="switchSection('grantwriter'); toggleMoreMenu();">Grant Writing</a>
            <a class="block px-4 py-2 text-sm text-slate-300 hover:bg-slate-700 hover:text-white" onclick="switchSection('creditmarket'); toggleMoreMenu();">Credit Marketplace</a>
            <a class="block px-4 py-2 text-sm text-slate-300 hover:bg-slate-700 hover:text-white" onclick="switchSection('doeloans'); toggleMoreMenu();">DOE Loan Programs</a>
          </div>
        </div>

        <!-- Mobile Search Icon -->
        <button onclick="openCommandPalette()" class="md:hidden w-10 h-10 flex items-center justify-center text-slate-300 hover:text-white hover:bg-slate-700/50 rounded-lg transition-all" title="Search">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
        </button>

        <!-- Ask Us Button -->
        <button onclick="openAskUsModal()" class="hidden sm:flex items-center gap-2 px-4 py-2 bg-teal-600 hover:bg-teal-700 text-white font-medium rounded-lg transition-all" title="Need help? Ask our team">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
          <span class="hidden lg:inline">Ask Us</span>
        </button>

        <!-- Theme Toggle -->
        <button onclick="toggleTheme()" class="w-10 h-10 hidden sm:flex items-center justify-center text-slate-400 hover:text-white hover:bg-slate-700/50 rounded-lg transition-all" title="Toggle theme">
          <svg class="w-5 h-5 block dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/></svg>
          <svg class="w-5 h-5 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
        </button>

        <!-- User Menu -->
        <div class="flex items-center gap-2">
          <div class="w-9 h-9 bg-slate-700 rounded-full flex items-center justify-center text-sm font-medium text-white cursor-pointer hover:bg-slate-600 transition-all">AD</div>
        </div>

        <!-- Mobile Menu Button -->
        <button class="xl:hidden w-10 h-10 flex items-center justify-center text-slate-300 hover:text-white hover:bg-slate-700/50 rounded-lg transition-all" onclick="toggleMobileMenu()" aria-label="Toggle menu">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
        </button>
      </div>
    </div>
  </nav>

  <!-- V40: Sidebar removed for MVP - cleaner UX per Bob White's advice -->

  <!-- V42: Mobile Menu - 5 Core Tabs + More -->
  <div id="mobile-menu" class="fixed top-[100px] left-0 right-0 bg-slate-900/98 backdrop-blur-sm border-b border-slate-700/50 z-30 hidden xl:hidden max-h-[calc(100vh-100px)] overflow-y-auto">
    <div class="p-4">
      <!-- Core Navigation - 5 Tabs in Grid -->
      <div class="grid grid-cols-2 gap-2 mb-4">
        <a class="nav-link text-center py-3 rounded-lg bg-slate-800/50" data-section="portfolio" onclick="switchSection('portfolio'); toggleMobileMenu();">Portfolio</a>
        <a class="nav-link text-center py-3 rounded-lg bg-slate-800/50" data-section="discover" onclick="switchSection('discover'); toggleMobileMenu();">Discover</a>
        <a class="nav-link text-center py-3 rounded-lg bg-slate-800/50 flex items-center justify-center gap-1.5" data-section="matching" onclick="switchSection('matching'); toggleMobileMenu();">
          Matching
          <span class="px-1.5 py-0.5 text-[10px] font-bold bg-blue-500/20 text-blue-400 rounded">AI</span>
        </a>
        <a class="nav-link text-center py-3 rounded-lg bg-slate-800/50" data-section="reports" onclick="switchSection('reports'); toggleMobileMenu();">Reports</a>
      </div>
      <!-- Green Incentives - Featured -->
      <a class="flex items-center justify-center gap-2 w-full py-3 mb-4 rounded-lg bg-emerald-500/10 border border-emerald-500/30 text-emerald-400 font-medium" onclick="switchSection('green'); toggleMobileMenu();">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/></svg>
        Green Incentives (IRA)
      </a>
      <!-- More (Tools & Resources) - Collapsed by default -->
      <details class="group">
        <summary class="flex items-center justify-between px-3 py-2 text-sm text-slate-400 cursor-pointer hover:text-white">
          <span>More Tools & Resources</span>
          <svg class="w-4 h-4 transform group-open:rotate-180 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
        </summary>
        <div class="grid grid-cols-2 gap-2 mt-2 pl-2">
          <a class="nav-link text-sm py-2" onclick="switchSection('calculator'); toggleMobileMenu();">ROI Calculator</a>
          <a class="nav-link text-sm py-2" onclick="switchSection('capitalstack'); toggleMobileMenu();">Capital Stack</a>
          <a class="nav-link text-sm py-2" onclick="switchSection('netzero'); toggleMobileMenu();">Net Zero</a>
          <a class="nav-link text-sm py-2" onclick="switchSection('compliance'); toggleMobileMenu();">Compliance</a>
          <a class="nav-link text-sm py-2" onclick="switchSection('documents'); toggleMobileMenu();">Documents</a>
          <a class="nav-link text-sm py-2" onclick="switchSection('grantwriter'); toggleMobileMenu();">Grant Writing</a>
        </div>
      </details>
      <!-- Ask Us - Always visible at bottom -->
      <div class="mt-4 pt-4 border-t border-slate-700/50">
        <button onclick="openAskUsModal(); toggleMobileMenu();" class="w-full py-3 bg-teal-600 hover:bg-teal-700 text-white font-medium rounded-lg transition-all flex items-center justify-center gap-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
          Ask Us
        </button>
      </div>
    </div>
  </div>

  <!-- Main Content Area -->
  <div class="main-content bg-slate-50 dark:bg-transparent">
    <!-- Sub Header with Breadcrumb and Actions -->
    <header class="h-14 bg-white dark:bg-slate-900/50 border-b border-slate-200 dark:border-slate-700/30 px-6 flex items-center justify-between">
      <div class="flex items-center gap-4">
        <nav class="text-sm text-slate-500 dark:text-blue-300">
          <span class="hover:text-slate-700 dark:hover:text-white cursor-pointer">Home</span>
          <span class="mx-2 text-slate-300 dark:text-blue-600">/</span>
          <span class="text-slate-900 dark:text-white font-medium" id="breadcrumb-current">Portfolio</span>
        </nav>
      </div>
      <div class="flex items-center gap-3">
        <!-- Security Badge -->
        <div class="hidden md:flex items-center gap-2 px-3 py-1.5 bg-slate-100 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-600/30 rounded-lg">
          <svg class="w-4 h-4 text-blue-700 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
          <span class="text-xs font-medium text-slate-600 dark:text-blue-200">SOC 2 Compliant</span>
        </div>
        <!-- New Project Button -->
        <button class="btn btn-primary" onclick="switchSection('analysis')">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
          <span class="hide-mobile">New Project</span>
        </button>
      </div>
    </header>

    <!-- V42: Data Freshness Bar -->
    <div class="hidden md:flex items-center justify-end gap-6 px-6 py-2 bg-slate-50 dark:bg-slate-900/30 border-b border-slate-200 dark:border-slate-700/30 text-xs">
      <div class="flex items-center gap-2">
        <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
        <span class="text-slate-500 dark:text-slate-400">Federal Programs</span>
        <span class="text-emerald-500 font-mono">Live</span>
      </div>
      <div class="flex items-center gap-2">
        <span class="w-2 h-2 rounded-full bg-teal-500"></span>
        <span class="text-slate-500 dark:text-slate-400">State Programs</span>
        <span class="text-teal-500 font-mono">2d ago</span>
      </div>
      <div class="flex items-center gap-2">
        <span class="w-2 h-2 rounded-full bg-blue-500"></span>
        <span class="text-slate-500 dark:text-slate-400">Local</span>
        <span class="text-blue-400 font-mono">1w ago</span>
      </div>
      <div class="flex items-center gap-2">
        <span class="w-2 h-2 rounded-full bg-amber-500"></span>
        <span class="text-slate-500 dark:text-slate-400">Utility</span>
        <span class="text-amber-500 font-mono">2mo ago</span>
      </div>
    </div>

    <!-- V23: Dynamic Content Sections - Compact Layout -->
    <main class="p-4">
      <!-- PORTFOLIO SECTION -->
      <section id="section-portfolio" class="section-content">
        <!-- V27: UNIFIED HORIZONTAL STRIP - 1.5x larger, CoStar institutional -->
        <div id="unified-kpi-section" class="card mb-4">
          <div class="flex items-center px-6 py-5 gap-6">
            <!-- LEFT: Project Image + Info (1.5x larger) - V28: Interactive Image -->
            <div class="flex items-center gap-4 min-w-[340px]">
              <div id="project-thumb-container" class="w-28 h-20 rounded-lg overflow-hidden bg-slate-200 dark:bg-slate-700 flex-shrink-0 shadow-sm relative group cursor-pointer"
                   onclick="openImageLightbox()"
                   ondragover="handleImageDragOver(event)"
                   ondragleave="handleImageDragLeave(event)"
                   ondrop="handleImageDrop(event)">
                <img id="project-thumb" src="Ground level.jpg" alt="" class="w-full h-full object-cover transition-transform group-hover:scale-105" onerror="this.src='https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=112&h=80&fit=crop'">
                <!-- Hover overlay with actions -->
                <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2">
                  <button onclick="event.stopPropagation(); openImageLightbox()" class="w-8 h-8 rounded-full bg-white/90 flex items-center justify-center hover:bg-white transition-colors" title="View larger">
                    <svg class="w-4 h-4 text-slate-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"/></svg>
                  </button>
                  <button onclick="event.stopPropagation(); triggerImageUpload()" class="w-8 h-8 rounded-full bg-white/90 flex items-center justify-center hover:bg-white transition-colors" title="Change image">
                    <svg class="w-4 h-4 text-slate-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                  </button>
                  <button onclick="event.stopPropagation(); undoImageChange()" id="undo-image-btn" class="w-8 h-8 rounded-full bg-white/90 flex items-center justify-center hover:bg-white transition-colors hidden" title="Undo change">
                    <svg class="w-4 h-4 text-slate-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"/></svg>
                  </button>
                </div>
                <!-- Drag overlay -->
                <div id="drag-overlay" class="absolute inset-0 bg-blue-500/80 hidden items-center justify-center">
                  <div class="text-white text-center">
                    <svg class="w-8 h-8 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/></svg>
                    <span class="text-xs font-medium">Drop image</span>
                  </div>
                </div>
                <input type="file" id="image-upload-input" accept="image/*" class="hidden" onchange="handleImageUpload(event)">
              </div>
              <div class="min-w-0">
                <select id="project-selector" onchange="switchProjectView(this.value)" class="text-base font-bold border-0 p-0 bg-transparent text-slate-900 dark:text-white focus:ring-0 cursor-pointer truncate max-w-[200px]" style="background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2214%22%20height%3D%2214%22%20fill%3D%22%236b7280%22%20viewBox%3D%220%200%2020%2020%22%3E%3Cpath%20fill-rule%3D%22evenodd%22%20d%3D%22M5.293%207.293a1%201%200%20011.414%200L10%2010.586l3.293-3.293a1%201%200%20111.414%201.414l-4%204a1%201%200%2001-1.414%200l-4-4a1%201%200%20010-1.414z%22%20clip-rule%3D%22evenodd%22%2F%3E%3C%2Fsvg%3E'); background-position: right 0 center; background-repeat: no-repeat; padding-right: 20px;">
                  <option value="portfolio">Portfolio Overview</option>
                  <option value="mt-vernon" selected>Mount Vernon Mixed-Use</option>
                  <option value="yonkers">Yonkers Affordable Housing</option>
                  <option value="new-rochelle">New Rochelle Transit Hub</option>
                </select>
                <p id="project-address" class="text-xs text-slate-500 dark:text-slate-400 truncate mt-1">225 South 4th Ave, Mount Vernon, NY</p>
              </div>
            </div>

            <!-- Vertical Divider (1.5x taller) -->
            <div class="w-px h-16 bg-slate-200 dark:bg-slate-700"></div>

            <!-- CENTER: Scenario Cards (1.5x larger) -->
            <div id="scenario-tabs-container" class="flex items-center justify-center gap-3 flex-1">
              <button class="scenario-card-compact" data-scenario="conservative" onclick="selectScenario('conservative')">
                <span class="scenario-compact-label">CONS</span>
                <span class="scenario-compact-value" id="scenario-cons-val">$88.1M</span>
                <span class="scenario-compact-conf">80%</span>
              </button>
              <button class="scenario-card-compact active" data-scenario="realistic" onclick="selectScenario('realistic')">
                <span class="scenario-compact-label">REAL</span>
                <span class="scenario-compact-value" id="scenario-real-val">$156.1M</span>
                <span class="scenario-compact-conf">65%</span>
              </button>
              <button class="scenario-card-compact" data-scenario="optimistic" onclick="selectScenario('optimistic')">
                <span class="scenario-compact-label">OPT</span>
                <span class="scenario-compact-value" id="scenario-opt-val">$204.5M</span>
                <span class="scenario-compact-conf">40%</span>
              </button>
              <button class="scenario-card-compact" data-scenario="bestcase" onclick="selectScenario('bestcase')">
                <span class="scenario-compact-label">BEST</span>
                <span class="scenario-compact-value" id="scenario-best-val">$252.2M</span>
                <span class="scenario-compact-conf">20%</span>
              </button>
              <button onclick="showScenarioMethodology()" class="p-2 rounded hover:bg-slate-100 dark:hover:bg-slate-700 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors" title="Methodology">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
              </button>
            </div>

            <!-- Vertical Divider (1.5x taller) -->
            <div class="w-px h-16 bg-slate-200 dark:bg-slate-700"></div>

            <!-- RIGHT: KPI Metrics (1.5x larger) -->
            <div class="flex items-center gap-6">
              <div class="text-right">
                <p class="text-base font-mono font-bold text-slate-900 dark:text-white" id="kpi-portfolio-value">$88.5M</p>
                <p class="text-[10px] text-slate-400 uppercase tracking-wider">TDC</p>
              </div>
              <!-- V32: Portfolio ROI Metric -->
              <div class="text-right">
                <p class="text-base font-mono font-bold text-green-600 dark:text-green-400" id="kpi-portfolio-roi">176%</p>
                <p class="text-[10px] text-slate-400 uppercase tracking-wider">Incentive ROI</p>
              </div>
              <div class="text-right">
                <p class="text-base font-mono font-bold text-slate-900 dark:text-white"><span id="kpi-programs-qualifying">18</span><span class="text-slate-400 font-normal"> / </span><span id="kpi-programs-total">29</span></p>
                <p class="text-[10px] text-slate-400 uppercase tracking-wider">Programs</p>
              </div>
              <div class="text-right cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-800 px-3 py-2 -mr-3 rounded transition-colors" onclick="toggleActionsPanel()">
                <p class="text-base font-mono font-bold text-blue-800 dark:text-blue-400" id="kpi-actions">2</p>
                <p class="text-[10px] text-blue-700 dark:text-blue-400 uppercase tracking-wider">Actions ▸</p>
              </div>
            </div>
          </div>
          <!-- Hidden elements for compatibility -->
          <span id="kpi-identified" class="hidden">$252.2M</span>
          <span id="kpi-captured" class="hidden">$156.1M</span>
          <span id="kpi-captured-label" class="hidden">Expected (Realistic)</span>
          <span id="kpi-programs" class="hidden">48</span>
        </div>

        <!-- V24: Actions Slide-out Panel -->
        <div id="actions-panel-overlay" class="actions-panel-overlay" onclick="toggleActionsPanel()"></div>
        <div id="actions-panel" class="actions-panel">
          <div class="p-5 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between sticky top-0 bg-white dark:bg-slate-800 z-10">
            <div>
              <h2 class="text-lg font-bold text-slate-900 dark:text-white">Actions Required</h2>
              <p class="text-sm text-slate-500 dark:text-slate-400">Items requiring attention</p>
            </div>
            <button onclick="toggleActionsPanel()" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors">
              <svg class="w-5 h-5 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
            </button>
          </div>

          <!-- V24: AI Deadline Intelligence Summary -->
          <div class="p-4 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border-b border-blue-100 dark:border-blue-800/30">
            <div class="flex items-start gap-3">
              <div class="w-8 h-8 rounded-lg bg-blue-600 flex items-center justify-center flex-shrink-0">
                <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
              </div>
              <div>
                <p class="text-sm font-semibold text-blue-900 dark:text-blue-200">AI Deadline Intelligence</p>
                <p class="text-xs text-blue-700 dark:text-blue-300 mt-1">Based on your project timeline, prioritize the NYSERDA application first. The IDA compliance has more flexibility if you file an extension request by Jan 25th.</p>
              </div>
            </div>
          </div>

          <div id="actions-list">
            <!-- Action Item 1 - Urgent -->
            <div class="action-item urgent">
              <div class="flex items-start justify-between mb-2">
                <div class="flex items-center gap-2">
                  <span class="px-2 py-0.5 bg-blue-900 dark:bg-blue-900/50 text-white dark:text-blue-200 text-xs font-semibold rounded">URGENT</span>
                  <span class="text-xs text-slate-500 dark:text-slate-400">14 days remaining</span>
                </div>
                <span class="text-sm font-bold text-blue-900 dark:text-blue-300">$8.2M at risk</span>
              </div>
              <h3 class="font-semibold text-slate-900 dark:text-white mb-1">NYSERDA PON 4959 Application</h3>
              <p class="text-sm text-slate-600 dark:text-slate-400 mb-2">New Construction Housing Program enrollment deadline approaching.</p>
              <div class="flex items-center gap-2 text-xs text-slate-500 dark:text-slate-400 mb-3">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                <span>Required: Energy model, design docs, prevailing wage commitment</span>
              </div>
              <div class="flex items-center gap-2">
                <button onclick="switchSection('documents'); toggleActionsPanel();" class="btn btn-primary text-sm py-1.5">Start Application</button>
                <button onclick="openIncentiveDetail('nyserda-pon')" class="btn btn-secondary text-sm py-1.5">View Details</button>
              </div>
            </div>

            <!-- Action Item 2 - Upcoming -->
            <div class="action-item">
              <div class="flex items-start justify-between mb-2">
                <div class="flex items-center gap-2">
                  <span class="px-2 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 text-xs font-semibold rounded">UPCOMING</span>
                  <span class="text-xs text-slate-500 dark:text-slate-400">45 days remaining</span>
                </div>
                <span class="text-sm font-bold text-blue-600 dark:text-blue-400">$2.1M/year</span>
              </div>
              <h3 class="font-semibold text-slate-900 dark:text-white mb-1">IDA PILOT Annual Compliance</h3>
              <p class="text-sm text-slate-600 dark:text-slate-400 mb-2">Submit annual jobs report and compliance documentation.</p>
              <div class="flex items-center gap-2 text-xs text-slate-500 dark:text-slate-400 mb-3">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                <span>Extension available until Feb 15 if requested</span>
              </div>
              <div class="flex items-center gap-2">
                <button onclick="switchSection('documents'); toggleActionsPanel();" class="btn btn-secondary text-sm py-1.5">Prepare Documents</button>
              </div>
            </div>

            <!-- Action Item 3 - Opportunity -->
            <div class="action-item" style="border-left: 4px solid #10b981;">
              <div class="flex items-start justify-between mb-2">
                <div class="flex items-center gap-2">
                  <span class="px-2 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 text-xs font-semibold rounded">OPPORTUNITY</span>
                  <span class="text-xs text-slate-500 dark:text-slate-400">New program</span>
                </div>
                <span class="text-sm font-bold text-blue-700 dark:text-blue-400">+$3.2M</span>
              </div>
              <h3 class="font-semibold text-slate-900 dark:text-white mb-1">EPA Environmental Justice Grant</h3>
              <p class="text-sm text-slate-600 dark:text-slate-400 mb-3">AI detected: Your project location qualifies for this newly announced program.</p>
              <div class="flex items-center gap-2">
                <button onclick="switchSection('discover'); toggleActionsPanel();" class="btn btn-secondary text-sm py-1.5">Learn More</button>
              </div>
            </div>
          </div>

          <div class="p-4 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50">
            <p class="text-xs text-center text-slate-500 dark:text-slate-400">AI insights updated 2 hours ago</p>
          </div>
        </div>

        <!-- V20: Section Divider -->
        <div class="section-divider"></div>

        <!-- V26: Old project card - now hidden, replaced by horizontal strip above -->
        <div id="selected-project-card" class="card mb-6 hidden" style="display: none !important;">
          <div class="flex items-start gap-6 p-6">
            <!-- Project Image - V25: 16:9 aspect ratio -->
            <div class="w-52 aspect-video rounded-lg bg-slate-100 dark:bg-slate-800 overflow-hidden flex-shrink-0">
              <img id="project-card-image" src="Ground level.jpg" alt="Project" class="w-full h-full object-cover" onerror="this.src='https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=208&h=117&fit=crop'">
            </div>
            <!-- Project Details -->
            <div class="flex-1">
              <div class="flex items-start justify-between">
                <div>
                  <h2 id="project-card-name" class="text-xl font-bold text-slate-900 dark:text-white">Mount Vernon Mixed-Use</h2>
                  <p id="project-card-address" class="text-sm text-slate-500 dark:text-slate-400 mt-1">225 South 4th Ave, Mount Vernon, NY 10550</p>
                </div>
                <span id="project-card-badge" class="px-3 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 text-xs font-semibold rounded-full">2 Actions Required</span>
              </div>
              <div class="grid grid-cols-4 gap-6 mt-5">
                <div>
                  <p class="text-xs text-slate-500 dark:text-slate-400 uppercase tracking-wide">Units</p>
                  <p id="project-card-units" class="text-lg font-bold text-slate-900 dark:text-white mt-1">747 units</p>
                </div>
                <div>
                  <p class="text-xs text-slate-500 dark:text-slate-400 uppercase tracking-wide">Type</p>
                  <p id="project-card-type" class="text-lg font-bold text-slate-900 dark:text-white mt-1">Mixed-Use</p>
                </div>
                <div>
                  <p class="text-xs text-slate-500 dark:text-slate-400 uppercase tracking-wide">Development Cost</p>
                  <p id="project-card-tdc" class="text-lg font-bold font-mono text-slate-900 dark:text-white mt-1">$588.8M</p>
                </div>
                <div>
                  <p class="text-xs text-slate-500 dark:text-slate-400 uppercase tracking-wide">Incentive Tier</p>
                  <p id="project-card-tier" class="text-lg font-bold text-blue-600 dark:text-blue-400 mt-1">Tier 3</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Master Incentives Table -->
        <div class="card mb-6">
          <div class="px-6 py-4 border-b border-slate-200 dark:border-slate-700">
            <div class="flex items-center justify-between">
              <div>
                <h2 class="text-base font-semibold text-slate-900 dark:text-white" id="incentives-title">All Incentives</h2>
                <p class="text-xs text-slate-500 dark:text-slate-400 mt-0.5" id="incentives-subtitle">29 programs across 3 projects</p>
              </div>
              <div class="flex items-center gap-3">
                <!-- Filters (hidden when individual project selected) -->
                <div id="portfolio-filters" class="flex items-center gap-3">
                  <select class="text-xs border border-slate-200 dark:border-slate-600 rounded px-2 py-1.5 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300" id="filter-type" onchange="filterIncentives()">
                    <option value="">All Types</option>
                    <option value="federal">Federal</option>
                    <option value="state">State</option>
                    <option value="local">Local</option>
                    <option value="utility">Utility</option>
                  </select>
                  <select class="text-xs border border-slate-200 dark:border-slate-600 rounded px-2 py-1.5 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300" id="filter-status" onchange="filterIncentives()">
                    <option value="">All Status</option>
                    <option value="captured">Captured</option>
                    <option value="pending">Pending</option>
                    <option value="at-risk">At Risk</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
          <div class="overflow-x-auto">
            <table class="data-table dense" id="incentives-table">
              <thead>
                <tr>
                  <th class="sort-header" data-sort="program" onclick="sortIncentives('program')">Program Name</th>
                  <th class="sort-header" data-sort="project" onclick="sortIncentives('project')">Project</th>
                  <th class="sort-header" data-sort="type" onclick="sortIncentives('type')">Type</th>
                  <th class="text-right sort-header" data-sort="amount" onclick="sortIncentives('amount')">Amount</th>
                  <!-- V32: Variance Column -->
                  <th class="text-right sort-header" data-sort="variance" onclick="sortIncentives('variance')">Variance</th>
                  <!-- V35: AI Confidence Score -->
                  <th class="text-right sort-header" data-sort="probability" onclick="sortIncentives('probability')">
                    <span class="inline-flex items-center gap-1">
                      AI Confidence
                      <svg class="w-3 h-3 text-blue-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                    </span>
                  </th>
                  <th class="sort-header" data-sort="deadline" onclick="sortIncentives('deadline')">Deadline</th>
                  <th class="sort-header" data-sort="status" onclick="sortIncentives('status')">Status</th>
                  <th class="text-center">Action</th>
                </tr>
              </thead>
              <tbody id="incentives-tbody">
                <tr class="incentive-row" data-project="new-rochelle" data-type="federal" data-status="pending">
                  <td>
                    <p class="font-medium text-slate-900 dark:text-white">LIHTC 4% Tax Credit</p>
                    <p class="text-xs text-slate-500">Low-Income Housing Tax Credit</p>
                  </td>
                  <td class="text-slate-600 dark:text-slate-300">New Rochelle</td>
                  <td><span class="text-xs font-medium text-blue-600 dark:text-blue-400">Federal</span></td>
                  <td class="text-right font-mono font-medium text-slate-900 dark:text-white">$14.2M</td>
                  <td class="text-right font-mono text-sm text-slate-400">-</td>
                  <!-- V35: AI Confidence Score Display -->
                  <td class="text-right">
                    <div class="prob-bar-container group relative cursor-help" title="AI-analyzed eligibility based on project data, historical awards, and compliance factors">
                      <div class="flex items-center justify-end gap-1">
                        <span class="text-[10px] px-1 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded font-medium">AI</span>
                        <span class="font-mono text-sm font-bold text-green-600 dark:text-green-400">94%</span>
                      </div>
                      <div class="prob-bar"><div class="prob-bar-fill high" style="width: 94%"></div></div>
                    </div>
                  </td>
                  <td class="text-slate-600 dark:text-slate-300">45 days</td>
                  <td><span class="text-xs font-medium text-blue-600 dark:text-blue-400">Pending</span></td>
                  <td class="text-center">
                    <button onclick="openIncentiveDetail('lihtc')" class="text-xs px-3 py-1.5 bg-blue-900 hover:bg-blue-800 text-white rounded-md font-medium transition-colors shadow-sm">View</button>
                  </td>
                </tr>
                <tr class="incentive-row" data-project="mt-vernon" data-type="federal" data-status="captured">
                  <td>
                    <p class="font-medium text-slate-900 dark:text-white">179D Energy Deduction</p>
                    <p class="text-xs text-slate-500">Commercial Building Energy Credit</p>
                  </td>
                  <td class="text-slate-600 dark:text-slate-300">Mount Vernon</td>
                  <td><span class="text-xs font-medium text-blue-600 dark:text-blue-400">Federal</span></td>
                  <td class="text-right font-mono font-medium text-slate-900 dark:text-white">$5.2M</td>
                  <td class="text-right font-mono text-sm text-green-500">+$320K</td>
                  <!-- V35: AI Confidence Score Display -->
                  <td class="text-right">
                    <div class="prob-bar-container group relative cursor-help" title="AI-analyzed eligibility based on project data, historical awards, and compliance factors">
                      <div class="flex items-center justify-end gap-1">
                        <span class="text-[10px] px-1 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded font-medium">AI</span>
                        <span class="font-mono text-sm font-bold text-green-600 dark:text-green-400">100%</span>
                      </div>
                      <div class="prob-bar"><div class="prob-bar-fill high" style="width: 100%"></div></div>
                    </div>
                  </td>
                  <td class="text-slate-600 dark:text-slate-300">-</td>
                  <td><span class="text-xs font-medium text-blue-700 dark:text-blue-400">Captured</span></td>
                  <td class="text-center">
                    <button onclick="openIncentiveDetail('179d')" class="text-xs px-3 py-1.5 bg-blue-900 hover:bg-blue-800 text-white rounded-md font-medium transition-colors shadow-sm">View</button>
                  </td>
                </tr>
                <tr class="incentive-row" data-project="yonkers" data-type="state" data-status="at-risk">
                  <td>
                    <p class="font-medium text-slate-900 dark:text-white">NYSERDA New Construction</p>
                    <p class="text-xs text-slate-500">NY Clean Energy Incentive</p>
                  </td>
                  <td class="text-slate-600 dark:text-slate-300">Yonkers</td>
                  <td><span class="text-xs font-medium text-blue-700 dark:text-blue-400">State</span></td>
                  <td class="text-right font-mono font-medium text-slate-900 dark:text-white">$4.8M</td>
                  <td class="text-right font-mono text-sm text-red-500">-$180K</td>
                  <td class="text-right">
                    <span class="font-mono text-sm font-medium text-blue-600 dark:text-blue-400">91%</span>
                  </td>
                  <td>
                    <span class="text-red-600 dark:text-red-400 font-medium">5 days</span>
                  </td>
                  <td><span class="text-xs font-medium text-blue-900 dark:text-blue-300">At Risk</span></td>
                  <td class="text-center">
                    <button onclick="openIncentiveDetail('nyserda')" class="text-xs px-3 py-1.5 bg-blue-900 hover:bg-blue-800 text-white rounded-md font-medium transition-colors shadow-sm">View</button>
                  </td>
                </tr>
                <tr class="incentive-row" data-project="mt-vernon" data-type="local" data-status="pending">
                  <td>
                    <p class="font-medium text-slate-900 dark:text-white">IDA PILOT</p>
                    <p class="text-xs text-slate-500">Property Tax Abatement</p>
                  </td>
                  <td class="text-slate-600 dark:text-slate-300">Mount Vernon</td>
                  <td><span class="text-xs font-medium text-blue-600 dark:text-blue-400">Local</span></td>
                  <td class="text-right font-mono font-medium text-slate-900 dark:text-white">$3.8M</td>
                  <td class="text-right font-mono text-sm text-slate-400">-</td>
                  <td class="text-right">
                    <div class="prob-bar-container">
                      <span class="font-mono text-sm font-medium text-blue-600 dark:text-blue-400">78%</span>
                      <div class="prob-bar"><div class="prob-bar-fill medium" style="width: 78%"></div></div>
                    </div>
                  </td>
                  <td class="text-slate-600 dark:text-slate-300">14 days</td>
                  <td><span class="text-xs font-medium text-blue-600 dark:text-blue-400">Pending</span></td>
                  <td class="text-center">
                    <button onclick="openIncentiveDetail('ida')" class="text-xs px-3 py-1.5 bg-blue-900 hover:bg-blue-800 text-white rounded-md font-medium transition-colors shadow-sm">View</button>
                  </td>
                </tr>
                <tr class="incentive-row" data-project="mt-vernon" data-type="federal" data-status="at-risk">
                  <td>
                    <p class="font-medium text-slate-900 dark:text-white">IRA 48C Credit</p>
                    <p class="text-xs text-slate-500">Advanced Energy Project Credit</p>
                  </td>
                  <td class="text-slate-600 dark:text-slate-300">Mount Vernon</td>
                  <td><span class="text-xs font-medium text-blue-600 dark:text-blue-400">Federal</span></td>
                  <td class="text-right font-mono font-medium text-slate-900 dark:text-white">$3.2M</td>
                  <td class="text-right font-mono text-sm text-amber-500">+$85K</td>
                  <td class="text-right">
                    <span class="font-mono text-sm font-medium text-blue-600 dark:text-blue-400">72%</span>
                  </td>
                  <td>
                    <span class="text-red-600 dark:text-red-400 font-medium">3 days</span>
                  </td>
                  <td><span class="text-xs font-medium text-blue-900 dark:text-blue-300">At Risk</span></td>
                  <td class="text-center">
                    <button onclick="openIncentiveDetail('48c')" class="text-xs px-3 py-1.5 bg-blue-900 hover:bg-blue-800 text-white rounded-md font-medium transition-colors shadow-sm">View</button>
                  </td>
                </tr>
                <tr class="incentive-row" data-project="yonkers" data-type="federal" data-status="pending">
                  <td>
                    <p class="font-medium text-slate-900 dark:text-white">45L Tax Credit</p>
                    <p class="text-xs text-slate-500">Energy Efficient Home Credit</p>
                  </td>
                  <td class="text-slate-600 dark:text-slate-300">Yonkers</td>
                  <td><span class="text-xs font-medium text-blue-600 dark:text-blue-400">Federal</span></td>
                  <td class="text-right font-mono font-medium text-slate-900 dark:text-white">$2.4M</td>
                  <td class="text-right">
                    <span class="font-mono text-sm font-medium text-blue-700 dark:text-blue-400">88%</span>
                  </td>
                  <td class="text-slate-600 dark:text-slate-300">30 days</td>
                  <td><span class="text-xs font-medium text-blue-600 dark:text-blue-400">Pending</span></td>
                  <td class="text-center">
                    <button onclick="openIncentiveDetail('45l')" class="text-xs px-3 py-1.5 bg-blue-900 hover:bg-blue-800 text-white rounded-md font-medium transition-colors shadow-sm">View</button>
                  </td>
                </tr>
                <tr class="incentive-row" data-project="new-rochelle" data-type="state" data-status="captured">
                  <td>
                    <p class="font-medium text-slate-900 dark:text-white">HCR Subsidy</p>
                    <p class="text-xs text-slate-500">NY Housing Capital Resources</p>
                  </td>
                  <td class="text-slate-600 dark:text-slate-300">New Rochelle</td>
                  <td><span class="text-xs font-medium text-blue-700 dark:text-blue-400">State</span></td>
                  <td class="text-right font-mono font-medium text-slate-900 dark:text-white">$8.5M</td>
                  <td class="text-right">
                    <span class="font-mono text-sm font-medium text-blue-700 dark:text-blue-400">100%</span>
                  </td>
                  <td class="text-slate-600 dark:text-slate-300">-</td>
                  <td><span class="text-xs font-medium text-blue-700 dark:text-blue-400">Captured</span></td>
                  <td class="text-center">
                    <button onclick="openIncentiveDetail('hcr')" class="text-xs px-3 py-1.5 bg-blue-900 hover:bg-blue-800 text-white rounded-md font-medium transition-colors shadow-sm">View</button>
                  </td>
                </tr>
                <tr class="incentive-row" data-project="mt-vernon" data-type="utility" data-status="pending">
                  <td>
                    <p class="font-medium text-slate-900 dark:text-white">Con Edison Rebate</p>
                    <p class="text-xs text-slate-500">Commercial EE Program</p>
                  </td>
                  <td class="text-slate-600 dark:text-slate-300">Mount Vernon</td>
                  <td><span class="text-xs font-medium text-blue-700 dark:text-blue-400">Utility</span></td>
                  <td class="text-right font-mono font-medium text-slate-900 dark:text-white">$1.2M</td>
                  <td class="text-right">
                    <span class="font-mono text-sm font-medium text-blue-700 dark:text-blue-400">95%</span>
                  </td>
                  <td class="text-slate-600 dark:text-slate-300">60 days</td>
                  <td><span class="text-xs font-medium text-blue-600 dark:text-blue-400">Pending</span></td>
                  <td class="text-center">
                    <button onclick="openIncentiveDetail('coned')" class="text-xs px-3 py-1.5 bg-blue-900 hover:bg-blue-800 text-white rounded-md font-medium transition-colors shadow-sm">View</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div id="incentives-footer" class="px-6 py-3 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50 flex items-center justify-between">
            <p id="incentives-count" class="text-xs text-slate-500 dark:text-slate-400">Showing 10 of 48 incentives</p>
            <button id="view-all-btn" onclick="toggleViewAll()" class="text-xs px-3 py-1.5 bg-blue-600/20 hover:bg-blue-600/30 text-blue-600 dark:text-blue-300 rounded-md font-medium transition-colors">View All 48 Incentives</button>
          </div>
        </div>

        <!-- Projects Summary Table (hidden when viewing individual project) -->
        <div id="projects-summary-card" class="card">
          <div class="px-6 py-4 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between">
            <div>
              <h2 class="text-base font-semibold text-slate-900 dark:text-white">Projects Summary</h2>
              <p class="text-xs text-slate-500 dark:text-slate-400 mt-0.5">Select projects to compare</p>
            </div>
            <button id="compare-btn" onclick="openCompareModal()" class="btn btn-secondary text-xs py-1.5 px-3 opacity-50" disabled>
              Compare Selected
            </button>
          </div>
          <div class="overflow-x-auto">
            <table class="data-table" id="projects-table">
              <thead>
                <tr>
                  <th class="w-10"><input type="checkbox" class="w-4 h-4 rounded" id="select-all" onchange="toggleAllProjects(this)"></th>
                  <th class="sort-header" onclick="sortTable('name')">Project</th>
                  <th class="text-right">TDC</th>
                  <th class="text-right">Identified</th>
                  <th class="text-right">Captured</th>
                  <th class="text-right">Rate</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="projects-tbody">
                <tr class="project-row" data-id="1">
                  <td><input type="checkbox" class="project-checkbox w-4 h-4 rounded" onchange="updateCompareSelection()"></td>
                  <td>
                    <p class="font-medium text-slate-900 dark:text-white">Mount Vernon Mixed-Use</p>
                    <p class="text-xs text-slate-500 dark:text-slate-400">225 South 4th Ave | 747 units</p>
                  </td>
                  <td class="text-right font-mono text-slate-900 dark:text-white">$285.0M</td>
                  <td class="text-right font-mono text-slate-900 dark:text-white">$87.2M</td>
                  <td class="text-right font-mono text-blue-600 dark:text-blue-400">$28.5M</td>
                  <td class="text-right font-mono text-slate-600 dark:text-slate-300">33%</td>
                  <td><span class="text-xs font-medium text-blue-600">2 actions</span></td>
                </tr>
                <tr class="project-row" data-id="2">
                  <td><input type="checkbox" class="project-checkbox w-4 h-4 rounded" onchange="updateCompareSelection()"></td>
                  <td>
                    <p class="font-medium text-slate-900 dark:text-white">Yonkers Affordable Housing</p>
                    <p class="text-xs text-slate-500 dark:text-slate-400">87 Warburton Ave | 312 units</p>
                  </td>
                  <td class="text-right font-mono text-slate-900 dark:text-white">$155.0M</td>
                  <td class="text-right font-mono text-slate-900 dark:text-white">$47.6M</td>
                  <td class="text-right font-mono text-blue-600 dark:text-blue-400">$15.3M</td>
                  <td class="text-right font-mono text-slate-600 dark:text-slate-300">32%</td>
                  <td><span class="text-xs font-medium text-red-600">1 critical</span></td>
                </tr>
                <tr class="project-row" data-id="3">
                  <td><input type="checkbox" class="project-checkbox w-4 h-4 rounded" onchange="updateCompareSelection()"></td>
                  <td>
                    <p class="font-medium text-slate-900 dark:text-white">New Rochelle Transit Hub</p>
                    <p class="text-xs text-slate-500 dark:text-slate-400">150 Main St | 428 units</p>
                  </td>
                  <td class="text-right font-mono text-slate-900 dark:text-white">$104.0M</td>
                  <td class="text-right font-mono text-slate-900 dark:text-white">$36.4M</td>
                  <td class="text-right font-mono text-blue-600 dark:text-blue-400">$6.9M</td>
                  <td class="text-right font-mono text-slate-600 dark:text-slate-300">19%</td>
                  <td><span class="text-xs font-medium text-blue-700">On track</span></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- DISCOVER SECTION -->
      <section id="section-discover" class="section-content hidden">
        <div class="section-header mb-6">
          <div>
            <h1 class="font-sora text-2xl font-bold text-slate-900 dark:text-white">Incentive Scanner</h1>
            <p class="text-slate-500 dark:text-slate-400 mt-1">Analyze your project against 10,000+ incentive programs</p>
          </div>
          <div class="flex items-center gap-3">
            <span class="text-xs text-slate-500 dark:text-slate-400" id="access-level-label">Access Level:</span>
            <select id="demo-access-tier" onchange="updateAccessTier(this.value)" class="form-input w-auto text-xs py-1">
              <option value="public">Public Preview</option>
              <option value="free" selected>Free Account</option>
              <option value="paid">Enterprise</option>
            </select>
          </div>
        </div>

        <!-- V23: Tiered Access Gate (shows for public tier) -->
        <div id="discover-gate" class="hidden mb-6 p-6 bg-gradient-to-br from-blue-50 to-slate-50 dark:from-blue-950/20 dark:to-slate-900 border border-blue-200 dark:border-blue-800 rounded-xl">
          <div class="flex items-start gap-4">
            <div class="w-12 h-12 rounded-xl bg-blue-100 dark:bg-blue-900/50 flex items-center justify-center flex-shrink-0">
              <svg class="w-6 h-6 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
            </div>
            <div class="flex-1">
              <h3 class="font-semibold text-slate-900 dark:text-white mb-1">Unlock Full Program Details</h3>
              <p class="text-sm text-slate-600 dark:text-slate-400 mb-3">
                You're viewing a preview. Create a free account to see full program details, exact values, and eligibility requirements.
              </p>
              <div class="flex items-center gap-3">
                <button onclick="document.getElementById('demo-access-tier').value='free'; updateAccessTier('free');" class="btn btn-primary text-sm">
                  Create Free Account
                </button>
                <span class="text-xs text-slate-500">or</span>
                <button onclick="document.getElementById('demo-access-tier').value='paid'; updateAccessTier('paid');" class="text-sm text-blue-600 dark:text-blue-400 hover:underline">
                  View Enterprise Plans
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- V23: Search Limit Warning (shows for free tier) -->
        <div id="search-limit-warning" class="hidden mb-4 px-4 py-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg">
          <div class="flex items-center gap-3">
            <svg class="w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
            <span class="text-sm text-amber-800 dark:text-amber-300">
              <strong>Free tier:</strong> <span id="searches-remaining">7</span> searches remaining this month. <a href="#" onclick="document.getElementById('demo-access-tier').value='paid'; updateAccessTier('paid'); return false;" class="underline hover:no-underline">Upgrade for unlimited</a>
            </span>
          </div>
        </div>

        <!-- Search and Filters -->
        <div class="card p-4 mb-6">
          <div class="flex flex-wrap gap-4">
            <div class="flex-1 min-w-[200px]">
              <input type="text" placeholder="Search incentives by name, program, or keyword..." class="form-input" id="incentive-search">
            </div>
            <select class="form-input w-auto" id="filter-level">
              <option value="">All Levels</option>
              <option value="federal">Federal</option>
              <option value="state">State</option>
              <option value="local">Local</option>
              <option value="utility">Utility</option>
            </select>
            <select class="form-input w-auto" id="filter-type">
              <option value="">All Types</option>
              <option value="tax-credit">Tax Credit</option>
              <option value="grant">Grant</option>
              <option value="rebate">Rebate</option>
              <option value="loan">Low-Interest Loan</option>
              <option value="abatement">Tax Abatement</option>
            </select>
            <button class="btn btn-primary" onclick="searchIncentives()">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
              Search
            </button>
          </div>
        </div>

        <!-- Incentive Categories -->
        <div class="grid grid-cols-4 gap-4 mb-6 metric-grid">
          <div class="card p-5 cursor-pointer hover:border-blue-500 transition-all" onclick="filterByLevel('federal')">
            <div class="flex items-center gap-3 mb-3">
              <div class="w-10 h-10 rounded-lg bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center">
                <svg class="w-5 h-5 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 21v-4m0 0V5a2 2 0 012-2h6.5l1 1H21l-3 6 3 6h-8.5l-1-1H5a2 2 0 00-2 2zm9-13.5V9"/></svg>
              </div>
              <div>
                <p class="text-sm font-medium text-slate-900 dark:text-white">Federal</p>
                <p class="text-xs text-slate-500">IRA, 179D, 45L, LIHTC</p>
              </div>
            </div>
            <p class="text-2xl font-mono font-bold text-blue-600 dark:text-blue-400">2,847</p>
            <p class="text-xs text-slate-500 mt-1">Active programs</p>
          </div>
          <div class="card p-5 cursor-pointer hover:border-blue-500 transition-all" onclick="filterByLevel('state')">
            <div class="flex items-center gap-3 mb-3">
              <div class="w-10 h-10 rounded-lg bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center">
                <svg class="w-5 h-5 text-blue-700 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
              </div>
              <div>
                <p class="text-sm font-medium text-slate-900 dark:text-white">State</p>
                <p class="text-xs text-slate-500">NYSERDA, HCR, ESD</p>
              </div>
            </div>
            <p class="text-2xl font-mono font-bold text-blue-700 dark:text-blue-400">4,521</p>
            <p class="text-xs text-slate-500 mt-1">Active programs</p>
          </div>
          <div class="card p-5 cursor-pointer hover:border-cyan-500 transition-all" onclick="filterByLevel('local')">
            <div class="flex items-center gap-3 mb-3">
              <div class="w-10 h-10 rounded-lg bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center">
                <svg class="w-5 h-5 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
              </div>
              <div>
                <p class="text-sm font-medium text-slate-900 dark:text-white">Local</p>
                <p class="text-xs text-slate-500">IDA, PILOT, TIF</p>
              </div>
            </div>
            <p class="text-2xl font-mono font-bold text-blue-600 dark:text-blue-400">2,156</p>
            <p class="text-xs text-slate-500 mt-1">Active programs</p>
          </div>
          <div class="card p-5 cursor-pointer hover:border-blue-500 transition-all" onclick="filterByLevel('utility')">
            <div class="flex items-center gap-3 mb-3">
              <div class="w-10 h-10 rounded-lg bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center">
                <svg class="w-5 h-5 text-blue-700 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
              </div>
              <div>
                <p class="text-sm font-medium text-slate-900 dark:text-white">Utility</p>
                <p class="text-xs text-slate-500">Con Ed, National Grid</p>
              </div>
            </div>
            <p class="text-2xl font-mono font-bold text-blue-700 dark:text-blue-400">892</p>
            <p class="text-xs text-slate-500 mt-1">Active programs</p>
          </div>
        </div>

        <!-- V32: Historical Incentive Data -->
        <div class="card mb-6">
          <div class="p-4 border-b border-slate-200 dark:border-slate-700/30 flex items-center justify-between">
            <div>
              <h3 class="font-semibold text-slate-900 dark:text-white">Historical Incentive Trends</h3>
              <p class="text-sm text-slate-500">Track how incentive values have changed over time</p>
            </div>
            <select class="form-input w-auto text-sm" id="historical-program-select">
              <option value="45L">45L Energy Efficient Home Credit</option>
              <option value="179D">179D Commercial Deduction</option>
              <option value="LIHTC">LIHTC 9% Credit Rate</option>
              <option value="NYSERDA">NYSERDA PON Rates</option>
            </select>
          </div>
          <div class="p-4">
            <div class="grid grid-cols-5 gap-4 mb-4">
              <div class="text-center p-3 bg-slate-100 dark:bg-slate-800/50 rounded-lg">
                <p class="text-xs text-slate-500 mb-1">2022</p>
                <p class="font-mono font-bold text-slate-600 dark:text-slate-400">$2,000</p>
                <p class="text-xs text-slate-400">Pre-IRA</p>
              </div>
              <div class="text-center p-3 bg-slate-100 dark:bg-slate-800/50 rounded-lg">
                <p class="text-xs text-slate-500 mb-1">2023</p>
                <p class="font-mono font-bold text-blue-600 dark:text-blue-400">$2,500</p>
                <p class="text-xs text-green-500">+25%</p>
              </div>
              <div class="text-center p-3 bg-slate-100 dark:bg-slate-800/50 rounded-lg">
                <p class="text-xs text-slate-500 mb-1">2024</p>
                <p class="font-mono font-bold text-blue-600 dark:text-blue-400">$2,500</p>
                <p class="text-xs text-slate-400">Stable</p>
              </div>
              <div class="text-center p-3 bg-blue-100 dark:bg-blue-900/30 rounded-lg border-2 border-blue-500">
                <p class="text-xs text-blue-600 dark:text-blue-400 font-medium mb-1">2025</p>
                <p class="font-mono font-bold text-blue-700 dark:text-blue-300">$2,585</p>
                <p class="text-xs text-green-500">+3.4%</p>
              </div>
              <div class="text-center p-3 bg-slate-100 dark:bg-slate-800/50 rounded-lg border border-dashed border-slate-300 dark:border-slate-600">
                <p class="text-xs text-slate-500 mb-1">2026</p>
                <p class="font-mono font-bold text-slate-500 dark:text-slate-400">$2,670*</p>
                <p class="text-xs text-slate-400">Projected</p>
              </div>
            </div>
            <div class="flex items-center justify-between text-xs text-slate-500">
              <p>* 2026 values projected based on CPI inflation estimates</p>
              <a href="#" onclick="switchSection('trustcenter'); return false;" class="text-blue-600 dark:text-blue-400 hover:underline">View data methodology</a>
            </div>
          </div>
        </div>

        <!-- Incentives Table -->
        <div class="card overflow-hidden">
          <div class="px-6 py-4 border-b border-slate-200 dark:border-slate-700/30">
            <h2 class="section-title">Featured Incentives</h2>
          </div>
          <div class="overflow-x-auto">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Program Name</th>
                  <th>Level</th>
                  <th>Type</th>
                  <th class="text-right">Max Value</th>
                  <th>Deadline</th>
                  <th>Eligibility</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <p class="font-medium text-slate-900 dark:text-white">IRA Section 45L Tax Credit</p>
                    <p class="text-xs text-slate-500">Energy efficient home credit</p>
                  </td>
                  <td><span class="badge badge-federal">Federal</span></td>
                  <td>Tax Credit</td>
                  <td class="text-right font-mono font-medium">$5,000/unit</td>
                  <td>Dec 31, 2032</td>
                  <td><span class="status-badge status-success">Eligible</span></td>
                </tr>
                <tr>
                  <td>
                    <p class="font-medium text-slate-900 dark:text-white">NYSERDA Clean Energy Fund</p>
                    <p class="text-xs text-slate-500">New construction incentives</p>
                  </td>
                  <td><span class="badge badge-state">State</span></td>
                  <td>Grant</td>
                  <td class="text-right font-mono font-medium">$3M max</td>
                  <td>Rolling</td>
                  <td><span class="status-badge status-success">Eligible</span></td>
                </tr>
                <tr>
                  <td>
                    <p class="font-medium text-slate-900 dark:text-white">Westchester County IDA PILOT</p>
                    <p class="text-xs text-slate-500">Property tax abatement</p>
                  </td>
                  <td><span class="badge badge-local">Local</span></td>
                  <td>Tax Abatement</td>
                  <td class="text-right font-mono font-medium">15-year</td>
                  <td>Application based</td>
                  <td><span class="status-badge status-info">Review</span></td>
                </tr>
                <tr>
                  <td>
                    <p class="font-medium text-slate-900 dark:text-white">Con Edison Commercial Rebate</p>
                    <p class="text-xs text-slate-500">HVAC and lighting upgrades</p>
                  </td>
                  <td><span class="badge badge-utility">Utility</span></td>
                  <td>Rebate</td>
                  <td class="text-right font-mono font-medium">$500K max</td>
                  <td>Q4 2026</td>
                  <td><span class="status-badge status-success">Eligible</span></td>
                </tr>
                <tr>
                  <td>
                    <p class="font-medium text-slate-900 dark:text-white">IRA Section 179D Deduction</p>
                    <p class="text-xs text-slate-500">Commercial building efficiency</p>
                  </td>
                  <td><span class="badge badge-federal">Federal</span></td>
                  <td>Tax Deduction</td>
                  <td class="text-right font-mono font-medium">$5.00/sqft</td>
                  <td>Permanent</td>
                  <td><span class="status-badge status-success">Eligible</span></td>
                </tr>
              </tbody>
            </table>
          </div>
          <!-- V31: Empty State for No Search Results -->
          <div id="discover-empty-state" class="empty-state hidden">
            <div class="empty-state-icon">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
            </div>
            <h3 class="empty-state-title">No incentives found</h3>
            <p class="empty-state-description">Try adjusting your search terms or filters. You can also browse by category using the cards above.</p>
            <button onclick="clearIncentiveSearch()" class="empty-state-action">Clear Filters</button>
          </div>
          <!-- V31: Error State Example -->
          <div id="discover-error-state" class="error-state hidden m-6">
            <div class="error-state-icon">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
            </div>
            <h4 class="error-state-title">Unable to load incentives</h4>
            <p class="error-state-description">There was a problem connecting to the incentive database. Please try again.</p>
            <button onclick="retryIncentiveLoad()" class="error-state-retry">Retry</button>
          </div>
          <!-- V31: Skeleton Loading State -->
          <div id="discover-skeleton" class="hidden p-6">
            <div class="skeleton skeleton-row"></div>
            <div class="skeleton skeleton-row"></div>
            <div class="skeleton skeleton-row"></div>
            <div class="skeleton skeleton-row"></div>
            <div class="skeleton skeleton-row"></div>
          </div>
        </div>
      </section>

      <!-- V42: MATCHING SECTION (AI-Powered) -->
      <section id="section-matching" class="section-content hidden">
        <div class="section-header mb-6">
          <div>
            <h1 class="font-sora text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-3">
              AI-Powered Incentive Matching
              <span class="px-2 py-1 text-xs font-bold bg-blue-500/20 text-blue-400 rounded">AI</span>
            </h1>
            <p class="text-slate-500 dark:text-slate-400 mt-1">Category 40% &bull; Location 35% &bull; Eligibility 25%</p>
          </div>
        </div>

        <!-- Project Selector -->
        <div class="card p-4 mb-6">
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Select Project to Match</label>
          <select class="w-full md:w-1/2 px-4 py-3 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white">
            <option>Mount Vernon Mixed-Use</option>
            <option>Yonkers Affordable Housing</option>
            <option>New Rochelle Transit Hub</option>
          </select>
        </div>

        <!-- Match Results Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <!-- Match Card 1 -->
          <div class="card p-4">
            <div class="flex items-start justify-between mb-3">
              <span class="px-2 py-1 text-xs font-medium rounded" style="background: rgba(29, 78, 216, 1); color: white;">Federal</span>
              <div class="flex items-center gap-1">
                <span class="w-2 h-2 rounded-full bg-teal-500"></span>
                <span class="text-teal-400 text-xs font-mono">2d ago</span>
              </div>
            </div>
            <h3 class="font-semibold text-slate-900 dark:text-white mb-2">IRA Section 48 ITC</h3>
            <p class="text-sm text-slate-500 dark:text-slate-400 mb-4">Investment Tax Credit for clean energy property</p>
            <div class="mb-3">
              <div class="flex justify-between text-xs mb-1">
                <span class="text-slate-400">Match Score</span>
                <span class="text-blue-400 font-mono font-bold">94%</span>
              </div>
              <div class="w-full h-1.5 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden">
                <div class="h-full rounded-full bg-gradient-to-r from-blue-500 to-teal-500" style="width: 94%"></div>
              </div>
            </div>
            <div class="text-2xl font-mono font-bold text-emerald-500">$4,500,000</div>
          </div>

          <!-- Match Card 2 -->
          <div class="card p-4">
            <div class="flex items-start justify-between mb-3">
              <span class="px-2 py-1 text-xs font-medium rounded" style="background: rgba(37, 99, 235, 0.75); color: white;">State</span>
              <div class="flex items-center gap-1">
                <span class="w-2 h-2 rounded-full bg-blue-500"></span>
                <span class="text-blue-400 text-xs font-mono">1w ago</span>
              </div>
            </div>
            <h3 class="font-semibold text-slate-900 dark:text-white mb-2">NY-Sun Incentive</h3>
            <p class="text-sm text-slate-500 dark:text-slate-400 mb-4">NYSERDA solar installation incentive</p>
            <div class="mb-3">
              <div class="flex justify-between text-xs mb-1">
                <span class="text-slate-400">Match Score</span>
                <span class="text-blue-400 font-mono font-bold">87%</span>
              </div>
              <div class="w-full h-1.5 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden">
                <div class="h-full rounded-full bg-gradient-to-r from-blue-500 to-teal-500" style="width: 87%"></div>
              </div>
            </div>
            <div class="text-2xl font-mono font-bold text-emerald-500">$1,250,000</div>
          </div>

          <!-- Match Card 3 -->
          <div class="card p-4">
            <div class="flex items-start justify-between mb-3">
              <span class="px-2 py-1 text-xs font-medium rounded" style="background: rgba(59, 130, 246, 0.5); color: white;">Local</span>
              <div class="flex items-center gap-1">
                <span class="w-2 h-2 rounded-full bg-amber-500"></span>
                <span class="text-amber-500 text-xs font-mono">3mo ago</span>
              </div>
            </div>
            <h3 class="font-semibold text-slate-900 dark:text-white mb-2">Yonkers Tax Abatement</h3>
            <p class="text-sm text-slate-500 dark:text-slate-400 mb-4">Property tax abatement for green buildings</p>
            <div class="mb-3">
              <div class="flex justify-between text-xs mb-1">
                <span class="text-slate-400">Match Score</span>
                <span class="text-blue-400 font-mono font-bold">78%</span>
              </div>
              <div class="w-full h-1.5 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden">
                <div class="h-full rounded-full bg-gradient-to-r from-blue-500 to-teal-500" style="width: 78%"></div>
              </div>
            </div>
            <div class="text-2xl font-mono font-bold text-emerald-500">$2,000,000</div>
          </div>
        </div>

        <!-- Total Summary -->
        <div class="card p-6 mt-6 bg-gradient-to-r from-blue-500/10 to-teal-500/10 border-blue-500/30">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-slate-500 dark:text-slate-400 text-sm">Total Matched Incentive Value</p>
              <p class="text-3xl font-mono font-bold text-emerald-500 mt-1">$7,750,000</p>
            </div>
            <div class="text-right">
              <p class="text-slate-500 dark:text-slate-400 text-sm">Incentive / TDC Ratio</p>
              <p class="text-3xl font-mono font-bold text-blue-400 mt-1">17.2%</p>
            </div>
            <button class="btn btn-primary">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
              Export Report
            </button>
          </div>
        </div>
      </section>

      <!-- V42: GREEN INCENTIVES SECTION (IRA Tax Credits) -->
      <section id="section-green" class="section-content hidden">
        <div class="section-header mb-6">
          <div>
            <h1 class="font-sora text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-3">
              <svg class="w-6 h-6 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/></svg>
              Green Incentives
            </h1>
            <p class="text-slate-500 dark:text-slate-400 mt-1">IRA Tax Credits &amp; Clean Energy Incentives</p>
          </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- IRA ITC Calculator -->
          <div class="card p-6" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(20, 184, 166, 0.05)); border-color: rgba(16, 185, 129, 0.3);">
            <h3 class="font-semibold text-slate-900 dark:text-white mb-4 flex items-center gap-2">
              <span class="w-8 h-8 rounded-lg bg-emerald-500/20 flex items-center justify-center">
                <svg class="w-4 h-4 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707"/></svg>
              </span>
              IRA ITC Calculator
            </h3>
            <div class="space-y-3 mb-6">
              <div class="flex justify-between items-center py-2 border-b border-slate-700/50">
                <span class="text-slate-500 dark:text-slate-400 text-sm">Base ITC Rate</span>
                <span class="text-slate-900 dark:text-white font-mono">30%</span>
              </div>
              <div class="flex justify-between items-center py-2 border-b border-slate-700/50">
                <span class="text-slate-500 dark:text-slate-400 text-sm">Domestic Content Bonus</span>
                <span class="text-emerald-500 font-mono">+10%</span>
              </div>
              <div class="flex justify-between items-center py-2 border-b border-slate-700/50">
                <span class="text-slate-500 dark:text-slate-400 text-sm">Energy Community Bonus</span>
                <span class="text-emerald-500 font-mono">+10%</span>
              </div>
              <div class="flex justify-between items-center py-2">
                <span class="text-slate-900 dark:text-white font-semibold">Total ITC Rate</span>
                <span class="text-emerald-500 font-mono font-bold text-xl">50%</span>
              </div>
            </div>
            <div class="bg-slate-100 dark:bg-slate-800/50 rounded-lg p-4">
              <p class="text-slate-500 dark:text-slate-400 text-xs mb-1">Estimated Tax Credit Value</p>
              <p class="text-3xl font-mono font-bold text-emerald-500">$7,500,000</p>
              <p class="text-slate-400 text-xs mt-1">Based on $15M qualified investment</p>
            </div>
          </div>

          <!-- Technology Categories -->
          <div class="card p-6">
            <h3 class="font-semibold text-slate-900 dark:text-white mb-4">Eligible Technologies</h3>
            <div class="grid grid-cols-2 gap-3">
              <div class="bg-slate-100 dark:bg-slate-800/50 rounded-lg p-3 border border-slate-200 dark:border-slate-700/50 hover:border-blue-500/30 transition-colors cursor-pointer">
                <div class="w-10 h-10 rounded-lg bg-amber-500/20 flex items-center justify-center mb-2">
                  <svg class="w-5 h-5 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
                </div>
                <p class="text-slate-900 dark:text-white text-sm font-medium">Solar PV</p>
                <p class="text-slate-400 text-xs">Section 48 ITC</p>
              </div>
              <div class="bg-slate-100 dark:bg-slate-800/50 rounded-lg p-3 border border-slate-200 dark:border-slate-700/50 hover:border-blue-500/30 transition-colors cursor-pointer">
                <div class="w-10 h-10 rounded-lg bg-purple-500/20 flex items-center justify-center mb-2">
                  <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                </div>
                <p class="text-slate-900 dark:text-white text-sm font-medium">Battery Storage</p>
                <p class="text-slate-400 text-xs">Standalone eligible</p>
              </div>
              <div class="bg-slate-100 dark:bg-slate-800/50 rounded-lg p-3 border border-slate-200 dark:border-slate-700/50 hover:border-blue-500/30 transition-colors cursor-pointer">
                <div class="w-10 h-10 rounded-lg bg-cyan-500/20 flex items-center justify-center mb-2">
                  <svg class="w-5 h-5 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/></svg>
                </div>
                <p class="text-slate-900 dark:text-white text-sm font-medium">Wind</p>
                <p class="text-slate-400 text-xs">Section 45 PTC</p>
              </div>
              <div class="bg-slate-100 dark:bg-slate-800/50 rounded-lg p-3 border border-slate-200 dark:border-slate-700/50 hover:border-blue-500/30 transition-colors cursor-pointer">
                <div class="w-10 h-10 rounded-lg bg-emerald-500/20 flex items-center justify-center mb-2">
                  <svg class="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
                </div>
                <p class="text-slate-900 dark:text-white text-sm font-medium">Efficient Buildings</p>
                <p class="text-slate-400 text-xs">Section 179D</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ANALYSIS SECTION -->
      <section id="section-analysis" class="section-content hidden">
        <div class="section-header mb-6">
          <div>
            <h1 class="font-sora text-2xl font-bold text-slate-900 dark:text-white">New Project Analysis</h1>
            <p class="text-slate-500 dark:text-slate-400 mt-1">Enter your project details to discover matching incentives</p>
          </div>
        </div>

        <!-- Progress Steps -->
        <div class="flex items-center justify-center mb-8">
          <div class="flex items-center gap-4">
            <div class="flex items-center gap-2">
              <div class="w-8 h-8 rounded-full bg-blue-500 text-white flex items-center justify-center text-sm font-semibold" id="step-1">1</div>
              <span class="text-sm font-medium text-slate-900 dark:text-white">Property</span>
            </div>
            <div class="w-16 h-0.5 bg-slate-200 dark:bg-slate-700/50" id="line-1-2"></div>
            <div class="flex items-center gap-2">
              <div class="w-8 h-8 rounded-full bg-slate-200 dark:bg-slate-700/50 text-slate-500 flex items-center justify-center text-sm font-semibold" id="step-2">2</div>
              <span class="text-sm font-medium text-slate-500">Details</span>
            </div>
            <div class="w-16 h-0.5 bg-slate-200 dark:bg-slate-700/50" id="line-2-3"></div>
            <div class="flex items-center gap-2">
              <div class="w-8 h-8 rounded-full bg-slate-200 dark:bg-slate-700/50 text-slate-500 flex items-center justify-center text-sm font-semibold" id="step-3">3</div>
              <span class="text-sm font-medium text-slate-500">Sustainability</span>
            </div>
            <div class="w-16 h-0.5 bg-slate-200 dark:bg-slate-700/50" id="line-3-4"></div>
            <div class="flex items-center gap-2">
              <div class="w-8 h-8 rounded-full bg-slate-200 dark:bg-slate-700/50 text-slate-500 flex items-center justify-center text-sm font-semibold" id="step-4">4</div>
              <span class="text-sm font-medium text-slate-500">Results</span>
            </div>
          </div>
        </div>

        <!-- Step 1: Property Info - V25 Hybrid API Approach -->
        <div class="card p-6" id="analysis-step-1">
          <h2 class="section-title mb-4">Property Information</h2>

          <!-- V25: Address Lookup Bar -->
          <div class="mb-6 p-4 bg-slate-50 dark:bg-slate-800/50 rounded-lg border border-slate-200 dark:border-slate-700">
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
              Quick Property Lookup
            </label>
            <div class="flex gap-3">
              <input type="text" class="form-input flex-1" id="prop-address-lookup" placeholder="Enter full address (e.g., 225 South 4th Ave, Mount Vernon, NY 10550)">
              <button onclick="lookupPropertyAddress()" class="btn btn-primary whitespace-nowrap" id="lookup-btn">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                Lookup
              </button>
            </div>
            <p class="text-xs text-slate-500 dark:text-slate-400 mt-2">Enter address to auto-populate property details, or fill in manually below</p>

            <!-- Lookup Status -->
            <div id="lookup-status" class="hidden mt-3">
              <div id="lookup-loading" class="hidden flex items-center gap-2 text-blue-600 dark:text-blue-400">
                <div class="spinner w-4 h-4"></div>
                <span class="text-sm">Fetching property data...</span>
              </div>
              <div id="lookup-success" class="hidden flex items-center gap-2 text-blue-700 dark:text-blue-400">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                <span class="text-sm">Property data found and auto-populated. <button onclick="clearLookupData()" class="underline hover:text-blue-800 dark:hover:text-blue-300">Clear & enter manually</button></span>
              </div>
              <div id="lookup-error" class="hidden flex items-center gap-2 text-blue-600 dark:text-blue-400">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
                <span class="text-sm">Property not found in database. Please enter details manually below.</span>
              </div>
            </div>
          </div>

          <!-- Manual Entry Fields -->
          <div class="grid grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Property Address <span class="text-red-500">*</span></label>
              <div class="address-autocomplete-container">
                <input type="text" class="form-input" id="prop-address" placeholder="Start typing an address..." autocomplete="off" oninput="handleAddressInput(this)" onfocus="showAddressDropdown()" onblur="setTimeout(() => hideAddressDropdown(), 200)">
                <div id="address-dropdown" class="address-autocomplete-dropdown">
                  <!-- Results populated by JavaScript -->
                </div>
              </div>
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">City, State, ZIP <span class="text-red-500">*</span></label>
              <input type="text" class="form-input" id="prop-city" placeholder="e.g., Mount Vernon, NY 10550">
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Property Type <span class="text-red-500">*</span></label>
              <select class="form-input" id="prop-type" onchange="toggleOtherPropertyType()">
                <option value="">Select property type</option>
                <optgroup label="Residential">
                  <option value="multifamily">Multifamily Residential</option>
                  <option value="single-family">Single Family Rental</option>
                  <option value="affordable">Affordable Housing (LIHTC)</option>
                  <option value="senior-living">Senior Living / Active Adult</option>
                  <option value="student-housing">Student Housing</option>
                  <option value="workforce">Workforce Housing</option>
                  <option value="manufactured">Manufactured Housing</option>
                  <option value="co-living">Co-Living / Micro-Units</option>
                </optgroup>
                <optgroup label="Commercial Office">
                  <option value="office-class-a">Class A Office</option>
                  <option value="office-class-b">Class B/C Office</option>
                  <option value="office-medical">Medical Office Building</option>
                  <option value="office-creative">Creative / Flex Office</option>
                  <option value="office-conversion">Office-to-Residential Conversion</option>
                </optgroup>
                <optgroup label="Retail & Hospitality">
                  <option value="retail-strip">Strip Center / Retail</option>
                  <option value="retail-mall">Regional Mall / Lifestyle Center</option>
                  <option value="mixed-use">Mixed-Use Development</option>
                  <option value="hospitality-full">Full-Service Hotel</option>
                  <option value="hospitality-limited">Limited-Service / Select-Service Hotel</option>
                  <option value="hospitality-extended">Extended Stay</option>
                  <option value="restaurant">Restaurant / Food Service</option>
                  <option value="entertainment">Entertainment / Sports Venue</option>
                </optgroup>
                <optgroup label="Industrial & Logistics">
                  <option value="industrial-warehouse">Warehouse / Distribution</option>
                  <option value="industrial-manufacturing">Manufacturing Facility</option>
                  <option value="industrial-flex">Flex Industrial</option>
                  <option value="logistics">Last-Mile Logistics</option>
                  <option value="cold-storage">Cold Storage / Refrigerated</option>
                  <option value="self-storage">Self-Storage</option>
                  <option value="truck-terminal">Truck Terminal</option>
                </optgroup>
                <optgroup label="Specialty & Technology">
                  <option value="data-center">Data Center</option>
                  <option value="life-sciences">Life Sciences / Lab</option>
                  <option value="biotech">Biotech / Pharmaceutical</option>
                  <option value="cannabis">Cannabis Cultivation / Dispensary</option>
                  <option value="film-studio">Film / Media Studio</option>
                  <option value="ev-charging">EV Charging Hub</option>
                </optgroup>
                <optgroup label="Healthcare">
                  <option value="hospital">Hospital / Acute Care</option>
                  <option value="outpatient">Outpatient / Ambulatory Surgery</option>
                  <option value="skilled-nursing">Skilled Nursing Facility</option>
                  <option value="behavioral-health">Behavioral Health</option>
                  <option value="urgent-care">Urgent Care / Clinic</option>
                </optgroup>
                <optgroup label="Education & Civic">
                  <option value="education-k12">K-12 School</option>
                  <option value="education-higher">Higher Education</option>
                  <option value="community-center">Community Center</option>
                  <option value="religious">Religious / House of Worship</option>
                  <option value="government">Government / Civic</option>
                </optgroup>
                <optgroup label="Infrastructure & Utilities">
                  <option value="infrastructure-transit">Transit / Transportation</option>
                  <option value="infrastructure-utility">Utility Infrastructure</option>
                  <option value="infrastructure-telecom">Telecommunications / Cell Tower</option>
                  <option value="solar-farm">Solar Farm / Renewable Energy</option>
                  <option value="parking">Parking Structure</option>
                </optgroup>
                <optgroup label="Land & Development">
                  <option value="land-entitled">Entitled Land</option>
                  <option value="land-unentitled">Unentitled Land</option>
                  <option value="brownfield">Brownfield / Remediation</option>
                  <option value="agricultural">Agricultural / Farm</option>
                </optgroup>
                <optgroup label="Other">
                  <option value="other">Other (specify below)</option>
                </optgroup>
              </select>
              <input type="text" class="form-input mt-2 hidden" id="prop-type-other" placeholder="Describe property type...">
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Project Type <span class="text-red-500">*</span></label>
              <select class="form-input" id="project-type" onchange="showMixedIncomeOptions(this.value)">
                <option value="">Select project type</option>
                <option value="new-construction">New Construction</option>
                <option value="conversion">Office to Residential Conversion</option>
                <option value="renovation">Major Renovation</option>
                <option value="adaptive-reuse">Adaptive Reuse</option>
                <!-- V32: Mixed-Income Housing -->
                <option value="mixed-income">Mixed-Income Housing</option>
              </select>
              <!-- V32: Mixed-Income Configuration Panel -->
              <div id="mixed-income-config" class="hidden mt-3 p-4 bg-blue-900/20 border border-blue-700/30 rounded-lg">
                <p class="text-sm font-medium text-blue-300 mb-3">Mixed-Income Configuration</p>
                <div class="grid grid-cols-3 gap-4">
                  <div>
                    <label class="block text-xs text-slate-400 mb-1">Market Rate Units (%)</label>
                    <input type="number" class="form-input" id="market-rate-pct" value="70" max="100" min="0" oninput="updateAffordablePct()">
                  </div>
                  <div>
                    <label class="block text-xs text-slate-400 mb-1">Affordable Units (%)</label>
                    <input type="number" class="form-input" id="affordable-units-pct" value="30" max="100" min="0" readonly>
                  </div>
                  <div>
                    <label class="block text-xs text-slate-400 mb-1">AMI Target</label>
                    <select class="form-input" id="ami-target">
                      <option value="30">30% AMI (Very Low)</option>
                      <option value="50">50% AMI (Low)</option>
                      <option value="60" selected>60% AMI (LIHTC Standard)</option>
                      <option value="80">80% AMI (Moderate)</option>
                      <option value="100">100% AMI (Workforce)</option>
                      <option value="120">120% AMI (Middle Income)</option>
                    </select>
                  </div>
                </div>
                <div class="mt-3 p-2 bg-slate-800/50 rounded text-xs text-slate-400">
                  <span class="text-green-400 font-medium">Eligible Programs:</span> LIHTC (4% or 9%), 421-a Successor, IDA PILOT, 45L Credits, Section 8 PBRA
                </div>
              </div>
            </div>
          </div>
          <div class="flex justify-end mt-6">
            <button class="btn btn-primary" onclick="nextAnalysisStep(2)">
              Continue
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
            </button>
          </div>
        </div>

        <!-- Step 2: Project Details (Hidden initially) -->
        <div class="card p-6 hidden" id="analysis-step-2">
          <h2 class="section-title mb-4">Project Details</h2>
          <div class="grid grid-cols-3 gap-6">
            <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Total Units</label>
              <input type="number" class="form-input" id="total-units" placeholder="e.g., 120">
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Affordable Units (%)</label>
              <input type="number" class="form-input" id="affordable-pct" placeholder="e.g., 25">
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Total Sq Ft</label>
              <input type="number" class="form-input" id="total-sqft" placeholder="e.g., 150000">
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Estimated TDC ($M)</label>
              <input type="number" class="form-input" id="est-tdc" placeholder="e.g., 85">
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Construction Start</label>
              <input type="date" class="form-input" id="const-start">
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Completion Target</label>
              <input type="date" class="form-input" id="const-end">
            </div>
          </div>
          <div class="flex justify-between mt-6">
            <button class="btn btn-secondary" onclick="nextAnalysisStep(1)">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
              Back
            </button>
            <button class="btn btn-primary" onclick="nextAnalysisStep(3)">
              Continue
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
            </button>
          </div>
        </div>

        <!-- Step 3: Sustainability (Hidden initially) -->
        <div class="card p-6 hidden" id="analysis-step-3">
          <h2 class="section-title mb-4">Sustainability Features</h2>
          <p class="text-sm text-slate-500 dark:text-slate-400 mb-4">Select your target sustainability tier to maximize incentive eligibility</p>
          <div class="grid grid-cols-3 gap-4">
            <div class="card p-4 cursor-pointer border-2 hover:border-blue-500 transition-all tier-card" onclick="selectTier(this, 1)">
              <div class="flex items-center gap-3 mb-3">
                <div class="w-10 h-10 rounded-full bg-slate-200 dark:bg-slate-700/50 flex items-center justify-center">
                  <span class="text-lg">🏠</span>
                </div>
                <div>
                  <p class="font-semibold text-slate-900 dark:text-white">Tier 1: Efficient</p>
                  <p class="text-xs text-slate-500">Code compliant + 10%</p>
                </div>
              </div>
              <ul class="text-xs text-slate-500 space-y-1">
                <li>• Energy Star certified</li>
                <li>• LED lighting throughout</li>
                <li>• Low-flow fixtures</li>
              </ul>
            </div>
            <div class="card p-4 cursor-pointer border-2 hover:border-blue-500 transition-all tier-card" onclick="selectTier(this, 2)">
              <div class="flex items-center gap-3 mb-3">
                <div class="w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center">
                  <span class="text-lg">🌿</span>
                </div>
                <div>
                  <p class="font-semibold text-slate-900 dark:text-white">Tier 2: High Performance</p>
                  <p class="text-xs text-slate-500">Code + 25% efficiency</p>
                </div>
              </div>
              <ul class="text-xs text-slate-500 space-y-1">
                <li>• High-efficiency HVAC</li>
                <li>• Advanced envelope</li>
                <li>• Solar-ready design</li>
              </ul>
            </div>
            <div class="card p-4 cursor-pointer border-2 hover:border-blue-500 transition-all tier-card" onclick="selectTier(this, 3)">
              <div class="flex items-center gap-3 mb-3">
                <div class="w-10 h-10 rounded-full bg-blue-100 dark:bg-slate-800/30 flex items-center justify-center">
                  <span class="text-lg">🌍</span>
                </div>
                <div>
                  <p class="font-semibold text-slate-900 dark:text-white">Tier 3: Net Zero</p>
                  <p class="text-xs text-blue-700">Maximum incentives</p>
                </div>
              </div>
              <ul class="text-xs text-slate-500 space-y-1">
                <li>• Passive House certified</li>
                <li>• On-site renewable energy</li>
                <li>• All-electric systems</li>
              </ul>
            </div>
          </div>
          <div class="flex justify-between mt-6">
            <button class="btn btn-secondary" onclick="nextAnalysisStep(2)">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
              Back
            </button>
            <button class="btn btn-primary" onclick="runAnalysis()">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
              Run Analysis
            </button>
          </div>
        </div>

        <!-- Step 4: Results (Hidden initially) -->
        <div class="hidden" id="analysis-step-4">
          <div class="card p-6 mb-6 bg-gradient-to-r from-blue-50 to-slate-50 dark:from-blue-900/20 dark:to-slate-900/20 border-blue-200 dark:border-slate-700">
            <div class="flex items-center justify-between">
              <div>
                <h2 class="font-sora text-xl font-bold text-slate-900 dark:text-white">Analysis Complete</h2>
                <p class="text-slate-600 dark:text-slate-300 mt-1">We found <span class="font-semibold text-blue-600">15 matching incentive programs</span> for your project</p>
              </div>
              <div class="text-right">
                <p class="text-sm text-slate-500 dark:text-slate-400">Total Potential Value</p>
                <p class="text-3xl font-mono font-bold text-blue-700 dark:text-blue-400">$42.8M</p>
              </div>
            </div>
          </div>

          <div class="grid grid-cols-4 gap-4 mb-6 metric-grid">
            <div class="card p-4">
              <p class="metric-label mb-1">Federal Programs</p>
              <p class="text-xl font-mono font-bold text-blue-600">$18.5M</p>
              <p class="text-xs text-slate-500 mt-1">5 programs</p>
            </div>
            <div class="card p-4">
              <p class="metric-label mb-1">State Programs</p>
              <p class="text-xl font-mono font-bold text-blue-700">$12.3M</p>
              <p class="text-xs text-slate-500 mt-1">4 programs</p>
            </div>
            <div class="card p-4">
              <p class="metric-label mb-1">Local Programs</p>
              <p class="text-xl font-mono font-bold text-blue-600">$8.2M</p>
              <p class="text-xs text-slate-500 mt-1">4 programs</p>
            </div>
            <div class="card p-4">
              <p class="metric-label mb-1">Utility Rebates</p>
              <p class="text-xl font-mono font-bold text-blue-700">$3.8M</p>
              <p class="text-xs text-slate-500 mt-1">2 programs</p>
            </div>
          </div>

          <!-- V24: Same table format as Portfolio view -->
          <div class="card overflow-hidden">
            <div class="px-6 py-4 border-b border-slate-200 dark:border-slate-700/30 flex items-center justify-between">
              <div>
                <h2 class="section-title">Matched Incentive Programs</h2>
                <p class="text-xs text-slate-500 dark:text-slate-400 mt-0.5">15 programs matched to your project criteria</p>
              </div>
              <button class="btn btn-primary" onclick="exportData('pdf')">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                Export Report
              </button>
            </div>
            <div class="overflow-x-auto">
              <table class="w-full" id="analysis-results-table">
                <thead class="text-xs text-left text-slate-500 dark:text-slate-400 uppercase tracking-wide border-b border-slate-200 dark:border-slate-700/30">
                  <tr>
                    <th class="px-6 py-3 font-medium">Program Name</th>
                    <th class="px-6 py-3 font-medium">Type</th>
                    <th class="px-6 py-3 font-medium text-right">Amount</th>
                    <th class="px-6 py-3 font-medium text-right">Probability</th>
                    <th class="px-6 py-3 font-medium">Timeline</th>
                    <th class="px-6 py-3 font-medium text-center">Action</th>
                  </tr>
                </thead>
                <tbody id="analysis-results-tbody" class="divide-y divide-slate-200 dark:divide-slate-700/30">
                  <tr class="incentive-row hover:bg-slate-50 dark:hover:bg-slate-800/50">
                    <td class="px-6 py-4">
                      <p class="font-medium text-slate-900 dark:text-white">Section 48 ITC Solar/Storage</p>
                      <p class="text-xs text-slate-500">Investment Tax Credit for solar and storage</p>
                    </td>
                    <td class="px-6 py-4"><span class="text-xs font-medium text-blue-600">Federal</span></td>
                    <td class="px-6 py-4 text-right font-mono font-medium text-slate-900 dark:text-white">$8.5M</td>
                    <td class="px-6 py-4 text-right"><span class="font-mono text-sm font-medium text-blue-700">92%</span></td>
                    <td class="px-6 py-4 text-slate-600">90 days</td>
                    <td class="px-6 py-4 text-center">
                      <button class="text-xs px-3 py-1.5 bg-blue-900 hover:bg-blue-800 text-white rounded-md font-medium transition-colors shadow-sm">View</button>
                    </td>
                  </tr>
                  <tr class="incentive-row hover:bg-slate-50 dark:hover:bg-slate-800/50">
                    <td class="px-6 py-4">
                      <p class="font-medium text-slate-900 dark:text-white">4% LIHTC</p>
                      <p class="text-xs text-slate-500">Low-Income Housing Tax Credit</p>
                    </td>
                    <td class="px-6 py-4"><span class="text-xs font-medium text-blue-600">Federal</span></td>
                    <td class="px-6 py-4 text-right font-mono font-medium text-slate-900 dark:text-white">$6.2M</td>
                    <td class="px-6 py-4 text-right"><span class="font-mono text-sm font-medium text-blue-700">95%</span></td>
                    <td class="px-6 py-4 text-slate-600">120 days</td>
                    <td class="px-6 py-4 text-center">
                      <button class="text-xs px-3 py-1.5 bg-blue-900 hover:bg-blue-800 text-white rounded-md font-medium transition-colors shadow-sm">View</button>
                    </td>
                  </tr>
                  <tr class="incentive-row hover:bg-slate-50 dark:hover:bg-slate-800/50">
                    <td class="px-6 py-4">
                      <p class="font-medium text-slate-900 dark:text-white">NYSERDA New Construction</p>
                      <p class="text-xs text-slate-500">Clean energy building incentive</p>
                    </td>
                    <td class="px-6 py-4"><span class="text-xs font-medium text-blue-700">State</span></td>
                    <td class="px-6 py-4 text-right font-mono font-medium text-slate-900 dark:text-white">$4.8M</td>
                    <td class="px-6 py-4 text-right"><span class="font-mono text-sm font-medium text-blue-700">88%</span></td>
                    <td class="px-6 py-4 text-slate-600">60 days</td>
                    <td class="px-6 py-4 text-center">
                      <button class="text-xs px-3 py-1.5 bg-blue-900 hover:bg-blue-800 text-white rounded-md font-medium transition-colors shadow-sm">View</button>
                    </td>
                  </tr>
                  <tr class="incentive-row hover:bg-slate-50 dark:hover:bg-slate-800/50">
                    <td class="px-6 py-4">
                      <p class="font-medium text-slate-900 dark:text-white">IDA PILOT</p>
                      <p class="text-xs text-slate-500">Property tax abatement program</p>
                    </td>
                    <td class="px-6 py-4"><span class="text-xs font-medium text-blue-600">Local</span></td>
                    <td class="px-6 py-4 text-right font-mono font-medium text-slate-900 dark:text-white">$3.8M</td>
                    <td class="px-6 py-4 text-right"><span class="font-mono text-sm font-medium text-blue-600">75%</span></td>
                    <td class="px-6 py-4 text-slate-600">45 days</td>
                    <td class="px-6 py-4 text-center">
                      <button class="text-xs px-3 py-1.5 bg-blue-900 hover:bg-blue-800 text-white rounded-md font-medium transition-colors shadow-sm">View</button>
                    </td>
                  </tr>
                  <tr class="incentive-row hover:bg-slate-50 dark:hover:bg-slate-800/50">
                    <td class="px-6 py-4">
                      <p class="font-medium text-slate-900 dark:text-white">Section 45L Credit</p>
                      <p class="text-xs text-slate-500">Energy efficient dwelling credit</p>
                    </td>
                    <td class="px-6 py-4"><span class="text-xs font-medium text-blue-600">Federal</span></td>
                    <td class="px-6 py-4 text-right font-mono font-medium text-slate-900 dark:text-white">$2.1M</td>
                    <td class="px-6 py-4 text-right"><span class="font-mono text-sm font-medium text-blue-700">85%</span></td>
                    <td class="px-6 py-4 text-slate-600">90 days</td>
                    <td class="px-6 py-4 text-center">
                      <button class="text-xs px-3 py-1.5 bg-blue-900 hover:bg-blue-800 text-white rounded-md font-medium transition-colors shadow-sm">View</button>
                    </td>
                  </tr>
                  <tr class="incentive-row hover:bg-slate-50 dark:hover:bg-slate-800/50">
                    <td class="px-6 py-4">
                      <p class="font-medium text-slate-900 dark:text-white">Con Edison Rebates</p>
                      <p class="text-xs text-slate-500">Utility efficiency rebates</p>
                    </td>
                    <td class="px-6 py-4"><span class="text-xs font-medium text-blue-700">Utility</span></td>
                    <td class="px-6 py-4 text-right font-mono font-medium text-slate-900 dark:text-white">$1.8M</td>
                    <td class="px-6 py-4 text-right"><span class="font-mono text-sm font-medium text-blue-700">95%</span></td>
                    <td class="px-6 py-4 text-slate-600">30 days</td>
                    <td class="px-6 py-4 text-center">
                      <button class="text-xs px-3 py-1.5 bg-blue-900 hover:bg-blue-800 text-white rounded-md font-medium transition-colors shadow-sm">View</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="px-6 py-4 border-t border-slate-200 dark:border-slate-700/30 flex items-center justify-between bg-slate-50 dark:bg-slate-800/30">
              <span class="text-xs text-slate-500">Showing 6 of 15 matched programs</span>
              <button class="text-sm text-blue-600 hover:text-blue-700 font-medium">View All 15 Programs →</button>
            </div>
          </div>

          <div class="flex justify-center mt-6">
            <button class="btn btn-secondary" onclick="resetAnalysis()">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
              Start New Analysis
            </button>
          </div>
        </div>
      </section>

      <!-- REPORTS SECTION -->
      <section id="section-reports" class="section-content hidden">
        <div class="section-header mb-6">
          <div>
            <h1 class="font-sora text-2xl font-bold text-slate-900 dark:text-white">Reports & Analytics</h1>
            <p class="text-slate-500 dark:text-slate-400 mt-1">Generate institutional-grade reports and track portfolio performance</p>
          </div>
        </div>

        <!-- Report Types -->
        <div class="grid grid-cols-3 gap-6 mb-6">
          <div class="card p-6 cursor-pointer hover:border-blue-500 transition-all" onclick="generateReport('portfolio')">
            <div class="w-12 h-12 rounded-xl bg-blue-100 dark:bg-slate-800/30 flex items-center justify-center mb-4">
              <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
            </div>
            <h3 class="font-semibold text-slate-900 dark:text-white mb-2">Portfolio Summary</h3>
            <p class="text-sm text-slate-500 dark:text-slate-400 mb-4">Comprehensive overview of all projects, incentives, and performance metrics</p>
            <div class="flex items-center gap-2">
              <span class="badge badge-federal">PDF</span>
              <span class="badge badge-state">Excel</span>
            </div>
          </div>
          <div class="card p-6 cursor-pointer hover:border-blue-500 transition-all" onclick="generateReport('incentive')">
            <div class="w-12 h-12 rounded-xl bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center mb-4">
              <svg class="w-6 h-6 text-blue-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
            </div>
            <h3 class="font-semibold text-slate-900 dark:text-white mb-2">Incentive Analysis</h3>
            <p class="text-sm text-slate-500 dark:text-slate-400 mb-4">Detailed breakdown of identified incentives, capture rates, and projections</p>
            <div class="flex items-center gap-2">
              <span class="badge badge-federal">PDF</span>
              <span class="badge badge-state">Excel</span>
            </div>
          </div>
          <div class="card p-6 cursor-pointer hover:border-blue-500 transition-all" onclick="generateReport('compliance')">
            <div class="w-12 h-12 rounded-xl bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center mb-4">
              <svg class="w-6 h-6 text-blue-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
            </div>
            <h3 class="font-semibold text-slate-900 dark:text-white mb-2">Compliance Report</h3>
            <p class="text-sm text-slate-500 dark:text-slate-400 mb-4">Audit-ready documentation for all captured incentives and compliance status</p>
            <div class="flex items-center gap-2">
              <span class="badge badge-federal">PDF</span>
            </div>
          </div>
        </div>

        <!-- Recent Reports -->
        <div class="card overflow-hidden">
          <div class="px-6 py-4 border-b border-slate-200 dark:border-slate-700/30">
            <h2 class="section-title">Recent Reports</h2>
          </div>
          <div class="overflow-x-auto">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Report Name</th>
                  <th>Type</th>
                  <th>Generated</th>
                  <th>Size</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <div class="flex items-center gap-3">
                      <div class="w-8 h-8 rounded bg-red-100 dark:bg-red-900/30 flex items-center justify-center">
                        <svg class="w-4 h-4 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>
                      </div>
                      <span class="font-medium">Q4_2025_Portfolio_Summary.pdf</span>
                    </div>
                  </td>
                  <td>Portfolio Summary</td>
                  <td class="font-mono text-sm">Jan 8, 2026</td>
                  <td class="font-mono text-sm">2.4 MB</td>
                  <td>
                    <button class="btn btn-secondary text-sm py-1.5" onclick="openDownloadModal('portfolio', 'Q4_2025_Portfolio_Summary')">Download</button>
                  </td>
                </tr>
                <tr>
                  <td>
                    <div class="flex items-center gap-3">
                      <div class="w-8 h-8 rounded bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center">
                        <svg class="w-4 h-4 text-blue-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                      </div>
                      <span class="font-medium">MountVernon_Incentive_Analysis.xlsx</span>
                    </div>
                  </td>
                  <td>Incentive Analysis</td>
                  <td class="font-mono text-sm">Jan 5, 2026</td>
                  <td class="font-mono text-sm">856 KB</td>
                  <td>
                    <button class="btn btn-secondary text-sm py-1.5" onclick="openDownloadModal('incentive', 'MountVernon_Incentive_Analysis'); selectDownloadFormat('xlsx');">Download</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- HEAT MAP SECTION -->
      <section id="section-heatmap" class="section-content hidden">
        <div class="section-header mb-6">
          <div>
            <h1 class="font-sora text-2xl font-bold text-slate-900 dark:text-white">Geographic Heat Map</h1>
            <p class="text-slate-500 dark:text-slate-400 mt-1">Visualize incentive density and opportunity by location</p>
          </div>
          <div class="flex items-center gap-2">
            <select class="form-input w-auto" id="heatmap-layer">
              <option value="incentives">Incentive Density</option>
              <option value="opportunity">Opportunity Zones</option>
              <option value="energy">Energy Programs</option>
              <option value="affordable">Affordable Housing</option>
            </select>
          </div>
        </div>

        <!-- Map Container -->
        <div class="card p-0 mb-6 overflow-hidden" style="height: 500px;">
          <div class="w-full h-full bg-gradient-to-br from-blue-900/20 to-slate-900/20 relative" id="map-container">
            <!-- Simulated Map -->
            <div class="absolute inset-0 flex items-center justify-center">
              <div class="text-center">
                <div class="w-24 h-24 mx-auto mb-4 bg-blue-100 dark:bg-slate-800/30 rounded-full flex items-center justify-center">
                  <svg class="w-12 h-12 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/></svg>
                </div>
                <h3 class="font-sora text-lg font-semibold text-slate-900 dark:text-white mb-2">Interactive Heat Map</h3>
                <p class="text-slate-500 dark:text-slate-400 text-sm max-w-md">Explore incentive density across regions. Click regions to view detailed program availability.</p>
              </div>
            </div>
            <!-- Sample Hot Spots -->
            <div class="absolute top-20 left-1/4 w-16 h-16 bg-red-500/40 rounded-full blur-xl animate-pulse"></div>
            <div class="absolute top-32 left-1/3 w-24 h-24 bg-orange-500/30 rounded-full blur-xl animate-pulse" style="animation-delay: 0.5s"></div>
            <div class="absolute bottom-24 right-1/4 w-20 h-20 bg-yellow-500/30 rounded-full blur-xl animate-pulse" style="animation-delay: 1s"></div>
            <div class="absolute top-1/2 right-1/3 w-28 h-28 bg-blue-500/40 rounded-full blur-xl animate-pulse" style="animation-delay: 0.3s"></div>
          </div>
        </div>

        <!-- Regional Stats -->
        <div class="grid grid-cols-4 gap-4 metric-grid">
          <div class="card p-5 cursor-pointer hover:border-blue-500" onclick="showToast('info', 'Region Selected', 'Showing New York Metro incentives')">
            <div class="flex items-center justify-between mb-3">
              <span class="text-sm font-medium text-slate-900 dark:text-white">New York Metro</span>
              <span class="w-3 h-3 bg-red-500 rounded-full"></span>
            </div>
            <p class="text-2xl font-mono font-bold text-slate-900 dark:text-white">2,847</p>
            <p class="text-xs text-slate-500 mt-1">Active programs</p>
            <div class="mt-3 flex items-center gap-2">
              <span class="metric-delta positive">+12%</span>
              <span class="text-xs text-slate-500">vs last year</span>
            </div>
          </div>
          <div class="card p-5 cursor-pointer hover:border-blue-500" onclick="showToast('info', 'Region Selected', 'Showing Westchester incentives')">
            <div class="flex items-center justify-between mb-3">
              <span class="text-sm font-medium text-slate-900 dark:text-white">Westchester</span>
              <span class="w-3 h-3 bg-orange-500 rounded-full"></span>
            </div>
            <p class="text-2xl font-mono font-bold text-slate-900 dark:text-white">456</p>
            <p class="text-xs text-slate-500 mt-1">Active programs</p>
            <div class="mt-3 flex items-center gap-2">
              <span class="metric-delta positive">+8%</span>
              <span class="text-xs text-slate-500">vs last year</span>
            </div>
          </div>
          <div class="card p-5 cursor-pointer hover:border-blue-500" onclick="showToast('info', 'Region Selected', 'Showing New Jersey incentives')">
            <div class="flex items-center justify-between mb-3">
              <span class="text-sm font-medium text-slate-900 dark:text-white">New Jersey</span>
              <span class="w-3 h-3 bg-yellow-500 rounded-full"></span>
            </div>
            <p class="text-2xl font-mono font-bold text-slate-900 dark:text-white">1,234</p>
            <p class="text-xs text-slate-500 mt-1">Active programs</p>
            <div class="mt-3 flex items-center gap-2">
              <span class="metric-delta positive">+15%</span>
              <span class="text-xs text-slate-500">vs last year</span>
            </div>
          </div>
          <div class="card p-5 cursor-pointer hover:border-blue-500" onclick="showToast('info', 'Region Selected', 'Showing Connecticut incentives')">
            <div class="flex items-center justify-between mb-3">
              <span class="text-sm font-medium text-slate-900 dark:text-white">Connecticut</span>
              <span class="w-3 h-3 bg-blue-500 rounded-full"></span>
            </div>
            <p class="text-2xl font-mono font-bold text-slate-900 dark:text-white">892</p>
            <p class="text-xs text-slate-500 mt-1">Active programs</p>
            <div class="mt-3 flex items-center gap-2">
              <span class="metric-delta positive">+6%</span>
              <span class="text-xs text-slate-500">vs last year</span>
            </div>
          </div>
        </div>
      </section>

      <!-- CAPITAL STACK SECTION - Enhanced with Incentive Breakdown -->
      <section id="section-capitalstack" class="section-content hidden">
        <div class="section-header mb-6">
          <div>
            <h1 class="font-sora text-2xl font-bold text-slate-900 dark:text-white">Capital Stack Optimizer</h1>
            <p class="text-slate-500 dark:text-slate-400 mt-1">AI-optimized capital structure with detailed incentive breakdown</p>
          </div>
          <div class="flex items-center gap-3">
            <!-- Data Source Attribution -->
            <div class="flex items-center gap-2 px-3 py-1.5 bg-slate-100 dark:bg-slate-800/50 rounded-lg">
              <span class="pulse-indicator"></span>
              <span class="text-xs text-slate-600 dark:text-blue-300">Synced: Jan 10, 2026 09:45 EST</span>
            </div>
            <button onclick="exportCapitalStack()" class="btn btn-secondary text-sm">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
              Export
            </button>
          </div>
        </div>

        <!-- Agency Integration Bar -->
        <div class="card p-4 mb-6">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-2">
              <span class="text-sm font-medium text-slate-700 dark:text-slate-300">Verified Data Sources:</span>
              <div class="flex items-center gap-3">
                <div class="flex items-center gap-1.5 px-2.5 py-1 bg-blue-50 dark:bg-blue-900/30 rounded-md">
                  <div class="w-4 h-4 bg-blue-600 rounded flex items-center justify-center text-white text-[8px] font-bold">IRS</div>
                  <span class="text-xs font-medium text-blue-700 dark:text-blue-400">Federal</span>
                </div>
                <div class="flex items-center gap-1.5 px-2.5 py-1 bg-blue-50 dark:bg-blue-900/30 rounded-md">
                  <div class="w-4 h-4 bg-blue-700 rounded flex items-center justify-center text-white text-[8px] font-bold">NY</div>
                  <span class="text-xs font-medium text-blue-700 dark:text-blue-400">NYSERDA</span>
                </div>
                <div class="flex items-center gap-1.5 px-2.5 py-1 bg-cyan-50 dark:bg-cyan-900/30 rounded-md">
                  <div class="w-4 h-4 bg-cyan-600 rounded flex items-center justify-center text-white text-[8px] font-bold">IDA</div>
                  <span class="text-xs font-medium text-blue-700 dark:text-blue-400">Westchester</span>
                </div>
                <div class="flex items-center gap-1.5 px-2.5 py-1 bg-blue-50 dark:bg-blue-900/30 rounded-md">
                  <div class="w-4 h-4 bg-blue-700 rounded flex items-center justify-center text-white text-[8px] font-bold">HUD</div>
                  <span class="text-xs font-medium text-blue-800 dark:text-blue-400">Housing</span>
                </div>
              </div>
            </div>
            <div class="text-xs text-slate-500 dark:text-slate-400">
              <svg class="w-4 h-4 inline mr-1 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
              All data verified from official sources
            </div>
          </div>
        </div>

        <div class="grid grid-cols-3 gap-6">
          <!-- Capital Stack Visualization -->
          <div class="col-span-2 space-y-6">
            <!-- Visual Stack -->
            <div class="card p-6">
              <h2 class="section-title mb-4">Optimized Capital Structure</h2>
              <div class="space-y-3">
                <!-- Senior Debt -->
                <div class="relative">
                  <div class="flex items-center justify-between mb-1">
                    <span class="text-sm font-medium text-slate-700 dark:text-slate-300">Senior Debt</span>
                    <span class="font-mono text-sm">$51.0M (60%)</span>
                  </div>
                  <div class="h-10 bg-blue-500 rounded-lg flex items-center justify-between px-4">
                    <span class="text-sm text-white font-medium">Agency Debt @ 5.25%</span>
                    <span class="text-xs text-blue-200">Fannie Mae Green Rewards</span>
                  </div>
                </div>
                <!-- Subsidies (Expanded) -->
                <div class="relative">
                  <div class="flex items-center justify-between mb-1">
                    <span class="text-sm font-medium text-blue-600 dark:text-blue-400">Incentives & Subsidies</span>
                    <span class="font-mono text-sm font-bold text-blue-600">$25.5M (30%)</span>
                  </div>
                  <div class="h-10 bg-gradient-to-r from-blue-600 to-blue-800 rounded-lg flex items-center justify-between px-4">
                    <span class="text-sm text-white font-medium">6 Programs Identified</span>
                    <span class="text-xs text-blue-100">Click below for details</span>
                  </div>
                </div>
                <!-- Equity -->
                <div class="relative">
                  <div class="flex items-center justify-between mb-1">
                    <span class="text-sm font-medium text-slate-700 dark:text-slate-300">Equity Required</span>
                    <span class="font-mono text-sm">$8.5M (10%)</span>
                  </div>
                  <div class="h-10 bg-blue-500 rounded-lg flex items-center justify-between px-4">
                    <span class="text-sm text-white font-medium">GP + LP Equity</span>
                    <span class="text-xs text-blue-200">42% reduction vs conventional</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Detailed Incentive Breakdown - THE KEY ENHANCEMENT -->
            <div class="card overflow-hidden">
              <div class="px-6 py-4 border-b border-slate-200 dark:border-slate-700/30 bg-gradient-to-r from-blue-50 to-slate-50 dark:from-blue-900/30 dark:to-slate-900/30">
                <div class="flex items-center justify-between">
                  <div>
                    <h2 class="section-title text-blue-800 dark:text-blue-200">Incentive Breakdown</h2>
                    <p class="text-sm text-blue-600 dark:text-blue-400 mt-1">6 programs identified totaling $25.5M</p>
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="status-badge status-success">All Eligible</span>
                  </div>
                </div>
              </div>

              <!-- Incentive Table -->
              <div class="overflow-x-auto">
                <table class="data-table w-full">
                  <thead>
                    <tr>
                      <th class="w-8"></th>
                      <th>Program Name</th>
                      <th>Source</th>
                      <th class="text-right">Value</th>
                      <th>Status</th>
                      <th>Deadline</th>
                      <th class="text-center">Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- 1. LIHTC 4% -->
                    <tr class="incentive-row hover:bg-blue-50/50 dark:hover:bg-slate-800/20 cursor-pointer" onclick="openIncentiveDetail('lihtc')">
                      <td><span class="w-6 h-6 rounded bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 font-bold text-xs">1</span></td>
                      <td>
                        <div class="flex items-center gap-3">
                          <div>
                            <p class="font-medium text-slate-900 dark:text-white">LIHTC 4% Tax Credit</p>
                            <p class="text-xs text-slate-500">Low-Income Housing Tax Credit (As-of-Right)</p>
                          </div>
                        </div>
                      </td>
                      <td>
                        <div class="flex items-center gap-2">
                          <span class="badge badge-federal">Federal</span>
                          <span class="text-xs text-slate-500">IRS / HCR</span>
                        </div>
                      </td>
                      <td class="text-right">
                        <p class="font-mono font-bold text-slate-900 dark:text-white">$12.8M</p>
                        <p class="text-xs text-slate-500">10-year credit</p>
                      </td>
                      <td><span class="status-badge status-success">Eligible</span></td>
                      <td>
                        <p class="text-sm text-slate-700 dark:text-slate-300">Rolling</p>
                        <p class="text-xs text-slate-500">With bond issuance</p>
                      </td>
                      <td class="text-center">
                        <button onclick="event.stopPropagation(); openIncentiveDetail('lihtc');" class="px-3 py-1.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 text-xs font-medium rounded-lg hover:bg-blue-200 dark:hover:bg-blue-800/40 transition-all">
                          View Details
                        </button>
                      </td>
                    </tr>

                    <!-- 2. NYSERDA -->
                    <tr class="incentive-row hover:bg-blue-50/50 dark:hover:bg-slate-800/20 cursor-pointer" onclick="openIncentiveDetail('nyserda')">
                      <td><span class="w-6 h-6 rounded bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-700 font-bold text-xs">2</span></td>
                      <td>
                        <div class="flex items-center gap-3">
                          <div>
                            <p class="font-medium text-slate-900 dark:text-white">NYSERDA Clean Energy Incentive</p>
                            <p class="text-xs text-slate-500">New Construction Housing Program</p>
                          </div>
                        </div>
                      </td>
                      <td>
                        <div class="flex items-center gap-2">
                          <span class="badge badge-state">State</span>
                          <span class="text-xs text-slate-500">NYSERDA</span>
                        </div>
                      </td>
                      <td class="text-right">
                        <p class="font-mono font-bold text-slate-900 dark:text-white">$4.2M</p>
                        <p class="text-xs text-slate-500">Direct rebate</p>
                      </td>
                      <td><span class="status-badge status-success">Eligible</span></td>
                      <td>
                        <p class="text-sm text-slate-700 dark:text-slate-300">Rolling</p>
                        <p class="text-xs text-blue-700">Funding available</p>
                      </td>
                      <td class="text-center">
                        <button onclick="event.stopPropagation(); openIncentiveDetail('nyserda');" class="px-3 py-1.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 text-xs font-medium rounded-lg hover:bg-blue-200 dark:hover:bg-blue-800/40 transition-all">
                          View Details
                        </button>
                      </td>
                    </tr>

                    <!-- 3. IDA PILOT -->
                    <tr class="incentive-row hover:bg-blue-50/50 dark:hover:bg-slate-800/20 cursor-pointer" onclick="openIncentiveDetail('pilot')">
                      <td><span class="w-6 h-6 rounded bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 font-bold text-xs">3</span></td>
                      <td>
                        <div class="flex items-center gap-3">
                          <div>
                            <p class="font-medium text-slate-900 dark:text-white">Westchester IDA PILOT</p>
                            <p class="text-xs text-slate-500">Payment in Lieu of Taxes (15-year)</p>
                          </div>
                        </div>
                      </td>
                      <td>
                        <div class="flex items-center gap-2">
                          <span class="badge badge-local">Local</span>
                          <span class="text-xs text-slate-500">Westchester IDA</span>
                        </div>
                      </td>
                      <td class="text-right">
                        <p class="font-mono font-bold text-slate-900 dark:text-white">$3.8M</p>
                        <p class="text-xs text-slate-500">NPV savings</p>
                      </td>
                      <td><span class="status-badge status-success">Eligible</span></td>
                      <td>
                        <p class="text-sm text-slate-700 dark:text-slate-300">Application</p>
                        <p class="text-xs text-slate-500">Board approval req.</p>
                      </td>
                      <td class="text-center">
                        <button onclick="event.stopPropagation(); openIncentiveDetail('pilot');" class="px-3 py-1.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 text-xs font-medium rounded-lg hover:bg-blue-200 dark:hover:bg-blue-800/40 transition-all">
                          View Details
                        </button>
                      </td>
                    </tr>

                    <!-- 4. 179D -->
                    <tr class="incentive-row hover:bg-blue-50/50 dark:hover:bg-slate-800/20 cursor-pointer" onclick="openIncentiveDetail('179d')">
                      <td><span class="w-6 h-6 rounded bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 font-bold text-xs">4</span></td>
                      <td>
                        <div class="flex items-center gap-3">
                          <div>
                            <p class="font-medium text-slate-900 dark:text-white">IRA 179D Deduction</p>
                            <p class="text-xs text-slate-500">Energy Efficient Commercial Building</p>
                          </div>
                        </div>
                      </td>
                      <td>
                        <div class="flex items-center gap-2">
                          <span class="badge badge-federal">Federal</span>
                          <span class="text-xs text-slate-500">IRS / IRA</span>
                        </div>
                      </td>
                      <td class="text-right">
                        <p class="font-mono font-bold text-slate-900 dark:text-white">$2.4M</p>
                        <p class="text-xs text-slate-500">$5/SF deduction</p>
                      </td>
                      <td><span class="status-badge status-success">Eligible</span></td>
                      <td>
                        <p class="text-sm text-slate-700 dark:text-slate-300">Tax filing</p>
                        <p class="text-xs text-blue-700">Ongoing</p>
                      </td>
                      <td class="text-center">
                        <button onclick="event.stopPropagation(); openIncentiveDetail('179d');" class="px-3 py-1.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 text-xs font-medium rounded-lg hover:bg-blue-200 dark:hover:bg-blue-800/40 transition-all">
                          View Details
                        </button>
                      </td>
                    </tr>

                    <!-- 5. 45L -->
                    <tr class="incentive-row hover:bg-blue-50/50 dark:hover:bg-slate-800/20 cursor-pointer" onclick="openIncentiveDetail('45l')">
                      <td><span class="w-6 h-6 rounded bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 font-bold text-xs">5</span></td>
                      <td>
                        <div class="flex items-center gap-3">
                          <div>
                            <p class="font-medium text-slate-900 dark:text-white">IRA 45L Tax Credit</p>
                            <p class="text-xs text-slate-500">New Energy Efficient Home Credit</p>
                          </div>
                        </div>
                      </td>
                      <td>
                        <div class="flex items-center gap-2">
                          <span class="badge badge-federal">Federal</span>
                          <span class="text-xs text-slate-500">IRS / IRA</span>
                        </div>
                      </td>
                      <td class="text-right">
                        <p class="font-mono font-bold text-slate-900 dark:text-white">$1.5M</p>
                        <p class="text-xs text-slate-500">$5K/unit</p>
                      </td>
                      <td><span class="status-badge status-warning">Requires ENERGY STAR</span></td>
                      <td>
                        <p class="text-sm text-slate-700 dark:text-slate-300">Tax filing</p>
                        <p class="text-xs text-blue-700">Ongoing</p>
                      </td>
                      <td class="text-center">
                        <button onclick="event.stopPropagation(); openIncentiveDetail('45l');" class="px-3 py-1.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 text-xs font-medium rounded-lg hover:bg-blue-200 dark:hover:bg-blue-800/40 transition-all">
                          View Details
                        </button>
                      </td>
                    </tr>

                    <!-- 6. Utility Rebates -->
                    <tr class="incentive-row hover:bg-blue-50/50 dark:hover:bg-slate-800/20 cursor-pointer" onclick="openIncentiveDetail('utility')">
                      <td><span class="w-6 h-6 rounded bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-700 font-bold text-xs">6</span></td>
                      <td>
                        <div class="flex items-center gap-3">
                          <div>
                            <p class="font-medium text-slate-900 dark:text-white">Con Edison Rebates</p>
                            <p class="text-xs text-slate-500">Commercial EE Program Bundle</p>
                          </div>
                        </div>
                      </td>
                      <td>
                        <div class="flex items-center gap-2">
                          <span class="badge badge-utility">Utility</span>
                          <span class="text-xs text-slate-500">Con Edison</span>
                        </div>
                      </td>
                      <td class="text-right">
                        <p class="font-mono font-bold text-slate-900 dark:text-white">$0.8M</p>
                        <p class="text-xs text-slate-500">Per-measure</p>
                      </td>
                      <td><span class="status-badge status-success">Eligible</span></td>
                      <td>
                        <p class="text-sm text-slate-700 dark:text-slate-300">Pre-approval</p>
                        <p class="text-xs text-blue-600">Before install</p>
                      </td>
                      <td class="text-center">
                        <button onclick="event.stopPropagation(); openIncentiveDetail('utility');" class="px-3 py-1.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 text-xs font-medium rounded-lg hover:bg-blue-200 dark:hover:bg-blue-800/40 transition-all">
                          View Details
                        </button>
                      </td>
                    </tr>
                  </tbody>
                  <!-- TOTAL ROW -->
                  <tfoot>
                    <tr class="bg-gradient-to-r from-blue-50 to-slate-50 dark:from-blue-900/40 dark:to-slate-900/40">
                      <td colspan="3" class="font-semibold text-blue-800 dark:text-blue-200 py-4">
                        <div class="flex items-center gap-2">
                          <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                          Total Incentives Identified
                        </div>
                      </td>
                      <td class="text-right py-4">
                        <p class="font-mono text-2xl font-bold text-blue-600 dark:text-blue-400">$25.5M</p>
                      </td>
                      <td colspan="2" class="py-4">
                        <p class="text-sm text-blue-700 dark:text-blue-300">30% of TDC captured</p>
                      </td>
                      <td class="text-center py-4">
                        <button onclick="applyAllIncentives()" class="px-4 py-2 bg-blue-700 hover:bg-slate-600 text-white text-sm font-medium rounded-lg transition-all">
                          Apply All
                        </button>
                      </td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>

            <!-- AI Recommendation Card -->
            <div class="card p-5 bg-gradient-to-r from-blue-50 to-slate-50 dark:from-blue-900/20 dark:to-slate-900/20 border-blue-200 dark:border-slate-600">
              <div class="flex items-start gap-4">
                <div class="w-12 h-12 bg-blue-100 dark:bg-slate-800/30 rounded-xl flex items-center justify-center flex-shrink-0">
                  <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                </div>
                <div>
                  <p class="font-semibold text-blue-800 dark:text-blue-200 mb-1">AI-Powered Optimization</p>
                  <p class="text-sm text-blue-700 dark:text-blue-300 mb-3">This capital stack reduces your equity requirement by 42% compared to conventional financing. IncentEdge identified 2 additional programs not typically captured by developers in this market.</p>
                  <div class="flex items-center gap-4 text-xs">
                    <span class="flex items-center gap-1 text-blue-600">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4"/></svg>
                      IRR improved +8.2%
                    </span>
                    <span class="flex items-center gap-1 text-blue-600">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4"/></svg>
                      Confidence: 94%
                    </span>
                    <span class="flex items-center gap-1 text-blue-600">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4"/></svg>
                      6/6 programs verified
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Metrics Sidebar -->
          <div class="space-y-4">
            <div class="card p-5 metric-card">
              <p class="metric-label mb-2">Total Development Cost</p>
              <p class="metric-value">$85.0M</p>
            </div>
            <div class="card p-5 metric-card">
              <p class="metric-label mb-2">Subsidy Rate</p>
              <p class="metric-value highlight">30.0%</p>
              <p class="text-xs text-slate-500 mt-1">Top 15% of comparable projects</p>
              <div class="mt-2 flex items-center gap-2">
                <span class="metric-delta positive">+12%</span>
                <span class="text-xs text-slate-500">vs market avg</span>
              </div>
            </div>
            <div class="card p-5 metric-card">
              <p class="metric-label mb-2">Projected IRR</p>
              <p class="metric-value text-blue-700">22.4%</p>
              <p class="text-xs text-slate-500 mt-1">vs 14.2% without subsidies</p>
            </div>
            <div class="card p-5 metric-card">
              <p class="metric-label mb-2">Equity Multiple</p>
              <p class="metric-value">2.1x</p>
              <p class="text-xs text-slate-500 mt-1">5-year hold period</p>
            </div>
            <div class="card p-5 metric-card">
              <p class="metric-label mb-2">Equity Reduction</p>
              <p class="metric-value text-blue-700">-42%</p>
              <p class="text-xs text-slate-500 mt-1">vs conventional financing</p>
            </div>
            <button class="btn btn-primary w-full" onclick="showToast('success', 'Stack Applied', 'Capital stack saved to project')">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
              Apply to Project
            </button>
            <button class="btn btn-secondary w-full" onclick="showToast('info', 'Export Started', 'Generating LP-ready memo...')">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
              Export LP Memo
            </button>
          </div>
        </div>

        <!-- V33: Waterfall Chart - IRR Impact -->
        <div class="card p-6 mt-6">
          <div class="flex items-center justify-between mb-4">
            <h2 class="section-title">IRR Waterfall Analysis</h2>
            <span class="text-xs text-slate-500">Incentive impact on returns</span>
          </div>
          <div class="flex items-end justify-between h-48 gap-2 px-4">
            <div class="flex flex-col items-center gap-1">
              <div class="w-12 bg-slate-500 rounded-t" style="height: 80px;"></div>
              <span class="text-xs text-slate-400">Base IRR</span>
              <span class="font-mono text-sm text-white">14.2%</span>
            </div>
            <div class="flex flex-col items-center gap-1">
              <div class="w-12 bg-blue-500 rounded-t" style="height: 28px;"></div>
              <span class="text-xs text-slate-400">LIHTC</span>
              <span class="font-mono text-sm text-green-400">+3.2%</span>
            </div>
            <div class="flex flex-col items-center gap-1">
              <div class="w-12 bg-blue-500 rounded-t" style="height: 21px;"></div>
              <span class="text-xs text-slate-400">45L</span>
              <span class="font-mono text-sm text-green-400">+2.1%</span>
            </div>
            <div class="flex flex-col items-center gap-1">
              <div class="w-12 bg-blue-500 rounded-t" style="height: 14px;"></div>
              <span class="text-xs text-slate-400">179D</span>
              <span class="font-mono text-sm text-green-400">+1.4%</span>
            </div>
            <div class="flex flex-col items-center gap-1">
              <div class="w-12 bg-cyan-500 rounded-t" style="height: 10px;"></div>
              <span class="text-xs text-slate-400">IDA PILOT</span>
              <span class="font-mono text-sm text-green-400">+1.0%</span>
            </div>
            <div class="flex flex-col items-center gap-1">
              <div class="w-12 bg-cyan-500 rounded-t" style="height: 5px;"></div>
              <span class="text-xs text-slate-400">NYSERDA</span>
              <span class="font-mono text-sm text-green-400">+0.5%</span>
            </div>
            <div class="flex flex-col items-center gap-1">
              <div class="w-12 bg-green-500 rounded-t" style="height: 130px;"></div>
              <span class="text-xs text-slate-400">With Incentives</span>
              <span class="font-mono text-sm font-bold text-green-400">22.4%</span>
            </div>
          </div>
          <div class="mt-4 p-3 bg-green-900/20 border border-green-700/30 rounded-lg">
            <p class="text-sm text-green-300"><span class="font-bold">+8.2%</span> IRR improvement from incentive capture strategy</p>
          </div>
        </div>

        <!-- V33: Credit Subsidy Cost Calculator -->
        <div class="card p-6 mt-6">
          <div class="flex items-center justify-between mb-4">
            <h2 class="section-title flex items-center gap-2">
              <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>
              Credit Subsidy Cost Calculator
            </h2>
            <span class="text-xs text-slate-500">For federal loan programs</span>
          </div>
          <p class="text-sm text-slate-400 mb-4">Estimate the credit subsidy cost for DOE LPO, WIFIA, and other federal credit programs</p>
          <div class="grid grid-cols-4 gap-4 mb-4">
            <div>
              <label class="block text-xs text-slate-400 mb-1">Loan Amount ($M)</label>
              <input type="number" class="form-input" id="csc-loan-amount" value="50" oninput="calculateCreditSubsidy()">
            </div>
            <div>
              <label class="block text-xs text-slate-400 mb-1">Term (Years)</label>
              <input type="number" class="form-input" id="csc-term" value="30" oninput="calculateCreditSubsidy()">
            </div>
            <div>
              <label class="block text-xs text-slate-400 mb-1">Risk Category</label>
              <select class="form-input" id="csc-risk" onchange="calculateCreditSubsidy()">
                <option value="0.02">Low (2%)</option>
                <option value="0.05" selected>Moderate (5%)</option>
                <option value="0.10">Elevated (10%)</option>
                <option value="0.15">High (15%)</option>
              </select>
            </div>
            <div>
              <label class="block text-xs text-slate-400 mb-1">Program</label>
              <select class="form-input" id="csc-program" onchange="calculateCreditSubsidy()">
                <option value="doe">DOE Title XVII</option>
                <option value="wifia">WIFIA</option>
                <option value="cifia">CIFIA (Covered)</option>
              </select>
            </div>
          </div>
          <div class="grid grid-cols-3 gap-4 p-4 bg-slate-800/50 rounded-lg">
            <div class="text-center">
              <p class="text-xs text-slate-400 mb-1">Credit Subsidy Cost</p>
              <p class="font-mono text-xl font-bold text-blue-400" id="csc-result">$2.5M</p>
            </div>
            <div class="text-center">
              <p class="text-xs text-slate-400 mb-1">Subsidy Rate</p>
              <p class="font-mono text-xl font-bold text-white" id="csc-rate">5.0%</p>
            </div>
            <div class="text-center">
              <p class="text-xs text-slate-400 mb-1">Coverage Status</p>
              <p class="font-mono text-xl font-bold text-green-400" id="csc-coverage">Borrower Pays</p>
            </div>
          </div>
          <p class="text-xs text-slate-500 mt-3">Note: CIFIA provides 100% credit subsidy coverage under IRA. DOE/WIFIA require borrower payment.</p>
        </div>
      </section>

      <!-- CALCULATOR SECTION -->
      <section id="section-calculator" class="section-content hidden">
        <div class="section-header mb-6">
          <div>
            <h1 class="font-sora text-2xl font-bold text-slate-900 dark:text-white">ROI Impact Calculator</h1>
            <p class="text-slate-500 dark:text-slate-400 mt-1">Calculate the financial impact of incentive programs on your project returns</p>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-6">
          <!-- Input Panel -->
          <div class="card p-6">
            <h2 class="section-title mb-4">Project Inputs</h2>
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Total Development Cost</label>
                <div class="relative">
                  <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">$</span>
                  <input type="text" class="form-input pl-7" id="calc-tdc" value="85,000,000" oninput="calculateROI()">
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Equity Contribution</label>
                <div class="relative">
                  <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">$</span>
                  <input type="text" class="form-input pl-7" id="calc-equity" value="15,000,000" oninput="calculateROI()">
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Annual NOI (Stabilized)</label>
                <div class="relative">
                  <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">$</span>
                  <input type="text" class="form-input pl-7" id="calc-noi" value="6,500,000" oninput="calculateROI()">
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Hold Period (Years)</label>
                <input type="range" class="w-full" min="3" max="10" value="5" id="calc-hold" oninput="calculateROI()">
                <div class="flex justify-between text-xs text-slate-500"><span>3 yrs</span><span id="hold-display">5 yrs</span><span>10 yrs</span></div>
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Incentive Value</label>
                <div class="relative">
                  <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">$</span>
                  <input type="text" class="form-input pl-7 border-blue-500" id="calc-incentive" value="25,500,000" oninput="calculateROI()">
                </div>
                <p class="text-xs text-blue-600 mt-1">IncentEdge identified programs</p>
              </div>
            </div>
          </div>

          <!-- Results Panel -->
          <div class="space-y-4">
            <div class="card p-6 bg-gradient-to-br from-blue-50 to-slate-50 dark:from-blue-900/20 dark:to-slate-900/20 border-blue-200 dark:border-slate-700">
              <h2 class="section-title mb-4">With IncentEdge</h2>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <p class="text-sm text-slate-500 mb-1">Levered IRR</p>
                  <p class="text-3xl font-mono font-bold text-blue-600" id="irr-with">22.4%</p>
                </div>
                <div>
                  <p class="text-sm text-slate-500 mb-1">Equity Multiple</p>
                  <p class="text-3xl font-mono font-bold text-blue-600" id="mult-with">2.12x</p>
                </div>
                <div>
                  <p class="text-sm text-slate-500 mb-1">Cash on Cash</p>
                  <p class="text-xl font-mono font-bold text-slate-900 dark:text-white" id="coc-with">11.2%</p>
                </div>
                <div>
                  <p class="text-sm text-slate-500 mb-1">Total Profit</p>
                  <p class="text-xl font-mono font-bold text-slate-900 dark:text-white" id="profit-with">$16.8M</p>
                </div>
              </div>
            </div>

            <div class="card p-6">
              <h2 class="section-title mb-4">Without Incentives</h2>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <p class="text-sm text-slate-500 mb-1">Levered IRR</p>
                  <p class="text-3xl font-mono font-bold text-slate-400" id="irr-without">14.2%</p>
                </div>
                <div>
                  <p class="text-sm text-slate-500 mb-1">Equity Multiple</p>
                  <p class="text-3xl font-mono font-bold text-slate-400" id="mult-without">1.58x</p>
                </div>
              </div>
            </div>

            <div class="card p-5 border-2 border-blue-500">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm text-slate-500">IncentEdge Advantage</p>
                  <p class="text-2xl font-mono font-bold text-blue-600" id="irr-advantage">+8.2% IRR</p>
                </div>
                <div class="text-right">
                  <p class="text-sm text-slate-500">Additional Profit</p>
                  <p class="text-2xl font-mono font-bold text-blue-600" id="profit-advantage">+$5.4M</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- SENSITIVITY ANALYSIS - Council Recommendation -->
        <div class="mt-6">
          <div class="card overflow-hidden">
            <div class="px-6 py-4 border-b border-slate-200 dark:border-slate-700/30 flex items-center justify-between">
              <div>
                <h2 class="section-title">Sensitivity Analysis</h2>
                <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">See how changes in key assumptions impact returns</p>
              </div>
              <div class="flex items-center gap-2">
                <button onclick="toggleSensitivityView('table')" id="sens-table-btn" class="px-3 py-1.5 text-sm font-medium bg-blue-100 dark:bg-slate-800/50 text-blue-700 dark:text-blue-300 rounded-lg">Table</button>
                <button onclick="toggleSensitivityView('chart')" id="sens-chart-btn" class="px-3 py-1.5 text-sm font-medium text-slate-500 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg">Chart</button>
              </div>
            </div>

            <!-- Sensitivity Table -->
            <div class="p-6" id="sensitivity-table-view">
              <div class="grid grid-cols-2 gap-6">
                <!-- Cap Rate Sensitivity -->
                <div>
                  <h3 class="text-sm font-semibold text-slate-700 dark:text-slate-300 mb-3 flex items-center gap-2">
                    <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
                    Exit Cap Rate Impact on IRR
                  </h3>
                  <table class="w-full text-sm">
                    <thead>
                      <tr class="border-b border-slate-200 dark:border-slate-700/30">
                        <th class="text-left py-2 font-medium text-slate-500">Exit Cap</th>
                        <th class="text-right py-2 font-medium text-slate-500">IRR w/ Inc</th>
                        <th class="text-right py-2 font-medium text-slate-500">IRR w/o Inc</th>
                        <th class="text-right py-2 font-medium text-blue-600">Delta</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr class="border-b border-slate-100 dark:border-blue-900/20">
                        <td class="py-2">4.50%</td>
                        <td class="py-2 text-right font-mono text-blue-700">26.8%</td>
                        <td class="py-2 text-right font-mono text-slate-500">18.2%</td>
                        <td class="py-2 text-right font-mono font-bold text-blue-600">+8.6%</td>
                      </tr>
                      <tr class="border-b border-slate-100 dark:border-blue-900/20 bg-blue-50/50 dark:bg-slate-800/20">
                        <td class="py-2 font-medium">5.00% (Base)</td>
                        <td class="py-2 text-right font-mono text-blue-700 font-bold">22.4%</td>
                        <td class="py-2 text-right font-mono text-slate-500 font-bold">14.2%</td>
                        <td class="py-2 text-right font-mono font-bold text-blue-600">+8.2%</td>
                      </tr>
                      <tr class="border-b border-slate-100 dark:border-blue-900/20">
                        <td class="py-2">5.50%</td>
                        <td class="py-2 text-right font-mono text-blue-700">18.6%</td>
                        <td class="py-2 text-right font-mono text-slate-500">10.8%</td>
                        <td class="py-2 text-right font-mono font-bold text-blue-600">+7.8%</td>
                      </tr>
                      <tr>
                        <td class="py-2">6.00%</td>
                        <td class="py-2 text-right font-mono text-blue-600">15.2%</td>
                        <td class="py-2 text-right font-mono text-slate-500">8.1%</td>
                        <td class="py-2 text-right font-mono font-bold text-blue-600">+7.1%</td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <!-- Construction Cost Sensitivity -->
                <div>
                  <h3 class="text-sm font-semibold text-slate-700 dark:text-slate-300 mb-3 flex items-center gap-2">
                    <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
                    Construction Cost Impact on IRR
                  </h3>
                  <table class="w-full text-sm">
                    <thead>
                      <tr class="border-b border-slate-200 dark:border-slate-700/30">
                        <th class="text-left py-2 font-medium text-slate-500">TDC Change</th>
                        <th class="text-right py-2 font-medium text-slate-500">IRR w/ Inc</th>
                        <th class="text-right py-2 font-medium text-slate-500">IRR w/o Inc</th>
                        <th class="text-right py-2 font-medium text-blue-600">Delta</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr class="border-b border-slate-100 dark:border-blue-900/20">
                        <td class="py-2 text-blue-700">-10%</td>
                        <td class="py-2 text-right font-mono text-blue-700">28.1%</td>
                        <td class="py-2 text-right font-mono text-slate-500">19.4%</td>
                        <td class="py-2 text-right font-mono font-bold text-blue-600">+8.7%</td>
                      </tr>
                      <tr class="border-b border-slate-100 dark:border-blue-900/20 bg-blue-50/50 dark:bg-slate-800/20">
                        <td class="py-2 font-medium">0% (Base)</td>
                        <td class="py-2 text-right font-mono text-blue-700 font-bold">22.4%</td>
                        <td class="py-2 text-right font-mono text-slate-500 font-bold">14.2%</td>
                        <td class="py-2 text-right font-mono font-bold text-blue-600">+8.2%</td>
                      </tr>
                      <tr class="border-b border-slate-100 dark:border-blue-900/20">
                        <td class="py-2 text-blue-600">+10%</td>
                        <td class="py-2 text-right font-mono text-blue-600">17.8%</td>
                        <td class="py-2 text-right font-mono text-slate-500">10.1%</td>
                        <td class="py-2 text-right font-mono font-bold text-blue-600">+7.7%</td>
                      </tr>
                      <tr>
                        <td class="py-2 text-red-600">+20%</td>
                        <td class="py-2 text-right font-mono text-red-600">13.9%</td>
                        <td class="py-2 text-right font-mono text-slate-500">6.5%</td>
                        <td class="py-2 text-right font-mono font-bold text-blue-600">+7.4%</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- Key Insight -->
              <div class="mt-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl border border-blue-200 dark:border-blue-800">
                <div class="flex items-start gap-3">
                  <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center flex-shrink-0">
                    <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                  </div>
                  <div>
                    <p class="font-semibold text-blue-800 dark:text-blue-200 mb-1">Sensitivity Insight</p>
                    <p class="text-sm text-blue-700 dark:text-blue-300">IncentEdge programs provide consistent 7-9% IRR advantage across all scenarios. Even in stress case (Cap +100bps, TDC +20%), incentives maintain returns above 13% IRR vs 6.5% without incentives.</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Sensitivity Chart View (hidden by default) -->
            <div class="p-6 hidden" id="sensitivity-chart-view">
              <div class="h-64 bg-slate-50 dark:bg-slate-800/50 rounded-lg flex items-center justify-center">
                <div class="text-center">
                  <svg class="w-16 h-16 mx-auto text-slate-300 dark:text-slate-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
                  <p class="text-slate-500 dark:text-slate-400 font-medium">Interactive Tornado Chart</p>
                  <p class="text-xs text-slate-400 dark:text-slate-500 mt-1">Coming in V2.0</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- SUSTAINABILITY IMPACT CALCULATOR -->
      <section id="section-sustainability" class="section-content hidden">
        <div class="section-header mb-6">
          <div>
            <h1 class="font-sora text-2xl font-bold text-slate-900 dark:text-white">Sustainability Impact Calculator</h1>
            <p class="text-slate-500 dark:text-slate-400 mt-1">Select equipment and measures to see incentive unlock potential</p>
          </div>
          <div class="flex items-center gap-3">
            <button onclick="resetSustainability()" class="btn btn-secondary">Reset All</button>
            <button onclick="exportSustainabilityReport()" class="btn btn-primary">Export Report</button>
          </div>
        </div>

        <div class="grid grid-cols-3 gap-6">
          <!-- Left Panel: Equipment Selector -->
          <div class="col-span-2 space-y-4">
            <!-- Current Tier Display -->
            <div class="card p-5">
              <div class="flex items-center justify-between mb-4">
                <div>
                  <p class="text-sm text-slate-500 dark:text-slate-400 mb-1">Current Sustainability Tier</p>
                  <div class="flex items-center gap-3">
                    <span id="current-tier-badge" class="px-4 py-2 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 font-bold rounded-lg text-lg">BASE</span>
                    <span id="tier-score" class="font-mono text-2xl font-bold text-slate-900 dark:text-white">32</span>
                    <span class="text-slate-400">/100 points</span>
                  </div>
                </div>
                <div class="text-right">
                  <p class="text-sm text-slate-500 mb-1">Next Tier</p>
                  <p id="next-tier-info" class="text-blue-600 dark:text-blue-400 font-medium">+18 points to ENHANCED</p>
                </div>
              </div>
              <div class="w-full h-4 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden">
                <div id="tier-progress-bar" class="h-full bg-gradient-to-r from-slate-400 to-slate-500 transition-all duration-500" style="width: 32%"></div>
              </div>
              <div class="flex justify-between text-xs text-slate-500 mt-2">
                <span>0</span>
                <span class="text-slate-400">BASE (0-49)</span>
                <span class="text-blue-600 font-medium">ENHANCED (50-79)</span>
                <span class="text-blue-600 font-medium">MAXIMUM (80-100)</span>
              </div>
            </div>

            <!-- HVAC Systems -->
            <div class="card p-5">
              <div class="flex items-center justify-between mb-4">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 rounded-lg bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center">
                    <svg class="w-5 h-5 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
                  </div>
                  <div>
                    <h3 class="font-semibold text-slate-900 dark:text-white">HVAC Systems</h3>
                    <p class="text-xs text-slate-500">Heating, ventilation, and cooling equipment</p>
                  </div>
                </div>
                <span id="hvac-points" class="font-mono text-lg font-bold text-blue-600 dark:text-blue-400">+0 pts</span>
              </div>
              <div class="grid grid-cols-2 gap-3">
                <label class="equipment-option flex items-center gap-3 p-3 border border-slate-200 dark:border-slate-700/30 rounded-lg cursor-pointer hover:border-blue-500 transition-all" data-category="hvac" data-points="8" data-cost="45000" data-incentive="12000">
                  <input type="checkbox" class="equipment-checkbox w-5 h-5 rounded text-blue-600" onchange="updateSustainabilityScore()">
                  <div class="flex-1">
                    <p class="font-medium text-slate-900 dark:text-white text-sm">High-Efficiency Heat Pump</p>
                    <p class="text-xs text-slate-500">HSPF 10+, SEER2 18+</p>
                  </div>
                  <div class="text-right">
                    <p class="text-xs text-slate-500">+$45K</p>
                    <p class="text-xs text-blue-600 dark:text-blue-400">Unlocks: $12K</p>
                  </div>
                </label>
                <label class="equipment-option flex items-center gap-3 p-3 border border-slate-200 dark:border-slate-700/30 rounded-lg cursor-pointer hover:border-blue-500 transition-all" data-category="hvac" data-points="15" data-cost="180000" data-incentive="48000">
                  <input type="checkbox" class="equipment-checkbox w-5 h-5 rounded text-blue-600" onchange="updateSustainabilityScore()">
                  <div class="flex-1">
                    <p class="font-medium text-slate-900 dark:text-white text-sm">VRF System (Variable Refrigerant Flow)</p>
                    <p class="text-xs text-slate-500">Simultaneous heating/cooling, zoned</p>
                  </div>
                  <div class="text-right">
                    <p class="text-xs text-slate-500">+$180K</p>
                    <p class="text-xs text-blue-600 dark:text-blue-400">Unlocks: $48K</p>
                  </div>
                </label>
                <label class="equipment-option flex items-center gap-3 p-3 border border-slate-200 dark:border-slate-700/30 rounded-lg cursor-pointer hover:border-blue-500 transition-all" data-category="hvac" data-points="20" data-cost="420000" data-incentive="125000">
                  <input type="checkbox" class="equipment-checkbox w-5 h-5 rounded text-blue-600" onchange="updateSustainabilityScore()">
                  <div class="flex-1">
                    <p class="font-medium text-slate-900 dark:text-white text-sm">Geothermal Heat Pump System</p>
                    <p class="text-xs text-slate-500">Ground-source, COP 4.0+</p>
                  </div>
                  <div class="text-right">
                    <p class="text-xs text-slate-500">+$420K</p>
                    <p class="text-xs text-blue-600 dark:text-blue-400">Unlocks: $125K</p>
                  </div>
                </label>
                <label class="equipment-option flex items-center gap-3 p-3 border border-slate-200 dark:border-slate-700/30 rounded-lg cursor-pointer hover:border-blue-500 transition-all" data-category="hvac" data-points="5" data-cost="28000" data-incentive="8500">
                  <input type="checkbox" class="equipment-checkbox w-5 h-5 rounded text-blue-600" onchange="updateSustainabilityScore()">
                  <div class="flex-1">
                    <p class="font-medium text-slate-900 dark:text-white text-sm">Heat Pump Water Heaters</p>
                    <p class="text-xs text-slate-500">UEF 3.5+, replaces gas</p>
                  </div>
                  <div class="text-right">
                    <p class="text-xs text-slate-500">+$28K</p>
                    <p class="text-xs text-blue-600 dark:text-blue-400">Unlocks: $8.5K</p>
                  </div>
                </label>
              </div>
            </div>

            <!-- Building Envelope -->
            <div class="card p-5">
              <div class="flex items-center justify-between mb-4">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 rounded-lg bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center">
                    <svg class="w-5 h-5 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
                  </div>
                  <div>
                    <h3 class="font-semibold text-slate-900 dark:text-white">Building Envelope</h3>
                    <p class="text-xs text-slate-500">Insulation, air sealing, windows</p>
                  </div>
                </div>
                <span id="envelope-points" class="font-mono text-lg font-bold text-blue-600 dark:text-blue-400">+0 pts</span>
              </div>
              <div class="grid grid-cols-2 gap-3">
                <label class="equipment-option flex items-center gap-3 p-3 border border-slate-200 dark:border-slate-700/30 rounded-lg cursor-pointer hover:border-blue-500 transition-all" data-category="envelope" data-points="8" data-cost="85000" data-incentive="22000">
                  <input type="checkbox" class="equipment-checkbox w-5 h-5 rounded text-blue-600" onchange="updateSustainabilityScore()">
                  <div class="flex-1">
                    <p class="font-medium text-slate-900 dark:text-white text-sm">Continuous Exterior Insulation</p>
                    <p class="text-xs text-slate-500">R-10+ continuous, thermal bridge break</p>
                  </div>
                  <div class="text-right">
                    <p class="text-xs text-slate-500">+$85K</p>
                    <p class="text-xs text-blue-600 dark:text-blue-400">Unlocks: $22K</p>
                  </div>
                </label>
                <label class="equipment-option flex items-center gap-3 p-3 border border-slate-200 dark:border-slate-700/30 rounded-lg cursor-pointer hover:border-blue-500 transition-all" data-category="envelope" data-points="6" data-cost="45000" data-incentive="15000">
                  <input type="checkbox" class="equipment-checkbox w-5 h-5 rounded text-blue-600" onchange="updateSustainabilityScore()">
                  <div class="flex-1">
                    <p class="font-medium text-slate-900 dark:text-white text-sm">Professional Air Sealing</p>
                    <p class="text-xs text-slate-500">Blower door tested, <0.25 ACH50</p>
                  </div>
                  <div class="text-right">
                    <p class="text-xs text-slate-500">+$45K</p>
                    <p class="text-xs text-blue-600 dark:text-blue-400">Unlocks: $15K</p>
                  </div>
                </label>
                <label class="equipment-option flex items-center gap-3 p-3 border border-slate-200 dark:border-slate-700/30 rounded-lg cursor-pointer hover:border-blue-500 transition-all" data-category="envelope" data-points="10" data-cost="220000" data-incentive="45000">
                  <input type="checkbox" class="equipment-checkbox w-5 h-5 rounded text-blue-600" onchange="updateSustainabilityScore()">
                  <div class="flex-1">
                    <p class="font-medium text-slate-900 dark:text-white text-sm">Triple-Pane Windows</p>
                    <p class="text-xs text-slate-500">U-0.20 or better, low-E coating</p>
                  </div>
                  <div class="text-right">
                    <p class="text-xs text-slate-500">+$220K</p>
                    <p class="text-xs text-blue-600 dark:text-blue-400">Unlocks: $45K</p>
                  </div>
                </label>
                <label class="equipment-option flex items-center gap-3 p-3 border border-slate-200 dark:border-slate-700/30 rounded-lg cursor-pointer hover:border-blue-500 transition-all" data-category="envelope" data-points="4" data-cost="32000" data-incentive="9500">
                  <input type="checkbox" class="equipment-checkbox w-5 h-5 rounded text-blue-600" onchange="updateSustainabilityScore()">
                  <div class="flex-1">
                    <p class="font-medium text-slate-900 dark:text-white text-sm">Cool Roof System</p>
                    <p class="text-xs text-slate-500">SRI 78+, reduces heat island</p>
                  </div>
                  <div class="text-right">
                    <p class="text-xs text-slate-500">+$32K</p>
                    <p class="text-xs text-blue-600 dark:text-blue-400">Unlocks: $9.5K</p>
                  </div>
                </label>
              </div>
            </div>

            <!-- Renewable Energy -->
            <div class="card p-5">
              <div class="flex items-center justify-between mb-4">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 rounded-lg bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center">
                    <svg class="w-5 h-5 text-blue-700 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
                  </div>
                  <div>
                    <h3 class="font-semibold text-slate-900 dark:text-white">Renewable Energy</h3>
                    <p class="text-xs text-slate-500">Solar, storage, and on-site generation</p>
                  </div>
                </div>
                <span id="renewable-points" class="font-mono text-lg font-bold text-blue-700 dark:text-blue-400">+0 pts</span>
              </div>
              <div class="grid grid-cols-2 gap-3">
                <label class="equipment-option flex items-center gap-3 p-3 border border-slate-200 dark:border-slate-700/30 rounded-lg cursor-pointer hover:border-blue-500 transition-all" data-category="renewable" data-points="12" data-cost="180000" data-incentive="72000">
                  <input type="checkbox" class="equipment-checkbox w-5 h-5 rounded text-blue-600" onchange="updateSustainabilityScore()">
                  <div class="flex-1">
                    <p class="font-medium text-slate-900 dark:text-white text-sm">Rooftop Solar PV (100kW)</p>
                    <p class="text-xs text-slate-500">Monocrystalline, 22%+ efficiency</p>
                  </div>
                  <div class="text-right">
                    <p class="text-xs text-slate-500">+$180K</p>
                    <p class="text-xs text-blue-600 dark:text-blue-400">Unlocks: $72K</p>
                  </div>
                </label>
                <label class="equipment-option flex items-center gap-3 p-3 border border-slate-200 dark:border-slate-700/30 rounded-lg cursor-pointer hover:border-blue-500 transition-all" data-category="renewable" data-points="8" data-cost="120000" data-incentive="38000">
                  <input type="checkbox" class="equipment-checkbox w-5 h-5 rounded text-blue-600" onchange="updateSustainabilityScore()">
                  <div class="flex-1">
                    <p class="font-medium text-slate-900 dark:text-white text-sm">Battery Storage (200kWh)</p>
                    <p class="text-xs text-slate-500">LFP chemistry, 10-year warranty</p>
                  </div>
                  <div class="text-right">
                    <p class="text-xs text-slate-500">+$120K</p>
                    <p class="text-xs text-blue-600 dark:text-blue-400">Unlocks: $38K</p>
                  </div>
                </label>
                <label class="equipment-option flex items-center gap-3 p-3 border border-slate-200 dark:border-slate-700/30 rounded-lg cursor-pointer hover:border-blue-500 transition-all" data-category="renewable" data-points="15" data-cost="280000" data-incentive="95000">
                  <input type="checkbox" class="equipment-checkbox w-5 h-5 rounded text-blue-600" onchange="updateSustainabilityScore()">
                  <div class="flex-1">
                    <p class="font-medium text-slate-900 dark:text-white text-sm">BIPV (Building-Integrated PV)</p>
                    <p class="text-xs text-slate-500">Facade or roof integrated, dual function</p>
                  </div>
                  <div class="text-right">
                    <p class="text-xs text-slate-500">+$280K</p>
                    <p class="text-xs text-blue-600 dark:text-blue-400">Unlocks: $95K</p>
                  </div>
                </label>
                <label class="equipment-option flex items-center gap-3 p-3 border border-slate-200 dark:border-slate-700/30 rounded-lg cursor-pointer hover:border-blue-500 transition-all" data-category="renewable" data-points="3" data-cost="15000" data-incentive="4500">
                  <input type="checkbox" class="equipment-checkbox w-5 h-5 rounded text-blue-600" onchange="updateSustainabilityScore()">
                  <div class="flex-1">
                    <p class="font-medium text-slate-900 dark:text-white text-sm">Solar Ready Infrastructure</p>
                    <p class="text-xs text-slate-500">Conduit, panel space, structural</p>
                  </div>
                  <div class="text-right">
                    <p class="text-xs text-slate-500">+$15K</p>
                    <p class="text-xs text-blue-600 dark:text-blue-400">Unlocks: $4.5K</p>
                  </div>
                </label>
              </div>
            </div>
          </div>

          <!-- Right Panel: Impact Summary -->
          <div class="space-y-4">
            <!-- Incentive Summary -->
            <div class="card p-5 bg-gradient-to-br from-blue-50 to-slate-50 dark:from-blue-900/20 dark:to-slate-900/20 border-blue-200 dark:border-slate-600">
              <h3 class="font-semibold text-slate-900 dark:text-white mb-4">Incentives Unlocked</h3>
              <div class="space-y-3">
                <div class="flex justify-between items-center">
                  <span class="text-sm text-slate-600 dark:text-slate-300">IRA 45L Tax Credit</span>
                  <span id="incentive-45l" class="font-mono font-bold text-blue-600 dark:text-blue-400">$0</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-sm text-slate-600 dark:text-slate-300">179D Deduction</span>
                  <span id="incentive-179d" class="font-mono font-bold text-blue-600 dark:text-blue-400">$0</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-sm text-slate-600 dark:text-slate-300">NYSERDA Programs</span>
                  <span id="incentive-nyserda" class="font-mono font-bold text-blue-600 dark:text-blue-400">$0</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-sm text-slate-600 dark:text-slate-300">Utility Rebates</span>
                  <span id="incentive-utility" class="font-mono font-bold text-blue-600 dark:text-blue-400">$0</span>
                </div>
                <div class="border-t border-blue-200 dark:border-slate-600 pt-3 mt-3">
                  <div class="flex justify-between items-center">
                    <span class="font-semibold text-slate-900 dark:text-white">Total Unlocked</span>
                    <span id="incentive-total" class="font-mono text-xl font-bold text-blue-600 dark:text-blue-400">$0</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Cost vs Benefit -->
            <div class="card p-5">
              <h3 class="font-semibold text-slate-900 dark:text-white mb-4">Cost vs. Benefit Analysis</h3>
              <div class="space-y-4">
                <div>
                  <div class="flex justify-between text-sm mb-1">
                    <span class="text-slate-500">Total Investment</span>
                    <span id="total-cost" class="font-mono font-medium text-slate-900 dark:text-white">$0</span>
                  </div>
                  <div class="w-full h-2 bg-slate-200 dark:bg-slate-700 rounded-full">
                    <div id="cost-bar" class="h-full bg-red-400 rounded-full transition-all" style="width: 0%"></div>
                  </div>
                </div>
                <div>
                  <div class="flex justify-between text-sm mb-1">
                    <span class="text-slate-500">Incentive Offset</span>
                    <span id="incentive-offset" class="font-mono font-medium text-blue-600 dark:text-blue-400">$0</span>
                  </div>
                  <div class="w-full h-2 bg-slate-200 dark:bg-slate-700 rounded-full">
                    <div id="incentive-bar" class="h-full bg-blue-500 rounded-full transition-all" style="width: 0%"></div>
                  </div>
                </div>
                <div class="p-4 bg-slate-50 dark:bg-slate-800/50 rounded-lg">
                  <div class="flex justify-between items-center">
                    <span class="font-medium text-slate-700 dark:text-slate-300">Net Cost After Incentives</span>
                    <span id="net-cost" class="font-mono text-lg font-bold text-slate-900 dark:text-white">$0</span>
                  </div>
                  <p id="roi-message" class="text-sm text-blue-600 dark:text-blue-400 mt-2">Select measures to see ROI</p>
                </div>
              </div>
            </div>

            <!-- Carbon Impact -->
            <div class="card p-5">
              <h3 class="font-semibold text-slate-900 dark:text-white mb-4">Environmental Impact</h3>
              <div class="grid grid-cols-2 gap-4">
                <div class="text-center p-3 bg-slate-50 dark:bg-slate-800/50 rounded-lg">
                  <p id="co2-reduction" class="font-mono text-2xl font-bold text-blue-700 dark:text-blue-400">0%</p>
                  <p class="text-xs text-slate-500 mt-1">CO2 Reduction</p>
                </div>
                <div class="text-center p-3 bg-slate-50 dark:bg-slate-800/50 rounded-lg">
                  <p id="energy-savings" class="font-mono text-2xl font-bold text-blue-600 dark:text-blue-400">0%</p>
                  <p class="text-xs text-slate-500 mt-1">Energy Savings</p>
                </div>
              </div>
              <div class="mt-4 p-3 border border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                <p id="ll97-status" class="text-sm text-blue-700 dark:text-blue-400 font-medium text-center">Add measures to assess LL97 compliance</p>
              </div>
            </div>

            <!-- Tier Unlock Status -->
            <div class="card p-5">
              <h3 class="font-semibold text-slate-900 dark:text-white mb-4">Tier Benefits</h3>
              <div class="space-y-3">
                <div id="tier-base" class="flex items-center gap-3 p-3 bg-slate-100 dark:bg-slate-800 rounded-lg">
                  <div class="w-8 h-8 rounded-full bg-slate-400 flex items-center justify-center">
                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                  </div>
                  <div>
                    <p class="font-medium text-slate-900 dark:text-white text-sm">BASE</p>
                    <p class="text-xs text-slate-500">Standard 45L, 179D base rates</p>
                  </div>
                </div>
                <div id="tier-enhanced" class="flex items-center gap-3 p-3 border border-slate-200 dark:border-slate-700 rounded-lg opacity-50">
                  <div class="w-8 h-8 rounded-full border-2 border-blue-400 flex items-center justify-center">
                    <span class="text-xs font-bold text-blue-600">50</span>
                  </div>
                  <div>
                    <p class="font-medium text-slate-900 dark:text-white text-sm">ENHANCED</p>
                    <p class="text-xs text-slate-500">+25% bonus credits, NYSERDA tier 2</p>
                  </div>
                </div>
                <div id="tier-maximum" class="flex items-center gap-3 p-3 border border-slate-200 dark:border-slate-700 rounded-lg opacity-50">
                  <div class="w-8 h-8 rounded-full border-2 border-blue-400 flex items-center justify-center">
                    <span class="text-xs font-bold text-blue-600">80</span>
                  </div>
                  <div>
                    <p class="font-medium text-slate-900 dark:text-white text-sm">MAXIMUM</p>
                    <p class="text-xs text-slate-500">Full 45L ($5K/unit), 179D max, Zero Energy Ready</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- V31: IRS-Accurate 45L/179D Technical Calculator -->
        <div class="mt-6">
          <div class="card overflow-hidden">
            <button onclick="toggle45L179DCalculator()" class="w-full px-6 py-4 flex items-center justify-between bg-gradient-to-r from-blue-900/50 to-slate-900 hover:from-blue-800/50 transition-colors">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-lg bg-blue-600 flex items-center justify-center">
                  <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>
                </div>
                <div class="text-left">
                  <h3 class="font-semibold text-white">45L / 179D Technical Calculator</h3>
                  <p class="text-sm text-slate-400">IRS-accurate rates with prevailing wage & apprenticeship multipliers</p>
                </div>
              </div>
              <svg id="tech-calc-chevron" class="w-5 h-5 text-slate-400 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
            </button>
            <div id="tech-calculator-panel" class="hidden">
              <div class="p-6 border-t border-slate-700/50">
                <!-- V32: Tax Year Selector -->
                <div class="mb-6 p-4 bg-slate-800/50 rounded-lg border border-slate-700/50">
                  <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                      <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                      <div>
                        <label class="block text-sm font-medium text-slate-300">Tax Year (Placed in Service)</label>
                        <p class="text-xs text-slate-500">Rates adjust based on IRS inflation factors</p>
                      </div>
                    </div>
                    <select class="form-input w-auto" id="calc-tax-year" onchange="updateTaxYear()">
                      <option value="2023">2023</option>
                      <option value="2024" selected>2024</option>
                      <option value="2025">2025</option>
                      <option value="2026">2026+</option>
                    </select>
                  </div>
                  <div class="mt-3 pt-3 border-t border-slate-700/50">
                    <p class="text-xs text-slate-500"><strong>Key IRS Notices:</strong>
                      <a href="https://www.irs.gov/pub/irs-drop/n-22-61.pdf" target="_blank" class="text-blue-400 hover:underline">Notice 2022-61</a> (Prevailing Wage & Apprenticeship Requirements) •
                      <a href="https://www.irs.gov/pub/irs-drop/n-23-29.pdf" target="_blank" class="text-blue-400 hover:underline">Notice 2023-29</a> (Energy Community Bonus) •
                      <a href="https://www.irs.gov/pub/irs-drop/n-24-30.pdf" target="_blank" class="text-blue-400 hover:underline">Notice 2024-30</a> (Inflation Adjustments)
                    </p>
                  </div>
                </div>

                <div class="grid grid-cols-2 gap-6">
                  <!-- 45L Calculator -->
                  <div class="space-y-4">
                    <div class="flex items-center gap-2 mb-4">
                      <span class="badge badge-federal">Section 45L</span>
                      <span class="text-sm text-slate-500">Energy Efficient Home Credit</span>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-slate-300 mb-2">Number of Dwelling Units</label>
                      <input type="number" class="form-input" id="calc-45l-units" value="250" oninput="calculate45L()">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-slate-300 mb-2">Energy Performance Level</label>
                      <select class="form-input" id="calc-45l-level" onchange="calculate45L()">
                        <option value="energy-star">ENERGY STAR (Base Requirement)</option>
                        <option value="energy-star-plus" selected>ENERGY STAR + DOE Zero Energy Ready</option>
                        <option value="prevailing-wage">With Prevailing Wage & Apprenticeship (5x)</option>
                      </select>
                    </div>
                    <!-- V32: ENERGY STAR vs Zero Energy Ready Clarification -->
                    <div class="p-3 bg-blue-900/20 border border-blue-700/30 rounded-lg text-xs">
                      <p class="font-medium text-blue-300 mb-2">Understanding the Certification Levels:</p>
                      <div class="grid grid-cols-2 gap-3">
                        <div>
                          <p class="font-medium text-slate-300">ENERGY STAR</p>
                          <ul class="text-slate-400 mt-1 space-y-0.5">
                            <li>• 10-15% more efficient than code</li>
                            <li>• $500/unit base credit</li>
                            <li>• Easier to achieve</li>
                          </ul>
                        </div>
                        <div>
                          <p class="font-medium text-slate-300">Zero Energy Ready (ZER)</p>
                          <ul class="text-slate-400 mt-1 space-y-0.5">
                            <li>• 40-50% more efficient than code</li>
                            <li>• $1,000/unit base credit (2x)</li>
                            <li>• Requires HERS rating + DOE cert</li>
                          </ul>
                        </div>
                      </div>
                      <p class="mt-2 text-slate-500">ZER homes are "solar-ready" - designed to reach net-zero with the addition of renewables.</p>
                    </div>
                    <div class="p-4 bg-slate-800/50 rounded-lg">
                      <div class="flex justify-between items-center mb-2">
                        <span class="text-sm text-slate-400">Credit per Unit:</span>
                        <span id="rate-45l-unit" class="font-mono font-bold text-white">$2,500</span>
                      </div>
                      <div class="flex justify-between items-center mb-2">
                        <span class="text-sm text-slate-400">Multiplier Applied:</span>
                        <span id="rate-45l-mult" class="font-mono text-blue-400">1x (Base)</span>
                      </div>
                      <div class="border-t border-slate-700 pt-2 mt-2">
                        <div class="flex justify-between items-center">
                          <span class="font-medium text-white">Total 45L Credit:</span>
                          <span id="total-45l" class="font-mono text-xl font-bold text-green-400">$625,000</span>
                        </div>
                      </div>
                    </div>
                    <div class="text-xs text-slate-500 space-y-1">
                      <p><strong>IRS Guidance:</strong> IRC §45L as amended by IRA 2022</p>
                      <p>• Base: $500/unit (ENERGY STAR) or $1,000/unit (Zero Energy Ready)</p>
                      <p>• With prevailing wage: $2,500 or $5,000/unit (5x multiplier per <a href="https://www.irs.gov/pub/irs-drop/n-22-61.pdf" target="_blank" class="text-blue-400 hover:underline">Notice 2022-61</a>)</p>
                      <p>• Energy Community bonus: +10% (<a href="https://www.irs.gov/pub/irs-drop/n-23-29.pdf" target="_blank" class="text-blue-400 hover:underline">Notice 2023-29</a>)</p>
                      <p>• Available through Dec 31, 2032</p>
                    </div>
                  </div>

                  <!-- 179D Calculator -->
                  <div class="space-y-4">
                    <div class="flex items-center gap-2 mb-4">
                      <span class="badge badge-federal">Section 179D</span>
                      <span class="text-sm text-slate-500">Commercial Building Deduction</span>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-slate-300 mb-2">Building Square Footage</label>
                      <input type="number" class="form-input" id="calc-179d-sqft" value="175000" oninput="calculate179D()">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-slate-300 mb-2">Energy Reduction vs ASHRAE 90.1</label>
                      <select class="form-input" id="calc-179d-reduction" onchange="calculate179D()">
                        <option value="25">25% Reduction (Minimum - $0.50/sqft base)</option>
                        <option value="35">35% Reduction ($0.62/sqft base)</option>
                        <option value="45">45% Reduction ($0.75/sqft base)</option>
                        <option value="50" selected>50%+ Reduction (Maximum - $1.00/sqft base)</option>
                      </select>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-slate-300 mb-2">Prevailing Wage Compliance</label>
                      <select class="form-input" id="calc-179d-wage" onchange="calculate179D()">
                        <option value="no">No (Base Rate)</option>
                        <option value="yes" selected>Yes (5x Multiplier)</option>
                      </select>
                    </div>
                    <div class="p-4 bg-slate-800/50 rounded-lg">
                      <div class="flex justify-between items-center mb-2">
                        <span class="text-sm text-slate-400">Base Rate per SQFT:</span>
                        <span id="rate-179d-base" class="font-mono font-bold text-white">$1.00</span>
                      </div>
                      <div class="flex justify-between items-center mb-2">
                        <span class="text-sm text-slate-400">With Prevailing Wage:</span>
                        <span id="rate-179d-final" class="font-mono text-blue-400">$5.00/sqft</span>
                      </div>
                      <div class="border-t border-slate-700 pt-2 mt-2">
                        <div class="flex justify-between items-center">
                          <span class="font-medium text-white">Total 179D Deduction:</span>
                          <span id="total-179d" class="font-mono text-xl font-bold text-green-400">$875,000</span>
                        </div>
                      </div>
                    </div>
                    <div class="text-xs text-slate-500 space-y-1">
                      <p><strong>IRS Guidance:</strong> IRC §179D as amended by IRA 2022</p>
                      <p>• Base rates: $0.50-$1.00/sqft (sliding scale by % reduction)</p>
                      <p>• Prevailing wage multiplier: 5x up to $5.00/sqft (<a href="https://www.irs.gov/pub/irs-drop/n-22-61.pdf" target="_blank" class="text-blue-400 hover:underline">Notice 2022-61</a>)</p>
                      <p>• Partial qualification for HVAC, lighting, envelope (<a href="https://www.irs.gov/pub/irs-drop/n-23-56.pdf" target="_blank" class="text-blue-400 hover:underline">Notice 2023-56</a>)</p>
                      <p>• ASHRAE 90.1 baseline: 2007 (pre-2023) or 2019 (2023+)</p>
                    </div>
                  </div>
                </div>

                <!-- Combined Summary -->
                <div class="mt-6 p-4 bg-gradient-to-r from-green-900/30 to-blue-900/30 border border-green-700/30 rounded-lg">
                  <div class="flex items-center justify-between">
                    <div>
                      <h4 class="font-semibold text-white">Combined Federal Tax Benefits</h4>
                      <p class="text-sm text-slate-400">45L + 179D for this project</p>
                    </div>
                    <div class="text-right">
                      <p id="combined-federal" class="font-mono text-2xl font-bold text-green-400">$1,500,000</p>
                      <p class="text-xs text-slate-500">Based on IRS 2024 rates</p>
                    </div>
                  </div>
                </div>

                <!-- V32: 179D Certification Path Workflow -->
                <div class="mt-6">
                  <button onclick="toggle179DCertPath()" class="w-full p-4 flex items-center justify-between bg-slate-800/50 hover:bg-slate-800 rounded-lg transition-colors">
                    <div class="flex items-center gap-3">
                      <div class="w-8 h-8 rounded-lg bg-purple-600/30 flex items-center justify-center">
                        <svg class="w-4 h-4 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                      </div>
                      <div class="text-left">
                        <h5 class="font-medium text-white">179D Certification Path</h5>
                        <p class="text-xs text-slate-400">Step-by-step workflow for deduction qualification</p>
                      </div>
                    </div>
                    <svg id="cert-path-chevron" class="w-5 h-5 text-slate-400 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                  </button>
                  <div id="cert-path-panel" class="hidden mt-4 p-4 bg-slate-800/30 rounded-lg">
                    <div class="grid grid-cols-6 gap-2 mb-4">
                      <!-- Step 1 -->
                      <div class="text-center">
                        <div class="w-10 h-10 rounded-full bg-green-600 flex items-center justify-center mx-auto mb-2">
                          <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                        </div>
                        <p class="text-xs font-medium text-white">ASHRAE Baseline</p>
                        <p class="text-xs text-green-400">90.1-2019</p>
                      </div>
                      <div class="flex items-center justify-center">
                        <div class="w-full h-0.5 bg-green-600"></div>
                      </div>
                      <!-- Step 2 -->
                      <div class="text-center">
                        <div class="w-10 h-10 rounded-full bg-green-600 flex items-center justify-center mx-auto mb-2">
                          <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                        </div>
                        <p class="text-xs font-medium text-white">Energy Model</p>
                        <p class="text-xs text-green-400">Completed</p>
                      </div>
                      <div class="flex items-center justify-center">
                        <div class="w-full h-0.5 bg-blue-600"></div>
                      </div>
                      <!-- Step 3 -->
                      <div class="text-center">
                        <div class="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center mx-auto mb-2">
                          <span class="text-white text-sm font-bold">3</span>
                        </div>
                        <p class="text-xs font-medium text-white">QDP Review</p>
                        <p class="text-xs text-blue-400">In Progress</p>
                      </div>
                      <div class="flex items-center justify-center">
                        <div class="w-full h-0.5 bg-slate-600"></div>
                      </div>
                    </div>
                    <div class="grid grid-cols-3 gap-4">
                      <!-- Step 4, 5, 6 -->
                      <div class="p-3 bg-slate-800/50 rounded-lg border border-slate-700/50">
                        <div class="flex items-center gap-2 mb-2">
                          <div class="w-6 h-6 rounded-full bg-slate-600 flex items-center justify-center">
                            <span class="text-white text-xs font-bold">4</span>
                          </div>
                          <span class="text-sm font-medium text-slate-300">IRS Certification</span>
                        </div>
                        <p class="text-xs text-slate-400">Qualified deduction certificate from licensed engineer/architect</p>
                      </div>
                      <div class="p-3 bg-slate-800/50 rounded-lg border border-slate-700/50">
                        <div class="flex items-center gap-2 mb-2">
                          <div class="w-6 h-6 rounded-full bg-slate-600 flex items-center justify-center">
                            <span class="text-white text-xs font-bold">5</span>
                          </div>
                          <span class="text-sm font-medium text-slate-300">Prevailing Wage</span>
                        </div>
                        <p class="text-xs text-slate-400">Documentation for 5x multiplier per Notice 2022-61</p>
                      </div>
                      <div class="p-3 bg-slate-800/50 rounded-lg border border-slate-700/50">
                        <div class="flex items-center gap-2 mb-2">
                          <div class="w-6 h-6 rounded-full bg-slate-600 flex items-center justify-center">
                            <span class="text-white text-xs font-bold">6</span>
                          </div>
                          <span class="text-sm font-medium text-slate-300">Claim Deduction</span>
                        </div>
                        <p class="text-xs text-slate-400">File with tax return (Form 4562 + certification)</p>
                      </div>
                    </div>
                    <div class="mt-4 p-3 bg-blue-900/20 border border-blue-700/30 rounded-lg">
                      <p class="text-xs text-blue-300">
                        <strong>Qualified Designer Professional (QDP):</strong> Must be a licensed engineer or architect in the building jurisdiction.
                        <a href="https://www.irs.gov/credits-deductions/energy-efficient-commercial-buildings-deduction" target="_blank" class="text-blue-400 hover:underline">IRS 179D Guidance</a>
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- MARKETPLACE SECTION -->
      <section id="section-marketplace" class="section-content hidden">
        <div class="section-header mb-6">
          <div>
            <h1 class="font-sora text-2xl font-bold text-slate-900 dark:text-white">Consultant Marketplace</h1>
            <p class="text-slate-500 dark:text-slate-400 mt-1">Connect with verified incentive specialists and grant writers</p>
          </div>
          <div class="flex items-center gap-2">
            <select class="form-input w-auto">
              <option>All Specialties</option>
              <option>LIHTC</option>
              <option>NYSERDA</option>
              <option>Historic Tax Credits</option>
              <option>IDA/PILOT</option>
            </select>
          </div>
        </div>

        <!-- Featured Consultants -->
        <div class="grid grid-cols-3 gap-6 mb-6">
          <div class="card p-6 hover:border-blue-500 cursor-pointer" onclick="showToast('info', 'Profile Opened', 'Viewing consultant profile')">
            <div class="flex items-center gap-4 mb-4">
              <div class="w-14 h-14 rounded-full bg-gradient-to-br from-blue-600 to-blue-800 flex items-center justify-center text-white font-bold text-lg">SM</div>
              <div>
                <h3 class="font-semibold text-slate-900 dark:text-white">Sarah Mitchell</h3>
                <p class="text-sm text-slate-500">LIHTC Specialist</p>
              </div>
            </div>
            <div class="flex items-center gap-2 mb-3">
              <div class="flex text-yellow-400">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
              </div>
              <span class="text-sm text-slate-500">5.0 (47 reviews)</span>
            </div>
            <div class="flex flex-wrap gap-2 mb-4">
              <span class="badge badge-federal">LIHTC</span>
              <span class="badge badge-state">HCR</span>
              <span class="badge badge-local">NYC HPD</span>
            </div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-slate-500">42 projects completed</span>
              <span class="font-semibold text-blue-600">$180M captured</span>
            </div>
          </div>

          <div class="card p-6 hover:border-blue-500 cursor-pointer" onclick="showToast('info', 'Profile Opened', 'Viewing consultant profile')">
            <div class="flex items-center gap-4 mb-4">
              <div class="w-14 h-14 rounded-full bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center text-white font-bold text-lg">JR</div>
              <div>
                <h3 class="font-semibold text-slate-900 dark:text-white">James Rodriguez</h3>
                <p class="text-sm text-slate-500">Energy Incentives Expert</p>
              </div>
            </div>
            <div class="flex items-center gap-2 mb-3">
              <div class="flex text-yellow-400">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
              </div>
              <span class="text-sm text-slate-500">4.9 (38 reviews)</span>
            </div>
            <div class="flex flex-wrap gap-2 mb-4">
              <span class="badge badge-state">NYSERDA</span>
              <span class="badge badge-federal">IRA 179D</span>
              <span class="badge badge-utility">Con Ed</span>
            </div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-slate-500">28 projects completed</span>
              <span class="font-semibold text-blue-600">$45M captured</span>
            </div>
          </div>

          <div class="card p-6 hover:border-blue-500 cursor-pointer" onclick="showToast('info', 'Profile Opened', 'Viewing consultant profile')">
            <div class="flex items-center gap-4 mb-4">
              <div class="w-14 h-14 rounded-full bg-gradient-to-br from-cyan-500 to-blue-500 flex items-center justify-center text-white font-bold text-lg">AT</div>
              <div>
                <h3 class="font-semibold text-slate-900 dark:text-white">Amanda Thompson</h3>
                <p class="text-sm text-slate-500">IDA & PILOT Negotiator</p>
              </div>
            </div>
            <div class="flex items-center gap-2 mb-3">
              <div class="flex text-yellow-400">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
              </div>
              <span class="text-sm text-slate-500">5.0 (52 reviews)</span>
            </div>
            <div class="flex flex-wrap gap-2 mb-4">
              <span class="badge badge-local">IDA</span>
              <span class="badge badge-local">PILOT</span>
              <span class="badge badge-local">TIF</span>
            </div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-slate-500">65 projects completed</span>
              <span class="font-semibold text-blue-600">$320M captured</span>
            </div>
          </div>
        </div>

        <!-- Stats -->
        <div class="grid grid-cols-4 gap-4 metric-grid">
          <div class="card p-5">
            <p class="metric-label mb-2">Verified Consultants</p>
            <p class="metric-value">247</p>
          </div>
          <div class="card p-5">
            <p class="metric-label mb-2">Total Captured</p>
            <p class="metric-value highlight">$2.4B</p>
          </div>
          <div class="card p-5">
            <p class="metric-label mb-2">Avg Success Rate</p>
            <p class="metric-value">87%</p>
          </div>
          <div class="card p-5">
            <p class="metric-label mb-2">Avg Response Time</p>
            <p class="metric-value">4 hrs</p>
          </div>
        </div>
      </section>

      <!-- V34: AMI CALCULATOR SECTION -->
      <section id="section-amicalc" class="section-content hidden">
        <div class="section-header mb-6">
          <div>
            <h1 class="font-sora text-2xl font-bold text-slate-900 dark:text-white">AMI Income Calculator</h1>
            <p class="text-slate-500 dark:text-slate-400 mt-1">Calculate 60% and 80% AMI rent limits for LIHTC, Section 8, and affordable housing programs</p>
          </div>
          <div class="flex items-center gap-3">
            <span class="text-xs text-slate-500">Source: HUD FY2024</span>
          </div>
        </div>

        <div class="card p-6 mb-6">
          <h2 class="section-title mb-4">Income & Rent Limits</h2>
          <div class="grid grid-cols-4 gap-4 mb-6">
            <div>
              <label class="block text-xs text-slate-400 mb-1">Metro Area</label>
              <select class="form-input" id="ami-metro" onchange="calculateAMI()">
                <option value="ny-metro">New York-Newark-Jersey City, NY-NJ-PA</option>
                <option value="westchester">Westchester County, NY</option>
                <option value="nassau">Nassau-Suffolk, NY</option>
                <option value="bergen">Bergen-Passaic, NJ</option>
                <option value="stamford">Stamford-Norwalk, CT</option>
              </select>
            </div>
            <div>
              <label class="block text-xs text-slate-400 mb-1">Household Size</label>
              <select class="form-input" id="ami-household" onchange="calculateAMI()">
                <option value="1">1 Person</option>
                <option value="2">2 Persons</option>
                <option value="3">3 Persons</option>
                <option value="4" selected>4 Persons</option>
                <option value="5">5 Persons</option>
                <option value="6">6 Persons</option>
              </select>
            </div>
            <div>
              <label class="block text-xs text-slate-400 mb-1">AMI Level</label>
              <select class="form-input" id="ami-level" onchange="calculateAMI()">
                <option value="30">30% AMI (Extremely Low)</option>
                <option value="50">50% AMI (Very Low)</option>
                <option value="60" selected>60% AMI (LIHTC)</option>
                <option value="80">80% AMI (Low Income)</option>
                <option value="100">100% AMI</option>
                <option value="120">120% AMI (Moderate)</option>
              </select>
            </div>
            <div>
              <label class="block text-xs text-slate-400 mb-1">Unit Type</label>
              <select class="form-input" id="ami-unit" onchange="calculateAMI()">
                <option value="0">Studio (0BR)</option>
                <option value="1" selected>1 Bedroom</option>
                <option value="2">2 Bedroom</option>
                <option value="3">3 Bedroom</option>
                <option value="4">4 Bedroom</option>
              </select>
            </div>
          </div>

          <div class="grid grid-cols-4 gap-6 p-6 bg-slate-800/50 rounded-lg">
            <div class="text-center">
              <p class="text-xs text-slate-400 mb-2">Area Median Income</p>
              <p class="font-mono text-2xl font-bold text-white" id="ami-median">$129,400</p>
              <p class="text-xs text-slate-500 mt-1">FY2024 HUD</p>
            </div>
            <div class="text-center">
              <p class="text-xs text-slate-400 mb-2">Max Household Income</p>
              <p class="font-mono text-2xl font-bold text-blue-400" id="ami-income">$77,640</p>
              <p class="text-xs text-green-400 mt-1">60% AMI</p>
            </div>
            <div class="text-center">
              <p class="text-xs text-slate-400 mb-2">Max Monthly Rent</p>
              <p class="font-mono text-2xl font-bold text-green-400" id="ami-rent">$1,941</p>
              <p class="text-xs text-slate-500 mt-1">30% of gross income</p>
            </div>
            <div class="text-center">
              <p class="text-xs text-slate-400 mb-2">Utility Allowance</p>
              <p class="font-mono text-2xl font-bold text-yellow-400" id="ami-utility">-$125</p>
              <p class="text-xs text-slate-500 mt-1">Tenant-paid utilities</p>
            </div>
          </div>
        </div>

        <!-- Quick Reference Table -->
        <div class="card p-6">
          <h2 class="section-title mb-4">Westchester County Rent Limits (FY2024)</h2>
          <table class="data-table">
            <thead>
              <tr>
                <th>Unit Type</th>
                <th class="text-right">30% AMI</th>
                <th class="text-right">50% AMI</th>
                <th class="text-right">60% AMI</th>
                <th class="text-right">80% AMI</th>
              </tr>
            </thead>
            <tbody>
              <tr><td>Studio</td><td class="text-right font-mono">$872</td><td class="text-right font-mono">$1,453</td><td class="text-right font-mono">$1,744</td><td class="text-right font-mono">$2,326</td></tr>
              <tr><td>1 Bedroom</td><td class="text-right font-mono">$934</td><td class="text-right font-mono">$1,557</td><td class="text-right font-mono">$1,869</td><td class="text-right font-mono">$2,492</td></tr>
              <tr><td>2 Bedroom</td><td class="text-right font-mono">$1,121</td><td class="text-right font-mono">$1,869</td><td class="text-right font-mono">$2,243</td><td class="text-right font-mono">$2,991</td></tr>
              <tr><td>3 Bedroom</td><td class="text-right font-mono">$1,295</td><td class="text-right font-mono">$2,159</td><td class="text-right font-mono">$2,591</td><td class="text-right font-mono">$3,455</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- V34: HFA CONTACTS BY STATE -->
      <section id="section-hfacontacts" class="section-content hidden">
        <div class="section-header mb-6">
          <div>
            <h1 class="font-sora text-2xl font-bold text-slate-900 dark:text-white">HFA Contacts Directory</h1>
            <p class="text-slate-500 dark:text-slate-400 mt-1">State Housing Finance Agency contacts for LIHTC, bond financing, and affordable housing programs</p>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-6">
          <div class="card p-6">
            <h3 class="font-semibold text-white mb-4 flex items-center gap-2">
              <span class="w-8 h-8 bg-blue-600 rounded flex items-center justify-center text-sm font-bold">NY</span>
              New York State Homes & Community Renewal
            </h3>
            <div class="space-y-3">
              <div class="flex justify-between"><span class="text-slate-400">LIHTC Applications</span><span class="text-white">lihtc@hcr.ny.gov</span></div>
              <div class="flex justify-between"><span class="text-slate-400">Bond Financing</span><span class="text-white">bonds@hcr.ny.gov</span></div>
              <div class="flex justify-between"><span class="text-slate-400">Phone</span><span class="text-white">(518) 473-2526</span></div>
              <a href="https://hcr.ny.gov" target="_blank" class="btn btn-secondary w-full text-sm mt-2">Visit Website</a>
            </div>
          </div>
          <div class="card p-6">
            <h3 class="font-semibold text-white mb-4 flex items-center gap-2">
              <span class="w-8 h-8 bg-red-600 rounded flex items-center justify-center text-sm font-bold">NJ</span>
              New Jersey Housing & Mortgage Finance Agency
            </h3>
            <div class="space-y-3">
              <div class="flex justify-between"><span class="text-slate-400">LIHTC Applications</span><span class="text-white">lihtc@njhmfa.gov</span></div>
              <div class="flex justify-between"><span class="text-slate-400">Bond Financing</span><span class="text-white">mfbonds@njhmfa.gov</span></div>
              <div class="flex justify-between"><span class="text-slate-400">Phone</span><span class="text-white">(609) 278-7400</span></div>
              <a href="https://www.njhousing.gov" target="_blank" class="btn btn-secondary w-full text-sm mt-2">Visit Website</a>
            </div>
          </div>
          <div class="card p-6">
            <h3 class="font-semibold text-white mb-4 flex items-center gap-2">
              <span class="w-8 h-8 bg-blue-800 rounded flex items-center justify-center text-sm font-bold">CT</span>
              Connecticut Housing Finance Authority
            </h3>
            <div class="space-y-3">
              <div class="flex justify-between"><span class="text-slate-400">LIHTC Applications</span><span class="text-white">lihtc@chfa.org</span></div>
              <div class="flex justify-between"><span class="text-slate-400">Bond Financing</span><span class="text-white">bonds@chfa.org</span></div>
              <div class="flex justify-between"><span class="text-slate-400">Phone</span><span class="text-white">(860) 721-9501</span></div>
              <a href="https://www.chfa.org" target="_blank" class="btn btn-secondary w-full text-sm mt-2">Visit Website</a>
            </div>
          </div>
          <div class="card p-6">
            <h3 class="font-semibold text-white mb-4 flex items-center gap-2">
              <span class="w-8 h-8 bg-purple-600 rounded flex items-center justify-center text-sm font-bold">MA</span>
              MassHousing
            </h3>
            <div class="space-y-3">
              <div class="flex justify-between"><span class="text-slate-400">LIHTC Applications</span><span class="text-white">lihtc@masshousing.com</span></div>
              <div class="flex justify-between"><span class="text-slate-400">Bond Financing</span><span class="text-white">rental@masshousing.com</span></div>
              <div class="flex justify-between"><span class="text-slate-400">Phone</span><span class="text-white">(617) 854-1000</span></div>
              <a href="https://www.masshousing.com" target="_blank" class="btn btn-secondary w-full text-sm mt-2">Visit Website</a>
            </div>
          </div>
        </div>
      </section>

      <!-- V33: TEAM VIEW SECTION -->
      <section id="section-teamview" class="section-content hidden">
        <div class="section-header mb-6">
          <div>
            <h1 class="font-sora text-2xl font-bold text-slate-900 dark:text-white">Team View</h1>
            <p class="text-slate-500 dark:text-slate-400 mt-1">Collaborative workspace for analysts and project managers</p>
          </div>
          <div class="flex items-center gap-3">
            <span class="status-badge status-success">3 Online</span>
            <button class="btn btn-primary text-sm" onclick="showToast('info', 'Invite Sent', 'Team invitation email sent')">Invite Member</button>
          </div>
        </div>

        <!-- Team Members -->
        <div class="card p-6 mb-6">
          <h2 class="section-title mb-4">Team Members</h2>
          <div class="grid grid-cols-4 gap-4">
            <div class="p-4 bg-slate-800/50 rounded-lg flex items-center gap-3">
              <div class="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center text-white font-bold">JD</div>
              <div>
                <p class="font-medium text-white">John Doe</p>
                <p class="text-xs text-slate-400">Principal</p>
              </div>
              <div class="ml-auto w-2 h-2 rounded-full bg-green-500"></div>
            </div>
            <div class="p-4 bg-slate-800/50 rounded-lg flex items-center gap-3">
              <div class="w-10 h-10 rounded-full bg-purple-600 flex items-center justify-center text-white font-bold">SM</div>
              <div>
                <p class="font-medium text-white">Sarah Miller</p>
                <p class="text-xs text-slate-400">Sr. Analyst</p>
              </div>
              <div class="ml-auto w-2 h-2 rounded-full bg-green-500"></div>
            </div>
            <div class="p-4 bg-slate-800/50 rounded-lg flex items-center gap-3">
              <div class="w-10 h-10 rounded-full bg-cyan-600 flex items-center justify-center text-white font-bold">MK</div>
              <div>
                <p class="font-medium text-white">Mike Kim</p>
                <p class="text-xs text-slate-400">Analyst</p>
              </div>
              <div class="ml-auto w-2 h-2 rounded-full bg-green-500"></div>
            </div>
            <div class="p-4 bg-slate-800/50 rounded-lg flex items-center gap-3">
              <div class="w-10 h-10 rounded-full bg-orange-600 flex items-center justify-center text-white font-bold">EL</div>
              <div>
                <p class="font-medium text-white">Emily Lee</p>
                <p class="text-xs text-slate-400">Associate</p>
              </div>
              <div class="ml-auto w-2 h-2 rounded-full bg-slate-500"></div>
            </div>
          </div>
        </div>

        <!-- Activity Feed -->
        <div class="grid grid-cols-2 gap-6">
          <div class="card p-6">
            <h2 class="section-title mb-4">Recent Activity</h2>
            <div class="space-y-4">
              <div class="flex items-start gap-3">
                <div class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center text-white text-xs font-bold">JD</div>
                <div class="flex-1">
                  <p class="text-sm text-white">John Doe updated capital stack for <span class="text-blue-400">280 Fulton St</span></p>
                  <p class="text-xs text-slate-500 mt-1">2 minutes ago</p>
                </div>
              </div>
              <div class="flex items-start gap-3">
                <div class="w-8 h-8 rounded-full bg-purple-600 flex items-center justify-center text-white text-xs font-bold">SM</div>
                <div class="flex-1">
                  <p class="text-sm text-white">Sarah Miller added comment on <span class="text-blue-400">LIHTC Application</span></p>
                  <p class="text-xs text-slate-500 mt-1">15 minutes ago</p>
                </div>
              </div>
              <div class="flex items-start gap-3">
                <div class="w-8 h-8 rounded-full bg-cyan-600 flex items-center justify-center text-white text-xs font-bold">MK</div>
                <div class="flex-1">
                  <p class="text-sm text-white">Mike Kim completed analysis for <span class="text-blue-400">125 Riverdale Ave</span></p>
                  <p class="text-xs text-slate-500 mt-1">1 hour ago</p>
                </div>
              </div>
              <div class="flex items-start gap-3">
                <div class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center text-white text-xs font-bold">JD</div>
                <div class="flex-1">
                  <p class="text-sm text-white">John Doe exported portfolio report</p>
                  <p class="text-xs text-slate-500 mt-1">3 hours ago</p>
                </div>
              </div>
            </div>
          </div>

          <div class="card p-6">
            <h2 class="section-title mb-4">Project Assignments</h2>
            <div class="space-y-3">
              <div class="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg">
                <div>
                  <p class="font-medium text-white">125 Riverdale Ave</p>
                  <p class="text-xs text-slate-400">LIHTC + 45L Analysis</p>
                </div>
                <div class="flex items-center gap-2">
                  <div class="w-6 h-6 rounded-full bg-purple-600 flex items-center justify-center text-white text-[10px] font-bold">SM</div>
                  <span class="text-xs text-green-400">In Progress</span>
                </div>
              </div>
              <div class="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg">
                <div>
                  <p class="font-medium text-white">280 Fulton St</p>
                  <p class="text-xs text-slate-400">DOE Loan Application</p>
                </div>
                <div class="flex items-center gap-2">
                  <div class="w-6 h-6 rounded-full bg-blue-600 flex items-center justify-center text-white text-[10px] font-bold">JD</div>
                  <span class="text-xs text-blue-400">Review</span>
                </div>
              </div>
              <div class="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg">
                <div>
                  <p class="font-medium text-white">450 Main St</p>
                  <p class="text-xs text-slate-400">IDA PILOT Application</p>
                </div>
                <div class="flex items-center gap-2">
                  <div class="w-6 h-6 rounded-full bg-cyan-600 flex items-center justify-center text-white text-[10px] font-bold">MK</div>
                  <span class="text-xs text-yellow-400">Pending</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- V33: CIFIA/WIFIA INFRASTRUCTURE SECTION -->
      <section id="section-cifia" class="section-content hidden">
        <div class="section-header mb-6">
          <div>
            <h1 class="font-sora text-2xl font-bold text-slate-900 dark:text-white">CIFIA & WIFIA Programs</h1>
            <p class="text-slate-500 dark:text-slate-400 mt-1">DOT infrastructure financing for water, broadband, and climate-resilient projects</p>
          </div>
          <div class="flex items-center gap-3">
            <span class="status-badge status-success">Active Programs</span>
            <a href="https://www.transportation.gov/buildamerica/infra" target="_blank" class="btn btn-secondary text-sm">Build America Bureau</a>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-6 mb-6">
          <!-- WIFIA Card -->
          <div class="card p-6 border-l-4 border-blue-500">
            <div class="flex items-center gap-3 mb-4">
              <div class="w-12 h-12 rounded-xl bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center">
                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/></svg>
              </div>
              <div>
                <h3 class="font-semibold text-slate-900 dark:text-white">WIFIA</h3>
                <p class="text-xs text-slate-500">Water Infrastructure Finance</p>
              </div>
            </div>
            <p class="text-2xl font-mono font-bold text-blue-600 mb-3">$12.6B</p>
            <p class="text-sm text-slate-500 mb-4">Available Credit Assistance</p>
            <div class="space-y-2">
              <div class="flex justify-between text-sm">
                <span class="text-slate-400">Minimum Project Size</span>
                <span class="font-mono text-white">$20M</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-slate-400">Interest Rate</span>
                <span class="font-mono text-green-400">Treasury + 0bp</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-slate-400">Max Financing</span>
                <span class="font-mono text-white">49% of Costs</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-slate-400">Repayment Term</span>
                <span class="font-mono text-white">35 years</span>
              </div>
            </div>
            <a href="https://www.epa.gov/wifia" target="_blank" class="btn btn-primary w-full mt-4 text-sm">EPA WIFIA Portal</a>
          </div>

          <!-- CIFIA Card -->
          <div class="card p-6 border-l-4 border-cyan-500">
            <div class="flex items-center gap-3 mb-4">
              <div class="w-12 h-12 rounded-xl bg-cyan-100 dark:bg-cyan-900/30 flex items-center justify-center">
                <svg class="w-6 h-6 text-cyan-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
              </div>
              <div>
                <h3 class="font-semibold text-slate-900 dark:text-white">CIFIA</h3>
                <p class="text-xs text-slate-500">Carbon Dioxide Infrastructure</p>
              </div>
            </div>
            <p class="text-2xl font-mono font-bold text-cyan-600 mb-3">$2.1B</p>
            <p class="text-sm text-slate-500 mb-4">IRA Allocation</p>
            <div class="space-y-2">
              <div class="flex justify-between text-sm">
                <span class="text-slate-400">Eligible Projects</span>
                <span class="font-mono text-white">CO2 Transport/Storage</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-slate-400">Interest Rate</span>
                <span class="font-mono text-green-400">Treasury Rate</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-slate-400">Max Financing</span>
                <span class="font-mono text-white">80% of Costs</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-slate-400">Credit Subsidy</span>
                <span class="font-mono text-green-400">Fully Covered</span>
              </div>
            </div>
            <a href="https://www.transportation.gov/buildamerica/CIFIA" target="_blank" class="btn btn-primary w-full mt-4 text-sm">DOT CIFIA Portal</a>
          </div>
        </div>

        <!-- Eligibility Checker -->
        <div class="card p-6 bg-gradient-to-r from-blue-900/20 to-cyan-900/20 border-blue-700/30">
          <h3 class="font-semibold text-white mb-4">Quick Eligibility Check</h3>
          <div class="grid grid-cols-4 gap-4">
            <div>
              <label class="block text-xs text-slate-400 mb-1">Project Type</label>
              <select class="form-input text-sm">
                <option>Water/Wastewater</option>
                <option>Stormwater</option>
                <option>CO2 Pipeline</option>
                <option>Carbon Storage</option>
              </select>
            </div>
            <div>
              <label class="block text-xs text-slate-400 mb-1">Project Size ($M)</label>
              <input type="number" class="form-input text-sm" placeholder="e.g., 50" value="50">
            </div>
            <div>
              <label class="block text-xs text-slate-400 mb-1">State</label>
              <select class="form-input text-sm">
                <option>New York</option>
                <option>New Jersey</option>
                <option>Connecticut</option>
              </select>
            </div>
            <div class="flex items-end">
              <button class="btn btn-primary w-full text-sm" onclick="showToast('success', 'Eligible', 'This project may qualify for WIFIA financing')">Check Eligibility</button>
            </div>
          </div>
        </div>
      </section>

      <!-- V31: DOE LOAN PROGRAMS SECTION -->
      <section id="section-doeloans" class="section-content hidden">
        <div class="section-header mb-6">
          <div>
            <h1 class="font-sora text-2xl font-bold text-slate-900 dark:text-white">DOE Loan Programs Office</h1>
            <p class="text-slate-500 dark:text-slate-400 mt-1">$400B+ in available loan authority for clean energy projects</p>
          </div>
          <div class="flex items-center gap-3">
            <span class="status-badge status-success">LPO Programs Active</span>
          </div>
        </div>

        <!-- Program Cards -->
        <div class="grid grid-cols-3 gap-6 mb-6">
          <div class="card p-6 border-l-4 border-blue-500">
            <div class="flex items-center gap-3 mb-4">
              <div class="w-12 h-12 rounded-xl bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center">
                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
              </div>
              <div>
                <h3 class="font-semibold text-slate-900 dark:text-white">Title XVII</h3>
                <p class="text-xs text-slate-500">Innovative Clean Energy</p>
              </div>
            </div>
            <p class="text-3xl font-mono font-bold text-blue-600 mb-2">$250B+</p>
            <p class="text-sm text-slate-500 mb-4">Available Authority</p>
            <ul class="text-xs text-slate-400 space-y-1">
              <li>• Renewable energy generation</li>
              <li>• Advanced nuclear projects</li>
              <li>• Critical minerals processing</li>
              <li>• Carbon capture & storage</li>
            </ul>
            <button class="mt-4 w-full btn btn-primary text-sm" onclick="showToast('info', 'Title XVII', 'Application guidance would open here')">Explore Program</button>
          </div>

          <div class="card p-6 border-l-4 border-green-500">
            <div class="flex items-center gap-3 mb-4">
              <div class="w-12 h-12 rounded-xl bg-green-100 dark:bg-green-900/30 flex items-center justify-center">
                <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
              </div>
              <div>
                <h3 class="font-semibold text-slate-900 dark:text-white">1703 Guarantees</h3>
                <p class="text-xs text-slate-500">Commercial Scale</p>
              </div>
            </div>
            <p class="text-3xl font-mono font-bold text-green-600 mb-2">$40B+</p>
            <p class="text-sm text-slate-500 mb-4">Available Authority</p>
            <ul class="text-xs text-slate-400 space-y-1">
              <li>• Energy efficiency retrofits</li>
              <li>• Electric grid modernization</li>
              <li>• Clean energy manufacturing</li>
              <li>• Energy storage systems</li>
            </ul>
            <button class="mt-4 w-full btn btn-secondary text-sm" onclick="showToast('info', '1703 Program', 'Application guidance would open here')">Explore Program</button>
          </div>

          <div class="card p-6 border-l-4 border-purple-500">
            <div class="flex items-center gap-3 mb-4">
              <div class="w-12 h-12 rounded-xl bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center">
                <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/></svg>
              </div>
              <div>
                <h3 class="font-semibold text-slate-900 dark:text-white">Tribal Energy</h3>
                <p class="text-xs text-slate-500">Tribal Communities</p>
              </div>
            </div>
            <p class="text-3xl font-mono font-bold text-purple-600 mb-2">$20B</p>
            <p class="text-sm text-slate-500 mb-4">Available Authority</p>
            <ul class="text-xs text-slate-400 space-y-1">
              <li>• Tribal clean energy projects</li>
              <li>• Energy sovereignty initiatives</li>
              <li>• Grid resilience for tribes</li>
              <li>• Community solar programs</li>
            </ul>
            <button class="mt-4 w-full btn btn-secondary text-sm" onclick="showToast('info', 'Tribal Energy', 'Application guidance would open here')">Explore Program</button>
          </div>
        </div>

        <!-- V32: LPO Timeline Estimates -->
        <div class="card mb-6">
          <div class="p-4 border-b border-slate-700/50 bg-slate-800/50">
            <div class="flex items-center justify-between">
              <div>
                <h3 class="font-semibold text-white">LPO Application Timeline Estimates</h3>
                <p class="text-sm text-slate-400 mt-1">Typical durations from pre-application to closing</p>
              </div>
              <a href="https://www.energy.gov/lpo/loan-programs-office" target="_blank" class="btn btn-secondary text-sm">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg>
                Visit LPO Portal
              </a>
            </div>
          </div>
          <div class="p-6">
            <div class="relative">
              <!-- Timeline Bar -->
              <div class="h-2 bg-slate-700 rounded-full mb-8">
                <div class="h-full w-full bg-gradient-to-r from-blue-600 via-green-500 to-purple-600 rounded-full"></div>
              </div>
              <!-- Timeline Steps -->
              <div class="grid grid-cols-5 gap-4 text-center">
                <div>
                  <div class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center mx-auto mb-2">
                    <span class="text-white text-sm font-bold">1</span>
                  </div>
                  <p class="text-sm font-medium text-white">Pre-Application</p>
                  <p class="text-xs text-slate-400">2-4 weeks</p>
                  <p class="text-xs text-blue-400 mt-1">Initial meeting + concept paper</p>
                </div>
                <div>
                  <div class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center mx-auto mb-2">
                    <span class="text-white text-sm font-bold">2</span>
                  </div>
                  <p class="text-sm font-medium text-white">Part I Application</p>
                  <p class="text-xs text-slate-400">4-8 weeks</p>
                  <p class="text-xs text-blue-400 mt-1">Tech + financial overview</p>
                </div>
                <div>
                  <div class="w-8 h-8 rounded-full bg-green-500 flex items-center justify-center mx-auto mb-2">
                    <span class="text-white text-sm font-bold">3</span>
                  </div>
                  <p class="text-sm font-medium text-white">Part II Application</p>
                  <p class="text-xs text-slate-400">8-16 weeks</p>
                  <p class="text-xs text-green-400 mt-1">Full due diligence</p>
                </div>
                <div>
                  <div class="w-8 h-8 rounded-full bg-amber-500 flex items-center justify-center mx-auto mb-2">
                    <span class="text-white text-sm font-bold">4</span>
                  </div>
                  <p class="text-sm font-medium text-white">Term Sheet</p>
                  <p class="text-xs text-slate-400">4-8 weeks</p>
                  <p class="text-xs text-amber-400 mt-1">Conditional commitment</p>
                </div>
                <div>
                  <div class="w-8 h-8 rounded-full bg-purple-500 flex items-center justify-center mx-auto mb-2">
                    <span class="text-white text-sm font-bold">5</span>
                  </div>
                  <p class="text-sm font-medium text-white">Closing</p>
                  <p class="text-xs text-slate-400">8-12 weeks</p>
                  <p class="text-xs text-purple-400 mt-1">Final documents + funding</p>
                </div>
              </div>
              <div class="mt-6 p-4 bg-slate-800/50 rounded-lg text-center">
                <p class="text-sm text-slate-400">
                  <strong class="text-white">Total Estimated Timeline:</strong>
                  <span class="font-mono text-blue-400">6-12 months</span> from pre-application to closing
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- V32: DOE Portal Quick Links -->
        <div class="grid grid-cols-4 gap-4 mb-6">
          <a href="https://www.energy.gov/lpo/articles/how-apply-lpo-financing" target="_blank" class="card p-4 hover:border-blue-500 transition-colors group">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-lg bg-blue-600/20 flex items-center justify-center group-hover:bg-blue-600/40">
                <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
              </div>
              <div>
                <p class="font-medium text-white group-hover:text-blue-400">How to Apply</p>
                <p class="text-xs text-slate-400">Step-by-step guide</p>
              </div>
            </div>
          </a>
          <a href="https://www.energy.gov/lpo/frequently-asked-questions" target="_blank" class="card p-4 hover:border-green-500 transition-colors group">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-lg bg-green-600/20 flex items-center justify-center group-hover:bg-green-600/40">
                <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
              </div>
              <div>
                <p class="font-medium text-white group-hover:text-green-400">FAQs</p>
                <p class="text-xs text-slate-400">Common questions</p>
              </div>
            </div>
          </a>
          <a href="https://www.energy.gov/lpo/projects" target="_blank" class="card p-4 hover:border-purple-500 transition-colors group">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-lg bg-purple-600/20 flex items-center justify-center group-hover:bg-purple-600/40">
                <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/></svg>
              </div>
              <div>
                <p class="font-medium text-white group-hover:text-purple-400">Funded Projects</p>
                <p class="text-xs text-slate-400">Case studies</p>
              </div>
            </div>
          </a>
          <a href="https://www.energy.gov/lpo/contact-us" target="_blank" class="card p-4 hover:border-amber-500 transition-colors group">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-lg bg-amber-600/20 flex items-center justify-center group-hover:bg-amber-600/40">
                <svg class="w-5 h-5 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
              </div>
              <div>
                <p class="font-medium text-white group-hover:text-amber-400">Contact LPO</p>
                <p class="text-xs text-slate-400">Get in touch</p>
              </div>
            </div>
          </a>
        </div>

        <!-- Stack with IRA Credits Info -->
        <div class="card p-6 bg-gradient-to-r from-blue-900/20 to-green-900/20 border-blue-700/30">
          <div class="flex items-center justify-between">
            <div>
              <h3 class="font-semibold text-white mb-1">Stack DOE Loans with IRA Tax Credits</h3>
              <p class="text-sm text-slate-400">Combine LPO financing with 45X, 48C, and other IRA credits for maximum project value</p>
            </div>
            <button class="btn btn-primary" onclick="showToast('info', 'Stacking Guide', 'DOE + IRA stacking methodology would open here')">View Stacking Guide</button>
          </div>
        </div>
      </section>

      <!-- V31: RESILIENCE & CLIMATE MODULE -->
      <section id="section-resilience" class="section-content hidden">
        <div class="section-header mb-6">
          <div>
            <h1 class="font-sora text-2xl font-bold text-slate-900 dark:text-white">Resilience & Climate Adaptation</h1>
            <p class="text-slate-500 dark:text-slate-400 mt-1">FEMA, HUD, and state resilience funding for climate-ready projects</p>
          </div>
          <!-- V32: FEMA Risk Index Link -->
          <a href="https://hazards.fema.gov/nri/" target="_blank" class="btn btn-secondary">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/></svg>
            FEMA National Risk Index
          </a>
        </div>

        <!-- V32: Site Risk Assessment Card -->
        <div class="card p-4 mb-6 bg-gradient-to-r from-orange-900/20 to-red-900/20 border-orange-700/30">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-4">
              <div class="w-12 h-12 rounded-xl bg-orange-600 flex items-center justify-center">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
              </div>
              <div>
                <p class="font-semibold text-white">Mount Vernon, NY - Risk Assessment</p>
                <p class="text-sm text-slate-400">Based on FEMA National Risk Index data</p>
              </div>
            </div>
            <div class="flex items-center gap-6">
              <div class="text-center">
                <p class="text-xs text-slate-400">Overall Risk</p>
                <p class="font-mono font-bold text-amber-400">Moderate</p>
              </div>
              <div class="text-center">
                <p class="text-xs text-slate-400">Flood Risk</p>
                <p class="font-mono font-bold text-orange-400">High</p>
              </div>
              <div class="text-center">
                <p class="text-xs text-slate-400">Social Vuln.</p>
                <p class="font-mono font-bold text-yellow-400">Medium</p>
              </div>
              <a href="https://hazards.fema.gov/nri/map" target="_blank" class="btn btn-secondary text-sm">View Full Report</a>
            </div>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-6 mb-6">
          <!-- FEMA BRIC -->
          <div class="card p-6">
            <div class="flex items-center gap-3 mb-4">
              <div class="w-12 h-12 rounded-xl bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center">
                <svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"/></svg>
              </div>
              <div>
                <h3 class="font-semibold text-slate-900 dark:text-white">FEMA BRIC</h3>
                <p class="text-xs text-slate-500">Building Resilient Infrastructure</p>
              </div>
            </div>
            <p class="text-2xl font-mono font-bold text-orange-600 mb-3">$2.3B</p>
            <p class="text-sm text-slate-500 mb-4">FY2024 Allocation</p>
            <div class="space-y-2">
              <div class="flex justify-between text-sm">
                <span class="text-slate-400">Maximum Award</span>
                <span class="font-mono text-white">$50M</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-slate-400">Cost Share</span>
                <span class="font-mono text-white">75/25</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-slate-400">Deadline</span>
                <span class="font-mono text-blue-400">Jan 2026</span>
              </div>
            </div>
          </div>

          <!-- HUD CDBG-DR -->
          <div class="card p-6">
            <div class="flex items-center gap-3 mb-4">
              <div class="w-12 h-12 rounded-xl bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center">
                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
              </div>
              <div>
                <h3 class="font-semibold text-slate-900 dark:text-white">HUD CDBG-DR</h3>
                <p class="text-xs text-slate-500">Disaster Recovery</p>
              </div>
            </div>
            <p class="text-2xl font-mono font-bold text-blue-600 mb-3">$5B+</p>
            <p class="text-sm text-slate-500 mb-4">Active Allocations</p>
            <div class="space-y-2">
              <div class="flex justify-between text-sm">
                <span class="text-slate-400">Eligible Uses</span>
                <span class="font-mono text-white">Housing, Infra</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-slate-400">LMI Benefit</span>
                <span class="font-mono text-white">70% Required</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-slate-400">Type</span>
                <span class="font-mono text-green-400">Formula Grant</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Climate Risk Assessment -->
        <div class="card p-6">
          <h3 class="font-semibold text-slate-900 dark:text-white mb-4">Climate Risk Assessment for Your Projects</h3>
          <div class="grid grid-cols-4 gap-4">
            <div class="text-center p-4 bg-slate-800/50 rounded-lg">
              <p class="text-2xl font-mono font-bold text-yellow-400">Medium</p>
              <p class="text-xs text-slate-500 mt-1">Flood Risk</p>
            </div>
            <div class="text-center p-4 bg-slate-800/50 rounded-lg">
              <p class="text-2xl font-mono font-bold text-green-400">Low</p>
              <p class="text-xs text-slate-500 mt-1">Wildfire Risk</p>
            </div>
            <div class="text-center p-4 bg-slate-800/50 rounded-lg">
              <p class="text-2xl font-mono font-bold text-orange-400">High</p>
              <p class="text-xs text-slate-500 mt-1">Heat Stress</p>
            </div>
            <div class="text-center p-4 bg-slate-800/50 rounded-lg">
              <p class="text-2xl font-mono font-bold text-green-400">Low</p>
              <p class="text-xs text-slate-500 mt-1">Sea Level Rise</p>
            </div>
          </div>
        </div>
      </section>

      <!-- V31: STATE EDA DATABASE -->
      <section id="section-stateeda" class="section-content hidden">
        <div class="section-header mb-6">
          <div>
            <h1 class="font-sora text-2xl font-bold text-slate-900 dark:text-white">State Economic Development Incentives</h1>
            <p class="text-slate-500 dark:text-slate-400 mt-1">All 50 states' job creation credits, abatements, and infrastructure grants</p>
          </div>
          <div class="flex items-center gap-3">
            <select class="form-input w-auto" id="state-eda-filter">
              <option value="">All States</option>
              <option value="NY" selected>New York</option>
              <option value="NJ">New Jersey</option>
              <option value="CT">Connecticut</option>
              <option value="CA">California</option>
              <option value="TX">Texas</option>
              <option value="FL">Florida</option>
            </select>
          </div>
        </div>

        <!-- State Programs Table -->
        <div class="card overflow-hidden">
          <div class="px-6 py-4 border-b border-slate-200 dark:border-slate-700/30">
            <h2 class="section-title">New York State Incentives</h2>
          </div>
          <table class="data-table">
            <thead>
              <tr>
                <th>Program</th>
                <th>Type</th>
                <th class="text-right">Max Value</th>
                <th>Requirements</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  <p class="font-medium text-slate-900 dark:text-white">Excelsior Jobs Program</p>
                  <p class="text-xs text-slate-500">Job creation tax credits</p>
                </td>
                <td><span class="badge badge-state">Tax Credit</span></td>
                <td class="text-right font-mono font-medium">$10K/job</td>
                <td class="text-xs">Min 10 new FTE jobs</td>
                <td><span class="status-badge status-success">Active</span></td>
              </tr>
              <tr>
                <td>
                  <p class="font-medium text-slate-900 dark:text-white">Industrial Development Agency PILOT</p>
                  <p class="text-xs text-slate-500">Property tax abatement</p>
                </td>
                <td><span class="badge badge-local">Abatement</span></td>
                <td class="text-right font-mono font-medium">15-25 yrs</td>
                <td class="text-xs">Job creation, capital investment</td>
                <td><span class="status-badge status-success">Active</span></td>
              </tr>
              <tr>
                <td>
                  <p class="font-medium text-slate-900 dark:text-white">Empire State Development Grants</p>
                  <p class="text-xs text-slate-500">Capital grants</p>
                </td>
                <td><span class="badge badge-state">Grant</span></td>
                <td class="text-right font-mono font-medium">$5M max</td>
                <td class="text-xs">Priority industries only</td>
                <td><span class="status-badge status-info">Application</span></td>
              </tr>
              <tr>
                <td>
                  <p class="font-medium text-slate-900 dark:text-white">Brownfield Tax Credits</p>
                  <p class="text-xs text-slate-500">Site remediation credits</p>
                </td>
                <td><span class="badge badge-state">Tax Credit</span></td>
                <td class="text-right font-mono font-medium">22% of costs</td>
                <td class="text-xs">DEC-enrolled sites</td>
                <td><span class="status-badge status-success">Active</span></td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- V32: LIHTC QAP Calendar - All States -->
        <div class="card mt-6">
          <div class="p-4 border-b border-slate-200 dark:border-slate-700/30">
            <div class="flex items-center justify-between">
              <div>
                <h2 class="font-semibold text-slate-900 dark:text-white">LIHTC QAP Deadline Calendar</h2>
                <p class="text-sm text-slate-500">2026 Qualified Allocation Plan deadlines by state</p>
              </div>
              <div class="flex items-center gap-2">
                <select class="form-input w-auto text-sm" id="qap-region-filter">
                  <option value="all">All Regions</option>
                  <option value="northeast">Northeast</option>
                  <option value="southeast">Southeast</option>
                  <option value="midwest">Midwest</option>
                  <option value="southwest">Southwest</option>
                  <option value="west">West</option>
                  <option value="territories">Territories</option>
                </select>
                <button class="btn btn-secondary text-sm" onclick="exportQAPCalendar()">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                  Export
                </button>
              </div>
            </div>
          </div>
          <div class="p-4">
            <!-- Upcoming Deadlines Alert -->
            <div class="mb-4 p-3 bg-amber-900/20 border border-amber-700/30 rounded-lg flex items-center gap-3">
              <svg class="w-5 h-5 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
              <span class="text-sm text-amber-300"><strong>3 deadlines</strong> in the next 30 days: NY (Jan 15), CA (Jan 31), TX (Feb 1)</span>
            </div>

            <!-- QAP Calendar Grid -->
            <div class="grid grid-cols-4 gap-3 max-h-96 overflow-y-auto pr-2">
              <!-- Northeast -->
              <div class="space-y-2">
                <p class="text-xs font-medium text-blue-400 uppercase tracking-wider mb-2">Northeast</p>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">CT</span><span class="font-mono text-amber-400">Mar 15</span></div>
                  <a href="https://www.chfa.org/lihtc" target="_blank" class="text-blue-400 hover:underline">CHFA QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">MA</span><span class="font-mono text-slate-400">Apr 1</span></div>
                  <a href="https://www.masshousing.com/developers/lihtc" target="_blank" class="text-blue-400 hover:underline">MassHousing QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">ME</span><span class="font-mono text-slate-400">Apr 15</span></div>
                  <a href="https://www.mainehousing.org" target="_blank" class="text-blue-400 hover:underline">MaineHousing QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">NH</span><span class="font-mono text-slate-400">May 1</span></div>
                  <a href="https://www.nhhfa.org" target="_blank" class="text-blue-400 hover:underline">NHHFA QAP</a>
                </div>
                <div class="p-2 bg-red-900/30 rounded text-xs border border-red-700/30">
                  <div class="flex justify-between"><span class="text-slate-300 font-medium">NY</span><span class="font-mono text-red-400">Jan 15</span></div>
                  <a href="https://hcr.ny.gov/lihtc" target="_blank" class="text-blue-400 hover:underline">HCR QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">NJ</span><span class="font-mono text-slate-400">Feb 28</span></div>
                  <a href="https://www.njhousing.gov" target="_blank" class="text-blue-400 hover:underline">NJHMFA QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">PA</span><span class="font-mono text-slate-400">Mar 1</span></div>
                  <a href="https://www.phfa.org" target="_blank" class="text-blue-400 hover:underline">PHFA QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">RI</span><span class="font-mono text-slate-400">Apr 30</span></div>
                  <a href="https://www.rihousing.com" target="_blank" class="text-blue-400 hover:underline">RIHousing QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">VT</span><span class="font-mono text-slate-400">May 15</span></div>
                  <a href="https://www.vhfa.org" target="_blank" class="text-blue-400 hover:underline">VHFA QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">DC</span><span class="font-mono text-slate-400">Mar 31</span></div>
                  <a href="https://dhcd.dc.gov" target="_blank" class="text-blue-400 hover:underline">DHCD QAP</a>
                </div>
              </div>
              <!-- Southeast -->
              <div class="space-y-2">
                <p class="text-xs font-medium text-green-400 uppercase tracking-wider mb-2">Southeast</p>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">AL</span><span class="font-mono text-slate-400">Apr 1</span></div>
                  <a href="https://www.ahfa.com" target="_blank" class="text-blue-400 hover:underline">AHFA QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">FL</span><span class="font-mono text-slate-400">Mar 15</span></div>
                  <a href="https://www.floridahousing.org" target="_blank" class="text-blue-400 hover:underline">FL Housing QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">GA</span><span class="font-mono text-slate-400">Feb 15</span></div>
                  <a href="https://www.dca.ga.gov" target="_blank" class="text-blue-400 hover:underline">DCA QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">KY</span><span class="font-mono text-slate-400">Mar 1</span></div>
                  <a href="https://www.kyhousing.org" target="_blank" class="text-blue-400 hover:underline">KHC QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">LA</span><span class="font-mono text-slate-400">Apr 15</span></div>
                  <a href="https://www.lhc.la.gov" target="_blank" class="text-blue-400 hover:underline">LHC QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">MD</span><span class="font-mono text-slate-400">Mar 15</span></div>
                  <a href="https://dhcd.maryland.gov" target="_blank" class="text-blue-400 hover:underline">MD DHCD QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">NC</span><span class="font-mono text-slate-400">Feb 28</span></div>
                  <a href="https://www.nchfa.com" target="_blank" class="text-blue-400 hover:underline">NCHFA QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">SC</span><span class="font-mono text-slate-400">Mar 1</span></div>
                  <a href="https://www.schousing.com" target="_blank" class="text-blue-400 hover:underline">SC Housing QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">TN</span><span class="font-mono text-slate-400">Apr 1</span></div>
                  <a href="https://thda.org" target="_blank" class="text-blue-400 hover:underline">THDA QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">VA</span><span class="font-mono text-slate-400">Mar 15</span></div>
                  <a href="https://www.vhda.com" target="_blank" class="text-blue-400 hover:underline">VHDA QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">WV</span><span class="font-mono text-slate-400">May 1</span></div>
                  <a href="https://www.wvhdf.com" target="_blank" class="text-blue-400 hover:underline">WVHDF QAP</a>
                </div>
              </div>
              <!-- Midwest -->
              <div class="space-y-2">
                <p class="text-xs font-medium text-amber-400 uppercase tracking-wider mb-2">Midwest</p>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">IL</span><span class="font-mono text-slate-400">Mar 1</span></div>
                  <a href="https://www.ihda.org" target="_blank" class="text-blue-400 hover:underline">IHDA QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">IN</span><span class="font-mono text-slate-400">Feb 15</span></div>
                  <a href="https://www.ihcda.in.gov" target="_blank" class="text-blue-400 hover:underline">IHCDA QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">IA</span><span class="font-mono text-slate-400">Apr 1</span></div>
                  <a href="https://www.iowafinance.com" target="_blank" class="text-blue-400 hover:underline">IFA QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">KS</span><span class="font-mono text-slate-400">Mar 15</span></div>
                  <a href="https://www.kshousingcorp.org" target="_blank" class="text-blue-400 hover:underline">KHRC QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">MI</span><span class="font-mono text-slate-400">Feb 28</span></div>
                  <a href="https://www.michigan.gov/mshda" target="_blank" class="text-blue-400 hover:underline">MSHDA QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">MN</span><span class="font-mono text-slate-400">Mar 1</span></div>
                  <a href="https://www.mnhousing.gov" target="_blank" class="text-blue-400 hover:underline">MN Housing QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">MO</span><span class="font-mono text-slate-400">Apr 1</span></div>
                  <a href="https://www.mhdc.com" target="_blank" class="text-blue-400 hover:underline">MHDC QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">NE</span><span class="font-mono text-slate-400">Apr 15</span></div>
                  <a href="https://nifa.org" target="_blank" class="text-blue-400 hover:underline">NIFA QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">ND</span><span class="font-mono text-slate-400">May 1</span></div>
                  <a href="https://www.ndhfa.org" target="_blank" class="text-blue-400 hover:underline">NDHFA QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">OH</span><span class="font-mono text-slate-400">Feb 15</span></div>
                  <a href="https://ohiohome.org" target="_blank" class="text-blue-400 hover:underline">OHFA QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">SD</span><span class="font-mono text-slate-400">May 15</span></div>
                  <a href="https://www.sdhda.org" target="_blank" class="text-blue-400 hover:underline">SDHDA QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">WI</span><span class="font-mono text-slate-400">Mar 15</span></div>
                  <a href="https://www.wheda.com" target="_blank" class="text-blue-400 hover:underline">WHEDA QAP</a>
                </div>
              </div>
              <!-- West & Territories -->
              <div class="space-y-2">
                <p class="text-xs font-medium text-purple-400 uppercase tracking-wider mb-2">West</p>
                <div class="p-2 bg-amber-900/30 rounded text-xs border border-amber-700/30">
                  <div class="flex justify-between"><span class="text-slate-300 font-medium">CA</span><span class="font-mono text-amber-400">Jan 31</span></div>
                  <a href="https://www.treasurer.ca.gov/ctcac" target="_blank" class="text-blue-400 hover:underline">CTCAC QAP</a>
                </div>
                <div class="p-2 bg-amber-900/30 rounded text-xs border border-amber-700/30">
                  <div class="flex justify-between"><span class="text-slate-300 font-medium">TX</span><span class="font-mono text-amber-400">Feb 1</span></div>
                  <a href="https://www.tdhca.state.tx.us" target="_blank" class="text-blue-400 hover:underline">TDHCA QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">AZ</span><span class="font-mono text-slate-400">Feb 15</span></div>
                  <a href="https://housing.az.gov" target="_blank" class="text-blue-400 hover:underline">ADOH QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">CO</span><span class="font-mono text-slate-400">Feb 28</span></div>
                  <a href="https://www.chfainfo.com" target="_blank" class="text-blue-400 hover:underline">CHFA QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">NV</span><span class="font-mono text-slate-400">Mar 15</span></div>
                  <a href="https://housing.nv.gov" target="_blank" class="text-blue-400 hover:underline">NHD QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">OR</span><span class="font-mono text-slate-400">Mar 1</span></div>
                  <a href="https://www.oregon.gov/ohcs" target="_blank" class="text-blue-400 hover:underline">OHCS QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">WA</span><span class="font-mono text-slate-400">Apr 1</span></div>
                  <a href="https://www.wshfc.org" target="_blank" class="text-blue-400 hover:underline">WSHFC QAP</a>
                </div>
                <p class="text-xs font-medium text-teal-400 uppercase tracking-wider mt-4 mb-2">Territories</p>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">PR</span><span class="font-mono text-slate-400">Mar 31</span></div>
                  <a href="https://www.afv.pr.gov" target="_blank" class="text-blue-400 hover:underline">AFV QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">VI</span><span class="font-mono text-slate-400">Apr 15</span></div>
                  <a href="https://www.vihfa.gov" target="_blank" class="text-blue-400 hover:underline">VIHFA QAP</a>
                </div>
                <div class="p-2 bg-slate-800/30 rounded text-xs">
                  <div class="flex justify-between"><span class="text-slate-300">GU</span><span class="font-mono text-slate-400">May 1</span></div>
                  <span class="text-slate-400">GHURA QAP</span>
                </div>
              </div>
            </div>
            <div class="mt-4 pt-4 border-t border-slate-700/30 text-xs text-slate-500">
              <p>Dates shown are 2026 application deadlines. Some states have multiple rounds. Click state HFA links for current QAP documents.</p>
            </div>
          </div>
        </div>
      </section>

      <!-- V31: PREVAILING WAGE TRACKER -->
      <section id="section-prevailingwage" class="section-content hidden">
        <div class="section-header mb-6">
          <div>
            <h1 class="font-sora text-2xl font-bold text-slate-900 dark:text-white">Prevailing Wage & Apprenticeship Tracker</h1>
            <p class="text-slate-500 dark:text-slate-400 mt-1">IRA 5x multiplier compliance tracking and Davis-Bacon wage lookups</p>
          </div>
          <div class="flex items-center gap-3">
            <span class="status-badge status-success">5x Multiplier Eligible</span>
          </div>
        </div>

        <!-- Compliance Dashboard -->
        <div class="grid grid-cols-4 gap-4 mb-6">
          <div class="card p-5 border-l-4 border-green-500">
            <p class="text-sm text-slate-500 mb-1">Base Credit Value</p>
            <p class="text-xl font-mono font-bold text-slate-900 dark:text-white">$1.5M</p>
          </div>
          <div class="card p-5 border-l-4 border-blue-500">
            <p class="text-sm text-slate-500 mb-1">With 5x Multiplier</p>
            <p class="text-xl font-mono font-bold text-blue-600">$7.5M</p>
          </div>
          <div class="card p-5 border-l-4 border-green-500">
            <p class="text-sm text-slate-500 mb-1">Prevailing Wage Status</p>
            <p class="text-xl font-bold text-green-500">Compliant</p>
          </div>
          <div class="card p-5 border-l-4 border-yellow-500">
            <p class="text-sm text-slate-500 mb-1">Apprenticeship Status</p>
            <p class="text-xl font-bold text-yellow-500">In Progress</p>
          </div>
        </div>

        <!-- Wage Rate Lookup -->
        <div class="card p-6 mb-6">
          <h3 class="font-semibold text-slate-900 dark:text-white mb-4">Davis-Bacon Wage Rate Lookup</h3>
          <div class="grid grid-cols-3 gap-4 mb-4">
            <div>
              <label class="block text-sm font-medium text-slate-300 mb-2">County</label>
              <select class="form-input">
                <option>Westchester County, NY</option>
                <option>Bronx County, NY</option>
                <option>New York County, NY</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-300 mb-2">Construction Type</label>
              <select class="form-input">
                <option>Building Construction</option>
                <option>Residential Construction</option>
                <option>Heavy Construction</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-300 mb-2">Trade</label>
              <select class="form-input">
                <option>Electrician</option>
                <option>Plumber</option>
                <option>Carpenter</option>
                <option>HVAC Mechanic</option>
              </select>
            </div>
          </div>
          <div class="p-4 bg-slate-800/50 rounded-lg">
            <div class="flex justify-between items-center">
              <div>
                <p class="font-semibold text-white">Electrician - Westchester County, NY</p>
                <p class="text-sm text-slate-400">Building Construction</p>
              </div>
              <div class="text-right">
                <p class="font-mono text-2xl font-bold text-green-400">$78.50/hr</p>
                <p class="text-xs text-slate-500">Base + Fringe</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Apprenticeship Programs -->
        <div class="card p-6">
          <h3 class="font-semibold text-slate-900 dark:text-white mb-4">Registered Apprenticeship Programs</h3>
          <div class="space-y-3">
            <div class="flex items-center justify-between p-3 bg-slate-800/30 rounded-lg">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-lg bg-blue-600 flex items-center justify-center text-white font-bold">IBEW</div>
                <div>
                  <p class="font-medium text-white">IBEW Local 3 JATC</p>
                  <p class="text-xs text-slate-400">Electrical Apprenticeship</p>
                </div>
              </div>
              <span class="status-badge status-success">Approved</span>
            </div>
            <div class="flex items-center justify-between p-3 bg-slate-800/30 rounded-lg">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-lg bg-orange-600 flex items-center justify-center text-white font-bold">UA</div>
                <div>
                  <p class="font-medium text-white">UA Local 21</p>
                  <p class="text-xs text-slate-400">Plumbers & Steamfitters</p>
                </div>
              </div>
              <span class="status-badge status-success">Approved</span>
            </div>
          </div>
        </div>
      </section>

      <!-- V31: PORTFOLIO DASHBOARD -->
      <section id="section-portfolio" class="section-content hidden">
        <div class="section-header mb-6">
          <div>
            <h1 class="font-sora text-2xl font-bold text-slate-900 dark:text-white">Portfolio Dashboard</h1>
            <p class="text-slate-500 dark:text-slate-400 mt-1">Multi-project incentive tracking for developers managing 10+ simultaneous projects</p>
          </div>
          <div class="flex items-center gap-3">
            <span class="status-badge status-success">12 Active Projects</span>
            <button onclick="exportPortfolio()" class="btn btn-secondary text-sm">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
              Export Portfolio
            </button>
          </div>
        </div>

        <!-- Portfolio Summary Card -->
        <div class="portfolio-summary-card mb-6">
          <div class="flex items-center justify-between">
            <div>
              <h2 class="text-xl font-semibold">Total Portfolio Value</h2>
              <p class="text-blue-200 text-sm mt-1">Across all active projects</p>
            </div>
            <div class="text-right">
              <p class="text-4xl font-mono font-bold">$847.2M</p>
              <p class="text-blue-200 text-sm">Combined Development Value</p>
            </div>
          </div>
          <div class="portfolio-summary-grid">
            <div class="portfolio-summary-stat">
              <p class="value">$127.4M</p>
              <p class="label">Total Incentives Identified</p>
            </div>
            <div class="portfolio-summary-stat">
              <p class="value">$42.8M</p>
              <p class="label">Incentives Captured</p>
            </div>
            <div class="portfolio-summary-stat">
              <p class="value">$84.6M</p>
              <p class="label">Pipeline Value</p>
            </div>
            <div class="portfolio-summary-stat">
              <p class="value">15.0%</p>
              <p class="label">Avg Incentive/TDC</p>
            </div>
          </div>
        </div>

        <!-- V32: Portfolio Capital Stack Summary -->
        <div class="card p-6 mb-6 bg-gradient-to-r from-blue-900/20 to-slate-900/10 border-blue-700/30">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-lg font-semibold text-white flex items-center gap-2">
              <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
              Portfolio Capital Stack
            </h2>
            <button onclick="switchSection('capitalstack'); showToast('info', 'View Mode', 'Showing aggregated portfolio capital stack')" class="btn btn-secondary text-sm">
              View Detailed Stack
            </button>
          </div>
          <div class="grid grid-cols-5 gap-4">
            <div class="text-center p-3 bg-slate-800/50 rounded-lg">
              <p class="text-2xl font-mono font-bold text-white">$508.3M</p>
              <p class="text-xs text-slate-400 mt-1">Senior Debt (60%)</p>
              <p class="text-[10px] text-blue-400">Avg Rate: 5.45%</p>
            </div>
            <div class="text-center p-3 bg-slate-800/50 rounded-lg">
              <p class="text-2xl font-mono font-bold text-blue-400">$127.4M</p>
              <p class="text-xs text-slate-400 mt-1">Total Subsidies (15%)</p>
              <p class="text-[10px] text-green-400">76 Programs Active</p>
            </div>
            <div class="text-center p-3 bg-slate-800/50 rounded-lg">
              <p class="text-2xl font-mono font-bold text-green-400">$42.8M</p>
              <p class="text-xs text-slate-400 mt-1">Mezzanine (5%)</p>
              <p class="text-[10px] text-yellow-400">3 Projects</p>
            </div>
            <div class="text-center p-3 bg-slate-800/50 rounded-lg">
              <p class="text-2xl font-mono font-bold text-purple-400">$84.6M</p>
              <p class="text-xs text-slate-400 mt-1">LP Equity (10%)</p>
              <p class="text-[10px] text-slate-400">Avg IRR Target: 18%</p>
            </div>
            <div class="text-center p-3 bg-slate-800/50 rounded-lg">
              <p class="text-2xl font-mono font-bold text-cyan-400">$84.1M</p>
              <p class="text-xs text-slate-400 mt-1">GP Equity (10%)</p>
              <p class="text-[10px] text-slate-400">Promote: 20% > 12%</p>
            </div>
          </div>
          <div class="mt-4 flex items-center justify-between text-sm">
            <div class="flex items-center gap-4">
              <span class="text-slate-400">Weighted Avg DSCR: <span class="text-green-400 font-mono">1.35x</span></span>
              <span class="text-slate-400">Blended Cost of Capital: <span class="text-blue-400 font-mono">6.8%</span></span>
            </div>
            <span class="text-xs text-slate-500">Last updated: Jan 11, 2026 09:00 EST</span>
          </div>
        </div>

        <!-- Filter Bar -->
        <div class="portfolio-filter-bar">
          <button class="portfolio-filter-btn active" onclick="filterPortfolio('all')">All Projects</button>
          <button class="portfolio-filter-btn" onclick="filterPortfolio('active')">Active (8)</button>
          <button class="portfolio-filter-btn" onclick="filterPortfolio('pending')">Pending (3)</button>
          <button class="portfolio-filter-btn" onclick="filterPortfolio('completed')">Completed (1)</button>
          <div class="flex-1"></div>
          <select class="form-input w-48" onchange="sortPortfolio(this.value)">
            <option value="value">Sort by Value</option>
            <option value="name">Sort by Name</option>
            <option value="deadline">Sort by Deadline</option>
            <option value="incentive">Sort by Incentive %</option>
          </select>
        </div>

        <!-- Portfolio Grid -->
        <div class="portfolio-grid">
          <!-- Project Card 1 -->
          <div class="portfolio-card" onclick="openProjectDetail('riverdale-125')">
            <div class="portfolio-card-header">
              <div>
                <p class="font-semibold text-white">125 Riverdale Ave</p>
                <p class="text-xs text-slate-400">Yonkers, NY • Multifamily</p>
              </div>
              <span class="status-badge status-success">Active</span>
            </div>
            <div class="portfolio-card-body">
              <div class="portfolio-metric">
                <span class="text-slate-400 text-sm">TDC</span>
                <span class="font-mono font-medium text-white">$48.5M</span>
              </div>
              <div class="portfolio-metric">
                <span class="text-slate-400 text-sm">Incentives Identified</span>
                <span class="font-mono font-medium text-green-400">$7.2M</span>
              </div>
              <div class="portfolio-metric">
                <span class="text-slate-400 text-sm">Incentive/TDC</span>
                <span class="font-mono font-medium text-blue-400">14.8%</span>
              </div>
              <div class="portfolio-status-bar">
                <div class="portfolio-status-segment bg-green-500" style="flex: 3" title="Captured"></div>
                <div class="portfolio-status-segment bg-yellow-500" style="flex: 2" title="In Progress"></div>
                <div class="portfolio-status-segment bg-slate-600" style="flex: 2" title="Identified"></div>
              </div>
              <p class="text-xs text-slate-500 mt-2">45L, 179D, IDA PILOT, LIHTC</p>
            </div>
          </div>

          <!-- Project Card 2 -->
          <div class="portfolio-card" onclick="openProjectDetail('fulton-280')">
            <div class="portfolio-card-header">
              <div>
                <p class="font-semibold text-white">280 Fulton St</p>
                <p class="text-xs text-slate-400">Brooklyn, NY • Mixed-Use</p>
              </div>
              <span class="status-badge status-success">Active</span>
            </div>
            <div class="portfolio-card-body">
              <div class="portfolio-metric">
                <span class="text-slate-400 text-sm">TDC</span>
                <span class="font-mono font-medium text-white">$125.0M</span>
              </div>
              <div class="portfolio-metric">
                <span class="text-slate-400 text-sm">Incentives Identified</span>
                <span class="font-mono font-medium text-green-400">$21.3M</span>
              </div>
              <div class="portfolio-metric">
                <span class="text-slate-400 text-sm">Incentive/TDC</span>
                <span class="font-mono font-medium text-blue-400">17.0%</span>
              </div>
              <div class="portfolio-status-bar">
                <div class="portfolio-status-segment bg-green-500" style="flex: 2" title="Captured"></div>
                <div class="portfolio-status-segment bg-yellow-500" style="flex: 3" title="In Progress"></div>
                <div class="portfolio-status-segment bg-slate-600" style="flex: 2" title="Identified"></div>
              </div>
              <p class="text-xs text-slate-500 mt-2">179D, NYC J-51, ICAP, ITC</p>
            </div>
          </div>

          <!-- Project Card 3 -->
          <div class="portfolio-card" onclick="openProjectDetail('main-450')">
            <div class="portfolio-card-header">
              <div>
                <p class="font-semibold text-white">450 Main St</p>
                <p class="text-xs text-slate-400">New Rochelle, NY • TOD</p>
              </div>
              <span class="status-badge status-info">Pending</span>
            </div>
            <div class="portfolio-card-body">
              <div class="portfolio-metric">
                <span class="text-slate-400 text-sm">TDC</span>
                <span class="font-mono font-medium text-white">$78.2M</span>
              </div>
              <div class="portfolio-metric">
                <span class="text-slate-400 text-sm">Incentives Identified</span>
                <span class="font-mono font-medium text-green-400">$11.8M</span>
              </div>
              <div class="portfolio-metric">
                <span class="text-slate-400 text-sm">Incentive/TDC</span>
                <span class="font-mono font-medium text-blue-400">15.1%</span>
              </div>
              <div class="portfolio-status-bar">
                <div class="portfolio-status-segment bg-green-500" style="flex: 1" title="Captured"></div>
                <div class="portfolio-status-segment bg-yellow-500" style="flex: 1" title="In Progress"></div>
                <div class="portfolio-status-segment bg-slate-600" style="flex: 5" title="Identified"></div>
              </div>
              <p class="text-xs text-slate-500 mt-2">45L, 179D, TOD Bonus, EB-5</p>
            </div>
          </div>

          <!-- Project Card 4 -->
          <div class="portfolio-card" onclick="openProjectDetail('canal-88')">
            <div class="portfolio-card-header">
              <div>
                <p class="font-semibold text-white">88 Canal St</p>
                <p class="text-xs text-slate-400">Manhattan, NY • Commercial</p>
              </div>
              <span class="status-badge status-success">Active</span>
            </div>
            <div class="portfolio-card-body">
              <div class="portfolio-metric">
                <span class="text-slate-400 text-sm">TDC</span>
                <span class="font-mono font-medium text-white">$215.0M</span>
              </div>
              <div class="portfolio-metric">
                <span class="text-slate-400 text-sm">Incentives Identified</span>
                <span class="font-mono font-medium text-green-400">$32.4M</span>
              </div>
              <div class="portfolio-metric">
                <span class="text-slate-400 text-sm">Incentive/TDC</span>
                <span class="font-mono font-medium text-blue-400">15.1%</span>
              </div>
              <div class="portfolio-status-bar">
                <div class="portfolio-status-segment bg-green-500" style="flex: 4" title="Captured"></div>
                <div class="portfolio-status-segment bg-yellow-500" style="flex: 2" title="In Progress"></div>
                <div class="portfolio-status-segment bg-slate-600" style="flex: 1" title="Identified"></div>
              </div>
              <p class="text-xs text-slate-500 mt-2">179D, ICAP, Brownfield, OZ</p>
            </div>
          </div>

          <!-- Project Card 5 -->
          <div class="portfolio-card" onclick="openProjectDetail('grove-220')">
            <div class="portfolio-card-header">
              <div>
                <p class="font-semibold text-white">220 Grove St</p>
                <p class="text-xs text-slate-400">Jersey City, NJ • Multifamily</p>
              </div>
              <span class="status-badge status-success">Active</span>
            </div>
            <div class="portfolio-card-body">
              <div class="portfolio-metric">
                <span class="text-slate-400 text-sm">TDC</span>
                <span class="font-mono font-medium text-white">$92.5M</span>
              </div>
              <div class="portfolio-metric">
                <span class="text-slate-400 text-sm">Incentives Identified</span>
                <span class="font-mono font-medium text-green-400">$15.6M</span>
              </div>
              <div class="portfolio-metric">
                <span class="text-slate-400 text-sm">Incentive/TDC</span>
                <span class="font-mono font-medium text-blue-400">16.9%</span>
              </div>
              <div class="portfolio-status-bar">
                <div class="portfolio-status-segment bg-green-500" style="flex: 5" title="Captured"></div>
                <div class="portfolio-status-segment bg-yellow-500" style="flex: 1" title="In Progress"></div>
                <div class="portfolio-status-segment bg-slate-600" style="flex: 1" title="Identified"></div>
              </div>
              <p class="text-xs text-slate-500 mt-2">45L, NJ PILOT, Urban Transit Hub</p>
            </div>
          </div>

          <!-- Project Card 6 -->
          <div class="portfolio-card" onclick="openProjectDetail('bergen-500')">
            <div class="portfolio-card-header">
              <div>
                <p class="font-semibold text-white">500 Bergen Blvd</p>
                <p class="text-xs text-slate-400">Ridgefield, NJ • Industrial</p>
              </div>
              <span class="status-badge status-completed">Completed</span>
            </div>
            <div class="portfolio-card-body">
              <div class="portfolio-metric">
                <span class="text-slate-400 text-sm">TDC</span>
                <span class="font-mono font-medium text-white">$67.0M</span>
              </div>
              <div class="portfolio-metric">
                <span class="text-slate-400 text-sm">Incentives Captured</span>
                <span class="font-mono font-medium text-green-400">$8.7M</span>
              </div>
              <div class="portfolio-metric">
                <span class="text-slate-400 text-sm">Incentive/TDC</span>
                <span class="font-mono font-medium text-blue-400">13.0%</span>
              </div>
              <div class="portfolio-status-bar">
                <div class="portfolio-status-segment bg-green-500" style="flex: 7" title="Captured"></div>
              </div>
              <p class="text-xs text-slate-500 mt-2">179D, NJ Grow, PILOT</p>
            </div>
          </div>
        </div>

        <!-- Deadline Timeline -->
        <div class="card p-6 mt-6">
          <h3 class="font-semibold text-slate-900 dark:text-white mb-4">Upcoming Deadlines</h3>
          <div class="space-y-3">
            <div class="flex items-center justify-between p-3 bg-red-900/20 border border-red-500/30 rounded-lg">
              <div class="flex items-center gap-3">
                <div class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></div>
                <div>
                  <p class="font-medium text-white">LIHTC Application - 125 Riverdale Ave</p>
                  <p class="text-xs text-slate-400">NYHCR 9% Round</p>
                </div>
              </div>
              <div class="text-right">
                <p class="font-mono text-red-400">Jan 15, 2026</p>
                <p class="text-xs text-red-400">4 days remaining</p>
              </div>
            </div>
            <div class="flex items-center justify-between p-3 bg-yellow-900/20 border border-yellow-500/30 rounded-lg">
              <div class="flex items-center gap-3">
                <div class="w-2 h-2 rounded-full bg-yellow-500"></div>
                <div>
                  <p class="font-medium text-white">IDA PILOT Hearing - 280 Fulton St</p>
                  <p class="text-xs text-slate-400">Brooklyn IDA Board Meeting</p>
                </div>
              </div>
              <div class="text-right">
                <p class="font-mono text-yellow-400">Jan 22, 2026</p>
                <p class="text-xs text-yellow-400">11 days remaining</p>
              </div>
            </div>
            <div class="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg">
              <div class="flex items-center gap-3">
                <div class="w-2 h-2 rounded-full bg-blue-500"></div>
                <div>
                  <p class="font-medium text-white">179D Certification - 88 Canal St</p>
                  <p class="text-xs text-slate-400">Energy model due to certifier</p>
                </div>
              </div>
              <div class="text-right">
                <p class="font-mono text-slate-400">Feb 1, 2026</p>
                <p class="text-xs text-slate-500">21 days remaining</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- V31: ENVIRONMENTAL JUSTICE MAP -->
      <section id="section-ejmap" class="section-content hidden">
        <div class="section-header mb-6">
          <div>
            <h1 class="font-sora text-2xl font-bold text-slate-900 dark:text-white">Environmental Justice Map</h1>
            <p class="text-slate-500 dark:text-slate-400 mt-1">Disadvantaged communities, energy communities, and low-income census tracts for IRA bonus credits</p>
          </div>
          <div class="flex items-center gap-3">
            <span class="status-badge status-info">CEJST + DOE Data</span>
            <button onclick="exportEJReport()" class="btn btn-secondary text-sm">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
              Export Report
            </button>
          </div>
        </div>

        <!-- EJ Bonus Credit Summary -->
        <div class="grid grid-cols-4 gap-4 mb-6">
          <div class="card p-5 border-l-4 border-purple-500">
            <p class="text-sm text-slate-500 mb-1">DAC Bonus</p>
            <p class="text-2xl font-mono font-bold text-purple-400">+10%</p>
            <p class="text-xs text-slate-400">ITC/PTC adder</p>
          </div>
          <div class="card p-5 border-l-4 border-green-500">
            <p class="text-sm text-slate-500 mb-1">Energy Community</p>
            <p class="text-2xl font-mono font-bold text-green-400">+10%</p>
            <p class="text-xs text-slate-400">ITC/PTC adder</p>
          </div>
          <div class="card p-5 border-l-4 border-yellow-500">
            <p class="text-sm text-slate-500 mb-1">Low-Income Bonus</p>
            <p class="text-2xl font-mono font-bold text-yellow-400">+10-20%</p>
            <p class="text-xs text-slate-400">Residential solar</p>
          </div>
          <div class="card p-5 border-l-4 border-red-500">
            <p class="text-sm text-slate-500 mb-1">Stacked Maximum</p>
            <p class="text-2xl font-mono font-bold text-red-400">+40%</p>
            <p class="text-xs text-slate-400">All bonuses combined</p>
          </div>
        </div>

        <!-- Layer Toggle Controls -->
        <div class="card p-4 mb-6">
          <div class="flex items-center justify-between flex-wrap gap-4">
            <div class="flex items-center gap-4">
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" id="layer-dac" checked class="w-4 h-4 rounded border-slate-600 text-purple-600 focus:ring-purple-500" onchange="toggleEJLayer('dac')">
                <span class="text-sm text-slate-300">Disadvantaged Communities (DAC)</span>
                <span class="w-3 h-3 rounded bg-purple-500"></span>
              </label>
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" id="layer-energy" checked class="w-4 h-4 rounded border-slate-600 text-green-600 focus:ring-green-500" onchange="toggleEJLayer('energy')">
                <span class="text-sm text-slate-300">Energy Communities</span>
                <span class="w-3 h-3 rounded bg-green-500"></span>
              </label>
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" id="layer-lowincome" checked class="w-4 h-4 rounded border-slate-600 text-yellow-600 focus:ring-yellow-500" onchange="toggleEJLayer('lowincome')">
                <span class="text-sm text-slate-300">Low-Income Census Tracts</span>
                <span class="w-3 h-3 rounded bg-yellow-500"></span>
              </label>
            </div>
            <div class="flex items-center gap-2">
              <input type="text" placeholder="Search address or census tract..." class="form-input w-64" id="ej-search-input" oninput="searchEJMap(this.value)">
              <button onclick="locateCurrentProject()" class="btn btn-primary text-sm">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                Locate Project
              </button>
            </div>
          </div>
        </div>

        <!-- Interactive Map Container -->
        <div class="ej-map-container mb-6">
          <div class="ej-map-placeholder">
            <!-- Grid overlay for visual effect -->
            <div class="ej-map-grid"></div>

            <!-- Sample EJ Zones (NYC/Westchester area visualization) -->
            <div class="ej-zone ej-zone-dac" style="left: 15%; top: 25%; width: 120px; height: 120px;" onclick="showEJZoneDetail('dac', 'South Bronx')" title="South Bronx DAC"></div>
            <div class="ej-zone ej-zone-dac" style="left: 25%; top: 45%; width: 80px; height: 80px;" onclick="showEJZoneDetail('dac', 'East Harlem')" title="East Harlem DAC"></div>
            <div class="ej-zone ej-zone-energy" style="left: 55%; top: 20%; width: 100px; height: 100px;" onclick="showEJZoneDetail('energy', 'Westchester Coal Closure')" title="Westchester Energy Community"></div>
            <div class="ej-zone ej-zone-energy" style="left: 70%; top: 35%; width: 90px; height: 90px;" onclick="showEJZoneDetail('energy', 'Nassau Industrial')" title="Nassau Energy Community"></div>
            <div class="ej-zone ej-zone-lowincome" style="left: 35%; top: 55%; width: 110px; height: 110px;" onclick="showEJZoneDetail('lowincome', 'Central Brooklyn')" title="Central Brooklyn Low-Income"></div>
            <div class="ej-zone ej-zone-lowincome" style="left: 20%; top: 65%; width: 70px; height: 70px;" onclick="showEJZoneDetail('lowincome', 'Jamaica, Queens')" title="Jamaica Low-Income"></div>
            <div class="ej-zone ej-zone-overlap" style="left: 40%; top: 30%; width: 140px; height: 140px;" onclick="showEJZoneDetail('overlap', 'Yonkers Multi-Qualified')" title="Yonkers - Multiple Qualifications"></div>

            <!-- Project Markers -->
            <div class="ej-marker" style="left: 42%; top: 32%;" onclick="showProjectEJDetail('riverdale-125')" title="125 Riverdale Ave"></div>
            <div class="ej-marker" style="left: 38%; top: 58%;" onclick="showProjectEJDetail('fulton-280')" title="280 Fulton St"></div>
            <div class="ej-marker" style="left: 58%; top: 25%;" onclick="showProjectEJDetail('main-450')" title="450 Main St"></div>

            <!-- Map Controls -->
            <div class="ej-controls">
              <button class="ej-control-btn" onclick="zoomEJMap('in')" title="Zoom In">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>
              </button>
              <button class="ej-control-btn" onclick="zoomEJMap('out')" title="Zoom Out">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/></svg>
              </button>
              <button class="ej-control-btn" onclick="resetEJMap()" title="Reset View">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"/></svg>
              </button>
            </div>

            <!-- Stats Overlay -->
            <div class="ej-stats-overlay">
              <h4 class="font-semibold text-white text-sm mb-3">Map Statistics</h4>
              <div class="ej-stat-item">
                <span class="text-slate-400 text-xs">DAC Tracts Shown</span>
                <span class="font-mono text-purple-400 text-sm">47</span>
              </div>
              <div class="ej-stat-item">
                <span class="text-slate-400 text-xs">Energy Communities</span>
                <span class="font-mono text-green-400 text-sm">12</span>
              </div>
              <div class="ej-stat-item">
                <span class="text-slate-400 text-xs">Low-Income Tracts</span>
                <span class="font-mono text-yellow-400 text-sm">89</span>
              </div>
              <div class="ej-stat-item">
                <span class="text-slate-400 text-xs">Projects in Zones</span>
                <span class="font-mono text-blue-400 text-sm">3/12</span>
              </div>
            </div>

            <!-- V33: Collapsible Legend -->
            <div class="ej-legend" id="ej-legend-panel">
              <div class="flex items-center justify-between cursor-pointer" onclick="toggleEJLegend()">
                <h4 class="font-semibold text-white text-sm">Legend</h4>
                <svg id="ej-legend-chevron" class="w-4 h-4 text-slate-400 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
              </div>
              <div id="ej-legend-content" class="mt-3 space-y-2">
                <div class="ej-legend-item">
                  <div class="ej-legend-color bg-purple-500"></div>
                  <span>Disadvantaged Community (DAC)</span>
                </div>
                <div class="ej-legend-item">
                  <div class="ej-legend-color bg-green-500"></div>
                  <span>Energy Community</span>
                </div>
                <div class="ej-legend-item">
                  <div class="ej-legend-color bg-yellow-500"></div>
                  <span>Low-Income Census Tract</span>
                </div>
                <div class="ej-legend-item">
                  <div class="ej-legend-color bg-red-500" style="border: 2px dashed rgba(239,68,68,0.8);"></div>
                  <span>Multiple Qualifications</span>
                </div>
                <div class="ej-legend-item">
                  <div class="w-4 h-4 bg-blue-500 rounded-full border-2 border-white"></div>
                  <span>Your Projects</span>
                </div>
              </div>
            </div>

            <!-- Mapbox Attribution Placeholder -->
            <div class="absolute bottom-2 right-2 text-xs text-slate-500">
              Map data © Mapbox | CEJST | DOE
            </div>
          </div>

          <!-- Tooltip (hidden by default) -->
          <div id="ej-tooltip" class="ej-tooltip">
            <p class="font-semibold text-white" id="ej-tooltip-title">Zone Name</p>
            <p class="text-xs text-slate-400" id="ej-tooltip-type">Zone Type</p>
            <div class="mt-2 pt-2 border-t border-slate-700">
              <p class="text-xs text-slate-300" id="ej-tooltip-detail">Details about bonus eligibility...</p>
            </div>
          </div>
        </div>

        <!-- Project EJ Analysis Cards -->
        <div class="grid grid-cols-3 gap-4">
          <div class="card p-5">
            <div class="flex items-center gap-3 mb-4">
              <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-purple-500 to-red-500 flex items-center justify-center text-white font-bold text-sm">3x</div>
              <div>
                <p class="font-semibold text-white">125 Riverdale Ave</p>
                <p class="text-xs text-slate-400">Yonkers, NY</p>
              </div>
            </div>
            <div class="space-y-2">
              <div class="flex items-center justify-between">
                <span class="text-xs text-slate-400">DAC Status</span>
                <span class="text-xs font-medium text-green-400">✓ Qualified</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-xs text-slate-400">Energy Community</span>
                <span class="text-xs font-medium text-green-400">✓ Coal Closure</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-xs text-slate-400">Low-Income Tract</span>
                <span class="text-xs font-medium text-green-400">✓ Qualified</span>
              </div>
              <div class="mt-3 pt-3 border-t border-slate-700">
                <p class="text-xs text-slate-500">Potential Bonus Credit</p>
                <p class="text-lg font-mono font-bold text-green-400">+$2.16M (30%)</p>
              </div>
            </div>
          </div>

          <div class="card p-5">
            <div class="flex items-center gap-3 mb-4">
              <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-purple-500 to-yellow-500 flex items-center justify-center text-white font-bold text-sm">2x</div>
              <div>
                <p class="font-semibold text-white">280 Fulton St</p>
                <p class="text-xs text-slate-400">Brooklyn, NY</p>
              </div>
            </div>
            <div class="space-y-2">
              <div class="flex items-center justify-between">
                <span class="text-xs text-slate-400">DAC Status</span>
                <span class="text-xs font-medium text-green-400">✓ Qualified</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-xs text-slate-400">Energy Community</span>
                <span class="text-xs font-medium text-slate-500">✗ Not Qualified</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-xs text-slate-400">Low-Income Tract</span>
                <span class="text-xs font-medium text-green-400">✓ Qualified</span>
              </div>
              <div class="mt-3 pt-3 border-t border-slate-700">
                <p class="text-xs text-slate-500">Potential Bonus Credit</p>
                <p class="text-lg font-mono font-bold text-green-400">+$4.26M (20%)</p>
              </div>
            </div>
          </div>

          <div class="card p-5">
            <div class="flex items-center gap-3 mb-4">
              <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-green-500 to-green-700 flex items-center justify-center text-white font-bold text-sm">1x</div>
              <div>
                <p class="font-semibold text-white">450 Main St</p>
                <p class="text-xs text-slate-400">New Rochelle, NY</p>
              </div>
            </div>
            <div class="space-y-2">
              <div class="flex items-center justify-between">
                <span class="text-xs text-slate-400">DAC Status</span>
                <span class="text-xs font-medium text-slate-500">✗ Not Qualified</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-xs text-slate-400">Energy Community</span>
                <span class="text-xs font-medium text-green-400">✓ MSA Qualifying</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-xs text-slate-400">Low-Income Tract</span>
                <span class="text-xs font-medium text-slate-500">✗ Not Qualified</span>
              </div>
              <div class="mt-3 pt-3 border-t border-slate-700">
                <p class="text-xs text-slate-500">Potential Bonus Credit</p>
                <p class="text-lg font-mono font-bold text-green-400">+$1.18M (10%)</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- V31: ENTERPRISE API DOCUMENTATION -->
      <section id="section-apidocs" class="section-content hidden">
        <div class="section-header mb-6">
          <div>
            <h1 class="font-sora text-2xl font-bold text-slate-900 dark:text-white">Enterprise API Documentation</h1>
            <p class="text-slate-500 dark:text-slate-400 mt-1">RESTful API for programmatic access to incentive analysis and portfolio data</p>
          </div>
          <div class="flex items-center gap-3">
            <span class="status-badge status-info">v2.1.0</span>
            <button onclick="copyApiKey()" class="btn btn-secondary text-sm">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/></svg>
              Copy API Key
            </button>
          </div>
        </div>

        <!-- API Overview Cards -->
        <div class="grid grid-cols-4 gap-4 mb-6">
          <div class="card p-5 border-l-4 border-blue-500">
            <p class="text-sm text-slate-500 mb-1">API Calls Today</p>
            <p class="text-2xl font-mono font-bold text-slate-900 dark:text-white">2,847</p>
            <p class="text-xs text-slate-400">of 10,000 limit</p>
          </div>
          <div class="card p-5 border-l-4 border-green-500">
            <p class="text-sm text-slate-500 mb-1">Success Rate</p>
            <p class="text-2xl font-mono font-bold text-green-400">99.7%</p>
            <p class="text-xs text-slate-400">Last 30 days</p>
          </div>
          <div class="card p-5 border-l-4 border-purple-500">
            <p class="text-sm text-slate-500 mb-1">Avg Response Time</p>
            <p class="text-2xl font-mono font-bold text-purple-400">142ms</p>
            <p class="text-xs text-slate-400">P95: 380ms</p>
          </div>
          <div class="card p-5 border-l-4 border-cyan-500">
            <p class="text-sm text-slate-500 mb-1">Active Webhooks</p>
            <p class="text-2xl font-mono font-bold text-cyan-400">8</p>
            <p class="text-xs text-slate-400">All healthy</p>
          </div>
        </div>

        <div class="grid grid-cols-3 gap-6">
          <!-- API Endpoints List -->
          <div class="col-span-2">
            <div class="card p-6">
              <h3 class="font-semibold text-slate-900 dark:text-white mb-4">API Endpoints</h3>

              <!-- Tab Navigation -->
              <div class="api-tab-nav">
                <button class="api-tab-btn active" onclick="switchApiTab('incentives')">Incentives</button>
                <button class="api-tab-btn" onclick="switchApiTab('projects')">Projects</button>
                <button class="api-tab-btn" onclick="switchApiTab('analysis')">Analysis</button>
                <!-- V34: Bulk Analysis Tab -->
                <button class="api-tab-btn" onclick="switchApiTab('bulk')">Bulk Analysis</button>
                <button class="api-tab-btn" onclick="switchApiTab('webhooks')">Webhooks</button>
              </div>

              <!-- Incentives Endpoints -->
              <div id="api-tab-incentives">
                <div class="api-endpoint" onclick="toggleApiEndpoint(this)">
                  <div class="api-endpoint-header">
                    <span class="api-method api-method-get">GET</span>
                    <span class="api-path">/v2/incentives</span>
                    <span class="flex-1 text-sm text-slate-500 ml-4">List all incentives for a location</span>
                    <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                  </div>
                  <div class="api-endpoint-body">
                    <p class="text-sm text-slate-400 mb-3">Returns available incentives based on property location, type, and characteristics.</p>
                    <h4 class="text-xs font-semibold text-slate-300 mb-2">Query Parameters</h4>
                    <div class="api-code-block mb-3">
<span class="key">address</span>: <span class="string">"125 Riverdale Ave, Yonkers, NY 10701"</span>
<span class="key">property_type</span>: <span class="string">"multifamily"</span>
<span class="key">units</span>: <span class="number">150</span>
<span class="key">sqft</span>: <span class="number">125000</span>
<span class="key">include_federal</span>: <span class="number">true</span>
<span class="key">include_state</span>: <span class="number">true</span>
<span class="key">include_local</span>: <span class="number">true</span></div>
                    <h4 class="text-xs font-semibold text-slate-300 mb-2">Response Example</h4>
                    <div class="api-code-block">
{
  <span class="key">"incentives"</span>: [
    {
      <span class="key">"id"</span>: <span class="string">"45l-2024"</span>,
      <span class="key">"name"</span>: <span class="string">"45L Energy Efficient Home Credit"</span>,
      <span class="key">"type"</span>: <span class="string">"federal_tax_credit"</span>,
      <span class="key">"estimated_value"</span>: <span class="number">750000</span>,
      <span class="key">"probability"</span>: <span class="number">0.89</span>,
      <span class="key">"requirements"</span>: [...]
    }
  ],
  <span class="key">"total_estimated"</span>: <span class="number">7200000</span>,
  <span class="key">"metadata"</span>: {...}
}</div>
                  </div>
                </div>

                <div class="api-endpoint" onclick="toggleApiEndpoint(this)">
                  <div class="api-endpoint-header">
                    <span class="api-method api-method-post">POST</span>
                    <span class="api-path">/v2/incentives/analyze</span>
                    <span class="flex-1 text-sm text-slate-500 ml-4">Run full incentive analysis</span>
                    <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                  </div>
                  <div class="api-endpoint-body">
                    <p class="text-sm text-slate-400 mb-3">Performs comprehensive incentive analysis with eligibility scoring.</p>
                    <h4 class="text-xs font-semibold text-slate-300 mb-2">Request Body</h4>
                    <div class="api-code-block">
{
  <span class="key">"project"</span>: {
    <span class="key">"address"</span>: <span class="string">"125 Riverdale Ave, Yonkers, NY"</span>,
    <span class="key">"property_type"</span>: <span class="string">"multifamily"</span>,
    <span class="key">"total_development_cost"</span>: <span class="number">48500000</span>,
    <span class="key">"units"</span>: <span class="number">150</span>,
    <span class="key">"affordable_units"</span>: <span class="number">30</span>,
    <span class="key">"energy_target"</span>: <span class="string">"energy_star"</span>
  }
}</div>
                  </div>
                </div>

                <div class="api-endpoint" onclick="toggleApiEndpoint(this)">
                  <div class="api-endpoint-header">
                    <span class="api-method api-method-get">GET</span>
                    <span class="api-path">/v2/incentives/{id}</span>
                    <span class="flex-1 text-sm text-slate-500 ml-4">Get incentive details</span>
                    <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                  </div>
                  <div class="api-endpoint-body">
                    <p class="text-sm text-slate-400">Returns detailed information about a specific incentive program including requirements, deadlines, and documentation.</p>
                  </div>
                </div>

                <!-- V34: Bulk Analysis API Endpoint -->
                <div class="api-endpoint" onclick="toggleApiEndpoint(this)">
                  <div class="api-endpoint-header">
                    <span class="api-method api-method-post">POST</span>
                    <span class="api-path">/v2/bulk/analyze</span>
                    <span class="flex-1 text-sm text-slate-500 ml-4">Bulk portfolio analysis (up to 100 projects)</span>
                    <span class="px-2 py-0.5 bg-blue-600 text-white text-xs rounded ml-2">NEW</span>
                    <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                  </div>
                  <div class="api-endpoint-body">
                    <p class="text-sm text-slate-400 mb-3">Analyze multiple projects in a single API call. Returns aggregated incentive data and portfolio-level metrics.</p>
                    <h4 class="text-xs font-semibold text-slate-300 mb-2">Request Body</h4>
                    <div class="api-code-block mb-3">
{
  <span class="key">"projects"</span>: [
    {
      <span class="key">"id"</span>: <span class="string">"proj-001"</span>,
      <span class="key">"address"</span>: <span class="string">"125 Riverdale Ave, Yonkers, NY"</span>,
      <span class="key">"property_type"</span>: <span class="string">"multifamily"</span>,
      <span class="key">"tdc"</span>: <span class="number">48500000</span>,
      <span class="key">"units"</span>: <span class="number">150</span>
    },
    // ... up to 100 projects
  ],
  <span class="key">"options"</span>: {
    <span class="key">"include_recommendations"</span>: <span class="number">true</span>,
    <span class="key">"parallel_processing"</span>: <span class="number">true</span>
  }
}</div>
                    <h4 class="text-xs font-semibold text-slate-300 mb-2">Response</h4>
                    <div class="api-code-block">
{
  <span class="key">"results"</span>: [...],
  <span class="key">"portfolio_summary"</span>: {
    <span class="key">"total_tdc"</span>: <span class="number">847200000</span>,
    <span class="key">"total_incentives"</span>: <span class="number">127400000</span>,
    <span class="key">"avg_subsidy_rate"</span>: <span class="number">0.15</span>
  },
  <span class="key">"processing_time_ms"</span>: <span class="number">4250</span>
}</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Sidebar: Authentication & Rate Limits -->
          <div class="space-y-6">
            <div class="card p-6">
              <h3 class="font-semibold text-slate-900 dark:text-white mb-4">Authentication</h3>
              <p class="text-sm text-slate-400 mb-4">Include your API key in the Authorization header:</p>
              <div class="api-code-block text-xs">
Authorization: Bearer ie_live_abc123...</div>
              <div class="mt-4 p-3 bg-yellow-900/20 border border-yellow-500/30 rounded-lg">
                <p class="text-xs text-yellow-400">Your API key is shown once. Store it securely.</p>
              </div>
            </div>

            <div class="card p-6">
              <h3 class="font-semibold text-slate-900 dark:text-white mb-4">Rate Limits</h3>
              <div class="api-rate-limit">
                <div class="api-rate-item">
                  <p class="api-rate-value text-blue-400">10K</p>
                  <p class="text-xs text-slate-500">Daily</p>
                </div>
                <div class="api-rate-item">
                  <p class="api-rate-value text-purple-400">100</p>
                  <p class="text-xs text-slate-500">Per minute</p>
                </div>
                <div class="api-rate-item">
                  <p class="api-rate-value text-green-400">10</p>
                  <p class="text-xs text-slate-500">Concurrent</p>
                </div>
              </div>
            </div>

            <div class="card p-6">
              <h3 class="font-semibold text-slate-900 dark:text-white mb-4">SDKs & Libraries</h3>
              <div class="space-y-2">
                <a href="#" class="flex items-center gap-3 p-3 bg-slate-800/50 rounded-lg hover:bg-slate-800 transition-colors">
                  <div class="w-8 h-8 rounded bg-yellow-500 flex items-center justify-center text-black font-bold text-xs">JS</div>
                  <div>
                    <p class="text-sm font-medium text-white">JavaScript SDK</p>
                    <p class="text-xs text-slate-400">npm install @incentedge/sdk</p>
                  </div>
                </a>
                <a href="#" class="flex items-center gap-3 p-3 bg-slate-800/50 rounded-lg hover:bg-slate-800 transition-colors">
                  <div class="w-8 h-8 rounded bg-blue-500 flex items-center justify-center text-white font-bold text-xs">PY</div>
                  <div>
                    <p class="text-sm font-medium text-white">Python SDK</p>
                    <p class="text-xs text-slate-400">pip install incentedge</p>
                  </div>
                </a>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- V31: ENERGY MODELING INTEGRATIONS -->
      <section id="section-energymodel" class="section-content hidden">
        <div class="section-header mb-6">
          <div>
            <h1 class="font-sora text-2xl font-bold text-slate-900 dark:text-white">Energy Modeling Integrations</h1>
            <p class="text-slate-500 dark:text-slate-400 mt-1">Connect EnergyPlus, eQUEST, and other modeling tools for automated 179D/45L calculations</p>
          </div>
          <div class="flex items-center gap-3">
            <span class="status-badge status-success">3 Models Connected</span>
          </div>
        </div>

        <!-- Integration Cards -->
        <div class="grid grid-cols-3 gap-6 mb-6">
          <div class="energy-model-card">
            <div class="flex items-center gap-4 mb-4">
              <div class="energy-model-logo bg-green-600 text-white">E+</div>
              <div>
                <h3 class="font-semibold text-white">EnergyPlus</h3>
                <p class="text-xs text-slate-400">v23.2 Supported</p>
              </div>
              <span class="ml-auto status-badge status-success">Connected</span>
            </div>
            <p class="text-sm text-slate-400 mb-4">Import .idf files directly for automated energy savings calculations and 179D certification prep.</p>
            <div class="flex gap-2">
              <button onclick="uploadEnergyModel('energyplus')" class="btn btn-primary text-xs flex-1">Upload Model</button>
              <button class="btn btn-secondary text-xs">Settings</button>
            </div>
          </div>

          <div class="energy-model-card">
            <div class="flex items-center gap-4 mb-4">
              <div class="energy-model-logo bg-blue-600 text-white">eQ</div>
              <div>
                <h3 class="font-semibold text-white">eQUEST</h3>
                <p class="text-xs text-slate-400">v3.65 Supported</p>
              </div>
              <span class="ml-auto status-badge status-success">Connected</span>
            </div>
            <p class="text-sm text-slate-400 mb-4">Import .inp/.sim files for DOE-2 based energy analysis and compliance verification.</p>
            <div class="flex gap-2">
              <button onclick="uploadEnergyModel('equest')" class="btn btn-primary text-xs flex-1">Upload Model</button>
              <button class="btn btn-secondary text-xs">Settings</button>
            </div>
          </div>

          <div class="energy-model-card">
            <div class="flex items-center gap-4 mb-4">
              <div class="energy-model-logo bg-purple-600 text-white">OS</div>
              <div>
                <h3 class="font-semibold text-white">OpenStudio</h3>
                <p class="text-xs text-slate-400">v3.7 Supported</p>
              </div>
              <span class="ml-auto status-badge status-info">Available</span>
            </div>
            <p class="text-sm text-slate-400 mb-4">Import .osm files with full measure analysis for comprehensive energy modeling workflows.</p>
            <div class="flex gap-2">
              <button onclick="connectEnergyModel('openstudio')" class="btn btn-secondary text-xs flex-1">Connect</button>
              <button class="btn btn-secondary text-xs">Learn More</button>
            </div>
          </div>
        </div>

        <!-- V34: ASHRAE Baseline Selector -->
        <div class="card p-6 mb-6 bg-gradient-to-r from-blue-900/20 to-slate-900/10 border-blue-700/30">
          <div class="flex items-center justify-between mb-4">
            <h3 class="font-semibold text-white flex items-center gap-2">
              <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
              ASHRAE Baseline Configuration
            </h3>
            <span class="text-xs text-slate-500">For 179D/45L certification</span>
          </div>
          <div class="grid grid-cols-4 gap-4 mb-4">
            <div>
              <label class="block text-xs text-slate-400 mb-1">ASHRAE Standard</label>
              <select class="form-input" id="ashrae-version" onchange="updateASHRAEBaseline()">
                <option value="90.1-2019">90.1-2019 (Current)</option>
                <option value="90.1-2022">90.1-2022 (Latest)</option>
                <option value="90.1-2016">90.1-2016</option>
                <option value="90.1-2013">90.1-2013</option>
                <option value="90.1-2010">90.1-2010</option>
                <option value="90.1-2007">90.1-2007</option>
              </select>
            </div>
            <div>
              <label class="block text-xs text-slate-400 mb-1">Climate Zone</label>
              <select class="form-input" id="ashrae-climate" onchange="updateASHRAEBaseline()">
                <option value="4A">4A (Mixed-Humid) - NY</option>
                <option value="5A">5A (Cool-Humid) - Upstate</option>
                <option value="3A">3A (Warm-Humid)</option>
                <option value="3C">3C (Warm-Marine)</option>
                <option value="2A">2A (Hot-Humid)</option>
              </select>
            </div>
            <div>
              <label class="block text-xs text-slate-400 mb-1">Building Type</label>
              <select class="form-input" id="ashrae-building" onchange="updateASHRAEBaseline()">
                <option value="multifamily">Multifamily (4+ stories)</option>
                <option value="lowrise">Lowrise Residential (1-3)</option>
                <option value="office">Office</option>
                <option value="retail">Retail</option>
                <option value="mixed">Mixed-Use</option>
              </select>
            </div>
            <div>
              <label class="block text-xs text-slate-400 mb-1">179D Reference Year</label>
              <select class="form-input" id="ashrae-ref-year">
                <option value="2024">2024 (IRS Notice 2024-30)</option>
                <option value="2023">2023 (IRS Notice 2023-56)</option>
              </select>
            </div>
          </div>
          <div class="grid grid-cols-4 gap-4 p-4 bg-slate-800/50 rounded-lg">
            <div class="text-center">
              <p class="text-xs text-slate-400 mb-1">Base Envelope</p>
              <p class="font-mono text-lg font-bold text-white" id="ashrae-envelope">U-0.064</p>
            </div>
            <div class="text-center">
              <p class="text-xs text-slate-400 mb-1">Lighting LPD</p>
              <p class="font-mono text-lg font-bold text-white" id="ashrae-lpd">0.75 W/sf</p>
            </div>
            <div class="text-center">
              <p class="text-xs text-slate-400 mb-1">HVAC Efficiency</p>
              <p class="font-mono text-lg font-bold text-white" id="ashrae-hvac">14 SEER</p>
            </div>
            <div class="text-center">
              <p class="text-xs text-slate-400 mb-1">179D Threshold</p>
              <p class="font-mono text-lg font-bold text-green-400" id="ashrae-threshold">25% Savings</p>
            </div>
          </div>
        </div>

        <!-- Model Upload Zone -->
        <div class="card p-6 mb-6">
          <h3 class="font-semibold text-slate-900 dark:text-white mb-4">Upload Energy Model</h3>
          <div class="energy-upload-zone" id="energy-upload-zone" ondrop="handleEnergyDrop(event)" ondragover="handleEnergyDragOver(event)" ondragleave="handleEnergyDragLeave(event)" onclick="document.getElementById('energy-file-input').click()">
            <input type="file" id="energy-file-input" class="hidden" accept=".idf,.inp,.sim,.osm,.gbxml" onchange="handleEnergyFileSelect(event)">
            <svg class="w-12 h-12 mx-auto text-slate-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/></svg>
            <p class="text-slate-300 font-medium mb-1">Drop your energy model here</p>
            <p class="text-sm text-slate-500">Supports .idf, .inp, .sim, .osm, .gbxml files</p>
          </div>
        </div>

        <!-- Recent Models -->
        <div class="card p-6">
          <h3 class="font-semibold text-slate-900 dark:text-white mb-4">Recent Energy Models</h3>
          <div class="overflow-x-auto">
            <table class="min-w-full">
              <thead>
                <tr class="border-b border-slate-700">
                  <th class="text-left text-xs font-medium text-slate-400 pb-3">Model</th>
                  <th class="text-left text-xs font-medium text-slate-400 pb-3">Project</th>
                  <th class="text-left text-xs font-medium text-slate-400 pb-3">Format</th>
                  <th class="text-right text-xs font-medium text-slate-400 pb-3">Energy Savings</th>
                  <th class="text-right text-xs font-medium text-slate-400 pb-3">179D Value</th>
                  <th class="text-left text-xs font-medium text-slate-400 pb-3">Status</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-slate-700/50">
                <tr>
                  <td class="py-3">
                    <p class="font-medium text-white">riverdale_125_v3.idf</p>
                    <p class="text-xs text-slate-500">Uploaded Jan 8, 2026</p>
                  </td>
                  <td class="text-sm text-slate-300">125 Riverdale Ave</td>
                  <td><span class="component-tag">EnergyPlus</span></td>
                  <td class="text-right font-mono text-green-400">42.8%</td>
                  <td class="text-right font-mono font-medium text-white">$312,500</td>
                  <td><span class="status-badge status-success">Certified</span></td>
                </tr>
                <tr>
                  <td class="py-3">
                    <p class="font-medium text-white">fulton_280_baseline.inp</p>
                    <p class="text-xs text-slate-500">Uploaded Jan 5, 2026</p>
                  </td>
                  <td class="text-sm text-slate-300">280 Fulton St</td>
                  <td><span class="component-tag">eQUEST</span></td>
                  <td class="text-right font-mono text-green-400">38.2%</td>
                  <td class="text-right font-mono font-medium text-white">$875,000</td>
                  <td><span class="status-badge status-info">In Review</span></td>
                </tr>
                <tr>
                  <td class="py-3">
                    <p class="font-medium text-white">canal_88_proposed.idf</p>
                    <p class="text-xs text-slate-500">Uploaded Jan 3, 2026</p>
                  </td>
                  <td class="text-sm text-slate-300">88 Canal St</td>
                  <td><span class="component-tag">EnergyPlus</span></td>
                  <td class="text-right font-mono text-yellow-400">25.1%</td>
                  <td class="text-right font-mono font-medium text-white">$537,500</td>
                  <td><span class="status-badge status-warning">Needs Update</span></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- V32: TRUST CENTER / DATA METHODOLOGY -->
      <section id="section-trustcenter" class="section-content hidden">
        <div class="section-header mb-6">
          <div>
            <h1 class="font-sora text-2xl font-bold text-slate-900 dark:text-white">Trust Center</h1>
            <p class="text-slate-500 dark:text-slate-400 mt-1">Data methodology, sources, and update schedules</p>
          </div>
          <div class="flex items-center gap-3">
            <span class="inline-flex items-center gap-1.5 px-3 py-1 bg-green-900/30 border border-green-600/30 rounded-full text-sm text-green-400">
              <span class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></span>
              All Systems Operational
            </span>
          </div>
        </div>

        <!-- Data Update Frequency Overview -->
        <div class="grid grid-cols-5 gap-4 mb-6">
          <div class="card p-4 text-center border-t-4 border-green-500">
            <p class="text-2xl font-bold text-green-400 mb-1">Real-time</p>
            <p class="text-xs text-slate-400">Market Rates</p>
          </div>
          <div class="card p-4 text-center border-t-4 border-blue-500">
            <p class="text-2xl font-bold text-blue-400 mb-1">Daily</p>
            <p class="text-xs text-slate-400">IRS Guidance</p>
          </div>
          <div class="card p-4 text-center border-t-4 border-purple-500">
            <p class="text-2xl font-bold text-purple-400 mb-1">Weekly</p>
            <p class="text-xs text-slate-400">State Programs</p>
          </div>
          <div class="card p-4 text-center border-t-4 border-amber-500">
            <p class="text-2xl font-bold text-amber-400 mb-1">Monthly</p>
            <p class="text-xs text-slate-400">QAP Updates</p>
          </div>
          <div class="card p-4 text-center border-t-4 border-teal-500">
            <p class="text-2xl font-bold text-teal-400 mb-1">Quarterly</p>
            <p class="text-xs text-slate-400">RS Means</p>
          </div>
        </div>

        <!-- Data Sources Grid -->
        <div class="grid grid-cols-2 gap-6 mb-6">
          <!-- Federal Data Sources -->
          <div class="card">
            <div class="p-4 border-b border-slate-700/50 bg-slate-800/50">
              <h3 class="font-semibold text-white flex items-center gap-2">
                <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 21v-4m0 0V5a2 2 0 012-2h6.5l1 1H21l-3 6 3 6h-8.5l-1-1H5a2 2 0 00-2 2zm9-13.5V9"/></svg>
                Federal Data Sources
              </h3>
            </div>
            <div class="p-4 space-y-3">
              <div class="flex items-center justify-between p-3 bg-slate-800/30 rounded-lg">
                <div>
                  <p class="font-medium text-white">IRS Notice Publications</p>
                  <p class="text-xs text-slate-400">45L, 179D, 48/48E rates & guidance</p>
                </div>
                <div class="text-right">
                  <span class="text-xs text-green-400">Updated Daily</span>
                  <p class="text-xs text-slate-500">Last: Jan 11, 2026</p>
                </div>
              </div>
              <div class="flex items-center justify-between p-3 bg-slate-800/30 rounded-lg">
                <div>
                  <p class="font-medium text-white">DOE Loan Programs Office</p>
                  <p class="text-xs text-slate-400">LPO program rates, terms, eligibility</p>
                </div>
                <div class="text-right">
                  <span class="text-xs text-blue-400">Updated Weekly</span>
                  <p class="text-xs text-slate-500">Last: Jan 8, 2026</p>
                </div>
              </div>
              <div class="flex items-center justify-between p-3 bg-slate-800/30 rounded-lg">
                <div>
                  <p class="font-medium text-white">Treasury Prevailing Wage</p>
                  <p class="text-xs text-slate-400">Davis-Bacon wage determinations</p>
                </div>
                <div class="text-right">
                  <span class="text-xs text-purple-400">Updated Weekly</span>
                  <p class="text-xs text-slate-500">Last: Jan 6, 2026</p>
                </div>
              </div>
              <div class="flex items-center justify-between p-3 bg-slate-800/30 rounded-lg">
                <div>
                  <p class="font-medium text-white">EPA Energy Community Data</p>
                  <p class="text-xs text-slate-400">Census tract designations</p>
                </div>
                <div class="text-right">
                  <span class="text-xs text-amber-400">Updated Annually</span>
                  <p class="text-xs text-slate-500">Last: Nov 2025</p>
                </div>
              </div>
            </div>
          </div>

          <!-- State & Local Data Sources -->
          <div class="card">
            <div class="p-4 border-b border-slate-700/50 bg-slate-800/50">
              <h3 class="font-semibold text-white flex items-center gap-2">
                <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/></svg>
                State & Local Data Sources
              </h3>
            </div>
            <div class="p-4 space-y-3">
              <div class="flex items-center justify-between p-3 bg-slate-800/30 rounded-lg">
                <div>
                  <p class="font-medium text-white">State HFA QAP Documents</p>
                  <p class="text-xs text-slate-400">50 states + DC + territories</p>
                </div>
                <div class="text-right">
                  <span class="text-xs text-amber-400">Updated Monthly</span>
                  <p class="text-xs text-slate-500">Last: Jan 3, 2026</p>
                </div>
              </div>
              <div class="flex items-center justify-between p-3 bg-slate-800/30 rounded-lg">
                <div>
                  <p class="font-medium text-white">NYSERDA Programs</p>
                  <p class="text-xs text-slate-400">PON rates, MBCP, REDC priorities</p>
                </div>
                <div class="text-right">
                  <span class="text-xs text-blue-400">Updated Weekly</span>
                  <p class="text-xs text-slate-500">Last: Jan 9, 2026</p>
                </div>
              </div>
              <div class="flex items-center justify-between p-3 bg-slate-800/30 rounded-lg">
                <div>
                  <p class="font-medium text-white">IDA/PILOT Databases</p>
                  <p class="text-xs text-slate-400">Local tax abatement programs</p>
                </div>
                <div class="text-right">
                  <span class="text-xs text-purple-400">Updated Weekly</span>
                  <p class="text-xs text-slate-500">Last: Jan 7, 2026</p>
                </div>
              </div>
              <div class="flex items-center justify-between p-3 bg-slate-800/30 rounded-lg">
                <div>
                  <p class="font-medium text-white">Utility Rebate Programs</p>
                  <p class="text-xs text-slate-400">Electric, gas, water utilities</p>
                </div>
                <div class="text-right">
                  <span class="text-xs text-green-400">Updated Weekly</span>
                  <p class="text-xs text-slate-500">Last: Jan 10, 2026</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Methodology Details -->
        <div class="card mb-6">
          <div class="p-4 border-b border-slate-700/50 bg-slate-800/50">
            <h3 class="font-semibold text-white">Data Methodology</h3>
            <p class="text-sm text-slate-400 mt-1">How we source, validate, and maintain incentive data</p>
          </div>
          <div class="p-6">
            <div class="grid grid-cols-3 gap-6">
              <div>
                <div class="w-10 h-10 rounded-lg bg-blue-600/20 flex items-center justify-center mb-3">
                  <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                </div>
                <h4 class="font-semibold text-white mb-2">1. Primary Source Collection</h4>
                <p class="text-sm text-slate-400">We pull directly from official government sources (IRS, Treasury, DOE, state agencies). No third-party aggregation.</p>
              </div>
              <div>
                <div class="w-10 h-10 rounded-lg bg-green-600/20 flex items-center justify-center mb-3">
                  <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                </div>
                <h4 class="font-semibold text-white mb-2">2. Multi-Layer Validation</h4>
                <p class="text-sm text-slate-400">Each data point is verified against 2+ sources. Tax credits cross-referenced with IRS Notices, state programs with official PONs.</p>
              </div>
              <div>
                <div class="w-10 h-10 rounded-lg bg-purple-600/20 flex items-center justify-center mb-3">
                  <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                </div>
                <h4 class="font-semibold text-white mb-2">3. Continuous Monitoring</h4>
                <p class="text-sm text-slate-400">Automated monitoring of Federal Register, IRS announcements, and state agency updates with human review.</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Citation Standards -->
        <div class="card">
          <div class="p-4 border-b border-slate-700/50 bg-slate-800/50">
            <h3 class="font-semibold text-white">Citation Standards</h3>
            <p class="text-sm text-slate-400 mt-1">Every calculation includes links to authoritative sources</p>
          </div>
          <div class="p-6">
            <div class="grid grid-cols-2 gap-6">
              <div class="space-y-3">
                <h4 class="font-medium text-white">Federal Tax Credits</h4>
                <ul class="text-sm text-slate-400 space-y-2">
                  <li class="flex items-start gap-2">
                    <span class="text-blue-400">•</span>
                    <span><strong>45L:</strong> IRC §45L, IRS Notice 2022-61 (prevailing wage), Notice 2023-29 (energy communities)</span>
                  </li>
                  <li class="flex items-start gap-2">
                    <span class="text-blue-400">•</span>
                    <span><strong>179D:</strong> IRC §179D, IRS Notice 2022-61, Notice 2023-56 (partial qualification)</span>
                  </li>
                  <li class="flex items-start gap-2">
                    <span class="text-blue-400">•</span>
                    <span><strong>48/48E:</strong> IRC §48, IRS Notice 2023-38 (domestic content), Notice 2024-30 (inflation)</span>
                  </li>
                </ul>
              </div>
              <div class="space-y-3">
                <h4 class="font-medium text-white">State & Local Programs</h4>
                <ul class="text-sm text-slate-400 space-y-2">
                  <li class="flex items-start gap-2">
                    <span class="text-green-400">•</span>
                    <span><strong>LIHTC QAPs:</strong> Direct links to each state HFA's current Qualified Allocation Plan</span>
                  </li>
                  <li class="flex items-start gap-2">
                    <span class="text-green-400">•</span>
                    <span><strong>NYSERDA:</strong> Current PON documents and program guidelines</span>
                  </li>
                  <li class="flex items-start gap-2">
                    <span class="text-green-400">•</span>
                    <span><strong>IDA/PILOT:</strong> Individual IDA websites with UTEP documents</span>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- V31: SOC 2 COMPLIANCE -->
      <section id="section-soc2" class="section-content hidden">
        <div class="section-header mb-6">
          <div>
            <h1 class="font-sora text-2xl font-bold text-slate-900 dark:text-white">SOC 2 Compliance & Security</h1>
            <p class="text-slate-500 dark:text-slate-400 mt-1">Enterprise-grade security controls and compliance certifications</p>
          </div>
          <div class="flex items-center gap-3">
            <span class="compliance-badge compliance-badge-passed">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
              SOC 2 Type II Certified
            </span>
            <button onclick="downloadComplianceReport()" class="btn btn-secondary text-sm">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
              Download Report
            </button>
          </div>
        </div>

        <!-- Compliance Overview -->
        <div class="grid grid-cols-4 gap-4 mb-6">
          <div class="card p-5 border-l-4 border-green-500">
            <p class="text-sm text-slate-500 mb-1">SOC 2 Type II</p>
            <p class="text-xl font-bold text-green-400">Certified</p>
            <p class="text-xs text-slate-400">Valid until Dec 2026</p>
          </div>
          <div class="card p-5 border-l-4 border-green-500">
            <p class="text-sm text-slate-500 mb-1">Data Encryption</p>
            <p class="text-xl font-bold text-green-400">AES-256</p>
            <p class="text-xs text-slate-400">At rest & in transit</p>
          </div>
          <div class="card p-5 border-l-4 border-blue-500">
            <p class="text-sm text-slate-500 mb-1">Uptime SLA</p>
            <p class="text-xl font-mono font-bold text-blue-400">99.95%</p>
            <p class="text-xs text-slate-400">Current: 99.98%</p>
          </div>
          <div class="card p-5 border-l-4 border-purple-500">
            <p class="text-sm text-slate-500 mb-1">Last Audit</p>
            <p class="text-xl font-bold text-purple-400">Dec 2025</p>
            <p class="text-xs text-slate-400">By Deloitte</p>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-6">
          <!-- Trust Service Criteria -->
          <div class="compliance-card">
            <div class="compliance-card-header">
              <h3 class="font-semibold text-white">Trust Service Criteria</h3>
              <p class="text-sm text-blue-200 mt-1">SOC 2 Type II audit results</p>
            </div>
            <div class="compliance-checklist">
              <div class="compliance-item">
                <div class="compliance-check compliance-check-pass">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                </div>
                <div class="flex-1">
                  <p class="text-sm font-medium text-white">Security</p>
                  <p class="text-xs text-slate-400">Protection against unauthorized access</p>
                </div>
                <span class="compliance-badge compliance-badge-passed">Passed</span>
              </div>
              <div class="compliance-item">
                <div class="compliance-check compliance-check-pass">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                </div>
                <div class="flex-1">
                  <p class="text-sm font-medium text-white">Availability</p>
                  <p class="text-xs text-slate-400">System availability per SLA commitments</p>
                </div>
                <span class="compliance-badge compliance-badge-passed">Passed</span>
              </div>
              <div class="compliance-item">
                <div class="compliance-check compliance-check-pass">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                </div>
                <div class="flex-1">
                  <p class="text-sm font-medium text-white">Processing Integrity</p>
                  <p class="text-xs text-slate-400">Complete, accurate, timely processing</p>
                </div>
                <span class="compliance-badge compliance-badge-passed">Passed</span>
              </div>
              <div class="compliance-item">
                <div class="compliance-check compliance-check-pass">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                </div>
                <div class="flex-1">
                  <p class="text-sm font-medium text-white">Confidentiality</p>
                  <p class="text-xs text-slate-400">Protection of confidential information</p>
                </div>
                <span class="compliance-badge compliance-badge-passed">Passed</span>
              </div>
              <div class="compliance-item">
                <div class="compliance-check compliance-check-pass">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                </div>
                <div class="flex-1">
                  <p class="text-sm font-medium text-white">Privacy</p>
                  <p class="text-xs text-slate-400">Personal information handling</p>
                </div>
                <span class="compliance-badge compliance-badge-passed">Passed</span>
              </div>
            </div>
          </div>

          <!-- Security Features -->
          <div class="space-y-6">
            <div class="card p-6">
              <h3 class="font-semibold text-slate-900 dark:text-white mb-4">Security Features</h3>
              <div class="space-y-3">
                <div class="flex items-center gap-3 p-3 bg-slate-800/50 rounded-lg">
                  <div class="w-10 h-10 rounded-lg bg-green-600/20 flex items-center justify-center">
                    <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
                  </div>
                  <div>
                    <p class="text-sm font-medium text-white">SSO & MFA</p>
                    <p class="text-xs text-slate-400">SAML 2.0, Okta, Azure AD integration</p>
                  </div>
                </div>
                <div class="flex items-center gap-3 p-3 bg-slate-800/50 rounded-lg">
                  <div class="w-10 h-10 rounded-lg bg-blue-600/20 flex items-center justify-center">
                    <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                  </div>
                  <div>
                    <p class="text-sm font-medium text-white">Audit Logging</p>
                    <p class="text-xs text-slate-400">Complete audit trail, 7-year retention</p>
                  </div>
                </div>
                <div class="flex items-center gap-3 p-3 bg-slate-800/50 rounded-lg">
                  <div class="w-10 h-10 rounded-lg bg-purple-600/20 flex items-center justify-center">
                    <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"/></svg>
                  </div>
                  <div>
                    <p class="text-sm font-medium text-white">Data Residency</p>
                    <p class="text-xs text-slate-400">US-only data centers (AWS us-east-1)</p>
                  </div>
                </div>
              </div>
            </div>

            <div class="card p-6">
              <h3 class="font-semibold text-slate-900 dark:text-white mb-4">Compliance Documents</h3>
              <div class="space-y-2">
                <a href="#" class="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg hover:bg-slate-800 transition-colors">
                  <div class="flex items-center gap-3">
                    <svg class="w-5 h-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>
                    <span class="text-sm text-white">SOC 2 Type II Report</span>
                  </div>
                  <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                </a>
                <a href="#" class="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg hover:bg-slate-800 transition-colors">
                  <div class="flex items-center gap-3">
                    <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>
                    <span class="text-sm text-white">Security Whitepaper</span>
                  </div>
                  <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                </a>
                <a href="#" class="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg hover:bg-slate-800 transition-colors">
                  <div class="flex items-center gap-3">
                    <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>
                    <span class="text-sm text-white">Penetration Test Summary</span>
                  </div>
                  <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                </a>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- V31: COMPONENT DOCUMENTATION -->
      <section id="section-components" class="section-content hidden">
        <div class="section-header mb-6">
          <div>
            <h1 class="font-sora text-2xl font-bold text-slate-900 dark:text-white">Component Library</h1>
            <p class="text-slate-500 dark:text-slate-400 mt-1">Reusable UI components and design system documentation</p>
          </div>
          <div class="flex items-center gap-3">
            <span class="status-badge status-info">48 Components</span>
            <button onclick="openStorybook()" class="btn btn-secondary text-sm">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg>
              Open Storybook
            </button>
          </div>
        </div>

        <!-- Component Categories -->
        <div class="grid grid-cols-4 gap-4 mb-6">
          <button class="portfolio-filter-btn active" onclick="filterComponents('all')">All (48)</button>
          <button class="portfolio-filter-btn" onclick="filterComponents('forms')">Forms (12)</button>
          <button class="portfolio-filter-btn" onclick="filterComponents('data')">Data Display (18)</button>
          <button class="portfolio-filter-btn" onclick="filterComponents('navigation')">Navigation (8)</button>
        </div>

        <!-- Component Grid -->
        <div class="grid grid-cols-4 gap-4">
          <!-- Button Component -->
          <div class="component-card">
            <div class="component-preview">
              <div class="flex gap-2">
                <button class="btn btn-primary text-xs">Primary</button>
                <button class="btn btn-secondary text-xs">Secondary</button>
              </div>
            </div>
            <div class="component-info">
              <h4 class="font-semibold text-white text-sm mb-1">Button</h4>
              <p class="text-xs text-slate-400 mb-2">Primary action triggers</p>
              <div class="flex gap-1">
                <span class="component-tag">forms</span>
                <span class="component-tag">interactive</span>
              </div>
            </div>
          </div>

          <!-- Card Component -->
          <div class="component-card">
            <div class="component-preview">
              <div class="card p-3 w-full">
                <div class="h-8 bg-slate-700/50 rounded mb-2"></div>
                <div class="h-3 bg-slate-700/30 rounded w-3/4"></div>
              </div>
            </div>
            <div class="component-info">
              <h4 class="font-semibold text-white text-sm mb-1">Card</h4>
              <p class="text-xs text-slate-400 mb-2">Content container with border</p>
              <div class="flex gap-1">
                <span class="component-tag">layout</span>
                <span class="component-tag">container</span>
              </div>
            </div>
          </div>

          <!-- Status Badge Component -->
          <div class="component-card">
            <div class="component-preview">
              <div class="flex flex-col gap-2">
                <span class="status-badge status-success">Success</span>
                <span class="status-badge status-info">Info</span>
                <span class="status-badge status-warning">Warning</span>
              </div>
            </div>
            <div class="component-info">
              <h4 class="font-semibold text-white text-sm mb-1">Status Badge</h4>
              <p class="text-xs text-slate-400 mb-2">State indicators</p>
              <div class="flex gap-1">
                <span class="component-tag">data</span>
                <span class="component-tag">status</span>
              </div>
            </div>
          </div>

          <!-- Form Input Component -->
          <div class="component-card">
            <div class="component-preview">
              <input type="text" class="form-input text-xs w-full" placeholder="Enter value...">
            </div>
            <div class="component-info">
              <h4 class="font-semibold text-white text-sm mb-1">Text Input</h4>
              <p class="text-xs text-slate-400 mb-2">Single-line text entry</p>
              <div class="flex gap-1">
                <span class="component-tag">forms</span>
                <span class="component-tag">input</span>
              </div>
            </div>
          </div>

          <!-- Progress Bar Component -->
          <div class="component-card">
            <div class="component-preview w-full px-4">
              <div class="w-full h-2 bg-slate-700 rounded-full">
                <div class="h-2 bg-blue-500 rounded-full" style="width: 65%"></div>
              </div>
            </div>
            <div class="component-info">
              <h4 class="font-semibold text-white text-sm mb-1">Progress Bar</h4>
              <p class="text-xs text-slate-400 mb-2">Visual progress indicator</p>
              <div class="flex gap-1">
                <span class="component-tag">data</span>
                <span class="component-tag">feedback</span>
              </div>
            </div>
          </div>

          <!-- Toast Component -->
          <div class="component-card">
            <div class="component-preview">
              <div class="p-2 bg-green-900/30 border border-green-500/30 rounded-lg text-xs text-green-400">
                Success message
              </div>
            </div>
            <div class="component-info">
              <h4 class="font-semibold text-white text-sm mb-1">Toast</h4>
              <p class="text-xs text-slate-400 mb-2">Notification messages</p>
              <div class="flex gap-1">
                <span class="component-tag">feedback</span>
                <span class="component-tag">notification</span>
              </div>
            </div>
          </div>

          <!-- Table Component -->
          <div class="component-card">
            <div class="component-preview px-2">
              <table class="w-full text-xs">
                <tr class="border-b border-slate-700"><td class="py-1 text-slate-400">Header</td><td class="text-right text-white">Value</td></tr>
                <tr><td class="py-1 text-slate-400">Row</td><td class="text-right text-white">Data</td></tr>
              </table>
            </div>
            <div class="component-info">
              <h4 class="font-semibold text-white text-sm mb-1">Data Table</h4>
              <p class="text-xs text-slate-400 mb-2">Tabular data display</p>
              <div class="flex gap-1">
                <span class="component-tag">data</span>
                <span class="component-tag">table</span>
              </div>
            </div>
          </div>

          <!-- Modal Component -->
          <div class="component-card">
            <div class="component-preview">
              <div class="p-3 bg-slate-800 border border-slate-600 rounded-lg shadow-xl w-full">
                <div class="h-3 bg-slate-700 rounded w-3/4 mb-2"></div>
                <div class="h-2 bg-slate-700/50 rounded w-full"></div>
              </div>
            </div>
            <div class="component-info">
              <h4 class="font-semibold text-white text-sm mb-1">Modal</h4>
              <p class="text-xs text-slate-400 mb-2">Overlay dialog windows</p>
              <div class="flex gap-1">
                <span class="component-tag">overlay</span>
                <span class="component-tag">dialog</span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- IRA COMPLIANCE NAVIGATOR SECTION -->
      <section id="section-compliance" class="section-content hidden">
        <div class="section-header mb-6">
          <div>
            <h1 class="font-sora text-2xl font-bold text-slate-900 dark:text-white">IRA Compliance Navigator</h1>
            <p class="text-slate-500 dark:text-slate-400 mt-1">Ensure maximum credit value with prevailing wage and domestic content compliance</p>
          </div>
          <div class="flex items-center gap-3">
            <span class="status-badge status-success">IRA 2024 Updated</span>
            <button onclick="exportComplianceReport()" class="btn btn-secondary text-sm">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
              Export Report
            </button>
          </div>
        </div>

        <!-- Compliance Overview Cards -->
        <div class="grid grid-cols-4 gap-4 mb-6">
          <div class="card p-5 border-l-4 border-blue-500">
            <p class="text-sm text-slate-500 mb-1">Base Credit Available</p>
            <p class="text-2xl font-mono font-bold text-slate-900 dark:text-white">$3.2M</p>
            <p class="text-xs text-slate-400">Without bonus adders</p>
          </div>
          <div class="card p-5 border-l-4 border-blue-500">
            <p class="text-sm text-slate-500 mb-1">With Full Compliance</p>
            <p class="text-2xl font-mono font-bold text-blue-700">$16.0M</p>
            <p class="text-xs text-blue-700 font-medium">5x multiplier unlocked</p>
          </div>
          <div class="card p-5 border-l-4 border-cyan-500">
            <p class="text-sm text-slate-500 mb-1">Prevailing Wage Status</p>
            <p class="text-2xl font-bold text-blue-600">Pending</p>
            <p class="text-xs text-slate-400">Complete wizard below</p>
          </div>
          <div class="card p-5 border-l-4 border-blue-500">
            <p class="text-sm text-slate-500 mb-1">Domestic Content</p>
            <p class="text-2xl font-bold text-blue-700">42%</p>
            <p class="text-xs text-slate-400">Target: 40% (Met)</p>
          </div>
        </div>

        <div class="grid grid-cols-3 gap-6">
          <!-- Main Wizard Panel -->
          <div class="col-span-2 space-y-6">
            <!-- Prevailing Wage Calculator -->
            <div class="card overflow-hidden">
              <div class="px-6 py-4 border-b border-slate-200 dark:border-slate-700/30 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20">
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center">
                      <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
                    </div>
                    <div>
                      <h2 class="font-semibold text-blue-800 dark:text-blue-200">Prevailing Wage Calculator</h2>
                      <p class="text-sm text-blue-600 dark:text-blue-400">IRS Notice 2022-61 Compliance</p>
                    </div>
                  </div>
                  <span class="px-3 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded-full">5x Multiplier</span>
                </div>
              </div>
              <div class="p-6">
                <div class="grid grid-cols-2 gap-6 mb-6">
                  <div>
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Project Location</label>
                    <select class="form-input w-full" id="pw-location" onchange="calculatePrevailingWage()">
                      <option value="">Select County</option>
                      <option value="westchester" selected>Westchester County, NY</option>
                      <option value="bronx">Bronx County, NY</option>
                      <option value="newark">Essex County, NJ</option>
                      <option value="fairfield">Fairfield County, CT</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Construction Type</label>
                    <select class="form-input w-full" id="pw-type" onchange="calculatePrevailingWage()">
                      <option value="residential">Residential (Building)</option>
                      <option value="heavy">Heavy Construction</option>
                      <option value="highway">Highway/Infrastructure</option>
                    </select>
                  </div>
                </div>

                <!-- Trade Classifications -->
                <div class="mb-6">
                  <div class="flex items-center justify-between mb-3">
                    <h3 class="font-medium text-slate-700 dark:text-slate-300">Trade Classifications</h3>
                    <button class="text-sm text-blue-600 hover:text-blue-700" onclick="addTrade()">+ Add Trade</button>
                  </div>
                  <div class="space-y-3" id="trade-list">
                    <div class="flex items-center gap-4 p-3 bg-slate-50 dark:bg-slate-800/20 rounded-lg">
                      <span class="w-8 h-8 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center text-blue-600 text-sm font-bold">1</span>
                      <div class="flex-1 grid grid-cols-4 gap-4">
                        <div><p class="text-xs text-slate-500">Trade</p><p class="font-medium text-slate-900 dark:text-white">Electrician</p></div>
                        <div><p class="text-xs text-slate-500">DOL Rate</p><p class="font-mono font-medium text-slate-900 dark:text-white">$78.50/hr</p></div>
                        <div><p class="text-xs text-slate-500">Your Rate</p><p class="font-mono font-medium text-blue-700">$82.00/hr</p></div>
                        <div><p class="text-xs text-slate-500">Status</p><span class="status-badge status-success">Compliant</span></div>
                      </div>
                    </div>
                    <div class="flex items-center gap-4 p-3 bg-slate-50 dark:bg-slate-800/20 rounded-lg">
                      <span class="w-8 h-8 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center text-blue-600 text-sm font-bold">2</span>
                      <div class="flex-1 grid grid-cols-4 gap-4">
                        <div><p class="text-xs text-slate-500">Trade</p><p class="font-medium text-slate-900 dark:text-white">Plumber</p></div>
                        <div><p class="text-xs text-slate-500">DOL Rate</p><p class="font-mono font-medium text-slate-900 dark:text-white">$72.25/hr</p></div>
                        <div><p class="text-xs text-slate-500">Your Rate</p><p class="font-mono font-medium text-blue-700">$75.00/hr</p></div>
                        <div><p class="text-xs text-slate-500">Status</p><span class="status-badge status-success">Compliant</span></div>
                      </div>
                    </div>
                    <div class="flex items-center gap-4 p-3 bg-slate-50 dark:bg-slate-800/20 rounded-lg">
                      <span class="w-8 h-8 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center text-blue-600 text-sm font-bold">3</span>
                      <div class="flex-1 grid grid-cols-4 gap-4">
                        <div><p class="text-xs text-slate-500">Trade</p><p class="font-medium text-slate-900 dark:text-white">HVAC Tech</p></div>
                        <div><p class="text-xs text-slate-500">DOL Rate</p><p class="font-mono font-medium text-slate-900 dark:text-white">$68.75/hr</p></div>
                        <div><p class="text-xs text-slate-500">Your Rate</p><p class="font-mono font-medium text-blue-600">$65.00/hr</p></div>
                        <div><p class="text-xs text-slate-500">Status</p><span class="status-badge status-warning">Below Rate</span></div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Apprenticeship Requirements -->
                <div class="p-4 border border-slate-200 dark:border-slate-700/30 rounded-lg mb-6">
                  <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-2">
                      <svg class="w-5 h-5 text-blue-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"/></svg>
                      <h3 class="font-medium text-slate-700 dark:text-slate-300">Apprenticeship Requirement</h3>
                    </div>
                    <span class="text-sm text-slate-500">12.5% of labor hours (2024)</span>
                  </div>
                  <div class="grid grid-cols-3 gap-4">
                    <div>
                      <p class="text-xs text-slate-500 mb-1">Total Labor Hours</p>
                      <input type="text" class="form-input w-full font-mono" value="45,000" id="total-hours">
                    </div>
                    <div>
                      <p class="text-xs text-slate-500 mb-1">Required Apprentice Hours</p>
                      <p class="form-input w-full font-mono bg-slate-100 dark:bg-slate-800/30" id="req-apprentice">5,625</p>
                    </div>
                    <div>
                      <p class="text-xs text-slate-500 mb-1">Planned Apprentice Hours</p>
                      <input type="text" class="form-input w-full font-mono border-blue-500" value="6,200" id="plan-apprentice">
                    </div>
                  </div>
                  <div class="mt-3 flex items-center gap-2">
                    <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                    <span class="text-sm text-blue-700">13.8% apprentice hours planned - exceeds 12.5% requirement</span>
                  </div>
                </div>

                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-2">
                    <span class="w-3 h-3 rounded-full bg-blue-500"></span>
                    <span class="text-sm text-slate-600 dark:text-slate-400">2 of 3 trades compliant</span>
                  </div>
                  <button onclick="generatePWReport()" class="btn btn-primary">
                    Generate Compliance Report
                  </button>
                </div>
              </div>
            </div>

            <!-- Domestic Content Calculator -->
            <div class="card overflow-hidden">
              <div class="px-6 py-4 border-b border-slate-200 dark:border-slate-700/30 bg-gradient-to-r from-blue-50 to-slate-50 dark:from-blue-900/20 dark:to-slate-900/20">
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center">
                      <svg class="w-5 h-5 text-blue-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 21v-4m0 0V5a2 2 0 012-2h6.5l1 1H21l-3 6 3 6h-8.5l-1-1H5a2 2 0 00-2 2zm9-13.5V9"/></svg>
                    </div>
                    <div>
                      <h2 class="font-semibold text-blue-900 dark:text-blue-200">Domestic Content Calculator</h2>
                      <p class="text-sm text-blue-700 dark:text-blue-400">IRS Notice 2023-38 Requirements</p>
                    </div>
                  </div>
                  <span class="px-3 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded-full">+10% Bonus</span>
                </div>
              </div>
              <div class="p-6">
                <div class="mb-6">
                  <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-medium text-slate-700 dark:text-slate-300">Domestic Content Progress</span>
                    <span class="text-sm font-mono font-bold text-blue-700">42% of 40% target</span>
                  </div>
                  <div class="h-4 bg-slate-200 dark:bg-slate-800/30 rounded-full overflow-hidden">
                    <div class="h-full bg-gradient-to-r from-blue-500 to-blue-700 rounded-full transition-all" style="width: 100%;"></div>
                  </div>
                  <p class="text-xs text-blue-700 mt-1">Target met - eligible for 10% domestic content bonus</p>
                </div>

                <!-- Component Breakdown -->
                <div class="space-y-3 mb-6">
                  <div class="flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800/20 rounded-lg">
                    <div class="flex items-center gap-3">
                      <span class="w-8 h-8 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center">
                        <svg class="w-4 h-4 text-blue-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                      </span>
                      <div>
                        <p class="font-medium text-slate-900 dark:text-white">Steel Components</p>
                        <p class="text-xs text-slate-500">Structural, framing, fasteners</p>
                      </div>
                    </div>
                    <div class="text-right">
                      <p class="font-mono font-bold text-blue-700">100% US</p>
                      <p class="text-xs text-slate-500">$2.4M value</p>
                    </div>
                  </div>
                  <div class="flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800/20 rounded-lg">
                    <div class="flex items-center gap-3">
                      <span class="w-8 h-8 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center">
                        <svg class="w-4 h-4 text-blue-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                      </span>
                      <div>
                        <p class="font-medium text-slate-900 dark:text-white">Solar Panels</p>
                        <p class="text-xs text-slate-500">First Solar (US manufactured)</p>
                      </div>
                    </div>
                    <div class="text-right">
                      <p class="font-mono font-bold text-blue-700">100% US</p>
                      <p class="text-xs text-slate-500">$1.8M value</p>
                    </div>
                  </div>
                  <div class="flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800/20 rounded-lg">
                    <div class="flex items-center gap-3">
                      <span class="w-8 h-8 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center">
                        <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
                      </span>
                      <div>
                        <p class="font-medium text-slate-900 dark:text-white">HVAC Equipment</p>
                        <p class="text-xs text-slate-500">Heat pumps, VRF systems</p>
                      </div>
                    </div>
                    <div class="text-right">
                      <p class="font-mono font-bold text-blue-600">65% US</p>
                      <p class="text-xs text-slate-500">$1.2M value</p>
                    </div>
                  </div>
                  <div class="flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800/20 rounded-lg">
                    <div class="flex items-center gap-3">
                      <span class="w-8 h-8 bg-red-100 dark:bg-red-900/30 rounded-lg flex items-center justify-center">
                        <svg class="w-4 h-4 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                      </span>
                      <div>
                        <p class="font-medium text-slate-900 dark:text-white">Battery Storage</p>
                        <p class="text-xs text-slate-500">Tesla Powerwall (imported cells)</p>
                      </div>
                    </div>
                    <div class="text-right">
                      <p class="font-mono font-bold text-red-600">0% US</p>
                      <p class="text-xs text-slate-500">$0.8M value</p>
                    </div>
                  </div>
                </div>

                <div class="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800/30">
                  <div class="flex items-start gap-3">
                    <svg class="w-5 h-5 text-blue-700 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                    <div>
                      <p class="font-medium text-blue-900 dark:text-blue-200 mb-1">Optimization Recommendation</p>
                      <p class="text-sm text-blue-800 dark:text-blue-300">Consider switching battery storage to Enphase IQ (US manufactured) to increase domestic content to 58% and ensure compliance margin.</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Compliance Sidebar -->
          <div class="space-y-4">
            <!-- Credit Value Summary -->
            <div class="card p-5 bg-gradient-to-br from-blue-50 to-slate-50 dark:from-blue-900/20 dark:to-slate-900/20 border-blue-200 dark:border-blue-800">
              <h3 class="font-semibold text-blue-800 dark:text-blue-200 mb-4">Credit Value Summary</h3>
              <div class="space-y-3">
                <div class="flex justify-between items-center">
                  <span class="text-sm text-slate-600 dark:text-slate-400">Base 179D Credit</span>
                  <span class="font-mono font-medium">$3.2M</span>
                </div>
                <div class="flex justify-between items-center text-blue-700">
                  <span class="text-sm">+ Prevailing Wage (5x)</span>
                  <span class="font-mono font-medium">+$12.8M</span>
                </div>
                <div class="flex justify-between items-center text-blue-700">
                  <span class="text-sm">+ Domestic Content (10%)</span>
                  <span class="font-mono font-medium">+$1.6M</span>
                </div>
                <div class="border-t border-blue-200 dark:border-blue-800 pt-3 mt-3">
                  <div class="flex justify-between items-center">
                    <span class="font-semibold text-blue-800 dark:text-blue-200">Total Credit Value</span>
                    <span class="font-mono text-xl font-bold text-blue-700">$17.6M</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Compliance Checklist -->
            <div class="card p-5">
              <h3 class="font-semibold text-slate-900 dark:text-white mb-4">Compliance Checklist</h3>
              <div class="space-y-3">
                <label class="flex items-start gap-3 cursor-pointer">
                  <input type="checkbox" class="mt-1" checked>
                  <div>
                    <p class="text-sm font-medium text-slate-700 dark:text-slate-300">Form 7205 Prepared</p>
                    <p class="text-xs text-slate-500">Energy efficiency certification</p>
                  </div>
                </label>
                <label class="flex items-start gap-3 cursor-pointer">
                  <input type="checkbox" class="mt-1" checked>
                  <div>
                    <p class="text-sm font-medium text-slate-700 dark:text-slate-300">DOL Wage Determination</p>
                    <p class="text-xs text-slate-500">County-specific rates filed</p>
                  </div>
                </label>
                <label class="flex items-start gap-3 cursor-pointer">
                  <input type="checkbox" class="mt-1">
                  <div>
                    <p class="text-sm font-medium text-slate-700 dark:text-slate-300">Certified Payroll Records</p>
                    <p class="text-xs text-slate-500">Weekly submissions required</p>
                  </div>
                </label>
                <label class="flex items-start gap-3 cursor-pointer">
                  <input type="checkbox" class="mt-1">
                  <div>
                    <p class="text-sm font-medium text-slate-700 dark:text-slate-300">Apprenticeship Documentation</p>
                    <p class="text-xs text-slate-500">Registered program verification</p>
                  </div>
                </label>
                <label class="flex items-start gap-3 cursor-pointer">
                  <input type="checkbox" class="mt-1" checked>
                  <div>
                    <p class="text-sm font-medium text-slate-700 dark:text-slate-300">Domestic Content Attestation</p>
                    <p class="text-xs text-slate-500">Manufacturer certifications</p>
                  </div>
                </label>
              </div>
            </div>

            <!-- Deadline Alert -->
            <div class="card p-5 border-amber-300 bg-amber-50 dark:bg-amber-900/20">
              <div class="flex items-start gap-3">
                <svg class="w-5 h-5 text-blue-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                <div>
                  <p class="font-semibold text-amber-800 dark:text-amber-200 mb-1">Deadline Alert</p>
                  <p class="text-sm text-blue-700 dark:text-amber-300">Construction start required within 60 days to lock 2024 prevailing wage rates</p>
                  <p class="text-xs text-blue-600 mt-2 font-mono">Due: March 15, 2026</p>
                </div>
              </div>
            </div>

            <!-- Quick Actions -->
            <button class="btn btn-primary w-full" onclick="showToast('success', 'Compliance Check', 'All requirements verified')">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
              Run Full Compliance Check
            </button>
          </div>
        </div>
      </section>

      <!-- DOCUMENT GENERATOR SECTION -->
      <section id="section-documents" class="section-content hidden">
        <div class="section-header mb-6">
          <div>
            <h1 class="font-sora text-2xl font-bold text-slate-900 dark:text-white">Document Generator</h1>
            <p class="text-slate-500 dark:text-slate-400 mt-1">Auto-generate compliance documents, applications, and reports</p>
          </div>
          <div class="flex items-center gap-3">
            <span class="px-3 py-1.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 text-xs font-medium rounded-lg">
              <svg class="w-3 h-3 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
              AI-Powered
            </span>
          </div>
        </div>

        <div class="grid grid-cols-3 gap-6">
          <!-- Document Templates -->
          <div class="col-span-2 space-y-6">
            <!-- Application Documents -->
            <div class="card overflow-hidden">
              <div class="px-6 py-4 border-b border-slate-200 dark:border-slate-700/30">
                <h2 class="section-title">Application Documents</h2>
                <p class="text-sm text-slate-500 mt-1">Pre-filled templates for incentive applications</p>
              </div>
              <div class="p-6 grid grid-cols-2 gap-4">
                <div class="doc-template p-4 border border-slate-200 dark:border-slate-700/30 rounded-xl hover:border-blue-500 hover:bg-blue-50/50 dark:hover:bg-slate-800/20 cursor-pointer transition-all" onclick="generateDocument('lihtc-app')">
                  <div class="flex items-start gap-3">
                    <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center flex-shrink-0">
                      <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                    </div>
                    <div class="flex-1">
                      <p class="font-semibold text-slate-900 dark:text-white">LIHTC Application Package</p>
                      <p class="text-xs text-slate-500 mt-1">Complete 4% credit application with exhibits</p>
                      <div class="flex items-center gap-2 mt-2">
                        <span class="text-xs text-blue-600 font-medium">12 pages</span>
                        <span class="text-xs text-slate-400">PDF + DOCX</span>
                      </div>
                    </div>
                  </div>
                  <div class="mt-3 flex items-center gap-2">
                    <span class="px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded">Auto-fill ready</span>
                    <span class="px-2 py-0.5 bg-slate-100 text-slate-600 text-xs rounded">85% complete</span>
                  </div>
                </div>

                <div class="doc-template p-4 border border-slate-200 dark:border-slate-700/30 rounded-xl hover:border-blue-500 hover:bg-blue-50/50 dark:hover:bg-slate-800/20 cursor-pointer transition-all" onclick="generateDocument('nyserda-app')">
                  <div class="flex items-start gap-3">
                    <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center flex-shrink-0">
                      <svg class="w-6 h-6 text-blue-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                    </div>
                    <div class="flex-1">
                      <p class="font-semibold text-slate-900 dark:text-white">NYSERDA Pre-Construction</p>
                      <p class="text-xs text-slate-500 mt-1">New construction program enrollment form</p>
                      <div class="flex items-center gap-2 mt-2">
                        <span class="text-xs text-blue-700 font-medium">8 pages</span>
                        <span class="text-xs text-slate-400">PDF</span>
                      </div>
                    </div>
                  </div>
                  <div class="mt-3 flex items-center gap-2">
                    <span class="px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded">Auto-fill ready</span>
                    <span class="px-2 py-0.5 bg-slate-100 text-slate-600 text-xs rounded">70% complete</span>
                  </div>
                </div>

                <div class="doc-template p-4 border border-slate-200 dark:border-slate-700/30 rounded-xl hover:border-blue-500 hover:bg-blue-50/50 dark:hover:bg-slate-800/20 cursor-pointer transition-all" onclick="generateDocument('ida-app')">
                  <div class="flex items-start gap-3">
                    <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center flex-shrink-0">
                      <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                    </div>
                    <div class="flex-1">
                      <p class="font-semibold text-slate-900 dark:text-white">IDA PILOT Application</p>
                      <p class="text-xs text-slate-500 mt-1">Westchester County economic benefits form</p>
                      <div class="flex items-center gap-2 mt-2">
                        <span class="text-xs text-blue-600 font-medium">15 pages</span>
                        <span class="text-xs text-slate-400">PDF + Excel</span>
                      </div>
                    </div>
                  </div>
                  <div class="mt-3 flex items-center gap-2">
                    <span class="px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded">Auto-fill ready</span>
                    <span class="px-2 py-0.5 bg-slate-100 text-slate-600 text-xs rounded">60% complete</span>
                  </div>
                </div>

                <div class="doc-template p-4 border border-slate-200 dark:border-slate-700/30 rounded-xl hover:border-blue-500 hover:bg-blue-50/50 dark:hover:bg-slate-800/20 cursor-pointer transition-all" onclick="generateDocument('179d-cert')">
                  <div class="flex items-start gap-3">
                    <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center flex-shrink-0">
                      <svg class="w-6 h-6 text-blue-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                    </div>
                    <div class="flex-1">
                      <p class="font-semibold text-slate-900 dark:text-white">179D Certification Package</p>
                      <p class="text-xs text-slate-500 mt-1">IRS Form 7205 + supporting documentation</p>
                      <div class="flex items-center gap-2 mt-2">
                        <span class="text-xs text-blue-700 font-medium">6 pages</span>
                        <span class="text-xs text-slate-400">PDF</span>
                      </div>
                    </div>
                  </div>
                  <div class="mt-3 flex items-center gap-2">
                    <span class="px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded">Auto-fill ready</span>
                    <span class="px-2 py-0.5 bg-slate-100 text-slate-600 text-xs rounded">90% complete</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Investor Documents -->
            <div class="card overflow-hidden">
              <div class="px-6 py-4 border-b border-slate-200 dark:border-slate-700/30">
                <h2 class="section-title">Investor & LP Documents</h2>
                <p class="text-sm text-slate-500 mt-1">Institutional-quality reporting packages</p>
              </div>
              <div class="p-6 grid grid-cols-2 gap-4">
                <div class="doc-template p-4 border border-slate-200 dark:border-slate-700/30 rounded-xl hover:border-blue-500 hover:bg-blue-50/50 dark:hover:bg-slate-800/20 cursor-pointer transition-all" onclick="generateDocument('lp-memo')">
                  <div class="flex items-start gap-3">
                    <div class="w-12 h-12 bg-blue-100 dark:bg-slate-800/30 rounded-lg flex items-center justify-center flex-shrink-0">
                      <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                    </div>
                    <div class="flex-1">
                      <p class="font-semibold text-slate-900 dark:text-white">LP Investment Memo</p>
                      <p class="text-xs text-slate-500 mt-1">Deal summary with incentive analysis</p>
                      <div class="flex items-center gap-2 mt-2">
                        <span class="text-xs text-blue-600 font-medium">20 pages</span>
                        <span class="text-xs text-slate-400">PDF + PPT</span>
                      </div>
                    </div>
                  </div>
                  <div class="mt-3 flex items-center gap-2">
                    <span class="px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded">Institutional format</span>
                  </div>
                </div>

                <div class="doc-template p-4 border border-slate-200 dark:border-slate-700/30 rounded-xl hover:border-blue-500 hover:bg-blue-50/50 dark:hover:bg-slate-800/20 cursor-pointer transition-all" onclick="generateDocument('quarterly-report')">
                  <div class="flex items-start gap-3">
                    <div class="w-12 h-12 bg-indigo-100 dark:bg-indigo-900/30 rounded-lg flex items-center justify-center flex-shrink-0">
                      <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
                    </div>
                    <div class="flex-1">
                      <p class="font-semibold text-slate-900 dark:text-white">Quarterly Incentive Report</p>
                      <p class="text-xs text-slate-500 mt-1">Portfolio-wide incentive tracking</p>
                      <div class="flex items-center gap-2 mt-2">
                        <span class="text-xs text-indigo-600 font-medium">12 pages</span>
                        <span class="text-xs text-slate-400">PDF + Excel</span>
                      </div>
                    </div>
                  </div>
                  <div class="mt-3 flex items-center gap-2">
                    <span class="px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded">Audit-ready</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Recent Documents -->
            <div class="card overflow-hidden">
              <div class="px-6 py-4 border-b border-slate-200 dark:border-slate-700/30 flex items-center justify-between">
                <div>
                  <h2 class="section-title">Recently Generated</h2>
                  <p class="text-sm text-slate-500 mt-1">Your document history</p>
                </div>
                <button class="text-sm text-blue-600 hover:text-blue-700">View All</button>
              </div>
              <div class="divide-y divide-slate-200 dark:divide-slate-700/30">
                <div class="p-4 flex items-center justify-between hover:bg-slate-50 dark:hover:bg-slate-800/20">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-red-100 dark:bg-red-900/30 rounded-lg flex items-center justify-center">
                      <svg class="w-5 h-5 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>
                    </div>
                    <div>
                      <p class="font-medium text-slate-900 dark:text-white">LP_Investment_Memo_MV_Residences.pdf</p>
                      <p class="text-xs text-slate-500">Generated Jan 10, 2026 at 08:45 AM</p>
                    </div>
                  </div>
                  <div class="flex items-center gap-2">
                    <button class="p-2 hover:bg-slate-100 dark:hover:bg-slate-700/50 rounded-lg" onclick="openDownloadModal('portfolio', 'LP_Investment_Memo_MV_Residences')">
                      <svg class="w-4 h-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                    </button>
                  </div>
                </div>
                <div class="p-4 flex items-center justify-between hover:bg-slate-50 dark:hover:bg-slate-800/20">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center">
                      <svg class="w-5 h-5 text-blue-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                    </div>
                    <div>
                      <p class="font-medium text-slate-900 dark:text-white">NYSERDA_Application_YonkersApts.xlsx</p>
                      <p class="text-xs text-slate-500">Generated Jan 9, 2026 at 03:22 PM</p>
                    </div>
                  </div>
                  <div class="flex items-center gap-2">
                    <button class="p-2 hover:bg-slate-100 dark:hover:bg-slate-700/50 rounded-lg" onclick="openDownloadModal('portfolio', 'NYSERDA_Application_YonkersApts'); selectDownloadFormat('xlsx');">
                      <svg class="w-4 h-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Document Sidebar -->
          <div class="space-y-4">
            <!-- Quick Stats -->
            <div class="card p-5">
              <h3 class="font-semibold text-slate-900 dark:text-white mb-4">Document Stats</h3>
              <div class="space-y-3">
                <div class="flex justify-between items-center">
                  <span class="text-sm text-slate-500">Generated This Month</span>
                  <span class="font-mono font-bold text-slate-900 dark:text-white">24</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-sm text-slate-500">Time Saved</span>
                  <span class="font-mono font-bold text-blue-600">18 hrs</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-sm text-slate-500">Accuracy Rate</span>
                  <span class="font-mono font-bold text-blue-700">99.2%</span>
                </div>
              </div>
            </div>

            <!-- AI Assistant -->
            <div class="card p-5 bg-gradient-to-br from-blue-50 to-slate-50 dark:from-blue-900/20 dark:to-slate-900/20 border-blue-200 dark:border-blue-800">
              <div class="flex items-center gap-3 mb-4">
                <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center">
                  <svg class="w-5 h-5 text-blue-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                </div>
                <div>
                  <p class="font-semibold text-blue-900 dark:text-blue-200">AI Document Assistant</p>
                  <p class="text-xs text-blue-700 dark:text-blue-400">Powered by GPT-4</p>
                </div>
              </div>
              <p class="text-sm text-blue-800 dark:text-blue-300 mb-4">Ask questions about requirements, get help drafting narratives, or review compliance.</p>
              <div class="relative">
                <input type="text" class="form-input w-full pr-10 text-sm" placeholder="Ask about document requirements...">
                <button class="absolute right-2 top-1/2 -translate-y-1/2 w-8 h-8 bg-blue-700 hover:bg-blue-800 rounded-lg flex items-center justify-center text-white">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/></svg>
                </button>
              </div>
            </div>

            <!-- Upload Section - V28: Functional Import -->
            <div class="card p-5">
              <h3 class="font-semibold text-slate-900 dark:text-white mb-3">Import Project Data</h3>
              <div id="project-import-dropzone"
                   class="border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-xl p-6 text-center hover:border-blue-500 transition-colors cursor-pointer"
                   onclick="document.getElementById('project-file-input').click()"
                   ondragover="handleProjectDragOver(event)"
                   ondragleave="handleProjectDragLeave(event)"
                   ondrop="handleProjectDrop(event)">
                <svg class="w-8 h-8 text-slate-400 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/></svg>
                <p class="text-sm text-slate-600 dark:text-slate-400">Drop pro forma or project files</p>
                <p class="text-xs text-slate-400 mt-1">Excel, PDF, or CSV</p>
                <input type="file" id="project-file-input" accept=".xlsx,.xls,.csv,.pdf" class="hidden" onchange="handleProjectFileUpload(event)">
              </div>
              <!-- Import Progress (hidden initially) -->
              <div id="import-progress" class="hidden mt-4">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-sm font-medium text-slate-700 dark:text-slate-300" id="import-filename">file.xlsx</span>
                  <span class="text-xs text-blue-600" id="import-status">Processing...</span>
                </div>
                <div class="h-2 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden">
                  <div id="import-bar" class="h-full bg-blue-600 transition-all" style="width: 0%"></div>
                </div>
              </div>
              <!-- Recently Imported (shows after import) -->
              <div id="recent-imports" class="mt-4 space-y-2">
                <p class="text-xs font-medium text-slate-500 uppercase tracking-wide">Recently Imported</p>
                <div class="flex items-center gap-3 p-2 bg-slate-50 dark:bg-slate-800/50 rounded-lg">
                  <svg class="w-5 h-5 text-green-500 flex-shrink-0" fill="currentColor" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6z"/></svg>
                  <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium text-slate-700 dark:text-slate-300 truncate">MountVernon_ProForma.xlsx</p>
                    <p class="text-xs text-slate-500">Imported Jan 10, 2026</p>
                  </div>
                  <span class="px-2 py-0.5 bg-green-100 text-green-700 text-xs rounded">Processed</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- V35: Triple Net Zero Dashboard Section -->
      <section id="section-netzero" class="section-content hidden">
        <div class="section-header mb-6">
          <div class="flex items-center justify-between">
            <div>
              <h1 class="text-2xl font-sora font-bold text-slate-900 dark:text-white">Triple Net Zero Dashboard</h1>
              <p class="text-slate-500 dark:text-slate-400 mt-1">Track Energy, Water, and Waste performance across your portfolio</p>
            </div>
            <button class="px-4 py-2 bg-blue-700 hover:bg-blue-800 text-white text-sm font-medium rounded-lg transition-colors">
              Export Report
            </button>
          </div>
        </div>

        <!-- Net Zero Overview Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
          <!-- Energy Net Zero -->
          <div class="bg-gradient-to-br from-amber-500/10 to-orange-500/10 border border-amber-500/30 rounded-xl p-6">
            <div class="flex items-center justify-between mb-4">
              <div class="flex items-center gap-3">
                <div class="w-12 h-12 bg-amber-500/20 rounded-xl flex items-center justify-center">
                  <svg class="w-6 h-6 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                </div>
                <div>
                  <h3 class="font-semibold text-slate-900 dark:text-white">Energy Net Zero</h3>
                  <p class="text-xs text-slate-500 dark:text-slate-400">kBtu/SF/Year</p>
                </div>
              </div>
              <span class="px-2 py-1 bg-green-500/20 text-green-600 dark:text-green-400 text-xs font-medium rounded-full">On Track</span>
            </div>
            <div class="space-y-3">
              <div class="flex justify-between text-sm">
                <span class="text-slate-600 dark:text-slate-400">Current EUI</span>
                <span class="font-mono font-semibold text-slate-900 dark:text-white">42.3</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-slate-600 dark:text-slate-400">Target EUI</span>
                <span class="font-mono font-semibold text-amber-600 dark:text-amber-400">35.0</span>
              </div>
              <div class="h-2 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden">
                <div class="h-full bg-gradient-to-r from-amber-500 to-orange-500 rounded-full" style="width: 78%"></div>
              </div>
              <div class="flex justify-between text-xs text-slate-500">
                <span>78% to target</span>
                <span>-17.2% YoY</span>
              </div>
            </div>
            <div class="mt-4 pt-4 border-t border-amber-500/20">
              <p class="text-xs text-slate-500 dark:text-slate-400 mb-2">Key Initiatives</p>
              <div class="space-y-1">
                <div class="flex items-center gap-2 text-xs">
                  <svg class="w-3 h-3 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
                  <span class="text-slate-600 dark:text-slate-400">LED lighting retrofit (100%)</span>
                </div>
                <div class="flex items-center gap-2 text-xs">
                  <svg class="w-3 h-3 text-amber-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/></svg>
                  <span class="text-slate-600 dark:text-slate-400">Solar PV installation (65%)</span>
                </div>
                <div class="flex items-center gap-2 text-xs">
                  <svg class="w-3 h-3 text-slate-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/></svg>
                  <span class="text-slate-600 dark:text-slate-400">Heat pump HVAC (Planning)</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Water Net Zero -->
          <div class="bg-gradient-to-br from-blue-500/10 to-cyan-500/10 border border-blue-500/30 rounded-xl p-6">
            <div class="flex items-center justify-between mb-4">
              <div class="flex items-center gap-3">
                <div class="w-12 h-12 bg-blue-500/20 rounded-xl flex items-center justify-center">
                  <svg class="w-6 h-6 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/></svg>
                </div>
                <div>
                  <h3 class="font-semibold text-slate-900 dark:text-white">Water Net Zero</h3>
                  <p class="text-xs text-slate-500 dark:text-slate-400">Gallons/SF/Year</p>
                </div>
              </div>
              <span class="px-2 py-1 bg-amber-500/20 text-amber-600 dark:text-amber-400 text-xs font-medium rounded-full">In Progress</span>
            </div>
            <div class="space-y-3">
              <div class="flex justify-between text-sm">
                <span class="text-slate-600 dark:text-slate-400">Current Usage</span>
                <span class="font-mono font-semibold text-slate-900 dark:text-white">18.7</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-slate-600 dark:text-slate-400">Target Usage</span>
                <span class="font-mono font-semibold text-blue-600 dark:text-blue-400">12.0</span>
              </div>
              <div class="h-2 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden">
                <div class="h-full bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full" style="width: 64%"></div>
              </div>
              <div class="flex justify-between text-xs text-slate-500">
                <span>64% to target</span>
                <span>-8.4% YoY</span>
              </div>
            </div>
            <div class="mt-4 pt-4 border-t border-blue-500/20">
              <p class="text-xs text-slate-500 dark:text-slate-400 mb-2">Key Initiatives</p>
              <div class="space-y-1">
                <div class="flex items-center gap-2 text-xs">
                  <svg class="w-3 h-3 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
                  <span class="text-slate-600 dark:text-slate-400">Low-flow fixtures (100%)</span>
                </div>
                <div class="flex items-center gap-2 text-xs">
                  <svg class="w-3 h-3 text-amber-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/></svg>
                  <span class="text-slate-600 dark:text-slate-400">Greywater recycling (40%)</span>
                </div>
                <div class="flex items-center gap-2 text-xs">
                  <svg class="w-3 h-3 text-slate-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/></svg>
                  <span class="text-slate-600 dark:text-slate-400">Rainwater harvesting (Planning)</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Waste Net Zero -->
          <div class="bg-gradient-to-br from-green-500/10 to-emerald-500/10 border border-green-500/30 rounded-xl p-6">
            <div class="flex items-center justify-between mb-4">
              <div class="flex items-center gap-3">
                <div class="w-12 h-12 bg-green-500/20 rounded-xl flex items-center justify-center">
                  <svg class="w-6 h-6 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
                </div>
                <div>
                  <h3 class="font-semibold text-slate-900 dark:text-white">Waste Net Zero</h3>
                  <p class="text-xs text-slate-500 dark:text-slate-400">Diversion Rate</p>
                </div>
              </div>
              <span class="px-2 py-1 bg-green-500/20 text-green-600 dark:text-green-400 text-xs font-medium rounded-full">Achieved</span>
            </div>
            <div class="space-y-3">
              <div class="flex justify-between text-sm">
                <span class="text-slate-600 dark:text-slate-400">Current Rate</span>
                <span class="font-mono font-semibold text-slate-900 dark:text-white">92%</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-slate-600 dark:text-slate-400">Target Rate</span>
                <span class="font-mono font-semibold text-green-600 dark:text-green-400">90%</span>
              </div>
              <div class="h-2 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden">
                <div class="h-full bg-gradient-to-r from-green-500 to-emerald-500 rounded-full" style="width: 100%"></div>
              </div>
              <div class="flex justify-between text-xs text-slate-500">
                <span>Target exceeded!</span>
                <span>+12.3% YoY</span>
              </div>
            </div>
            <div class="mt-4 pt-4 border-t border-green-500/20">
              <p class="text-xs text-slate-500 dark:text-slate-400 mb-2">Key Initiatives</p>
              <div class="space-y-1">
                <div class="flex items-center gap-2 text-xs">
                  <svg class="w-3 h-3 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
                  <span class="text-slate-600 dark:text-slate-400">Recycling program (100%)</span>
                </div>
                <div class="flex items-center gap-2 text-xs">
                  <svg class="w-3 h-3 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
                  <span class="text-slate-600 dark:text-slate-400">Composting (100%)</span>
                </div>
                <div class="flex items-center gap-2 text-xs">
                  <svg class="w-3 h-3 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
                  <span class="text-slate-600 dark:text-slate-400">Construction waste mgmt (100%)</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Portfolio Net Zero Summary Table -->
        <div class="bg-white dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700/50 rounded-xl overflow-hidden">
          <div class="px-6 py-4 border-b border-slate-200 dark:border-slate-700/50">
            <h2 class="font-semibold text-slate-900 dark:text-white">Portfolio Net Zero Performance by Property</h2>
          </div>
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-slate-50 dark:bg-slate-900/50">
                <tr class="text-xs text-slate-500 dark:text-slate-400 uppercase tracking-wider">
                  <th class="text-left px-6 py-3 font-medium">Property</th>
                  <th class="text-center px-4 py-3 font-medium">Energy</th>
                  <th class="text-center px-4 py-3 font-medium">Water</th>
                  <th class="text-center px-4 py-3 font-medium">Waste</th>
                  <th class="text-center px-4 py-3 font-medium">Overall Score</th>
                  <th class="text-center px-4 py-3 font-medium">Status</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-slate-200 dark:divide-slate-700/50">
                <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/50">
                  <td class="px-6 py-4">
                    <p class="font-medium text-slate-900 dark:text-white">New Rochelle Mixed-Use</p>
                    <p class="text-xs text-slate-500">485,000 SF</p>
                  </td>
                  <td class="px-4 py-4 text-center">
                    <span class="inline-flex items-center gap-1 px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs font-medium rounded">
                      <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
                      32.1 EUI
                    </span>
                  </td>
                  <td class="px-4 py-4 text-center">
                    <span class="inline-flex items-center gap-1 px-2 py-1 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400 text-xs font-medium rounded">
                      <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/></svg>
                      15.2 gal/SF
                    </span>
                  </td>
                  <td class="px-4 py-4 text-center">
                    <span class="inline-flex items-center gap-1 px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs font-medium rounded">
                      <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
                      94%
                    </span>
                  </td>
                  <td class="px-4 py-4 text-center">
                    <span class="font-mono font-bold text-lg text-blue-600 dark:text-blue-400">A</span>
                  </td>
                  <td class="px-4 py-4 text-center">
                    <span class="px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs font-medium rounded-full">Net Zero Ready</span>
                  </td>
                </tr>
                <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/50">
                  <td class="px-6 py-4">
                    <p class="font-medium text-slate-900 dark:text-white">Mount Vernon Tower</p>
                    <p class="text-xs text-slate-500">320,000 SF</p>
                  </td>
                  <td class="px-4 py-4 text-center">
                    <span class="inline-flex items-center gap-1 px-2 py-1 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400 text-xs font-medium rounded">
                      <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/></svg>
                      48.5 EUI
                    </span>
                  </td>
                  <td class="px-4 py-4 text-center">
                    <span class="inline-flex items-center gap-1 px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs font-medium rounded">
                      <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
                      11.8 gal/SF
                    </span>
                  </td>
                  <td class="px-4 py-4 text-center">
                    <span class="inline-flex items-center gap-1 px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs font-medium rounded">
                      <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
                      91%
                    </span>
                  </td>
                  <td class="px-4 py-4 text-center">
                    <span class="font-mono font-bold text-lg text-blue-600 dark:text-blue-400">B+</span>
                  </td>
                  <td class="px-4 py-4 text-center">
                    <span class="px-2 py-1 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400 text-xs font-medium rounded-full">In Progress</span>
                  </td>
                </tr>
                <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/50">
                  <td class="px-6 py-4">
                    <p class="font-medium text-slate-900 dark:text-white">Yonkers Waterfront</p>
                    <p class="text-xs text-slate-500">275,000 SF</p>
                  </td>
                  <td class="px-4 py-4 text-center">
                    <span class="inline-flex items-center gap-1 px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs font-medium rounded">
                      <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
                      29.8 EUI
                    </span>
                  </td>
                  <td class="px-4 py-4 text-center">
                    <span class="inline-flex items-center gap-1 px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs font-medium rounded">
                      <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
                      10.5 gal/SF
                    </span>
                  </td>
                  <td class="px-4 py-4 text-center">
                    <span class="inline-flex items-center gap-1 px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs font-medium rounded">
                      <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
                      96%
                    </span>
                  </td>
                  <td class="px-4 py-4 text-center">
                    <span class="font-mono font-bold text-lg text-green-600 dark:text-green-400">A+</span>
                  </td>
                  <td class="px-4 py-4 text-center">
                    <span class="px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs font-medium rounded-full">Net Zero Certified</span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- V35: LP Reports Center Section -->
      <section id="section-lpreports" class="section-content hidden">
        <div class="section-header mb-6">
          <div class="flex items-center justify-between">
            <div>
              <h1 class="text-2xl font-sora font-bold text-slate-900 dark:text-white">LP Reports Center</h1>
              <p class="text-slate-500 dark:text-slate-400 mt-1">Generate and schedule institutional-grade reports for limited partners</p>
            </div>
            <button onclick="generateLPReport()" class="px-4 py-2 bg-blue-700 hover:bg-blue-800 text-white text-sm font-medium rounded-lg transition-colors flex items-center gap-2">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
              New Report
            </button>
          </div>
        </div>

        <!-- Report Type Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8">
          <!-- Portfolio Summary -->
          <div class="bg-white dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700/50 rounded-xl p-5 hover:border-blue-500/50 transition-colors cursor-pointer" onclick="generateLPReport('portfolio-summary')">
            <div class="flex items-start gap-4">
              <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center flex-shrink-0">
                <svg class="w-5 h-5 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
              </div>
              <div>
                <h3 class="font-semibold text-slate-900 dark:text-white">Portfolio Summary</h3>
                <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">High-level portfolio overview with NAV, distributions, and performance metrics</p>
                <div class="flex items-center gap-3 mt-3">
                  <span class="text-xs text-slate-400">PDF, Excel</span>
                  <span class="text-xs px-2 py-0.5 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded">Quarterly</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Incentive Capture -->
          <div class="bg-white dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700/50 rounded-xl p-5 hover:border-blue-500/50 transition-colors cursor-pointer" onclick="generateLPReport('incentive-capture')">
            <div class="flex items-start gap-4">
              <div class="w-10 h-10 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center flex-shrink-0">
                <svg class="w-5 h-5 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
              </div>
              <div>
                <h3 class="font-semibold text-slate-900 dark:text-white">Incentive Capture</h3>
                <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">Detailed breakdown of captured incentives, pending applications, and pipeline</p>
                <div class="flex items-center gap-3 mt-3">
                  <span class="text-xs text-slate-400">PDF, Excel</span>
                  <span class="text-xs px-2 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 rounded">Monthly</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Compliance Status -->
          <div class="bg-white dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700/50 rounded-xl p-5 hover:border-blue-500/50 transition-colors cursor-pointer" onclick="generateLPReport('compliance-status')">
            <div class="flex items-start gap-4">
              <div class="w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-lg flex items-center justify-center flex-shrink-0">
                <svg class="w-5 h-5 text-amber-600 dark:text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
              </div>
              <div>
                <h3 class="font-semibold text-slate-900 dark:text-white">Compliance Status</h3>
                <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">IRA compliance tracking, prevailing wage certifications, and audit status</p>
                <div class="flex items-center gap-3 mt-3">
                  <span class="text-xs text-slate-400">PDF</span>
                  <span class="text-xs px-2 py-0.5 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400 rounded">On-demand</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Capital Stack -->
          <div class="bg-white dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700/50 rounded-xl p-5 hover:border-blue-500/50 transition-colors cursor-pointer" onclick="generateLPReport('capital-stack')">
            <div class="flex items-start gap-4">
              <div class="w-10 h-10 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center flex-shrink-0">
                <svg class="w-5 h-5 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
              </div>
              <div>
                <h3 class="font-semibold text-slate-900 dark:text-white">Capital Stack</h3>
                <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">Debt, equity, and incentive financing structure with waterfall analysis</p>
                <div class="flex items-center gap-3 mt-3">
                  <span class="text-xs text-slate-400">PDF, Excel</span>
                  <span class="text-xs px-2 py-0.5 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded">Quarterly</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Investor Returns -->
          <div class="bg-white dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700/50 rounded-xl p-5 hover:border-blue-500/50 transition-colors cursor-pointer" onclick="generateLPReport('investor-returns')">
            <div class="flex items-start gap-4">
              <div class="w-10 h-10 bg-teal-100 dark:bg-teal-900/30 rounded-lg flex items-center justify-center flex-shrink-0">
                <svg class="w-5 h-5 text-teal-600 dark:text-teal-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/></svg>
              </div>
              <div>
                <h3 class="font-semibold text-slate-900 dark:text-white">Investor Returns</h3>
                <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">IRR, equity multiple, cash-on-cash returns by investor and project</p>
                <div class="flex items-center gap-3 mt-3">
                  <span class="text-xs text-slate-400">PDF, Excel</span>
                  <span class="text-xs px-2 py-0.5 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded">Quarterly</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Tax Credit Pipeline -->
          <div class="bg-white dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700/50 rounded-xl p-5 hover:border-blue-500/50 transition-colors cursor-pointer" onclick="generateLPReport('tax-credit-pipeline')">
            <div class="flex items-start gap-4">
              <div class="w-10 h-10 bg-rose-100 dark:bg-rose-900/30 rounded-lg flex items-center justify-center flex-shrink-0">
                <svg class="w-5 h-5 text-rose-600 dark:text-rose-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/></svg>
              </div>
              <div>
                <h3 class="font-semibold text-slate-900 dark:text-white">Tax Credit Pipeline</h3>
                <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">LIHTC, 45L, 179D, ITC allocations with transfer/syndication status</p>
                <div class="flex items-center gap-3 mt-3">
                  <span class="text-xs text-slate-400">PDF, Excel</span>
                  <span class="text-xs px-2 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 rounded">Monthly</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Scheduled Reports -->
        <div class="bg-white dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700/50 rounded-xl overflow-hidden mb-6">
          <div class="px-6 py-4 border-b border-slate-200 dark:border-slate-700/50 flex items-center justify-between">
            <h2 class="font-semibold text-slate-900 dark:text-white">Scheduled Reports</h2>
            <button class="text-sm text-blue-600 dark:text-blue-400 hover:underline">Manage Schedule</button>
          </div>
          <div class="divide-y divide-slate-200 dark:divide-slate-700/50">
            <div class="px-6 py-4 flex items-center justify-between">
              <div class="flex items-center gap-4">
                <div class="w-8 h-8 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center">
                  <svg class="w-4 h-4 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                </div>
                <div>
                  <p class="font-medium text-slate-900 dark:text-white">Q1 2026 Portfolio Summary</p>
                  <p class="text-xs text-slate-500">Recipients: Blackstone RE, Goldman Sachs AM, TPG</p>
                </div>
              </div>
              <div class="flex items-center gap-4">
                <span class="text-sm text-slate-500">Jan 15, 2026</span>
                <span class="px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs font-medium rounded">Scheduled</span>
              </div>
            </div>
            <div class="px-6 py-4 flex items-center justify-between">
              <div class="flex items-center gap-4">
                <div class="w-8 h-8 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center">
                  <svg class="w-4 h-4 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                </div>
                <div>
                  <p class="font-medium text-slate-900 dark:text-white">Monthly Incentive Capture Report</p>
                  <p class="text-xs text-slate-500">Recipients: All LPs (12 recipients)</p>
                </div>
              </div>
              <div class="flex items-center gap-4">
                <span class="text-sm text-slate-500">Every 1st</span>
                <span class="px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 text-xs font-medium rounded">Recurring</span>
              </div>
            </div>
            <div class="px-6 py-4 flex items-center justify-between">
              <div class="flex items-center gap-4">
                <div class="w-8 h-8 bg-amber-100 dark:bg-amber-900/30 rounded-lg flex items-center justify-center">
                  <svg class="w-4 h-4 text-amber-600 dark:text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
                </div>
                <div>
                  <p class="font-medium text-slate-900 dark:text-white">IRA Compliance Audit Package</p>
                  <p class="text-xs text-slate-500">Recipients: External Auditors, Legal</p>
                </div>
              </div>
              <div class="flex items-center gap-4">
                <span class="text-sm text-slate-500">Jan 20, 2026</span>
                <span class="px-2 py-1 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400 text-xs font-medium rounded">Pending Review</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Recent Reports -->
        <div class="bg-white dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700/50 rounded-xl overflow-hidden">
          <div class="px-6 py-4 border-b border-slate-200 dark:border-slate-700/50">
            <h2 class="font-semibold text-slate-900 dark:text-white">Recent Reports</h2>
          </div>
          <div class="divide-y divide-slate-200 dark:divide-slate-700/50">
            <div class="px-6 py-4 flex items-center justify-between hover:bg-slate-50 dark:hover:bg-slate-700/30 cursor-pointer">
              <div class="flex items-center gap-4">
                <svg class="w-8 h-8 text-red-500" fill="currentColor" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6zm-1 2l5 5h-5V4zM8.5 13H10v4.5H8.5v-3H7V13h1.5zm5.5 0c.55 0 1 .45 1 1v2.5c0 .55-.45 1-1 1h-1.5V13H14zm-.5 3.5h-.5v-2h.5v2zm2.5-3.5h1.5v1h-1v1h1v1h-1v1.5H16V13z"/></svg>
                <div>
                  <p class="font-medium text-slate-900 dark:text-white">Q4 2025 Portfolio Summary.pdf</p>
                  <p class="text-xs text-slate-500">Generated Dec 31, 2025 • 2.4 MB</p>
                </div>
              </div>
              <div class="flex items-center gap-2">
                <button class="p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg" title="Download">
                  <svg class="w-4 h-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                </button>
                <button class="p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg" title="Share">
                  <svg class="w-4 h-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/></svg>
                </button>
              </div>
            </div>
            <div class="px-6 py-4 flex items-center justify-between hover:bg-slate-50 dark:hover:bg-slate-700/30 cursor-pointer">
              <div class="flex items-center gap-4">
                <svg class="w-8 h-8 text-green-600" fill="currentColor" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6zm4 18H6V4h7v5h5v11zM8 15h8v2H8v-2zm0-4h8v2H8v-2z"/></svg>
                <div>
                  <p class="font-medium text-slate-900 dark:text-white">December Incentive Capture.xlsx</p>
                  <p class="text-xs text-slate-500">Generated Jan 1, 2026 • 856 KB</p>
                </div>
              </div>
              <div class="flex items-center gap-2">
                <button class="p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg" title="Download">
                  <svg class="w-4 h-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                </button>
                <button class="p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg" title="Share">
                  <svg class="w-4 h-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/></svg>
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- V35: Credit Marketplace Section -->
      <section id="section-creditmarket" class="section-content hidden">
        <div class="section-header mb-6">
          <div class="flex items-center justify-between">
            <div>
              <h1 class="text-2xl font-sora font-bold text-slate-900 dark:text-white">Credit Marketplace</h1>
              <p class="text-slate-500 dark:text-slate-400 mt-1">Connect with verified institutional buyers for tax credit transfers</p>
            </div>
            <button onclick="listCreditsForSale()" class="px-4 py-2 bg-gradient-to-r from-blue-700 to-blue-600 hover:from-blue-800 hover:to-blue-700 text-white text-sm font-medium rounded-lg transition-all flex items-center gap-2 shadow-lg shadow-blue-500/25">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
              List Your Credits
            </button>
          </div>
        </div>

        <!-- Marketplace Stats -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
          <div class="bg-white dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700/50 rounded-xl p-4 text-center">
            <p class="text-2xl font-mono font-bold text-slate-900 dark:text-white">$200B+</p>
            <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">Total Volume</p>
          </div>
          <div class="bg-white dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700/50 rounded-xl p-4 text-center">
            <p class="text-2xl font-mono font-bold text-slate-900 dark:text-white">50+</p>
            <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">Verified Buyers</p>
          </div>
          <div class="bg-white dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700/50 rounded-xl p-4 text-center">
            <p class="text-2xl font-mono font-bold text-slate-900 dark:text-white">92%</p>
            <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">Close Rate</p>
          </div>
          <div class="bg-white dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700/50 rounded-xl p-4 text-center">
            <p class="text-2xl font-mono font-bold text-slate-900 dark:text-white">45 days</p>
            <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">Avg. Close Time</p>
          </div>
        </div>

        <!-- Your Listings -->
        <div class="bg-white dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700/50 rounded-xl overflow-hidden mb-6">
          <div class="px-6 py-4 border-b border-slate-200 dark:border-slate-700/50 flex items-center justify-between">
            <h2 class="font-semibold text-slate-900 dark:text-white">Your Active Listings</h2>
            <span class="px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 text-xs font-medium rounded">3 Active</span>
          </div>
          <div class="divide-y divide-slate-200 dark:divide-slate-700/50">
            <div class="px-6 py-4">
              <div class="flex items-center justify-between mb-3">
                <div class="flex items-center gap-3">
                  <span class="px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 text-xs font-medium rounded">ITC</span>
                  <p class="font-medium text-slate-900 dark:text-white">New Rochelle Solar ITC - $8.2M Face Value</p>
                </div>
                <span class="px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs font-medium rounded-full">3 Bids</span>
              </div>
              <div class="grid grid-cols-4 gap-4 text-sm">
                <div>
                  <p class="text-slate-500 dark:text-slate-400">Asking Price</p>
                  <p class="font-mono font-semibold text-slate-900 dark:text-white">$0.92/dollar</p>
                </div>
                <div>
                  <p class="text-slate-500 dark:text-slate-400">Highest Bid</p>
                  <p class="font-mono font-semibold text-green-600 dark:text-green-400">$0.905/dollar</p>
                </div>
                <div>
                  <p class="text-slate-500 dark:text-slate-400">Credit Year</p>
                  <p class="font-mono text-slate-900 dark:text-white">2026</p>
                </div>
                <div>
                  <p class="text-slate-500 dark:text-slate-400">Status</p>
                  <p class="text-amber-600 dark:text-amber-400 font-medium">Negotiating</p>
                </div>
              </div>
            </div>
            <div class="px-6 py-4">
              <div class="flex items-center justify-between mb-3">
                <div class="flex items-center gap-3">
                  <span class="px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs font-medium rounded">45L</span>
                  <p class="font-medium text-slate-900 dark:text-white">Mount Vernon 45L Credits - $2.1M Face Value</p>
                </div>
                <span class="px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs font-medium rounded-full">5 Bids</span>
              </div>
              <div class="grid grid-cols-4 gap-4 text-sm">
                <div>
                  <p class="text-slate-500 dark:text-slate-400">Asking Price</p>
                  <p class="font-mono font-semibold text-slate-900 dark:text-white">$0.94/dollar</p>
                </div>
                <div>
                  <p class="text-slate-500 dark:text-slate-400">Highest Bid</p>
                  <p class="font-mono font-semibold text-green-600 dark:text-green-400">$0.935/dollar</p>
                </div>
                <div>
                  <p class="text-slate-500 dark:text-slate-400">Credit Year</p>
                  <p class="font-mono text-slate-900 dark:text-white">2026</p>
                </div>
                <div>
                  <p class="text-slate-500 dark:text-slate-400">Status</p>
                  <p class="text-blue-600 dark:text-blue-400 font-medium">Due Diligence</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Verified Buyers -->
        <div class="bg-white dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700/50 rounded-xl overflow-hidden">
          <div class="px-6 py-4 border-b border-slate-200 dark:border-slate-700/50">
            <h2 class="font-semibold text-slate-900 dark:text-white">Verified Institutional Buyers</h2>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-6">
            <div class="border border-slate-200 dark:border-slate-700/50 rounded-lg p-4 hover:border-blue-500/50 transition-colors">
              <div class="flex items-center gap-3 mb-3">
                <div class="w-10 h-10 bg-slate-100 dark:bg-slate-700 rounded-lg flex items-center justify-center font-bold text-slate-600 dark:text-slate-300">BX</div>
                <div>
                  <p class="font-medium text-slate-900 dark:text-white">Blackstone RE</p>
                  <div class="flex items-center gap-1">
                    <svg class="w-3 h-3 text-blue-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                    <span class="text-xs text-slate-500">Verified</span>
                  </div>
                </div>
              </div>
              <div class="text-xs text-slate-500 dark:text-slate-400 space-y-1">
                <p>Buying: ITC, PTC, 45L, LIHTC</p>
                <p>Capacity: $500M+/year</p>
                <p>Avg. Close: 30 days</p>
              </div>
            </div>
            <div class="border border-slate-200 dark:border-slate-700/50 rounded-lg p-4 hover:border-blue-500/50 transition-colors">
              <div class="flex items-center gap-3 mb-3">
                <div class="w-10 h-10 bg-slate-100 dark:bg-slate-700 rounded-lg flex items-center justify-center font-bold text-slate-600 dark:text-slate-300">GS</div>
                <div>
                  <p class="font-medium text-slate-900 dark:text-white">Goldman Sachs AM</p>
                  <div class="flex items-center gap-1">
                    <svg class="w-3 h-3 text-blue-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                    <span class="text-xs text-slate-500">Verified</span>
                  </div>
                </div>
              </div>
              <div class="text-xs text-slate-500 dark:text-slate-400 space-y-1">
                <p>Buying: ITC, PTC, 179D</p>
                <p>Capacity: $750M+/year</p>
                <p>Avg. Close: 45 days</p>
              </div>
            </div>
            <div class="border border-slate-200 dark:border-slate-700/50 rounded-lg p-4 hover:border-blue-500/50 transition-colors">
              <div class="flex items-center gap-3 mb-3">
                <div class="w-10 h-10 bg-slate-100 dark:bg-slate-700 rounded-lg flex items-center justify-center font-bold text-slate-600 dark:text-slate-300">JPM</div>
                <div>
                  <p class="font-medium text-slate-900 dark:text-white">JP Morgan RE</p>
                  <div class="flex items-center gap-1">
                    <svg class="w-3 h-3 text-blue-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                    <span class="text-xs text-slate-500">Verified</span>
                  </div>
                </div>
              </div>
              <div class="text-xs text-slate-500 dark:text-slate-400 space-y-1">
                <p>Buying: All credit types</p>
                <p>Capacity: $1B+/year</p>
                <p>Avg. Close: 35 days</p>
              </div>
            </div>
            <div class="border border-slate-200 dark:border-slate-700/50 rounded-lg p-4 hover:border-blue-500/50 transition-colors">
              <div class="flex items-center gap-3 mb-3">
                <div class="w-10 h-10 bg-slate-100 dark:bg-slate-700 rounded-lg flex items-center justify-center font-bold text-slate-600 dark:text-slate-300">TPG</div>
                <div>
                  <p class="font-medium text-slate-900 dark:text-white">TPG Rise Climate</p>
                  <div class="flex items-center gap-1">
                    <svg class="w-3 h-3 text-blue-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                    <span class="text-xs text-slate-500">Verified</span>
                  </div>
                </div>
              </div>
              <div class="text-xs text-slate-500 dark:text-slate-400 space-y-1">
                <p>Buying: ITC, PTC, 45V</p>
                <p>Capacity: $300M+/year</p>
                <p>Avg. Close: 40 days</p>
              </div>
            </div>
            <div class="border border-slate-200 dark:border-slate-700/50 rounded-lg p-4 hover:border-blue-500/50 transition-colors">
              <div class="flex items-center gap-3 mb-3">
                <div class="w-10 h-10 bg-slate-100 dark:bg-slate-700 rounded-lg flex items-center justify-center font-bold text-slate-600 dark:text-slate-300">BRK</div>
                <div>
                  <p class="font-medium text-slate-900 dark:text-white">Berkshire Energy</p>
                  <div class="flex items-center gap-1">
                    <svg class="w-3 h-3 text-blue-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                    <span class="text-xs text-slate-500">Verified</span>
                  </div>
                </div>
              </div>
              <div class="text-xs text-slate-500 dark:text-slate-400 space-y-1">
                <p>Buying: PTC, ITC (utility scale)</p>
                <p>Capacity: $2B+/year</p>
                <p>Avg. Close: 60 days</p>
              </div>
            </div>
            <div class="border border-slate-200 dark:border-slate-700/50 rounded-lg p-4 hover:border-blue-500/50 transition-colors">
              <div class="flex items-center gap-3 mb-3">
                <div class="w-10 h-10 bg-slate-100 dark:bg-slate-700 rounded-lg flex items-center justify-center font-bold text-slate-600 dark:text-slate-300">MS</div>
                <div>
                  <p class="font-medium text-slate-900 dark:text-white">Morgan Stanley Infra</p>
                  <div class="flex items-center gap-1">
                    <svg class="w-3 h-3 text-blue-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                    <span class="text-xs text-slate-500">Verified</span>
                  </div>
                </div>
              </div>
              <div class="text-xs text-slate-500 dark:text-slate-400 space-y-1">
                <p>Buying: ITC, 45L, LIHTC</p>
                <p>Capacity: $400M+/year</p>
                <p>Avg. Close: 38 days</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Transaction Timeline -->
        <div class="mt-6 bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 border border-blue-200 dark:border-blue-700/50 rounded-xl p-6">
          <h3 class="font-semibold text-slate-900 dark:text-white mb-4">Typical Transaction Timeline</h3>
          <div class="flex items-center justify-between">
            <div class="text-center">
              <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold mx-auto mb-2">1</div>
              <p class="text-xs font-medium text-slate-900 dark:text-white">List Credits</p>
              <p class="text-xs text-slate-500">Day 1</p>
            </div>
            <div class="flex-1 h-0.5 bg-blue-300 dark:bg-blue-600 mx-2"></div>
            <div class="text-center">
              <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold mx-auto mb-2">2</div>
              <p class="text-xs font-medium text-slate-900 dark:text-white">Receive Bids</p>
              <p class="text-xs text-slate-500">Days 2-7</p>
            </div>
            <div class="flex-1 h-0.5 bg-blue-300 dark:bg-blue-600 mx-2"></div>
            <div class="text-center">
              <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold mx-auto mb-2">3</div>
              <p class="text-xs font-medium text-slate-900 dark:text-white">Due Diligence</p>
              <p class="text-xs text-slate-500">Days 8-25</p>
            </div>
            <div class="flex-1 h-0.5 bg-blue-300 dark:bg-blue-600 mx-2"></div>
            <div class="text-center">
              <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold mx-auto mb-2">4</div>
              <p class="text-xs font-medium text-slate-900 dark:text-white">Execute Transfer</p>
              <p class="text-xs text-slate-500">Days 26-35</p>
            </div>
            <div class="flex-1 h-0.5 bg-blue-300 dark:bg-blue-600 mx-2"></div>
            <div class="text-center">
              <div class="w-10 h-10 bg-green-600 rounded-full flex items-center justify-center text-white font-bold mx-auto mb-2">5</div>
              <p class="text-xs font-medium text-slate-900 dark:text-white">Funds Received</p>
              <p class="text-xs text-slate-500">Day 45</p>
            </div>
          </div>
        </div>
      </section>

      <!-- V35: Grant Writing Accelerator Section -->
      <section id="section-grantwriter" class="section-content hidden">
        <div class="section-header mb-6">
          <div class="flex items-center justify-between">
            <div>
              <h1 class="text-2xl font-sora font-bold text-slate-900 dark:text-white">Grant Writing Accelerator</h1>
              <p class="text-slate-500 dark:text-slate-400 mt-1">AI-powered grant application assistance for federal programs</p>
            </div>
            <button onclick="startNewGrantApplication()" class="px-4 py-2 bg-blue-700 hover:bg-blue-800 text-white text-sm font-medium rounded-lg transition-colors flex items-center gap-2">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
              Start Application
            </button>
          </div>
        </div>

        <!-- Federal Programs Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
          <!-- USDA REAP -->
          <div class="bg-white dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700/50 rounded-xl overflow-hidden">
            <div class="px-6 py-4 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border-b border-slate-200 dark:border-slate-700/50">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <div class="w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-xl flex items-center justify-center">
                    <svg class="w-6 h-6 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                  </div>
                  <div>
                    <h3 class="font-semibold text-slate-900 dark:text-white">USDA REAP Grant</h3>
                    <p class="text-xs text-slate-500 dark:text-slate-400">Rural Energy for America Program</p>
                  </div>
                </div>
                <span class="px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs font-medium rounded-full">Open</span>
              </div>
            </div>
            <div class="p-6">
              <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                  <p class="text-xs text-slate-500 dark:text-slate-400">Max Award</p>
                  <p class="font-mono font-semibold text-slate-900 dark:text-white">$1,000,000</p>
                </div>
                <div>
                  <p class="text-xs text-slate-500 dark:text-slate-400">Cost Share</p>
                  <p class="font-mono font-semibold text-slate-900 dark:text-white">25% Grant</p>
                </div>
                <div>
                  <p class="text-xs text-slate-500 dark:text-slate-400">Next Deadline</p>
                  <p class="font-medium text-amber-600 dark:text-amber-400">Mar 31, 2026</p>
                </div>
                <div>
                  <p class="text-xs text-slate-500 dark:text-slate-400">Eligible Uses</p>
                  <p class="text-sm text-slate-700 dark:text-slate-300">Solar, Wind, Energy Efficiency</p>
                </div>
              </div>
              <div class="flex items-center gap-2 mb-4">
                <span class="text-xs px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 rounded">Auto-populate: 85%</span>
                <span class="text-xs px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded">Est. time: 2 hours</span>
              </div>
              <button onclick="startGrantApplication('usda-reap')" class="w-full py-2 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-lg transition-colors">
                Start USDA REAP Application
              </button>
            </div>
          </div>

          <!-- EPA Brownfield -->
          <div class="bg-white dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700/50 rounded-xl overflow-hidden">
            <div class="px-6 py-4 bg-gradient-to-r from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 border-b border-slate-200 dark:border-slate-700/50">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-xl flex items-center justify-center">
                    <svg class="w-6 h-6 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
                  </div>
                  <div>
                    <h3 class="font-semibold text-slate-900 dark:text-white">EPA Brownfield Grant</h3>
                    <p class="text-xs text-slate-500 dark:text-slate-400">Assessment, Cleanup, RLF</p>
                  </div>
                </div>
                <span class="px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs font-medium rounded-full">Open</span>
              </div>
            </div>
            <div class="p-6">
              <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                  <p class="text-xs text-slate-500 dark:text-slate-400">Max Award</p>
                  <p class="font-mono font-semibold text-slate-900 dark:text-white">$5,000,000</p>
                </div>
                <div>
                  <p class="text-xs text-slate-500 dark:text-slate-400">Cost Share</p>
                  <p class="font-mono font-semibold text-slate-900 dark:text-white">20% Match</p>
                </div>
                <div>
                  <p class="text-xs text-slate-500 dark:text-slate-400">Next Deadline</p>
                  <p class="font-medium text-amber-600 dark:text-amber-400">Nov 15, 2026</p>
                </div>
                <div>
                  <p class="text-xs text-slate-500 dark:text-slate-400">Eligible Uses</p>
                  <p class="text-sm text-slate-700 dark:text-slate-300">Assessment, Cleanup, Planning</p>
                </div>
              </div>
              <div class="flex items-center gap-2 mb-4">
                <span class="text-xs px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 rounded">Auto-populate: 72%</span>
                <span class="text-xs px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded">Est. time: 4 hours</span>
              </div>
              <button onclick="startGrantApplication('epa-brownfield')" class="w-full py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors">
                Start EPA Brownfield Application
              </button>
            </div>
          </div>

          <!-- HUD CDBG -->
          <div class="bg-white dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700/50 rounded-xl overflow-hidden">
            <div class="px-6 py-4 bg-gradient-to-r from-purple-50 to-violet-50 dark:from-purple-900/20 dark:to-violet-900/20 border-b border-slate-200 dark:border-slate-700/50">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900/30 rounded-xl flex items-center justify-center">
                    <svg class="w-6 h-6 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
                  </div>
                  <div>
                    <h3 class="font-semibold text-slate-900 dark:text-white">HUD CDBG</h3>
                    <p class="text-xs text-slate-500 dark:text-slate-400">Community Development Block Grant</p>
                  </div>
                </div>
                <span class="px-2 py-1 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400 text-xs font-medium rounded-full">Rolling</span>
              </div>
            </div>
            <div class="p-6">
              <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                  <p class="text-xs text-slate-500 dark:text-slate-400">Max Award</p>
                  <p class="font-mono font-semibold text-slate-900 dark:text-white">Varies by locality</p>
                </div>
                <div>
                  <p class="text-xs text-slate-500 dark:text-slate-400">Cost Share</p>
                  <p class="font-mono font-semibold text-slate-900 dark:text-white">None required</p>
                </div>
                <div>
                  <p class="text-xs text-slate-500 dark:text-slate-400">Next Deadline</p>
                  <p class="font-medium text-slate-600 dark:text-slate-400">Rolling</p>
                </div>
                <div>
                  <p class="text-xs text-slate-500 dark:text-slate-400">Eligible Uses</p>
                  <p class="text-sm text-slate-700 dark:text-slate-300">Housing, Infrastructure, Economic Dev</p>
                </div>
              </div>
              <div class="flex items-center gap-2 mb-4">
                <span class="text-xs px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 rounded">Auto-populate: 68%</span>
                <span class="text-xs px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded">Est. time: 3 hours</span>
              </div>
              <button onclick="startGrantApplication('hud-cdbg')" class="w-full py-2 bg-purple-600 hover:bg-purple-700 text-white text-sm font-medium rounded-lg transition-colors">
                Start HUD CDBG Application
              </button>
            </div>
          </div>

          <!-- DOE LPO -->
          <div class="bg-white dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700/50 rounded-xl overflow-hidden">
            <div class="px-6 py-4 bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20 border-b border-slate-200 dark:border-slate-700/50">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <div class="w-12 h-12 bg-amber-100 dark:bg-amber-900/30 rounded-xl flex items-center justify-center">
                    <svg class="w-6 h-6 text-amber-600 dark:text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                  </div>
                  <div>
                    <h3 class="font-semibold text-slate-900 dark:text-white">DOE Loan Programs</h3>
                    <p class="text-xs text-slate-500 dark:text-slate-400">Title XVII, ATVM, Tribal Energy</p>
                  </div>
                </div>
                <span class="px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs font-medium rounded-full">Open</span>
              </div>
            </div>
            <div class="p-6">
              <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                  <p class="text-xs text-slate-500 dark:text-slate-400">Loan Capacity</p>
                  <p class="font-mono font-semibold text-slate-900 dark:text-white">$400B+</p>
                </div>
                <div>
                  <p class="text-xs text-slate-500 dark:text-slate-400">Rate</p>
                  <p class="font-mono font-semibold text-slate-900 dark:text-white">Treasury + spread</p>
                </div>
                <div>
                  <p class="text-xs text-slate-500 dark:text-slate-400">Timeline</p>
                  <p class="font-medium text-slate-600 dark:text-slate-400">6-12 months</p>
                </div>
                <div>
                  <p class="text-xs text-slate-500 dark:text-slate-400">Eligible Uses</p>
                  <p class="text-sm text-slate-700 dark:text-slate-300">Clean Energy, Manufacturing</p>
                </div>
              </div>
              <div class="flex items-center gap-2 mb-4">
                <span class="text-xs px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 rounded">Auto-populate: 60%</span>
                <span class="text-xs px-2 py-1 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400 rounded">Est. time: 8 hours</span>
              </div>
              <button onclick="startGrantApplication('doe-lpo')" class="w-full py-2 bg-amber-600 hover:bg-amber-700 text-white text-sm font-medium rounded-lg transition-colors">
                Start DOE LPO Application
              </button>
            </div>
          </div>
        </div>

        <!-- Auto-populated Fields Preview -->
        <div class="bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 border border-blue-200 dark:border-blue-700/50 rounded-xl p-6">
          <div class="flex items-start gap-4">
            <div class="w-12 h-12 bg-blue-500/20 rounded-xl flex items-center justify-center flex-shrink-0">
              <svg class="w-6 h-6 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
            </div>
            <div>
              <h3 class="font-semibold text-slate-900 dark:text-white mb-2">AI-Powered Auto-Population</h3>
              <p class="text-sm text-slate-600 dark:text-slate-400 mb-4">IncentEdge automatically fills application fields using your project data:</p>
              <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="text-center p-3 bg-white dark:bg-slate-800/50 rounded-lg">
                  <p class="text-2xl font-mono font-bold text-blue-600 dark:text-blue-400">85%</p>
                  <p class="text-xs text-slate-500 mt-1">Fields auto-filled</p>
                </div>
                <div class="text-center p-3 bg-white dark:bg-slate-800/50 rounded-lg">
                  <p class="text-2xl font-mono font-bold text-green-600 dark:text-green-400">3hrs</p>
                  <p class="text-xs text-slate-500 mt-1">Avg. time saved</p>
                </div>
                <div class="text-center p-3 bg-white dark:bg-slate-800/50 rounded-lg">
                  <p class="text-2xl font-mono font-bold text-purple-600 dark:text-purple-400">95%</p>
                  <p class="text-xs text-slate-500 mt-1">Accuracy rate</p>
                </div>
                <div class="text-center p-3 bg-white dark:bg-slate-800/50 rounded-lg">
                  <p class="text-2xl font-mono font-bold text-amber-600 dark:text-amber-400">42%</p>
                  <p class="text-xs text-slate-500 mt-1">Higher approval</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- V37: MISSION PAGE (Three Pillars - Council-approved from V36) -->
      <section id="section-mission" class="section-content hidden">
        <!-- Hero Section -->
        <div class="relative overflow-hidden rounded-xl bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 border border-blue-500/20 mb-6">
          <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_top_right,rgba(59,130,246,0.15),transparent_50%)]"></div>
          <div class="relative px-8 py-12 text-center">
            <div class="inline-flex items-center gap-2 px-4 py-2 bg-blue-500/10 border border-blue-500/30 rounded-full text-blue-400 text-sm font-medium mb-6">
              <span class="w-2 h-2 bg-blue-400 rounded-full animate-pulse"></span>
              Over $200B in Available Incentives Indexed
            </div>
            <h1 class="font-sora text-4xl md:text-5xl font-bold text-white mb-4">
              The <span class="text-blue-400">Command Center</span> for<br>Real Estate Incentives
            </h1>
            <p class="text-lg text-slate-400 max-w-2xl mx-auto mb-8">
              Transform your development projects with AI-powered incentive discovery, accelerated grant writing, and seamless credit monetization - all in one institutional-grade platform.
            </p>
            <div class="flex flex-wrap justify-center gap-6 text-center">
              <div class="px-6">
                <p class="text-3xl font-bold text-blue-400 font-mono">86%</p>
                <p class="text-sm text-slate-500">Time Saved</p>
              </div>
              <div class="px-6 border-l border-slate-700">
                <p class="text-3xl font-bold text-blue-400 font-mono">2.5x</p>
                <p class="text-sm text-slate-500">Higher Capture</p>
              </div>
              <div class="px-6 border-l border-slate-700">
                <p class="text-3xl font-bold text-blue-400 font-mono">$200B+</p>
                <p class="text-sm text-slate-500">Incentives Indexed</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Three Pillars -->
        <div class="mb-8">
          <h2 class="font-sora text-xl font-bold text-slate-900 dark:text-white mb-6 text-center">Three Integrated Pillars</h2>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Pillar 1: AI-Powered Discovery -->
            <div class="card p-6 relative overflow-hidden group hover:border-blue-500/50 transition-all">
              <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 to-blue-600"></div>
              <div class="flex items-center gap-3 mb-4">
                <div class="w-12 h-12 bg-blue-500/10 rounded-xl flex items-center justify-center">
                  <svg class="w-6 h-6 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
                </div>
                <div>
                  <span class="text-xs text-blue-500 font-semibold">PILLAR 1</span>
                  <h3 class="font-sora font-bold text-slate-900 dark:text-white">AI-Powered Discovery</h3>
                </div>
              </div>
              <p class="text-sm text-slate-600 dark:text-slate-400 mb-4">Instantly match projects to 2,300+ tax credits, grants, and utility rebates across all 50 states.</p>
              <ul class="space-y-2 text-sm">
                <li class="flex items-center gap-2 text-slate-600 dark:text-slate-400"><svg class="w-4 h-4 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> Real-time eligibility scoring</li>
                <li class="flex items-center gap-2 text-slate-600 dark:text-slate-400"><svg class="w-4 h-4 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> Deadline tracking & alerts</li>
                <li class="flex items-center gap-2 text-slate-600 dark:text-slate-400"><svg class="w-4 h-4 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> Stacking optimization</li>
              </ul>
              <div class="mt-4 pt-4 border-t border-slate-200 dark:border-slate-700/50">
                <div class="flex justify-between text-sm">
                  <span class="text-slate-500">Discovery Accuracy</span>
                  <span class="font-mono font-semibold text-blue-500">97%</span>
                </div>
                <div class="mt-2 h-2 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden">
                  <div class="h-full bg-gradient-to-r from-blue-500 to-blue-600 rounded-full" style="width: 97%"></div>
                </div>
              </div>
            </div>

            <!-- Pillar 2: Accelerated Grant Writing -->
            <div class="card p-6 relative overflow-hidden group hover:border-green-500/50 transition-all">
              <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-green-500 to-emerald-500"></div>
              <div class="flex items-center gap-3 mb-4">
                <div class="w-12 h-12 bg-green-500/10 rounded-xl flex items-center justify-center">
                  <svg class="w-6 h-6 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                </div>
                <div>
                  <span class="text-xs text-green-500 font-semibold">PILLAR 2</span>
                  <h3 class="font-sora font-bold text-slate-900 dark:text-white">Accelerated Grant Writing</h3>
                </div>
              </div>
              <p class="text-sm text-slate-600 dark:text-slate-400 mb-4">AI-assisted applications with pre-filled templates and real-time compliance checking.</p>
              <ul class="space-y-2 text-sm">
                <li class="flex items-center gap-2 text-slate-600 dark:text-slate-400"><svg class="w-4 h-4 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> Auto-populated narratives</li>
                <li class="flex items-center gap-2 text-slate-600 dark:text-slate-400"><svg class="w-4 h-4 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> Compliance validation</li>
                <li class="flex items-center gap-2 text-slate-600 dark:text-slate-400"><svg class="w-4 h-4 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> Document assembly</li>
              </ul>
              <div class="mt-4 pt-4 border-t border-slate-200 dark:border-slate-700/50">
                <div class="flex justify-between text-sm">
                  <span class="text-slate-500">Approval Rate</span>
                  <span class="font-mono font-semibold text-green-500">89%</span>
                </div>
                <div class="mt-2 h-2 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden">
                  <div class="h-full bg-gradient-to-r from-green-500 to-emerald-500 rounded-full" style="width: 89%"></div>
                </div>
              </div>
            </div>

            <!-- Pillar 3: Credit Monetization -->
            <div class="card p-6 relative overflow-hidden group hover:border-purple-500/50 transition-all">
              <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-purple-500 to-pink-500"></div>
              <div class="flex items-center gap-3 mb-4">
                <div class="w-12 h-12 bg-purple-500/10 rounded-xl flex items-center justify-center">
                  <svg class="w-6 h-6 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                </div>
                <div>
                  <span class="text-xs text-purple-500 font-semibold">PILLAR 3</span>
                  <h3 class="font-sora font-bold text-slate-900 dark:text-white">Credit Monetization</h3>
                </div>
              </div>
              <p class="text-sm text-slate-600 dark:text-slate-400 mb-4">Connect with verified institutional buyers to monetize transferable tax credits at optimal pricing.</p>
              <ul class="space-y-2 text-sm">
                <li class="flex items-center gap-2 text-slate-600 dark:text-slate-400"><svg class="w-4 h-4 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> Verified buyer network</li>
                <li class="flex items-center gap-2 text-slate-600 dark:text-slate-400"><svg class="w-4 h-4 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> Price benchmarking</li>
                <li class="flex items-center gap-2 text-slate-600 dark:text-slate-400"><svg class="w-4 h-4 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> Transaction escrow</li>
              </ul>
              <div class="mt-4 pt-4 border-t border-slate-200 dark:border-slate-700/50">
                <div class="flex justify-between text-sm">
                  <span class="text-slate-500">Avg Premium vs Market</span>
                  <span class="font-mono font-semibold text-purple-500">+3.2%</span>
                </div>
                <div class="mt-2 h-2 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden">
                  <div class="h-full bg-gradient-to-r from-purple-500 to-pink-500 rounded-full" style="width: 78%"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Competitive Advantage -->
        <div class="card p-6">
          <h3 class="font-sora font-bold text-slate-900 dark:text-white mb-4">Competitive Advantage</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <div class="space-y-4">
                <div class="flex items-start gap-3">
                  <div class="w-8 h-8 bg-blue-500/10 rounded-lg flex items-center justify-center flex-shrink-0">
                    <svg class="w-4 h-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                  </div>
                  <div>
                    <h4 class="font-semibold text-slate-900 dark:text-white">Comprehensive Coverage</h4>
                    <p class="text-sm text-slate-500">2,321 tax credits indexed across all 50 states with daily updates from official sources.</p>
                  </div>
                </div>
                <div class="flex items-start gap-3">
                  <div class="w-8 h-8 bg-blue-500/10 rounded-lg flex items-center justify-center flex-shrink-0">
                    <svg class="w-4 h-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                  </div>
                  <div>
                    <h4 class="font-semibold text-slate-900 dark:text-white">Regulatory Agility</h4>
                    <p class="text-sm text-slate-500">48-hour turnaround on new program integration. Stay ahead of policy changes.</p>
                  </div>
                </div>
                <div class="flex items-start gap-3">
                  <div class="w-8 h-8 bg-blue-500/10 rounded-lg flex items-center justify-center flex-shrink-0">
                    <svg class="w-4 h-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
                  </div>
                  <div>
                    <h4 class="font-semibold text-slate-900 dark:text-white">Institutional Grade</h4>
                    <p class="text-sm text-slate-500">SOC 2 Type II certified. Trusted by top 50 developers and REITs.</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="flex items-center justify-center">
              <div class="text-center">
                <p class="text-7xl font-bold text-blue-500 font-mono">10x</p>
                <p class="text-lg text-slate-600 dark:text-slate-400 mt-2">Faster than manual research</p>
                <p class="text-sm text-slate-500 mt-1">Average time savings per project</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- V37: ROI CALCULATOR WITH PRO FORMA (Council-approved from V36) -->
      <section id="section-roicalc" class="section-content hidden">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <!-- Left: Project Parameters -->
          <div class="lg:col-span-1">
            <div class="card p-6">
              <h3 class="font-sora font-bold text-slate-900 dark:text-white mb-4">Project Parameters</h3>
              <div class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Asset Type</label>
                  <select id="roi-asset-type" class="w-full px-3 py-2 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-lg text-sm" onchange="updateROIProForma()">
                    <option value="multifamily">Multifamily Residential</option>
                    <option value="office">Office</option>
                    <option value="retail">Retail</option>
                    <option value="industrial">Industrial</option>
                    <option value="mixeduse">Mixed-Use</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Project Type</label>
                  <div class="flex gap-2">
                    <button id="roi-new-btn" class="flex-1 px-3 py-2 bg-blue-600 text-white text-sm rounded-lg font-medium" onclick="setProjectType('new')">New Construction</button>
                    <button id="roi-rehab-btn" class="flex-1 px-3 py-2 bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 text-sm rounded-lg font-medium" onclick="setProjectType('rehab')">Rehab</button>
                  </div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Building Size (SF)</label>
                  <input type="number" id="roi-building-size" value="150000" class="w-full px-3 py-2 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-lg text-sm font-mono" onchange="updateROIProForma()">
                </div>
                <div>
                  <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Baseline Budget</label>
                  <input type="text" id="roi-baseline-budget" value="$45,000,000" class="w-full px-3 py-2 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-lg text-sm font-mono" onchange="updateROIProForma()">
                </div>
                <div class="pt-4 border-t border-slate-200 dark:border-slate-700">
                  <h4 class="font-semibold text-slate-900 dark:text-white mb-3">Sustainability Tiers</h4>
                  <div class="space-y-2">
                    <label class="flex items-center gap-2 p-2 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800/50 cursor-pointer">
                      <input type="radio" name="roi-tier" value="1" class="text-blue-600" onchange="updateROIProForma()">
                      <span class="text-sm text-slate-700 dark:text-slate-300">Tier 1: Compliance</span>
                    </label>
                    <label class="flex items-center gap-2 p-2 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800/50 cursor-pointer">
                      <input type="radio" name="roi-tier" value="2" checked class="text-blue-600" onchange="updateROIProForma()">
                      <span class="text-sm text-slate-700 dark:text-slate-300">Tier 2: High Performance</span>
                    </label>
                    <label class="flex items-center gap-2 p-2 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800/50 cursor-pointer">
                      <input type="radio" name="roi-tier" value="3" class="text-blue-600" onchange="updateROIProForma()">
                      <span class="text-sm text-slate-700 dark:text-slate-300">Tier 3: Triple Net Zero</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Center: Results Display -->
          <div class="lg:col-span-2">
            <!-- Key Metrics -->
            <div class="grid grid-cols-3 gap-4 mb-6">
              <div class="card p-4 text-center bg-gradient-to-br from-blue-500/10 to-blue-600/10 border-blue-500/30">
                <p class="text-xs text-blue-600 dark:text-blue-400 uppercase tracking-wider font-medium mb-1">Projected ROI</p>
                <p class="text-3xl font-bold text-blue-600 dark:text-blue-400 font-mono" id="roi-result">10-12%</p>
              </div>
              <div class="card p-4 text-center bg-gradient-to-br from-green-500/10 to-emerald-500/10 border-green-500/30">
                <p class="text-xs text-green-600 dark:text-green-400 uppercase tracking-wider font-medium mb-1">Payback Period</p>
                <p class="text-3xl font-bold text-green-600 dark:text-green-400 font-mono" id="payback-result">6-8 Years</p>
              </div>
              <div class="card p-4 text-center bg-gradient-to-br from-purple-500/10 to-pink-500/10 border-purple-500/30">
                <p class="text-xs text-purple-600 dark:text-purple-400 uppercase tracking-wider font-medium mb-1">Incentive Value</p>
                <p class="text-3xl font-bold text-purple-600 dark:text-purple-400 font-mono" id="incentive-value-result">$1.8M</p>
              </div>
            </div>

            <!-- Triple Net Zero Analysis -->
            <div class="card p-6 mb-6">
              <h3 class="font-sora font-bold text-slate-900 dark:text-white mb-4">Triple Net Zero Analysis</h3>
              <div class="grid grid-cols-3 gap-4">
                <div class="text-center p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800/30">
                  <div class="w-12 h-12 mx-auto mb-2 bg-yellow-100 dark:bg-yellow-800/50 rounded-full flex items-center justify-center">
                    <svg class="w-6 h-6 text-yellow-600 dark:text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                  </div>
                  <p class="font-semibold text-yellow-700 dark:text-yellow-400">Energy Net Zero</p>
                  <p class="text-xs text-slate-500 mt-1">On-site renewable generation</p>
                </div>
                <div class="text-center p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800/30">
                  <div class="w-12 h-12 mx-auto mb-2 bg-blue-100 dark:bg-blue-800/50 rounded-full flex items-center justify-center">
                    <svg class="w-6 h-6 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/></svg>
                  </div>
                  <p class="font-semibold text-blue-700 dark:text-blue-400">Water Net Zero</p>
                  <p class="text-xs text-slate-500 mt-1">Greywater & rainwater systems</p>
                </div>
                <div class="text-center p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800/30">
                  <div class="w-12 h-12 mx-auto mb-2 bg-green-100 dark:bg-green-800/50 rounded-full flex items-center justify-center">
                    <svg class="w-6 h-6 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
                  </div>
                  <p class="font-semibold text-green-700 dark:text-green-400">Waste Net Zero</p>
                  <p class="text-xs text-slate-500 mt-1">90%+ diversion from landfill</p>
                </div>
              </div>
            </div>

            <!-- Financial Pro Forma Impact -->
            <div class="card p-6">
              <h3 class="font-sora font-bold text-slate-900 dark:text-white mb-4">Financial Pro Forma Impact</h3>
              <table class="w-full">
                <thead>
                  <tr class="border-b border-slate-200 dark:border-slate-700">
                    <th class="text-left py-2 text-xs font-semibold text-slate-500 uppercase">Line Item</th>
                    <th class="text-right py-2 text-xs font-semibold text-slate-500 uppercase">Baseline</th>
                    <th class="text-right py-2 text-xs font-semibold text-slate-500 uppercase">Optimized</th>
                    <th class="text-right py-2 text-xs font-semibold text-slate-500 uppercase">Delta</th>
                  </tr>
                </thead>
                <tbody class="text-sm">
                  <tr class="border-b border-slate-100 dark:border-slate-800">
                    <td class="py-3 text-slate-700 dark:text-slate-300">Construction Cost</td>
                    <td class="py-3 text-right font-mono text-slate-600 dark:text-slate-400">$45,000,000</td>
                    <td class="py-3 text-right font-mono text-blue-600 dark:text-blue-400" id="proforma-construction">$46,500,000</td>
                    <td class="py-3 text-right font-mono text-red-500" id="proforma-construction-delta">+$1.5M</td>
                  </tr>
                  <tr class="border-b border-slate-100 dark:border-slate-800">
                    <td class="py-3 text-slate-700 dark:text-slate-300">Incentives & Grants</td>
                    <td class="py-3 text-right font-mono text-slate-600 dark:text-slate-400">$200,000</td>
                    <td class="py-3 text-right font-mono text-green-600 dark:text-green-400" id="proforma-incentives">$1.8M</td>
                    <td class="py-3 text-right font-mono text-green-500" id="proforma-incentives-delta">+$1.60M</td>
                  </tr>
                  <tr class="border-b border-slate-100 dark:border-slate-800">
                    <td class="py-3 text-slate-700 dark:text-slate-300">Annual OpEx Savings</td>
                    <td class="py-3 text-right font-mono text-slate-600 dark:text-slate-400">$0</td>
                    <td class="py-3 text-right font-mono text-green-600 dark:text-green-400" id="proforma-opex">$450,000</td>
                    <td class="py-3 text-right font-mono text-green-500" id="proforma-opex-delta">+$450k/yr</td>
                  </tr>
                  <tr class="bg-slate-50 dark:bg-slate-800/50">
                    <td class="py-3 font-semibold text-slate-900 dark:text-white">Net Project Cost (Year 1)</td>
                    <td class="py-3 text-right font-mono font-semibold text-slate-700 dark:text-slate-300">$44,750,000</td>
                    <td class="py-3 text-right font-mono font-semibold text-blue-600 dark:text-blue-400" id="proforma-net">$41,500,000</td>
                    <td class="py-3 text-right font-mono font-semibold text-green-500" id="proforma-net-delta">-$3.4M</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- V38: TEAM PAGE WITH HEADSHOTS (Council-approved - Rechler) -->
      <section id="section-teampage" class="section-content hidden">
        <div class="mb-6">
          <h1 class="font-sora text-2xl font-bold text-slate-900 dark:text-white mb-2">Leadership Team</h1>
          <p class="text-slate-600 dark:text-slate-400">The experts behind IncentEdge's institutional-grade platform</p>
        </div>

        <!-- Executive Team -->
        <div class="card p-6 mb-6">
          <h2 class="font-sora text-lg font-bold text-slate-900 dark:text-white mb-6">Executive Team</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <div class="text-center group">
              <div class="w-32 h-32 mx-auto mb-4 rounded-full bg-gradient-to-br from-blue-500 to-blue-700 flex items-center justify-center overflow-hidden border-4 border-white dark:border-slate-700 shadow-lg group-hover:scale-105 transition-transform">
                <span class="text-4xl font-bold text-white">AO</span>
              </div>
              <h3 class="font-semibold text-slate-900 dark:text-white">Aundre Oldacre</h3>
              <p class="text-sm text-blue-600 dark:text-blue-400 font-medium">CEO & Founder</p>
              <p class="text-xs text-slate-500 mt-2">Former Goldman Sachs, 15+ years RE development</p>
              <div class="flex justify-center gap-2 mt-3">
                <a href="#" class="w-8 h-8 bg-slate-100 dark:bg-slate-800 rounded-full flex items-center justify-center hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors">
                  <svg class="w-4 h-4 text-slate-600 dark:text-slate-400" fill="currentColor" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg>
                </a>
              </div>
            </div>
            <div class="text-center group">
              <div class="w-32 h-32 mx-auto mb-4 rounded-full bg-gradient-to-br from-green-500 to-emerald-600 flex items-center justify-center overflow-hidden border-4 border-white dark:border-slate-700 shadow-lg group-hover:scale-105 transition-transform">
                <span class="text-4xl font-bold text-white">SC</span>
              </div>
              <h3 class="font-semibold text-slate-900 dark:text-white">Sarah Chen</h3>
              <p class="text-sm text-blue-600 dark:text-blue-400 font-medium">Chief Technology Officer</p>
              <p class="text-xs text-slate-500 mt-2">Ex-Google, MIT AI Lab, PropTech pioneer</p>
              <div class="flex justify-center gap-2 mt-3">
                <a href="#" class="w-8 h-8 bg-slate-100 dark:bg-slate-800 rounded-full flex items-center justify-center hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors">
                  <svg class="w-4 h-4 text-slate-600 dark:text-slate-400" fill="currentColor" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg>
                </a>
              </div>
            </div>
            <div class="text-center group">
              <div class="w-32 h-32 mx-auto mb-4 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center overflow-hidden border-4 border-white dark:border-slate-700 shadow-lg group-hover:scale-105 transition-transform">
                <span class="text-4xl font-bold text-white">MJ</span>
              </div>
              <h3 class="font-semibold text-slate-900 dark:text-white">Marcus Johnson</h3>
              <p class="text-sm text-blue-600 dark:text-blue-400 font-medium">Chief Operating Officer</p>
              <p class="text-xs text-slate-500 mt-2">Former Blackstone, $2B+ deals structured</p>
              <div class="flex justify-center gap-2 mt-3">
                <a href="#" class="w-8 h-8 bg-slate-100 dark:bg-slate-800 rounded-full flex items-center justify-center hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors">
                  <svg class="w-4 h-4 text-slate-600 dark:text-slate-400" fill="currentColor" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg>
                </a>
              </div>
            </div>
            <div class="text-center group">
              <div class="w-32 h-32 mx-auto mb-4 rounded-full bg-gradient-to-br from-amber-500 to-orange-500 flex items-center justify-center overflow-hidden border-4 border-white dark:border-slate-700 shadow-lg group-hover:scale-105 transition-transform">
                <span class="text-4xl font-bold text-white">EP</span>
              </div>
              <h3 class="font-semibold text-slate-900 dark:text-white">Elena Petrova</h3>
              <p class="text-sm text-blue-600 dark:text-blue-400 font-medium">Chief Revenue Officer</p>
              <p class="text-xs text-slate-500 mt-2">Ex-Salesforce, SaaS growth expert</p>
              <div class="flex justify-center gap-2 mt-3">
                <a href="#" class="w-8 h-8 bg-slate-100 dark:bg-slate-800 rounded-full flex items-center justify-center hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors">
                  <svg class="w-4 h-4 text-slate-600 dark:text-slate-400" fill="currentColor" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg>
                </a>
              </div>
            </div>
          </div>
        </div>

        <!-- Advisory Board -->
        <div class="card p-6">
          <h2 class="font-sora text-lg font-bold text-slate-900 dark:text-white mb-6">Advisory Board</h2>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="flex items-center gap-4 p-4 bg-slate-50 dark:bg-slate-800/50 rounded-xl">
              <div class="w-16 h-16 rounded-full bg-gradient-to-br from-slate-600 to-slate-800 flex items-center justify-center flex-shrink-0">
                <span class="text-xl font-bold text-white">SR</span>
              </div>
              <div>
                <h3 class="font-semibold text-slate-900 dark:text-white">Scott Rechler</h3>
                <p class="text-sm text-blue-600 dark:text-blue-400">Chairman, RXR Realty</p>
                <p class="text-xs text-slate-500 mt-1">$20B+ portfolio</p>
              </div>
            </div>
            <div class="flex items-center gap-4 p-4 bg-slate-50 dark:bg-slate-800/50 rounded-xl">
              <div class="w-16 h-16 rounded-full bg-gradient-to-br from-slate-600 to-slate-800 flex items-center justify-center flex-shrink-0">
                <span class="text-xl font-bold text-white">RM</span>
              </div>
              <div>
                <h3 class="font-semibold text-slate-900 dark:text-white">Ron Moelis</h3>
                <p class="text-sm text-blue-600 dark:text-blue-400">CEO, L+M Development</p>
                <p class="text-xs text-slate-500 mt-1">35,000+ affordable units</p>
              </div>
            </div>
            <div class="flex items-center gap-4 p-4 bg-slate-50 dark:bg-slate-800/50 rounded-xl">
              <div class="w-16 h-16 rounded-full bg-gradient-to-br from-slate-600 to-slate-800 flex items-center justify-center flex-shrink-0">
                <span class="text-xl font-bold text-white">MM</span>
              </div>
              <div>
                <h3 class="font-semibold text-slate-900 dark:text-white">Meredith Marshall</h3>
                <p class="text-sm text-blue-600 dark:text-blue-400">Co-Founder, BRP Companies</p>
                <p class="text-xs text-slate-500 mt-1">$3B affordable housing</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- V38: INTEGRATIONS PAGE (Council-approved - Rechler) -->
      <section id="section-integrations" class="section-content hidden">
        <div class="mb-6">
          <h1 class="font-sora text-2xl font-bold text-slate-900 dark:text-white mb-2">Integrations</h1>
          <p class="text-slate-600 dark:text-slate-400">Connect IncentEdge with your existing tools and government databases</p>
        </div>

        <!-- Connection Stats -->
        <div class="grid grid-cols-4 gap-4 mb-6">
          <div class="card p-4 text-center">
            <p class="text-3xl font-bold text-blue-600 dark:text-blue-400 font-mono">24</p>
            <p class="text-xs text-slate-500 uppercase tracking-wider">Active Connections</p>
          </div>
          <div class="card p-4 text-center">
            <p class="text-3xl font-bold text-green-600 dark:text-green-400 font-mono">2.4k</p>
            <p class="text-xs text-slate-500 uppercase tracking-wider">API Calls/min</p>
          </div>
          <div class="card p-4 text-center">
            <p class="text-3xl font-bold text-purple-600 dark:text-purple-400 font-mono">99.9%</p>
            <p class="text-xs text-slate-500 uppercase tracking-wider">Uptime</p>
          </div>
          <div class="card p-4 text-center">
            <p class="text-3xl font-bold text-amber-600 dark:text-amber-400 font-mono">45ms</p>
            <p class="text-xs text-slate-500 uppercase tracking-wider">Avg Latency</p>
          </div>
        </div>

        <!-- Government Databases -->
        <div class="card p-6 mb-6">
          <div class="flex items-center justify-between mb-4">
            <h2 class="font-sora text-lg font-bold text-slate-900 dark:text-white">Government Databases</h2>
            <span class="text-xs text-green-500 font-medium flex items-center gap-1"><span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span> All Connected</span>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <div class="flex items-center gap-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-200 dark:border-blue-800">
              <div class="w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center flex-shrink-0">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
              </div>
              <div class="flex-1">
                <h3 class="font-semibold text-slate-900 dark:text-white">IRS 45L Database</h3>
                <p class="text-xs text-slate-500">Energy efficient home credits</p>
              </div>
              <span class="px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs font-medium rounded-full">Live</span>
            </div>
            <div class="flex items-center gap-4 p-4 bg-green-50 dark:bg-green-900/20 rounded-xl border border-green-200 dark:border-green-800">
              <div class="w-12 h-12 bg-green-600 rounded-lg flex items-center justify-center flex-shrink-0">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
              </div>
              <div class="flex-1">
                <h3 class="font-semibold text-slate-900 dark:text-white">HUD Grants Portal</h3>
                <p class="text-xs text-slate-500">CDBG, HOME, Section 8</p>
              </div>
              <span class="px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs font-medium rounded-full">Live</span>
            </div>
            <div class="flex items-center gap-4 p-4 bg-purple-50 dark:bg-purple-900/20 rounded-xl border border-purple-200 dark:border-purple-800">
              <div class="w-12 h-12 bg-purple-600 rounded-lg flex items-center justify-center flex-shrink-0">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
              </div>
              <div class="flex-1">
                <h3 class="font-semibold text-slate-900 dark:text-white">State Tax Credit Registry</h3>
                <p class="text-xs text-slate-500">50 state databases</p>
              </div>
              <span class="px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs font-medium rounded-full">Live</span>
            </div>
            <div class="flex items-center gap-4 p-4 bg-amber-50 dark:bg-amber-900/20 rounded-xl border border-amber-200 dark:border-amber-800">
              <div class="w-12 h-12 bg-amber-600 rounded-lg flex items-center justify-center flex-shrink-0">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
              </div>
              <div class="flex-1">
                <h3 class="font-semibold text-slate-900 dark:text-white">DOE Loan Programs</h3>
                <p class="text-xs text-slate-500">LPO, CIFIA, WIFIA</p>
              </div>
              <span class="px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs font-medium rounded-full">Live</span>
            </div>
            <div class="flex items-center gap-4 p-4 bg-teal-50 dark:bg-teal-900/20 rounded-xl border border-teal-200 dark:border-teal-800">
              <div class="w-12 h-12 bg-teal-600 rounded-lg flex items-center justify-center flex-shrink-0">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
              </div>
              <div class="flex-1">
                <h3 class="font-semibold text-slate-900 dark:text-white">EPA ENERGY STAR</h3>
                <p class="text-xs text-slate-500">Portfolio Manager API</p>
              </div>
              <span class="px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs font-medium rounded-full">Live</span>
            </div>
            <div class="flex items-center gap-4 p-4 bg-red-50 dark:bg-red-900/20 rounded-xl border border-red-200 dark:border-red-800">
              <div class="w-12 h-12 bg-red-600 rounded-lg flex items-center justify-center flex-shrink-0">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z"/></svg>
              </div>
              <div class="flex-1">
                <h3 class="font-semibold text-slate-900 dark:text-white">USDA REAP</h3>
                <p class="text-xs text-slate-500">Rural energy grants</p>
              </div>
              <span class="px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs font-medium rounded-full">Live</span>
            </div>
          </div>
        </div>

        <!-- Third-Party Integrations -->
        <div class="card p-6">
          <h2 class="font-sora text-lg font-bold text-slate-900 dark:text-white mb-4">Third-Party Integrations</h2>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <button class="p-4 bg-slate-50 dark:bg-slate-800/50 rounded-xl border border-slate-200 dark:border-slate-700 hover:border-blue-500 transition-colors text-center">
              <div class="w-12 h-12 mx-auto mb-2 bg-[#0061FF] rounded-lg flex items-center justify-center">
                <span class="text-white font-bold text-lg">db</span>
              </div>
              <p class="text-sm font-medium text-slate-900 dark:text-white">Dropbox</p>
              <p class="text-xs text-green-500">Connected</p>
            </button>
            <button class="p-4 bg-slate-50 dark:bg-slate-800/50 rounded-xl border border-slate-200 dark:border-slate-700 hover:border-blue-500 transition-colors text-center">
              <div class="w-12 h-12 mx-auto mb-2 bg-[#4285F4] rounded-lg flex items-center justify-center">
                <span class="text-white font-bold text-lg">G</span>
              </div>
              <p class="text-sm font-medium text-slate-900 dark:text-white">Google Drive</p>
              <p class="text-xs text-green-500">Connected</p>
            </button>
            <button class="p-4 bg-slate-50 dark:bg-slate-800/50 rounded-xl border border-slate-200 dark:border-slate-700 hover:border-blue-500 transition-colors text-center">
              <div class="w-12 h-12 mx-auto mb-2 bg-[#00A4EF] rounded-lg flex items-center justify-center">
                <span class="text-white font-bold text-lg">M</span>
              </div>
              <p class="text-sm font-medium text-slate-900 dark:text-white">Microsoft 365</p>
              <p class="text-xs text-green-500">Connected</p>
            </button>
            <button class="p-4 bg-slate-50 dark:bg-slate-800/50 rounded-xl border border-slate-200 dark:border-slate-700 hover:border-blue-500 transition-colors text-center">
              <div class="w-12 h-12 mx-auto mb-2 bg-[#6264A7] rounded-lg flex items-center justify-center">
                <span class="text-white font-bold text-lg">S</span>
              </div>
              <p class="text-sm font-medium text-slate-900 dark:text-white">Salesforce</p>
              <p class="text-xs text-slate-400">Connect</p>
            </button>
          </div>
        </div>
      </section>

      <!-- V38: SYSTEM STATUS PAGE (Council-approved - Musk) -->
      <section id="section-systemstatus" class="section-content hidden">
        <div class="mb-6">
          <div class="flex items-center justify-between">
            <div>
              <h1 class="font-sora text-2xl font-bold text-slate-900 dark:text-white mb-2">System Status</h1>
              <p class="text-slate-600 dark:text-slate-400">Real-time infrastructure monitoring and security status</p>
            </div>
            <div class="flex items-center gap-2 px-4 py-2 bg-green-100 dark:bg-green-900/30 rounded-full">
              <span class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></span>
              <span class="text-green-700 dark:text-green-400 font-semibold">All Systems Operational</span>
            </div>
          </div>
        </div>

        <!-- Key Metrics -->
        <div class="grid grid-cols-4 gap-4 mb-6">
          <div class="card p-4">
            <div class="flex items-center justify-between mb-2">
              <span class="text-xs text-slate-500 uppercase tracking-wider">Uptime</span>
              <span class="w-2 h-2 bg-green-500 rounded-full"></span>
            </div>
            <p class="text-3xl font-bold text-slate-900 dark:text-white font-mono">99.8%</p>
            <p class="text-xs text-slate-500">Last 90 days</p>
          </div>
          <div class="card p-4">
            <div class="flex items-center justify-between mb-2">
              <span class="text-xs text-slate-500 uppercase tracking-wider">Latency</span>
              <span class="w-2 h-2 bg-green-500 rounded-full"></span>
            </div>
            <p class="text-3xl font-bold text-slate-900 dark:text-white font-mono">142ms</p>
            <p class="text-xs text-slate-500">P95 response time</p>
          </div>
          <div class="card p-4">
            <div class="flex items-center justify-between mb-2">
              <span class="text-xs text-slate-500 uppercase tracking-wider">API Requests</span>
              <span class="w-2 h-2 bg-green-500 rounded-full"></span>
            </div>
            <p class="text-3xl font-bold text-slate-900 dark:text-white font-mono">2.4k</p>
            <p class="text-xs text-slate-500">Requests/min</p>
          </div>
          <div class="card p-4">
            <div class="flex items-center justify-between mb-2">
              <span class="text-xs text-slate-500 uppercase tracking-wider">Error Rate</span>
              <span class="w-2 h-2 bg-green-500 rounded-full"></span>
            </div>
            <p class="text-3xl font-bold text-slate-900 dark:text-white font-mono">0.02%</p>
            <p class="text-xs text-slate-500">Last 24 hours</p>
          </div>
        </div>

        <!-- Service Status -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
          <div class="card p-6">
            <h2 class="font-sora text-lg font-bold text-slate-900 dark:text-white mb-4">Service Status</h2>
            <div class="space-y-3">
              <div class="flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800/50 rounded-lg">
                <div class="flex items-center gap-3">
                  <span class="w-3 h-3 bg-green-500 rounded-full"></span>
                  <span class="text-sm font-medium text-slate-900 dark:text-white">API Gateway</span>
                </div>
                <span class="text-xs text-green-500 font-medium">Operational</span>
              </div>
              <div class="flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800/50 rounded-lg">
                <div class="flex items-center gap-3">
                  <span class="w-3 h-3 bg-green-500 rounded-full"></span>
                  <span class="text-sm font-medium text-slate-900 dark:text-white">Database Cluster</span>
                </div>
                <span class="text-xs text-green-500 font-medium">Operational</span>
              </div>
              <div class="flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800/50 rounded-lg">
                <div class="flex items-center gap-3">
                  <span class="w-3 h-3 bg-green-500 rounded-full"></span>
                  <span class="text-sm font-medium text-slate-900 dark:text-white">AI Inference Engine</span>
                </div>
                <span class="text-xs text-green-500 font-medium">Operational</span>
              </div>
              <div class="flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800/50 rounded-lg">
                <div class="flex items-center gap-3">
                  <span class="w-3 h-3 bg-green-500 rounded-full"></span>
                  <span class="text-sm font-medium text-slate-900 dark:text-white">Authentication Service</span>
                </div>
                <span class="text-xs text-green-500 font-medium">Operational</span>
              </div>
              <div class="flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800/50 rounded-lg">
                <div class="flex items-center gap-3">
                  <span class="w-3 h-3 bg-green-500 rounded-full"></span>
                  <span class="text-sm font-medium text-slate-900 dark:text-white">Document Storage</span>
                </div>
                <span class="text-xs text-green-500 font-medium">Operational</span>
              </div>
            </div>
          </div>

          <!-- Security Status -->
          <div class="card p-6">
            <h2 class="font-sora text-lg font-bold text-slate-900 dark:text-white mb-4">Security Status</h2>
            <div class="space-y-4">
              <div class="flex items-center justify-between p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800">
                <div class="flex items-center gap-3">
                  <svg class="w-5 h-5 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
                  <span class="text-sm font-medium text-slate-900 dark:text-white">Encryption</span>
                </div>
                <span class="text-sm text-green-600 dark:text-green-400 font-mono">AES-256</span>
              </div>
              <div class="flex items-center justify-between p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800">
                <div class="flex items-center gap-3">
                  <svg class="w-5 h-5 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
                  <span class="text-sm font-medium text-slate-900 dark:text-white">Compliance</span>
                </div>
                <span class="text-sm text-green-600 dark:text-green-400 font-mono">SOC 2 Type II</span>
              </div>
              <div class="flex items-center justify-between p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800">
                <div class="flex items-center gap-3">
                  <svg class="w-5 h-5 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                  <span class="text-sm font-medium text-slate-900 dark:text-white">WAF Protection</span>
                </div>
                <span class="text-sm text-green-600 dark:text-green-400 font-mono">Active</span>
              </div>
              <div class="flex items-center justify-between p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800">
                <div class="flex items-center gap-3">
                  <svg class="w-5 h-5 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                  <span class="text-sm font-medium text-slate-900 dark:text-white">Last Security Scan</span>
                </div>
                <span class="text-sm text-green-600 dark:text-green-400 font-mono">2 hours ago</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Recent Incidents -->
        <div class="card p-6">
          <h2 class="font-sora text-lg font-bold text-slate-900 dark:text-white mb-4">Recent Activity</h2>
          <div class="space-y-3">
            <div class="flex items-start gap-3 p-3 bg-slate-50 dark:bg-slate-800/50 rounded-lg">
              <span class="w-2 h-2 mt-2 bg-green-500 rounded-full"></span>
              <div>
                <p class="text-sm text-slate-900 dark:text-white">System maintenance completed successfully</p>
                <p class="text-xs text-slate-500">Jan 11, 2026 - 03:00 EST</p>
              </div>
            </div>
            <div class="flex items-start gap-3 p-3 bg-slate-50 dark:bg-slate-800/50 rounded-lg">
              <span class="w-2 h-2 mt-2 bg-blue-500 rounded-full"></span>
              <div>
                <p class="text-sm text-slate-900 dark:text-white">New AI model deployed (v2.4.1)</p>
                <p class="text-xs text-slate-500">Jan 10, 2026 - 14:30 EST</p>
              </div>
            </div>
            <div class="flex items-start gap-3 p-3 bg-slate-50 dark:bg-slate-800/50 rounded-lg">
              <span class="w-2 h-2 mt-2 bg-green-500 rounded-full"></span>
              <div>
                <p class="text-sm text-slate-900 dark:text-white">Database cluster scaling completed</p>
                <p class="text-xs text-slate-500">Jan 9, 2026 - 22:15 EST</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- V38: REPOSITORY PAGE (Council-approved - Zell) -->
      <section id="section-repository" class="section-content hidden">
        <div class="mb-6">
          <div class="flex items-center justify-between">
            <div>
              <h1 class="font-sora text-2xl font-bold text-slate-900 dark:text-white mb-2">Grant Writing Repository</h1>
              <p class="text-slate-600 dark:text-slate-400">Templates, guides, and resources for accelerated applications</p>
            </div>
            <button class="btn btn-primary">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
              Upload Document
            </button>
          </div>
        </div>

        <!-- Filter Bar -->
        <div class="card p-4 mb-6">
          <div class="flex items-center gap-4 flex-wrap">
            <div class="flex items-center gap-2">
              <span class="text-sm text-slate-500">Category:</span>
              <select class="px-3 py-1.5 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-lg text-sm" onchange="filterRepository(this.value)">
                <option value="all">All Documents</option>
                <option value="templates">Templates</option>
                <option value="guides">Guides</option>
                <option value="policies">Policies</option>
                <option value="excel">Excel Models</option>
              </select>
            </div>
            <div class="flex items-center gap-2 flex-1">
              <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
              <input type="text" placeholder="Search documents..." class="flex-1 px-3 py-1.5 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-lg text-sm">
            </div>
            <span class="text-sm text-slate-500">15 documents</span>
          </div>
        </div>

        <!-- Document Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <div class="card p-4 hover:border-blue-500 cursor-pointer transition-colors group">
            <div class="flex items-start gap-3">
              <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center flex-shrink-0">
                <svg class="w-5 h-5 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
              </div>
              <div class="flex-1 min-w-0">
                <h3 class="font-medium text-slate-900 dark:text-white truncate group-hover:text-blue-600">Federal Solar ITC Application Guide</h3>
                <p class="text-xs text-slate-500 mt-1">Template • Updated Jan 8, 2026</p>
                <div class="flex items-center gap-2 mt-2">
                  <span class="px-2 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 text-xs rounded-full">Federal</span>
                  <span class="px-2 py-0.5 bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 text-xs rounded-full">PDF</span>
                </div>
              </div>
            </div>
          </div>
          <div class="card p-4 hover:border-blue-500 cursor-pointer transition-colors group">
            <div class="flex items-start gap-3">
              <div class="w-10 h-10 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center flex-shrink-0">
                <svg class="w-5 h-5 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
              </div>
              <div class="flex-1 min-w-0">
                <h3 class="font-medium text-slate-900 dark:text-white truncate group-hover:text-blue-600">LIHTC Allocation Scoring Model</h3>
                <p class="text-xs text-slate-500 mt-1">Excel • Updated Jan 5, 2026</p>
                <div class="flex items-center gap-2 mt-2">
                  <span class="px-2 py-0.5 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 text-xs rounded-full">State</span>
                  <span class="px-2 py-0.5 bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 text-xs rounded-full">XLSX</span>
                </div>
              </div>
            </div>
          </div>
          <div class="card p-4 hover:border-blue-500 cursor-pointer transition-colors group">
            <div class="flex items-start gap-3">
              <div class="w-10 h-10 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center flex-shrink-0">
                <svg class="w-5 h-5 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
              </div>
              <div class="flex-1 min-w-0">
                <h3 class="font-medium text-slate-900 dark:text-white truncate group-hover:text-blue-600">Energy Community Bonus Credit Guide</h3>
                <p class="text-xs text-slate-500 mt-1">Guide • Updated Jan 3, 2026</p>
                <div class="flex items-center gap-2 mt-2">
                  <span class="px-2 py-0.5 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 text-xs rounded-full">IRA</span>
                  <span class="px-2 py-0.5 bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 text-xs rounded-full">PDF</span>
                </div>
              </div>
            </div>
          </div>
          <div class="card p-4 hover:border-blue-500 cursor-pointer transition-colors group">
            <div class="flex items-start gap-3">
              <div class="w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-lg flex items-center justify-center flex-shrink-0">
                <svg class="w-5 h-5 text-amber-600 dark:text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
              </div>
              <div class="flex-1 min-w-0">
                <h3 class="font-medium text-slate-900 dark:text-white truncate group-hover:text-blue-600">HUD CDBG Application Template</h3>
                <p class="text-xs text-slate-500 mt-1">Template • Updated Dec 28, 2025</p>
                <div class="flex items-center gap-2 mt-2">
                  <span class="px-2 py-0.5 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 text-xs rounded-full">HUD</span>
                  <span class="px-2 py-0.5 bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 text-xs rounded-full">DOCX</span>
                </div>
              </div>
            </div>
          </div>
          <div class="card p-4 hover:border-blue-500 cursor-pointer transition-colors group">
            <div class="flex items-start gap-3">
              <div class="w-10 h-10 bg-red-100 dark:bg-red-900/30 rounded-lg flex items-center justify-center flex-shrink-0">
                <svg class="w-5 h-5 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
              </div>
              <div class="flex-1 min-w-0">
                <h3 class="font-medium text-slate-900 dark:text-white truncate group-hover:text-blue-600">Historic Tax Credit Pro Forma</h3>
                <p class="text-xs text-slate-500 mt-1">Excel • Updated Dec 20, 2025</p>
                <div class="flex items-center gap-2 mt-2">
                  <span class="px-2 py-0.5 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 text-xs rounded-full">HTC</span>
                  <span class="px-2 py-0.5 bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 text-xs rounded-full">XLSX</span>
                </div>
              </div>
            </div>
          </div>
          <div class="card p-4 hover:border-blue-500 cursor-pointer transition-colors group">
            <div class="flex items-start gap-3">
              <div class="w-10 h-10 bg-teal-100 dark:bg-teal-900/30 rounded-lg flex items-center justify-center flex-shrink-0">
                <svg class="w-5 h-5 text-teal-600 dark:text-teal-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/></svg>
              </div>
              <div class="flex-1 min-w-0">
                <h3 class="font-medium text-slate-900 dark:text-white truncate group-hover:text-blue-600">IRA Section 45L Credit Application</h3>
                <p class="text-xs text-slate-500 mt-1">Guide • Updated Dec 15, 2025</p>
                <div class="flex items-center gap-2 mt-2">
                  <span class="px-2 py-0.5 bg-teal-100 dark:bg-teal-900/30 text-teal-700 dark:text-teal-300 text-xs rounded-full">45L</span>
                  <span class="px-2 py-0.5 bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 text-xs rounded-full">PDF</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

    </main>

    <!-- Footer -->
    <footer class="border-t border-slate-200 dark:border-slate-700/30 px-6 py-4 bg-white dark:bg-slate-900/50">
      <div class="flex flex-col md:flex-row items-center justify-between gap-4">
        <div class="flex flex-wrap items-center gap-3">
          <div class="flex items-center gap-2 px-3 py-1.5 bg-slate-100 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-600/30 rounded-lg">
            <svg class="w-4 h-4 text-blue-700 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
            <span class="text-xs font-medium text-slate-600 dark:text-blue-200">SOC 2 Type II</span>
          </div>
          <div class="flex items-center gap-2 px-3 py-1.5 bg-slate-100 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-600/30 rounded-lg">
            <svg class="w-4 h-4 text-blue-700 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
            <span class="text-xs font-medium text-slate-600 dark:text-blue-200">256-bit Encryption</span>
          </div>
          <div class="flex items-center gap-2 px-3 py-1.5 bg-slate-100 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-600/30 rounded-lg">
            <svg class="w-4 h-4 text-blue-700 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/></svg>
            <span class="text-xs font-medium text-slate-600 dark:text-blue-200">Data from HUD, NYSERDA, DOE, HPD</span>
          </div>
          <!-- V35: System Health Status -->
          <div class="flex items-center gap-2 px-3 py-1.5 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-700/30 rounded-lg cursor-pointer hover:bg-green-100 dark:hover:bg-green-900/30 transition-colors" onclick="showSystemStatus()">
            <span class="relative flex h-2 w-2">
              <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
              <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
            </span>
            <span class="text-xs font-medium text-green-700 dark:text-green-400">All systems operational</span>
            <span class="text-xs text-green-600 dark:text-green-500 font-mono">45ms</span>
          </div>
        </div>
        <div class="flex items-center gap-6 text-xs text-slate-500 dark:text-blue-400">
          <span>2026 IncentEdge</span>
          <a href="#" class="hover:text-slate-700 dark:hover:text-blue-200">Help</a>
          <a href="#" class="hover:text-slate-700 dark:hover:text-blue-200">Documentation</a>
          <a href="#" class="hover:text-slate-700 dark:hover:text-blue-200">API</a>
        </div>
      </div>
    </footer>
  </div>

  <!-- Compare Floating Button -->
  <div id="compare-fab" class="fixed bottom-6 left-1/2 transform -translate-x-1/2 hidden items-center gap-3 px-6 py-3 bg-gradient-to-r from-blue-700 to-blue-600 text-white rounded-full shadow-lg cursor-pointer hover:shadow-xl transition-all z-50" onclick="openCompareModal()">
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
    <span class="font-semibold">Compare Projects</span>
    <span class="w-6 h-6 bg-white/20 rounded-full flex items-center justify-center text-sm font-bold" id="compare-count">0</span>
  </div>

  <!-- Compare Modal -->
  <div id="compare-overlay" class="modal-overlay" onclick="closeCompareModal()"></div>
  <div id="compare-modal" class="modal-content">
    <div class="p-6 border-b border-slate-200 dark:border-slate-700/30 flex items-center justify-between">
      <div>
        <h2 class="font-sora text-xl font-bold text-slate-900 dark:text-white">Project Comparison</h2>
        <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">Side-by-side analysis of selected projects</p>
      </div>
      <button onclick="closeCompareModal()" class="w-10 h-10 flex items-center justify-center text-slate-400 hover:text-slate-600 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700/50 transition-all">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
      </button>
    </div>
    <div class="p-6 overflow-y-auto max-h-[60vh]" id="compare-content">
      <p class="text-slate-500 text-center">Select 2-4 projects to compare</p>
    </div>
  </div>

  <!-- V33: Keyboard Shortcuts Help Modal -->
  <div id="keyboard-help-overlay" class="modal-overlay" onclick="closeKeyboardHelp()"></div>
  <div id="keyboard-help-modal" class="modal-content" style="max-width: 500px;">
    <div class="p-4 border-b border-slate-200 dark:border-slate-700/30 flex justify-between items-center">
      <h2 class="text-lg font-semibold text-slate-900 dark:text-white">Keyboard Shortcuts</h2>
      <button onclick="closeKeyboardHelp()" class="w-8 h-8 flex items-center justify-center text-slate-400 hover:text-slate-600 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700/50">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
      </button>
    </div>
    <div class="p-4 space-y-4">
      <div>
        <h3 class="text-xs font-semibold text-slate-500 uppercase mb-2">Navigation</h3>
        <div class="space-y-2">
          <div class="flex justify-between"><span class="text-sm text-slate-600 dark:text-slate-300">Dashboard</span><kbd class="px-2 py-1 bg-slate-100 dark:bg-slate-700 text-xs rounded">D</kbd></div>
          <div class="flex justify-between"><span class="text-sm text-slate-600 dark:text-slate-300">Analysis</span><kbd class="px-2 py-1 bg-slate-100 dark:bg-slate-700 text-xs rounded">A</kbd></div>
          <div class="flex justify-between"><span class="text-sm text-slate-600 dark:text-slate-300">Capital Stack</span><kbd class="px-2 py-1 bg-slate-100 dark:bg-slate-700 text-xs rounded">C</kbd></div>
          <div class="flex justify-between"><span class="text-sm text-slate-600 dark:text-slate-300">ROI Calculator</span><kbd class="px-2 py-1 bg-slate-100 dark:bg-slate-700 text-xs rounded">R</kbd></div>
          <div class="flex justify-between"><span class="text-sm text-slate-600 dark:text-slate-300">EJ Map</span><kbd class="px-2 py-1 bg-slate-100 dark:bg-slate-700 text-xs rounded">E</kbd></div>
          <div class="flex justify-between"><span class="text-sm text-slate-600 dark:text-slate-300">Programs</span><kbd class="px-2 py-1 bg-slate-100 dark:bg-slate-700 text-xs rounded">P</kbd></div>
        </div>
      </div>
      <div>
        <h3 class="text-xs font-semibold text-slate-500 uppercase mb-2">Actions</h3>
        <div class="space-y-2">
          <div class="flex justify-between"><span class="text-sm text-slate-600 dark:text-slate-300">Command Palette</span><kbd class="px-2 py-1 bg-slate-100 dark:bg-slate-700 text-xs rounded">Cmd/Ctrl + K</kbd></div>
          <div class="flex justify-between"><span class="text-sm text-slate-600 dark:text-slate-300">Search</span><kbd class="px-2 py-1 bg-slate-100 dark:bg-slate-700 text-xs rounded">/</kbd></div>
          <div class="flex justify-between"><span class="text-sm text-slate-600 dark:text-slate-300">Compare Projects</span><kbd class="px-2 py-1 bg-slate-100 dark:bg-slate-700 text-xs rounded">Shift + C</kbd></div>
          <div class="flex justify-between"><span class="text-sm text-slate-600 dark:text-slate-300">New Project</span><kbd class="px-2 py-1 bg-slate-100 dark:bg-slate-700 text-xs rounded">N</kbd></div>
          <div class="flex justify-between"><span class="text-sm text-slate-600 dark:text-slate-300">Close/Cancel</span><kbd class="px-2 py-1 bg-slate-100 dark:bg-slate-700 text-xs rounded">Esc</kbd></div>
          <div class="flex justify-between"><span class="text-sm text-slate-600 dark:text-slate-300">This Help</span><kbd class="px-2 py-1 bg-slate-100 dark:bg-slate-700 text-xs rounded">?</kbd></div>
        </div>
      </div>
    </div>
  </div>

  <!-- V40: Ask Us Modal (Bob White's key recommendation) -->
  <div id="askus-overlay" class="modal-overlay" onclick="closeAskUsModal()"></div>
  <div id="askus-modal" class="modal-content" style="max-width: 500px;">
    <div class="p-5 border-b border-slate-200 dark:border-slate-700/30 flex justify-between items-center bg-gradient-to-r from-teal-500 to-teal-600">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center">
          <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
        </div>
        <div>
          <h2 class="text-lg font-semibold text-white">Ask Us Anything</h2>
          <p class="text-sm text-white/80">We typically respond within 24 hours</p>
        </div>
      </div>
      <button onclick="closeAskUsModal()" class="w-8 h-8 flex items-center justify-center text-white/80 hover:text-white rounded-lg hover:bg-white/10">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
      </button>
    </div>
    <div class="p-5 space-y-4">
      <div>
        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">What can we help you with?</label>
        <select id="askus-topic" class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white">
          <option value="incentives">Understanding available incentives</option>
          <option value="eligibility">Checking my project's eligibility</option>
          <option value="application">Help with an application</option>
          <option value="compliance">Compliance requirements</option>
          <option value="pricing">Pricing and plans</option>
          <option value="demo">Request a personalized demo</option>
          <option value="other">Something else</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Your question or message</label>
        <textarea id="askus-message" rows="4" class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white resize-none" placeholder="Tell us about your project or ask us anything about incentives..."></textarea>
      </div>
      <div class="grid grid-cols-2 gap-3">
        <div>
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Your name</label>
          <input type="text" id="askus-name" class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white" placeholder="John Smith">
        </div>
        <div>
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Email</label>
          <input type="email" id="askus-email" class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white" placeholder="john@company.com">
        </div>
      </div>
      <div class="pt-2">
        <button onclick="submitAskUs()" class="w-full py-3 bg-gradient-to-r from-teal-500 to-teal-600 hover:from-teal-600 hover:to-teal-700 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transition-all flex items-center justify-center gap-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/></svg>
          Send Message
        </button>
      </div>
      <p class="text-xs text-center text-slate-500 dark:text-slate-400">Or email us directly at <a href="mailto:hello@incentedge.com" class="text-teal-500 hover:underline">hello@incentedge.com</a></p>
    </div>
  </div>

  <!-- Command Palette -->
  <div id="command-overlay" class="command-overlay" onclick="closeCommandPalette()"></div>
  <div id="command-modal" class="command-modal">
    <div class="p-4 border-b border-slate-200 dark:border-slate-700/30 flex items-center gap-3">
      <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
      <input type="text" id="command-input" class="flex-1 bg-transparent border-none outline-none text-slate-900 dark:text-white text-base" placeholder="Type a command or search..." autocomplete="off">
      <kbd class="px-2 py-1 bg-slate-100 dark:bg-slate-700/50 text-slate-500 text-xs rounded">ESC</kbd>
    </div>
    <div class="max-h-80 overflow-y-auto p-2" id="command-results"></div>
    <div class="p-3 border-t border-slate-200 dark:border-slate-700/30 flex justify-between text-xs text-slate-500">
      <span><kbd class="px-1 bg-slate-100 dark:bg-slate-700/50 rounded">↑</kbd><kbd class="px-1 bg-slate-100 dark:bg-slate-700/50 rounded ml-1">↓</kbd> navigate</span>
      <span><kbd class="px-1 bg-slate-100 dark:bg-slate-700/50 rounded">↵</kbd> select</span>
    </div>
  </div>

  <!-- Toast Container -->
  <!-- V19 AI Features -->

  <!-- V34: Mobile Quick Actions FAB (visible only on mobile) -->
  <div id="mobile-quick-actions" class="fixed bottom-6 left-6 z-50 lg:hidden">
    <button onclick="toggleMobileQuickActions()" id="mobile-qa-btn" class="w-14 h-14 rounded-full bg-gradient-to-br from-blue-700 to-blue-900 text-white shadow-lg hover:shadow-xl transition-all flex items-center justify-center">
      <svg id="mobile-qa-icon" class="w-6 h-6 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
    </button>
    <div id="mobile-qa-menu" class="hidden absolute bottom-16 left-0 w-48 bg-slate-800 border border-slate-600 rounded-lg shadow-xl p-2">
      <button onclick="switchSection('portfolio'); toggleMobileQuickActions();" class="w-full text-left px-3 py-2 text-sm text-white hover:bg-slate-700 rounded flex items-center gap-2">
        <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6z"/></svg>
        Dashboard
      </button>
      <button onclick="switchSection('analysis'); toggleMobileQuickActions();" class="w-full text-left px-3 py-2 text-sm text-white hover:bg-slate-700 rounded flex items-center gap-2">
        <svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
        New Analysis
      </button>
      <button onclick="switchSection('capitalstack'); toggleMobileQuickActions();" class="w-full text-left px-3 py-2 text-sm text-white hover:bg-slate-700 rounded flex items-center gap-2">
        <svg class="w-4 h-4 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
        Capital Stack
      </button>
      <button onclick="switchSection('calculator'); toggleMobileQuickActions();" class="w-full text-left px-3 py-2 text-sm text-white hover:bg-slate-700 rounded flex items-center gap-2">
        <svg class="w-4 h-4 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>
        ROI Calculator
      </button>
      <div class="border-t border-slate-600 my-1"></div>
      <button onclick="openCommandPalette(); toggleMobileQuickActions();" class="w-full text-left px-3 py-2 text-sm text-white hover:bg-slate-700 rounded flex items-center gap-2">
        <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
        Search
      </button>
    </div>
  </div>

  <!-- AI Chat Widget (Floating) -->
  <div id="ai-chat-widget" class="fixed bottom-6 right-6 z-50">
    <!-- Chat Button -->
    <button id="ai-chat-btn" onclick="toggleAIChat()" class="w-14 h-14 rounded-full bg-gradient-to-br from-blue-600 to-blue-800 text-white shadow-lg hover:shadow-xl transition-all flex items-center justify-center group">
      <svg id="ai-chat-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
      <span class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full text-xs font-bold flex items-center justify-center animate-pulse">AI</span>
    </button>

    <!-- Chat Panel -->
    <div id="ai-chat-panel" class="hidden absolute bottom-20 right-0 w-96 bg-white dark:bg-slate-800 rounded-2xl shadow-2xl border border-slate-200 dark:border-slate-700 overflow-hidden">
      <div class="bg-gradient-to-r from-blue-700 to-blue-800 text-white p-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
            </div>
            <div>
              <h3 class="font-semibold">IncentEdge AI</h3>
              <p class="text-xs text-white/80">Your incentive intelligence assistant</p>
            </div>
          </div>
          <button onclick="toggleAIChat()" class="text-white/70 hover:text-white">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
          </button>
        </div>
      </div>

      <div class="h-80 overflow-y-auto p-4 space-y-4" id="ai-chat-messages">
        <div class="flex gap-3">
          <div class="w-8 h-8 rounded-full bg-gradient-to-br from-blue-600 to-blue-800 flex-shrink-0 flex items-center justify-center text-white text-xs font-bold">AI</div>
          <div class="bg-slate-100 dark:bg-slate-700 rounded-2xl rounded-tl-none p-3 max-w-[85%]">
            <p class="text-sm text-slate-700 dark:text-slate-200">Hi! I'm your AI assistant for incentive intelligence. I can help you:</p>
            <ul class="text-sm text-slate-600 dark:text-slate-300 mt-2 space-y-1">
              <li>• Analyze program eligibility</li>
              <li>• Estimate potential savings</li>
              <li>• Track deadlines and requirements</li>
              <li>• Generate compliance reports</li>
            </ul>
            <p class="text-sm text-slate-700 dark:text-slate-200 mt-2">How can I help you today?</p>
          </div>
        </div>
      </div>

      <div class="p-4 border-t border-slate-200 dark:border-slate-700">
        <div class="flex gap-2">
          <input type="text" id="ai-chat-input" placeholder="Ask about incentives..." class="flex-1 px-4 py-2 rounded-full border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" onkeypress="if(event.key==='Enter')sendAIMessage()">
          <button onclick="sendAIMessage()" class="w-10 h-10 rounded-full bg-blue-700 hover:bg-slate-600 text-white flex items-center justify-center transition-colors">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/></svg>
          </button>
        </div>
        <div class="flex gap-2 mt-3">
          <button onclick="askAI('What deadlines are coming up?')" class="text-xs px-3 py-1.5 bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 rounded-full hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors">Upcoming deadlines</button>
          <button onclick="askAI('Which programs have highest ROI?')" class="text-xs px-3 py-1.5 bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 rounded-full hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors">Highest ROI</button>
        </div>
      </div>
    </div>
  </div>

  <!-- V24: AI Recommendations integrated into main UI, floating badge removed -->

  <div id="toast-container" class="toast-container"></div>

  <!-- Keyboard Shortcuts Modal -->
  <div class="modal-overlay" id="shortcuts-overlay" onclick="closeShortcutsModal()"></div>
  <div class="modal-content" id="shortcuts-modal" style="max-width: 600px;">
    <div class="p-6 border-b border-slate-200 dark:border-slate-700/30">
      <div class="flex items-center justify-between">
        <div>
          <h2 class="text-xl font-bold text-slate-900 dark:text-white">Keyboard Shortcuts</h2>
          <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">Power user shortcuts for faster navigation</p>
        </div>
        <button onclick="closeShortcutsModal()" class="w-10 h-10 flex items-center justify-center text-slate-400 hover:text-slate-600 dark:hover:text-white hover:bg-slate-100 dark:hover:bg-slate-700/50 rounded-lg transition-all">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
    </div>
    <div class="p-6 space-y-6">
      <!-- Navigation -->
      <div>
        <h3 class="text-sm font-semibold text-slate-500 uppercase tracking-wider mb-3">Navigation</h3>
        <div class="space-y-2">
          <div class="flex items-center justify-between py-2">
            <span class="text-sm text-slate-700 dark:text-slate-300">Open command palette</span>
            <div class="flex items-center gap-1">
              <kbd class="px-2 py-1 bg-slate-100 dark:bg-slate-700/50 text-slate-600 dark:text-slate-300 text-xs rounded font-mono">Ctrl</kbd>
              <span class="text-slate-400">+</span>
              <kbd class="px-2 py-1 bg-slate-100 dark:bg-slate-700/50 text-slate-600 dark:text-slate-300 text-xs rounded font-mono">K</kbd>
            </div>
          </div>
          <div class="flex items-center justify-between py-2">
            <span class="text-sm text-slate-700 dark:text-slate-300">Go to Portfolio</span>
            <div class="flex items-center gap-1">
              <kbd class="px-2 py-1 bg-slate-100 dark:bg-slate-700/50 text-slate-600 dark:text-slate-300 text-xs rounded font-mono">G</kbd>
              <span class="text-slate-400">then</span>
              <kbd class="px-2 py-1 bg-slate-100 dark:bg-slate-700/50 text-slate-600 dark:text-slate-300 text-xs rounded font-mono">P</kbd>
            </div>
          </div>
          <div class="flex items-center justify-between py-2">
            <span class="text-sm text-slate-700 dark:text-slate-300">Go to Capital Stack</span>
            <div class="flex items-center gap-1">
              <kbd class="px-2 py-1 bg-slate-100 dark:bg-slate-700/50 text-slate-600 dark:text-slate-300 text-xs rounded font-mono">G</kbd>
              <span class="text-slate-400">then</span>
              <kbd class="px-2 py-1 bg-slate-100 dark:bg-slate-700/50 text-slate-600 dark:text-slate-300 text-xs rounded font-mono">C</kbd>
            </div>
          </div>
          <div class="flex items-center justify-between py-2">
            <span class="text-sm text-slate-700 dark:text-slate-300">Go to ROI Calculator</span>
            <div class="flex items-center gap-1">
              <kbd class="px-2 py-1 bg-slate-100 dark:bg-slate-700/50 text-slate-600 dark:text-slate-300 text-xs rounded font-mono">G</kbd>
              <span class="text-slate-400">then</span>
              <kbd class="px-2 py-1 bg-slate-100 dark:bg-slate-700/50 text-slate-600 dark:text-slate-300 text-xs rounded font-mono">R</kbd>
            </div>
          </div>
          <div class="flex items-center justify-between py-2">
            <span class="text-sm text-slate-700 dark:text-slate-300">Go to IRA Compliance</span>
            <div class="flex items-center gap-1">
              <kbd class="px-2 py-1 bg-slate-100 dark:bg-slate-700/50 text-slate-600 dark:text-slate-300 text-xs rounded font-mono">G</kbd>
              <span class="text-slate-400">then</span>
              <kbd class="px-2 py-1 bg-slate-100 dark:bg-slate-700/50 text-slate-600 dark:text-slate-300 text-xs rounded font-mono">I</kbd>
            </div>
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div>
        <h3 class="text-sm font-semibold text-slate-500 uppercase tracking-wider mb-3">Actions</h3>
        <div class="space-y-2">
          <div class="flex items-center justify-between py-2">
            <span class="text-sm text-slate-700 dark:text-slate-300">Toggle dark mode</span>
            <div class="flex items-center gap-1">
              <kbd class="px-2 py-1 bg-slate-100 dark:bg-slate-700/50 text-slate-600 dark:text-slate-300 text-xs rounded font-mono">Ctrl</kbd>
              <span class="text-slate-400">+</span>
              <kbd class="px-2 py-1 bg-slate-100 dark:bg-slate-700/50 text-slate-600 dark:text-slate-300 text-xs rounded font-mono">D</kbd>
            </div>
          </div>
          <div class="flex items-center justify-between py-2">
            <span class="text-sm text-slate-700 dark:text-slate-300">Export data</span>
            <div class="flex items-center gap-1">
              <kbd class="px-2 py-1 bg-slate-100 dark:bg-slate-700/50 text-slate-600 dark:text-slate-300 text-xs rounded font-mono">Ctrl</kbd>
              <span class="text-slate-400">+</span>
              <kbd class="px-2 py-1 bg-slate-100 dark:bg-slate-700/50 text-slate-600 dark:text-slate-300 text-xs rounded font-mono">E</kbd>
            </div>
          </div>
          <div class="flex items-center justify-between py-2">
            <span class="text-sm text-slate-700 dark:text-slate-300">Show this help</span>
            <kbd class="px-2 py-1 bg-slate-100 dark:bg-slate-700/50 text-slate-600 dark:text-slate-300 text-xs rounded font-mono">?</kbd>
          </div>
          <div class="flex items-center justify-between py-2">
            <span class="text-sm text-slate-700 dark:text-slate-300">Close modal / Escape</span>
            <kbd class="px-2 py-1 bg-slate-100 dark:bg-slate-700/50 text-slate-600 dark:text-slate-300 text-xs rounded font-mono">Esc</kbd>
          </div>
        </div>
      </div>

      <!-- Quick Tips -->
      <div class="p-4 bg-blue-50 dark:bg-slate-800/20 rounded-lg">
        <div class="flex items-start gap-3">
          <svg class="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          <div>
            <p class="font-medium text-blue-800 dark:text-blue-200 text-sm mb-1">Pro Tip</p>
            <p class="text-sm text-blue-700 dark:text-blue-300">Use the search bar to quickly find and navigate to any feature. Type what you're looking for and press Enter.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- V24: Deadline Intelligence integrated into Actions Panel - standalone panel removed -->

  <!-- Incentive Detail Modal -->
  <div class="modal-overlay" id="incentive-detail-overlay" onclick="closeIncentiveDetail()"></div>
  <div class="modal-content" id="incentive-detail-modal" style="max-width: 700px;">
    <div class="p-6 border-b border-slate-200 dark:border-slate-700/30">
      <div class="flex items-start justify-between">
        <div>
          <p class="text-sm text-blue-600 dark:text-blue-400 font-medium mb-1" id="incentive-detail-source">Federal - IRS</p>
          <h2 class="text-xl font-bold text-slate-900 dark:text-white" id="incentive-detail-name">Program Name</h2>
          <p class="text-sm text-slate-500 dark:text-slate-400 mt-1" id="incentive-detail-fullname">Full program name</p>
        </div>
        <button onclick="closeIncentiveDetail()" class="w-10 h-10 flex items-center justify-center text-slate-400 hover:text-slate-600 dark:hover:text-white hover:bg-slate-100 dark:hover:bg-slate-700/50 rounded-lg transition-all">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
    </div>
    <div class="p-6 overflow-y-auto" style="max-height: 60vh;">
      <!-- Data Source Attribution - Council Approved Strategy -->
      <div class="mb-5 p-3 bg-slate-50 dark:bg-slate-800/30 rounded-lg flex items-center justify-between">
        <div class="flex items-center gap-3">
          <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
          <div>
            <p class="text-sm font-medium text-slate-700 dark:text-slate-300">Official Program</p>
            <p class="text-xs text-slate-500 dark:text-slate-400" id="incentive-detail-agency">Source Agency</p>
          </div>
        </div>
        <div class="text-right">
          <p class="text-xs text-slate-500 dark:text-slate-400" id="incentive-detail-verified">Last verified: Jan 10, 2026</p>
          <div class="flex items-center gap-1 justify-end mt-1">
            <span class="text-xs text-slate-500">Confidence:</span>
            <span class="text-xs font-bold text-blue-700" id="incentive-detail-confidence">94%</span>
          </div>
        </div>
      </div>

      <!-- Key Metrics -->
      <div class="grid grid-cols-4 gap-3 mb-5">
        <div class="bg-blue-50 dark:bg-slate-800/20 rounded-lg p-3 text-center">
          <p class="text-xs text-slate-500 dark:text-slate-400 mb-1">Est. Value</p>
          <p class="text-xl font-bold font-mono text-blue-700" id="incentive-detail-value">$12.8M</p>
        </div>
        <div class="bg-slate-50 dark:bg-slate-800/50 rounded-lg p-3 text-center">
          <p class="text-xs text-slate-500 dark:text-slate-400 mb-1">Type</p>
          <p class="text-sm font-semibold text-slate-700 dark:text-slate-300" id="incentive-detail-type">Tax Credit</p>
        </div>
        <div class="bg-slate-50 dark:bg-slate-800/50 rounded-lg p-3 text-center">
          <p class="text-xs text-slate-500 dark:text-slate-400 mb-1">Deadline</p>
          <p class="text-sm font-semibold text-slate-700 dark:text-slate-300" id="incentive-detail-deadline">Rolling</p>
        </div>
        <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3 text-center">
          <p class="text-xs text-slate-500 dark:text-slate-400 mb-1">Success Rate</p>
          <p class="text-xl font-bold text-blue-700" id="incentive-detail-success">95%</p>
        </div>
      </div>

      <!-- Description -->
      <div class="mb-5">
        <h3 class="font-semibold text-slate-900 dark:text-white mb-2">Program Description</h3>
        <p class="text-sm text-slate-600 dark:text-slate-300 leading-relaxed" id="incentive-detail-description">
          Description will be populated dynamically.
        </p>
      </div>

      <!-- Requirements -->
      <div class="mb-5">
        <h3 class="font-semibold text-slate-900 dark:text-white mb-3">Eligibility Requirements</h3>
        <ul class="space-y-2" id="incentive-detail-requirements">
          <!-- Populated by JavaScript -->
        </ul>
      </div>

      <!-- Documents -->
      <div class="mb-5">
        <h3 class="font-semibold text-slate-900 dark:text-white mb-3">Required Documentation</h3>
        <div class="flex flex-wrap gap-2" id="incentive-detail-docs">
          <!-- Populated by JavaScript -->
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="flex gap-3 pt-4 border-t border-slate-200 dark:border-slate-700/30">
        <button onclick="closeIncentiveDetail(); showToast('success', 'Added to Project', 'This incentive has been added to your capital stack');" class="flex-1 h-11 bg-blue-700 hover:bg-blue-800 text-white font-medium rounded-lg transition-all flex items-center justify-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
          Add to Capital Stack
        </button>
        <button onclick="showToast('info', 'Application Started', 'Generating application package...');" class="px-6 h-11 bg-slate-100 dark:bg-slate-800/50 text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700/50 font-medium rounded-lg transition-all flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
          Start Application
        </button>
      </div>

      <!-- No External Link Notice - Council Strategy -->
      <div class="mt-4 text-center">
        <p class="text-xs text-slate-400 dark:text-slate-500">
          IncentEdge handles applications directly. No external links required.
        </p>
      </div>
    </div>
  </div>

  <!-- V28: Image Lightbox Modal -->
  <div id="image-lightbox-overlay" class="fixed inset-0 bg-black/90 z-50 hidden items-center justify-center" onclick="closeImageLightbox()">
    <button onclick="closeImageLightbox()" class="absolute top-4 right-4 w-12 h-12 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center text-white transition-colors">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
    </button>
    <img id="lightbox-image" src="" alt="Project Image" class="max-w-[90vw] max-h-[90vh] object-contain rounded-lg shadow-2xl" onclick="event.stopPropagation()">
    <div class="absolute bottom-4 left-1/2 -translate-x-1/2 flex items-center gap-3">
      <button onclick="event.stopPropagation(); triggerImageUpload()" class="px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg flex items-center gap-2 transition-colors">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
        Change Image
      </button>
      <button onclick="event.stopPropagation(); undoImageChange(); closeImageLightbox()" id="lightbox-undo-btn" class="px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg flex items-center gap-2 transition-colors hidden">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"/></svg>
        Undo
      </button>
    </div>
  </div>

  <!-- V28: Download File Picker Modal -->
  <div id="download-modal-overlay" class="modal-overlay" onclick="closeDownloadModal()"></div>
  <div id="download-modal" class="modal-content" style="max-width: 500px;">
    <div class="p-5 border-b border-slate-200 dark:border-slate-700/30">
      <div class="flex items-center justify-between">
        <div>
          <h2 class="text-lg font-bold text-slate-900 dark:text-white">Download Report</h2>
          <p class="text-sm text-slate-500 dark:text-slate-400" id="download-modal-subtitle">Select format and location</p>
        </div>
        <button onclick="closeDownloadModal()" class="w-10 h-10 flex items-center justify-center text-slate-400 hover:text-slate-600 dark:hover:text-white hover:bg-slate-100 dark:hover:bg-slate-700/50 rounded-lg transition-all">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
    </div>
    <div class="p-5">
      <!-- File Name -->
      <div class="mb-4">
        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">File Name</label>
        <input type="text" id="download-filename" class="form-input" value="IncentEdge_Report">
      </div>
      <!-- Format Selection -->
      <div class="mb-4">
        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Format</label>
        <div class="grid grid-cols-3 gap-3">
          <button onclick="selectDownloadFormat('pdf')" id="format-pdf" class="download-format-btn active p-3 border-2 border-blue-500 bg-blue-50 dark:bg-blue-900/20 rounded-lg text-center transition-all">
            <svg class="w-8 h-8 mx-auto mb-1 text-red-500" fill="currentColor" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6zM6 20V4h7v5h5v11H6z"/><path d="M8 12h1.5v1.5H11V15H8v3H6.5v-6H8zm3.5 0H14a1 1 0 011 1v1.5a1 1 0 01-1 1h-1v1.5h-1.5V12zm1.5 2.5V13.5H14v1h-1zm2.5-2.5h1.5v1h1v1.5h-1v.5h1V16h-1v1h-1.5v-5z"/></svg>
            <span class="text-xs font-medium text-slate-700 dark:text-slate-300">PDF</span>
          </button>
          <button onclick="selectDownloadFormat('xlsx')" id="format-xlsx" class="download-format-btn p-3 border-2 border-slate-200 dark:border-slate-700 rounded-lg text-center transition-all hover:border-blue-300">
            <svg class="w-8 h-8 mx-auto mb-1 text-green-600" fill="currentColor" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6zM6 20V4h7v5h5v11H6z"/><path d="M8 12l1.5 2.25L8 16.5h1.5l.75-1.5.75 1.5H12.5L11 14.25 12.5 12H11l-.75 1.5L9.5 12H8zm5 0v4.5h3v-1h-2v-1h1.5v-1H14v-1h2v-1h-3z"/></svg>
            <span class="text-xs font-medium text-slate-700 dark:text-slate-300">Excel</span>
          </button>
          <button onclick="selectDownloadFormat('csv')" id="format-csv" class="download-format-btn p-3 border-2 border-slate-200 dark:border-slate-700 rounded-lg text-center transition-all hover:border-blue-300">
            <svg class="w-8 h-8 mx-auto mb-1 text-blue-600" fill="currentColor" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6zM6 20V4h7v5h5v11H6z"/><path d="M8 13a1 1 0 011-1h1a1 1 0 011 1v2a1 1 0 01-1 1H9a1 1 0 01-1-1v-2zm4.5-.5h2v1h-1v1h1v1h-2v-3zm3 0h1.5v1h-1v.5h1v.5h-1v.5h1v1h-1.5v-3.5z"/></svg>
            <span class="text-xs font-medium text-slate-700 dark:text-slate-300">CSV</span>
          </button>
        </div>
      </div>
      <!-- Report Preview -->
      <div class="mb-4 p-4 bg-slate-50 dark:bg-slate-800/50 rounded-lg">
        <div class="flex items-center gap-3">
          <div id="download-preview-icon" class="w-12 h-12 bg-red-100 dark:bg-red-900/30 rounded-lg flex items-center justify-center">
            <svg class="w-6 h-6 text-red-600" fill="currentColor" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6z"/></svg>
          </div>
          <div class="flex-1 min-w-0">
            <p class="font-medium text-slate-900 dark:text-white truncate" id="download-preview-name">IncentEdge_Report.pdf</p>
            <p class="text-sm text-slate-500 dark:text-slate-400" id="download-preview-size">~245 KB</p>
          </div>
        </div>
      </div>
      <!-- Download Button -->
      <button onclick="executeDownload()" class="w-full h-11 bg-blue-700 hover:bg-blue-800 text-white font-medium rounded-lg transition-all flex items-center justify-center gap-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
        Download Now
      </button>
    </div>
  </div>

  <script>
    // Section Navigation
    function switchSection(section) {
      document.querySelectorAll('.section-content').forEach(el => el.classList.add('hidden'));
      document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));

      document.getElementById('section-' + section).classList.remove('hidden');
      document.querySelectorAll('[data-section="' + section + '"]').forEach(el => el.classList.add('active'));
      document.getElementById('breadcrumb-current').textContent = section.charAt(0).toUpperCase() + section.slice(1).replace('stack', ' Stack').replace('map', ' Map');
    }

    // V38: Update sidebar active state
    function updateSidebarActive(element) {
      document.querySelectorAll('.icon-sidebar .sidebar-item').forEach(el => el.classList.remove('active'));
      if (element) {
        element.classList.add('active');
      }
    }

    // Mobile Menu Toggle
    function toggleMobileMenu() {
      const menu = document.getElementById('mobile-menu');
      menu.classList.toggle('hidden');
    }

    // V40: Unified "More" dropdown toggle (replaces Tools + Resources)
    function toggleMoreMenu() {
      const dropdown = document.getElementById('more-dropdown');
      if (dropdown) {
        dropdown.classList.toggle('hidden');
      }
    }

    // Legacy: Keep for backwards compatibility (may be used in mobile menu)
    function toggleToolsMenu() {
      const dropdown = document.getElementById('tools-dropdown');
      if (dropdown) dropdown.classList.toggle('hidden');
      document.getElementById('resources-dropdown')?.classList.add('hidden');
      document.getElementById('more-dropdown')?.classList.add('hidden');
    }

    function toggleResourcesMenu() {
      const dropdown = document.getElementById('resources-dropdown');
      if (dropdown) dropdown.classList.toggle('hidden');
      document.getElementById('tools-dropdown')?.classList.add('hidden');
      document.getElementById('more-dropdown')?.classList.add('hidden');
    }

    // Close dropdown menus when clicking outside
    document.addEventListener('click', function(e) {
      const moreBtn = document.getElementById('more-menu-btn');
      const moreDropdown = document.getElementById('more-dropdown');
      const toolsBtn = document.getElementById('tools-menu-btn');
      const toolsDropdown = document.getElementById('tools-dropdown');
      const resourcesBtn = document.getElementById('resources-menu-btn');
      const resourcesDropdown = document.getElementById('resources-dropdown');

      // Close more dropdown
      if (moreBtn && moreDropdown && !moreBtn.contains(e.target) && !moreDropdown.contains(e.target)) {
        moreDropdown.classList.add('hidden');
      }
      // Close tools dropdown
      if (toolsBtn && toolsDropdown && !toolsBtn.contains(e.target) && !toolsDropdown.contains(e.target)) {
        toolsDropdown.classList.add('hidden');
      }
      // Close resources dropdown
      if (resourcesBtn && resourcesDropdown && !resourcesBtn.contains(e.target) && !resourcesDropdown.contains(e.target)) {
        resourcesDropdown.classList.add('hidden');
      }
    });

    // Theme Toggle
    function toggleTheme() {
      document.documentElement.classList.toggle('dark');
      const isDark = document.documentElement.classList.contains('dark');
      localStorage.setItem('incentedge-theme', isDark ? 'dark' : 'light');
      showToast('info', 'Theme Changed', isDark ? 'Dark mode enabled' : 'Light mode enabled');
    }

    // Mobile Sidebar Toggle
    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('open');
    }

    // V19 AI Features Functions
    function toggleAIChat() {
      const panel = document.getElementById('ai-chat-panel');
      panel.classList.toggle('hidden');
    }

    function sendAIMessage() {
      const input = document.getElementById('ai-chat-input');
      const message = input.value.trim();
      if (!message) return;

      const messages = document.getElementById('ai-chat-messages');

      // Add user message
      messages.innerHTML += `
        <div class="flex gap-3 justify-end">
          <div class="bg-blue-700 text-white rounded-2xl rounded-tr-none p-3 max-w-[85%]">
            <p class="text-sm">${message}</p>
          </div>
        </div>
      `;

      input.value = '';
      messages.scrollTop = messages.scrollHeight;

      // Simulate AI thinking
      setTimeout(() => {
        const responses = [
          `Based on your portfolio, the <strong>Section 48 ITC</strong> represents your highest-value opportunity at <strong>$27.1M</strong> with 90% probability. I recommend prioritizing the documentation for solar storage systems.`,
          `Looking at upcoming deadlines, you have <strong>3 critical items</strong> in the next 30 days: EPA GGRF Capital (30 days), Con Edison EV Make Ready (30 days), and Alt Fuel Vehicle Credit (45 days).`,
          `For Mount Vernon, the total identified incentives are <strong>$252.2M</strong> across 48 programs. The conservative scenario yields $88.1M (35% capture rate).`,
          `I've analyzed your eligibility and found you may qualify for an additional <strong>$12.4M</strong> in programs you haven't applied for yet. Would you like me to generate an action plan?`
        ];
        const aiResponse = responses[Math.floor(Math.random() * responses.length)];

        messages.innerHTML += `
          <div class="flex gap-3">
            <div class="w-8 h-8 rounded-full bg-gradient-to-br from-blue-600 to-blue-800 flex-shrink-0 flex items-center justify-center text-white text-xs font-bold">AI</div>
            <div class="bg-slate-100 dark:bg-slate-700 rounded-2xl rounded-tl-none p-3 max-w-[85%]">
              <p class="text-sm text-slate-700 dark:text-slate-200">${aiResponse}</p>
            </div>
          </div>
        `;
        messages.scrollTop = messages.scrollHeight;
      }, 1000);
    }

    function askAI(question) {
      document.getElementById('ai-chat-input').value = question;
      sendAIMessage();
    }

    function showAIRecommendations() {
      showToast('info', 'AI Recommendations', 'Opening recommendations panel with 3 new opportunities worth $12.4M');

      // Could open a modal with detailed recommendations
      const recommendations = [
        { program: 'NYSERDA Clean Heat Expansion', amount: 4.2, reason: 'Your heat pump capacity exceeds tier threshold' },
        { program: 'DOE Building Upgrade Prize', amount: 5.0, reason: 'Net-zero design qualifies for competition' },
        { program: 'EPA Environmental Justice Grant', amount: 3.2, reason: 'Located in designated EJ community' }
      ];

      console.log('AI Recommendations:', recommendations);
    }

    // Toast Notifications - V23: Disabled (silent mode for professional demo)
    function showToast(type, title, message) {
      // V23: Toasts disabled - actions happen silently in the background
      // To re-enable, uncomment the code below
      return;
      /*
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      const icons = {
        success: '<svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>',
        error: '<svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>',
        warning: '<svg class="w-5 h-5 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>',
        info: '<svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>'
      };
      toast.innerHTML = `
        ${icons[type]}
        <div class="flex-1">
          <p class="font-semibold text-slate-900 dark:text-white text-sm">${title}</p>
          ${message ? `<p class="text-slate-500 dark:text-slate-400 text-xs mt-0.5">${message}</p>` : ''}
        </div>
        <button onclick="this.parentElement.remove()" class="text-slate-400 hover:text-slate-600">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      `;
      container.appendChild(toast);
      requestAnimationFrame(() => toast.classList.add('show'));
      setTimeout(() => { toast.classList.remove('show'); setTimeout(() => toast.remove(), 300); }, 4000);
      */
    }

    // Export Data
    function exportData(format) {
      showToast('info', 'Preparing Export', `Generating ${format.toUpperCase()} file...`);
      setTimeout(() => showToast('success', 'Download Ready', `Portfolio_${new Date().toISOString().slice(0,10)}.${format}`), 1500);
    }

    // V32: Mixed-Income Project Type Configuration
    function showMixedIncomeOptions(projectType) {
      const configPanel = document.getElementById('mixed-income-config');
      if (configPanel) {
        if (projectType === 'mixed-income') {
          configPanel.classList.remove('hidden');
        } else {
          configPanel.classList.add('hidden');
        }
      }
    }

    function updateAffordablePct() {
      const marketRate = parseInt(document.getElementById('market-rate-pct').value) || 0;
      const affordable = Math.max(0, Math.min(100, 100 - marketRate));
      document.getElementById('affordable-units-pct').value = affordable;

      // Update eligible programs based on affordable percentage
      updateEligiblePrograms(affordable);
    }

    function updateEligiblePrograms(affordablePct) {
      const programsDiv = document.querySelector('#mixed-income-config .bg-slate-800\\/50');
      if (!programsDiv) return;

      let programs = [];
      if (affordablePct >= 20) programs.push('LIHTC (4% or 9%)');
      if (affordablePct >= 25) programs.push('421-a Successor');
      if (affordablePct >= 10) programs.push('IDA PILOT');
      programs.push('45L Credits');
      if (affordablePct >= 30) programs.push('Section 8 PBRA');
      if (affordablePct >= 50) programs.push('HOME Funds', 'HTF');

      programsDiv.innerHTML = `<span class="text-green-400 font-medium">Eligible Programs:</span> ${programs.join(', ')}`;
    }

    // Compare Projects
    let selectedProjects = [];
    function updateCompareSelection() {
      selectedProjects = [];
      document.querySelectorAll('.project-checkbox:checked').forEach(cb => {
        const row = cb.closest('.project-row');
        selectedProjects.push({
          id: row.dataset.id,
          name: row.dataset.name,
          location: row.dataset.location,
          type: row.dataset.type,
          tier: row.dataset.tier,
          tdc: parseFloat(row.dataset.tdc),
          incentives: parseFloat(row.dataset.incentives),
          captured: parseFloat(row.dataset.captured),
          programs: parseInt(row.dataset.programs)
        });
      });
      const fab = document.getElementById('compare-fab');
      const count = document.getElementById('compare-count');
      count.textContent = selectedProjects.length;
      if (selectedProjects.length >= 2) {
        fab.classList.remove('hidden');
        fab.classList.add('flex');
      } else {
        fab.classList.add('hidden');
        fab.classList.remove('flex');
      }
    }

    function toggleAllProjects(cb) {
      document.querySelectorAll('.project-checkbox').forEach(checkbox => checkbox.checked = cb.checked);
      updateCompareSelection();
    }

    function openCompareModal() {
      if (selectedProjects.length < 2) return;
      document.getElementById('compare-overlay').classList.add('open');
      document.getElementById('compare-modal').classList.add('open');
      renderComparison();
    }

    function closeCompareModal() {
      document.getElementById('compare-overlay').classList.remove('open');
      document.getElementById('compare-modal').classList.remove('open');
    }

    // V33: Enhanced Compare Projects with more metrics
    function renderComparison() {
      const content = document.getElementById('compare-content');
      const cols = selectedProjects.length;
      const maxIncentives = Math.max(...selectedProjects.map(p => p.incentives/p.tdc*100));

      content.innerHTML = `
        <div class="grid grid-cols-${cols} gap-4">
          ${selectedProjects.map(p => {
            const rate = (p.incentives/p.tdc*100);
            const barWidth = (rate / maxIncentives * 100).toFixed(0);
            return `
            <div class="card p-4">
              <h3 class="font-semibold text-slate-900 dark:text-white mb-1">${p.name}</h3>
              <p class="text-xs text-slate-500 mb-4">${p.location}</p>
              <div class="space-y-3">
                <div class="flex justify-between"><span class="text-sm text-slate-500">TDC</span><span class="font-mono font-semibold">$${p.tdc}M</span></div>
                <div class="flex justify-between"><span class="text-sm text-slate-500">Incentives</span><span class="font-mono font-semibold">$${p.incentives}M</span></div>
                <div class="flex justify-between"><span class="text-sm text-slate-500">Captured</span><span class="font-mono font-semibold text-blue-600">$${p.captured}M</span></div>
                <div>
                  <div class="flex justify-between mb-1"><span class="text-sm text-slate-500">Subsidy Rate</span><span class="font-mono font-semibold">${rate.toFixed(1)}%</span></div>
                  <div class="h-2 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden">
                    <div class="h-full bg-blue-500 rounded-full" style="width: ${barWidth}%"></div>
                  </div>
                </div>
                <div class="flex justify-between"><span class="text-sm text-slate-500">Programs</span><span class="font-mono font-semibold">${p.programs}</span></div>
                <div class="flex justify-between"><span class="text-sm text-slate-500">IRR Impact</span><span class="font-mono font-semibold text-green-500">+${(p.incentives/p.tdc*8).toFixed(1)}%</span></div>
                <div class="flex justify-between"><span class="text-sm text-slate-500">Risk Level</span><span class="font-mono font-semibold ${p.captured > p.incentives*0.5 ? 'text-green-500' : 'text-yellow-500'}">${p.captured > p.incentives*0.5 ? 'Low' : 'Medium'}</span></div>
              </div>
            </div>
          `}).join('')}
        </div>
        <div class="mt-6 p-4 bg-slate-50 dark:bg-slate-800/50 rounded-xl">
          <h3 class="font-semibold text-slate-900 dark:text-white mb-3">Portfolio Comparison Summary</h3>
          <div class="grid grid-cols-5 gap-4 text-center">
            <div><p class="text-xs text-slate-500 mb-1">Combined TDC</p><p class="font-mono font-bold text-lg">$${selectedProjects.reduce((a,p)=>a+p.tdc,0).toFixed(1)}M</p></div>
            <div><p class="text-xs text-slate-500 mb-1">Total Incentives</p><p class="font-mono font-bold text-lg">$${selectedProjects.reduce((a,p)=>a+p.incentives,0).toFixed(1)}M</p></div>
            <div><p class="text-xs text-slate-500 mb-1">Total Captured</p><p class="font-mono font-bold text-lg text-blue-600">$${selectedProjects.reduce((a,p)=>a+p.captured,0).toFixed(1)}M</p></div>
            <div><p class="text-xs text-slate-500 mb-1">Avg Subsidy</p><p class="font-mono font-bold text-lg">${(selectedProjects.reduce((a,p)=>a+p.incentives,0)/selectedProjects.reduce((a,p)=>a+p.tdc,0)*100).toFixed(1)}%</p></div>
            <div><p class="text-xs text-slate-500 mb-1">Best Performer</p><p class="font-mono font-bold text-lg text-green-500">${selectedProjects.reduce((best, p) => p.incentives/p.tdc > best.incentives/best.tdc ? p : best).name.split(' ')[0]}</p></div>
          </div>
        </div>
        <div class="mt-4 flex justify-end gap-3">
          <button onclick="exportComparison()" class="btn btn-secondary text-sm">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
            Export PDF
          </button>
        </div>
      `;
    }

    function exportComparison() {
      showToast('info', 'Generating Report', 'Creating comparison PDF...');
    }

    // V33: Toggle EJ Legend
    function toggleEJLegend() {
      const content = document.getElementById('ej-legend-content');
      const chevron = document.getElementById('ej-legend-chevron');
      if (content && chevron) {
        content.classList.toggle('hidden');
        chevron.style.transform = content.classList.contains('hidden') ? 'rotate(-90deg)' : 'rotate(0deg)';
      }
    }

    // ROI Calculator - Full Functionality
    function parseNumber(str) {
      if (!str) return 0;
      return parseFloat(str.toString().replace(/[^0-9.-]/g, '')) || 0;
    }

    function formatCurrency(num) {
      if (num >= 1000000) return '$' + (num / 1000000).toFixed(1) + 'M';
      if (num >= 1000) return '$' + (num / 1000).toFixed(0) + 'K';
      return '$' + num.toFixed(0);
    }

    function formatPercent(num) {
      return num.toFixed(1) + '%';
    }

    function calculateIRR(cashFlows, guess = 0.1) {
      // Newton-Raphson method for IRR calculation
      const maxIterations = 100;
      const tolerance = 0.0001;
      let rate = guess;

      for (let i = 0; i < maxIterations; i++) {
        let npv = 0;
        let dnpv = 0;

        for (let j = 0; j < cashFlows.length; j++) {
          npv += cashFlows[j] / Math.pow(1 + rate, j);
          dnpv -= j * cashFlows[j] / Math.pow(1 + rate, j + 1);
        }

        const newRate = rate - npv / dnpv;
        if (Math.abs(newRate - rate) < tolerance) return newRate * 100;
        rate = newRate;

        // Prevent divergence
        if (rate < -0.99) rate = -0.5;
        if (rate > 5) rate = 0.5;
      }
      return rate * 100;
    }

    function calculateROI() {
      // Get input values
      const tdc = parseNumber(document.getElementById('calc-tdc').value);
      const equity = parseNumber(document.getElementById('calc-equity').value);
      const noi = parseNumber(document.getElementById('calc-noi').value);
      const holdPeriod = parseInt(document.getElementById('calc-hold').value) || 5;
      const incentiveValue = parseNumber(document.getElementById('calc-incentive').value);

      // Update hold period display
      document.getElementById('hold-display').textContent = holdPeriod + ' yrs';

      // Validate inputs
      if (tdc <= 0 || equity <= 0 || noi <= 0) return;

      // Assumptions
      const exitCapRate = 0.055; // 5.5% exit cap
      const noiGrowth = 0.025; // 2.5% annual NOI growth
      const debtRate = 0.065; // 6.5% debt rate
      const ltv = (tdc - equity) / tdc; // Loan to value
      const debtAmount = tdc - equity;

      // --- WITH INCENTIVES ---
      // Effective equity is reduced by incentives (treated as equity offset)
      const effectiveEquityWith = Math.max(equity - incentiveValue, equity * 0.1); // Min 10% of original equity
      const effectiveDebtWith = tdc - effectiveEquityWith - incentiveValue;

      // Calculate annual debt service
      const annualDebtServiceWith = effectiveDebtWith > 0 ? effectiveDebtWith * debtRate : 0;

      // Build cash flows WITH incentives
      let cashFlowsWith = [-effectiveEquityWith]; // Initial investment
      let currentNOI = noi;

      for (let year = 1; year <= holdPeriod; year++) {
        const annualCashFlow = currentNOI - annualDebtServiceWith;
        if (year < holdPeriod) {
          cashFlowsWith.push(annualCashFlow);
        } else {
          // Exit year: add sale proceeds
          const exitNOI = currentNOI * (1 + noiGrowth);
          const salePrice = exitNOI / exitCapRate;
          const netSaleProceeds = salePrice - effectiveDebtWith; // Pay off remaining debt
          cashFlowsWith.push(annualCashFlow + netSaleProceeds);
        }
        currentNOI *= (1 + noiGrowth);
      }

      // Calculate metrics WITH incentives
      const irrWith = calculateIRR(cashFlowsWith);
      const totalDistributionsWith = cashFlowsWith.slice(1).reduce((a, b) => a + b, 0);
      const multWith = (totalDistributionsWith / effectiveEquityWith);
      const cocWith = (noi - annualDebtServiceWith) / effectiveEquityWith * 100;
      const profitWith = totalDistributionsWith - effectiveEquityWith;

      // --- WITHOUT INCENTIVES ---
      const annualDebtServiceWithout = debtAmount * debtRate;

      // Build cash flows WITHOUT incentives
      let cashFlowsWithout = [-equity]; // Initial investment
      currentNOI = noi;

      for (let year = 1; year <= holdPeriod; year++) {
        const annualCashFlow = currentNOI - annualDebtServiceWithout;
        if (year < holdPeriod) {
          cashFlowsWithout.push(annualCashFlow);
        } else {
          const exitNOI = currentNOI * (1 + noiGrowth);
          const salePrice = exitNOI / exitCapRate;
          const netSaleProceeds = salePrice - debtAmount;
          cashFlowsWithout.push(annualCashFlow + netSaleProceeds);
        }
        currentNOI *= (1 + noiGrowth);
      }

      // Calculate metrics WITHOUT incentives
      const irrWithout = calculateIRR(cashFlowsWithout);
      const totalDistributionsWithout = cashFlowsWithout.slice(1).reduce((a, b) => a + b, 0);
      const multWithout = (totalDistributionsWithout / equity);

      // Update display - WITH incentives
      document.getElementById('irr-with').textContent = formatPercent(Math.max(0, Math.min(irrWith, 99)));
      document.getElementById('mult-with').textContent = multWith.toFixed(2) + 'x';
      document.getElementById('coc-with').textContent = formatPercent(Math.max(0, cocWith));
      document.getElementById('profit-with').textContent = formatCurrency(Math.max(0, profitWith));

      // Update display - WITHOUT incentives
      document.getElementById('irr-without').textContent = formatPercent(Math.max(0, Math.min(irrWithout, 99)));
      document.getElementById('mult-without').textContent = multWithout.toFixed(2) + 'x';

      // Update advantage display
      const irrAdvantage = irrWith - irrWithout;
      const profitAdvantage = profitWith - (totalDistributionsWithout - equity);

      const advantageIRR = document.querySelector('#section-calculator .border-blue-500 .text-blue-600:first-of-type');
      const advantageProfit = document.querySelector('#section-calculator .border-blue-500 .text-right .text-blue-600');

      if (advantageIRR) {
        advantageIRR.textContent = '+' + formatPercent(Math.max(0, irrAdvantage)) + ' IRR';
      }
      if (advantageProfit) {
        advantageProfit.textContent = '+' + formatCurrency(Math.max(0, profitAdvantage));
      }
    }

    // Initialize calculator on page load
    document.addEventListener('DOMContentLoaded', function() {
      if (document.getElementById('calc-tdc')) {
        calculateROI();
      }
      // V18: Default to Mount Vernon project view
      if (document.getElementById('project-selector')) {
        switchProjectView('mt-vernon');
      }
      // V23: Initialize tiered access for Discover (default to free tier)
      updateAccessTier('free');
    });

    // Sustainability Impact Calculator
    const baseScore = 32; // Starting score (code minimum)

    function updateSustainabilityScore() {
      const checkboxes = document.querySelectorAll('.equipment-checkbox:checked');
      let totalPoints = baseScore;
      let totalCost = 0;
      let totalIncentive = 0;

      // Category points
      let hvacPoints = 0, envelopePoints = 0, renewablePoints = 0;

      checkboxes.forEach(cb => {
        const option = cb.closest('.equipment-option');
        const points = parseInt(option.dataset.points) || 0;
        const cost = parseInt(option.dataset.cost) || 0;
        const incentive = parseInt(option.dataset.incentive) || 0;
        const category = option.dataset.category;

        totalPoints += points;
        totalCost += cost;
        totalIncentive += incentive;

        if (category === 'hvac') hvacPoints += points;
        if (category === 'envelope') envelopePoints += points;
        if (category === 'renewable') renewablePoints += points;

        // Visual feedback on selected items
        option.classList.add('border-blue-500', 'bg-blue-50', 'dark:bg-slate-800/20');
      });

      // Remove highlight from unchecked
      document.querySelectorAll('.equipment-checkbox:not(:checked)').forEach(cb => {
        const option = cb.closest('.equipment-option');
        option.classList.remove('border-blue-500', 'bg-blue-50', 'dark:bg-slate-800/20');
      });

      // Cap at 100
      totalPoints = Math.min(totalPoints, 100);

      // Update category points display
      document.getElementById('hvac-points').textContent = '+' + hvacPoints + ' pts';
      document.getElementById('envelope-points').textContent = '+' + envelopePoints + ' pts';
      document.getElementById('renewable-points').textContent = '+' + renewablePoints + ' pts';

      // Update tier display
      const tierBadge = document.getElementById('current-tier-badge');
      const tierScore = document.getElementById('tier-score');
      const tierProgress = document.getElementById('tier-progress-bar');
      const nextTierInfo = document.getElementById('next-tier-info');

      tierScore.textContent = totalPoints;
      tierProgress.style.width = totalPoints + '%';

      let currentTier = 'BASE';
      if (totalPoints >= 80) {
        currentTier = 'MAXIMUM';
        tierBadge.textContent = 'MAXIMUM';
        tierBadge.className = 'px-4 py-2 bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-400 font-bold rounded-lg text-lg';
        tierProgress.className = 'h-full bg-gradient-to-r from-blue-500 to-blue-700 transition-all duration-500';
        nextTierInfo.textContent = 'Maximum tier achieved!';
        nextTierInfo.className = 'text-blue-700 dark:text-blue-400 font-medium';
      } else if (totalPoints >= 50) {
        currentTier = 'ENHANCED';
        tierBadge.textContent = 'ENHANCED';
        tierBadge.className = 'px-4 py-2 bg-blue-100 dark:bg-slate-800/50 text-blue-700 dark:text-blue-400 font-bold rounded-lg text-lg';
        tierProgress.className = 'h-full bg-gradient-to-r from-blue-400 to-blue-600 transition-all duration-500';
        const needed = 80 - totalPoints;
        nextTierInfo.textContent = '+' + needed + ' points to MAXIMUM';
        nextTierInfo.className = 'text-blue-600 dark:text-blue-400 font-medium';
      } else {
        tierBadge.textContent = 'BASE';
        tierBadge.className = 'px-4 py-2 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 font-bold rounded-lg text-lg';
        tierProgress.className = 'h-full bg-gradient-to-r from-slate-400 to-slate-500 transition-all duration-500';
        const needed = 50 - totalPoints;
        nextTierInfo.textContent = '+' + needed + ' points to ENHANCED';
        nextTierInfo.className = 'text-blue-600 dark:text-blue-400 font-medium';
      }

      // Update tier cards opacity
      document.getElementById('tier-enhanced').style.opacity = totalPoints >= 50 ? '1' : '0.5';
      document.getElementById('tier-maximum').style.opacity = totalPoints >= 80 ? '1' : '0.5';
      if (totalPoints >= 50) {
        document.getElementById('tier-enhanced').classList.add('bg-blue-50', 'dark:bg-slate-800/20', 'border-blue-300');
      } else {
        document.getElementById('tier-enhanced').classList.remove('bg-blue-50', 'dark:bg-slate-800/20', 'border-blue-300');
      }
      if (totalPoints >= 80) {
        document.getElementById('tier-maximum').classList.add('bg-blue-50', 'dark:bg-blue-900/20', 'border-blue-300');
      } else {
        document.getElementById('tier-maximum').classList.remove('bg-blue-50', 'dark:bg-blue-900/20', 'border-blue-300');
      }

      // Calculate incentives by program (simplified model)
      const incentive45L = Math.round(totalIncentive * 0.3);
      const incentive179D = Math.round(totalIncentive * 0.25);
      const incentiveNYSERDA = Math.round(totalIncentive * 0.28);
      const incentiveUtility = Math.round(totalIncentive * 0.17);

      document.getElementById('incentive-45l').textContent = formatCurrency(incentive45L);
      document.getElementById('incentive-179d').textContent = formatCurrency(incentive179D);
      document.getElementById('incentive-nyserda').textContent = formatCurrency(incentiveNYSERDA);
      document.getElementById('incentive-utility').textContent = formatCurrency(incentiveUtility);
      document.getElementById('incentive-total').textContent = formatCurrency(totalIncentive);

      // Update cost vs benefit
      document.getElementById('total-cost').textContent = formatCurrency(totalCost);
      document.getElementById('incentive-offset').textContent = formatCurrency(totalIncentive);
      const netCost = totalCost - totalIncentive;
      document.getElementById('net-cost').textContent = formatCurrency(Math.max(0, netCost));

      // Visual bars (max at $500K for scaling)
      const maxScale = 500000;
      document.getElementById('cost-bar').style.width = Math.min((totalCost / maxScale) * 100, 100) + '%';
      document.getElementById('incentive-bar').style.width = Math.min((totalIncentive / maxScale) * 100, 100) + '%';

      // ROI message
      const roiMessage = document.getElementById('roi-message');
      if (totalCost > 0 && totalIncentive > 0) {
        const offsetPercent = Math.round((totalIncentive / totalCost) * 100);
        if (offsetPercent >= 100) {
          roiMessage.textContent = 'Incentives fully offset investment cost!';
          roiMessage.className = 'text-sm text-blue-700 dark:text-blue-400 mt-2 font-medium';
        } else {
          roiMessage.textContent = 'Incentives offset ' + offsetPercent + '% of investment';
          roiMessage.className = 'text-sm text-blue-600 dark:text-blue-400 mt-2';
        }
      } else {
        roiMessage.textContent = 'Select measures to see ROI';
        roiMessage.className = 'text-sm text-slate-500 mt-2';
      }

      // Environmental impact (simplified calculation)
      const co2Reduction = Math.min(Math.round((totalPoints - baseScore) * 1.5), 65);
      const energySavings = Math.min(Math.round((totalPoints - baseScore) * 1.2), 55);
      document.getElementById('co2-reduction').textContent = co2Reduction + '%';
      document.getElementById('energy-savings').textContent = energySavings + '%';

      // LL97 status
      const ll97Status = document.getElementById('ll97-status');
      if (totalPoints >= 80) {
        ll97Status.textContent = 'Exceeds LL97 2030 compliance requirements';
        ll97Status.className = 'text-sm text-blue-700 dark:text-blue-400 font-medium text-center';
      } else if (totalPoints >= 50) {
        ll97Status.textContent = 'Meets LL97 2030 compliance pathway';
        ll97Status.className = 'text-sm text-blue-700 dark:text-blue-400 font-medium text-center';
      } else {
        ll97Status.textContent = 'Add measures to assess LL97 compliance';
        ll97Status.className = 'text-sm text-slate-600 dark:text-slate-400 font-medium text-center';
      }
    }

    function resetSustainability() {
      document.querySelectorAll('.equipment-checkbox').forEach(cb => {
        cb.checked = false;
      });
      updateSustainabilityScore();
      showToast('info', 'Reset Complete', 'All measures have been cleared');
    }

    function exportSustainabilityReport() {
      showToast('info', 'Generating Report', 'Creating sustainability impact analysis...');
      setTimeout(() => showToast('success', 'Report Ready', 'PDF report has been generated'), 1500);
    }

    // Command Palette
    const commands = [
      { group: 'Navigation', title: 'Go to Portfolio', action: () => { switchSection('portfolio'); closeCommandPalette(); } },
      { group: 'Navigation', title: 'Go to Discover', action: () => { switchSection('discover'); closeCommandPalette(); } },
      { group: 'Navigation', title: 'Go to Analysis', action: () => { switchSection('analysis'); closeCommandPalette(); } },
      { group: 'Navigation', title: 'Go to Reports', action: () => { switchSection('reports'); closeCommandPalette(); } },
      { group: 'Navigation', title: 'Go to Heat Map', action: () => { switchSection('heatmap'); closeCommandPalette(); } },
      { group: 'Navigation', title: 'Go to Capital Stack', action: () => { switchSection('capitalstack'); closeCommandPalette(); } },
      { group: 'Navigation', title: 'Go to ROI Calculator', action: () => { switchSection('calculator'); closeCommandPalette(); } },
      { group: 'Navigation', title: 'Go to Sustainability', action: () => { switchSection('sustainability'); closeCommandPalette(); } },
      { group: 'Navigation', title: 'Go to Marketplace', action: () => { switchSection('marketplace'); closeCommandPalette(); } },
      { group: 'Actions', title: 'Toggle Dark Mode', action: () => { toggleTheme(); closeCommandPalette(); } },
      { group: 'Actions', title: 'Export to Excel', action: () => { exportData('xlsx'); closeCommandPalette(); } },
      { group: 'Actions', title: 'Export to PDF', action: () => { exportData('pdf'); closeCommandPalette(); } },
      { group: 'Actions', title: 'Print Report', action: () => { window.print(); closeCommandPalette(); } },
    ];

    function openCommandPalette() {
      document.getElementById('command-overlay').classList.add('open');
      document.getElementById('command-modal').classList.add('open');
      document.getElementById('command-input').value = '';
      document.getElementById('command-input').focus();
      renderCommands(commands);
    }

    function closeCommandPalette() {
      document.getElementById('command-overlay').classList.remove('open');
      document.getElementById('command-modal').classList.remove('open');
    }

    function renderCommands(cmds) {
      const results = document.getElementById('command-results');
      const grouped = cmds.reduce((acc, cmd) => { (acc[cmd.group] = acc[cmd.group] || []).push(cmd); return acc; }, {});
      results.innerHTML = Object.entries(grouped).map(([group, items]) => `
        <div class="mb-2">
          <p class="text-xs font-semibold text-slate-500 uppercase tracking-wider px-3 py-1">${group}</p>
          ${items.map((cmd, i) => `
            <div class="px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700/50 cursor-pointer flex items-center gap-3" onclick="commands.find(c=>c.title==='${cmd.title}').action()">
              <span class="text-sm text-slate-900 dark:text-white">${cmd.title}</span>
            </div>
          `).join('')}
        </div>
      `).join('');
    }

    document.getElementById('command-input').addEventListener('input', (e) => {
      const query = e.target.value.toLowerCase();
      const filtered = commands.filter(c => c.title.toLowerCase().includes(query));
      renderCommands(filtered);
    });

    // V33: Enhanced Keyboard Shortcuts
    document.addEventListener('keydown', (e) => {
      // Command palette
      if ((e.metaKey || e.ctrlKey) && e.key === 'k') { e.preventDefault(); openCommandPalette(); }
      if (e.key === 'Escape') { closeCommandPalette(); closeCompareModal(); closeKeyboardHelp(); }

      // Don't trigger shortcuts when typing in inputs
      if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'SELECT') return;

      // Navigation shortcuts (no modifiers)
      if (e.key === 'd') switchSection('portfolio'); // Dashboard
      if (e.key === 'a') switchSection('analysis'); // Analysis
      if (e.key === 'c') switchSection('capitalstack'); // Capital Stack
      if (e.key === 'r') switchSection('calculator'); // ROI Calculator
      if (e.key === 'e') switchSection('ejmap'); // EJ Map
      if (e.key === 'p') switchSection('doeloans'); // Programs

      // Quick actions
      if (e.key === 'n') document.querySelector('[onclick*="new-project"]')?.click(); // New Project
      if (e.key === '/') { e.preventDefault(); document.querySelector('.global-search-input')?.focus(); }
      if (e.key === '?') showKeyboardHelp(); // Show help

      // Compare projects (Shift+C)
      if (e.shiftKey && e.key === 'C') openCompareModal();
    });

    // V33: Keyboard shortcuts help modal
    function showKeyboardHelp() {
      const modal = document.getElementById('keyboard-help-modal');
      const overlay = document.getElementById('keyboard-help-overlay');
      if (modal && overlay) {
        modal.classList.add('open');
        overlay.classList.add('open');
      }
    }

    function closeKeyboardHelp() {
      const modal = document.getElementById('keyboard-help-modal');
      const overlay = document.getElementById('keyboard-help-overlay');
      if (modal && overlay) {
        modal.classList.remove('open');
        overlay.classList.remove('open');
      }
    }

    // V40: Ask Us Modal Functions (Bob White recommendation)
    function openAskUsModal() {
      const modal = document.getElementById('askus-modal');
      const overlay = document.getElementById('askus-overlay');
      if (modal && overlay) {
        modal.classList.add('open');
        overlay.classList.add('open');
      }
    }

    function closeAskUsModal() {
      const modal = document.getElementById('askus-modal');
      const overlay = document.getElementById('askus-overlay');
      if (modal && overlay) {
        modal.classList.remove('open');
        overlay.classList.remove('open');
      }
    }

    function submitAskUs() {
      const topic = document.getElementById('askus-topic').value;
      const message = document.getElementById('askus-message').value;
      const name = document.getElementById('askus-name').value;
      const email = document.getElementById('askus-email').value;

      if (!message.trim() || !name.trim() || !email.trim()) {
        showToast('Please fill in all fields', 'warning');
        return;
      }

      // In production, this would send to backend API
      console.log('Ask Us submission:', { topic, message, name, email });

      // Show success and close modal
      showToast('Message sent! We\'ll get back to you within 24 hours.', 'success');
      closeAskUsModal();

      // Clear form
      document.getElementById('askus-message').value = '';
      document.getElementById('askus-name').value = '';
      document.getElementById('askus-email').value = '';
    }

    // V34: Mobile Quick Actions Toggle
    function toggleMobileQuickActions() {
      const menu = document.getElementById('mobile-qa-menu');
      const icon = document.getElementById('mobile-qa-icon');
      if (menu && icon) {
        menu.classList.toggle('hidden');
        icon.style.transform = menu.classList.contains('hidden') ? 'rotate(0deg)' : 'rotate(90deg)';
      }
    }

    // V34: ASHRAE Baseline Update
    function updateASHRAEBaseline() {
      const version = document.getElementById('ashrae-version').value;
      const climate = document.getElementById('ashrae-climate').value;
      const building = document.getElementById('ashrae-building').value;

      // Simplified baseline values - would be from database in production
      const baselines = {
        '90.1-2019': { envelope: 'U-0.064', lpd: '0.75 W/sf', hvac: '14 SEER', threshold: '25%' },
        '90.1-2022': { envelope: 'U-0.055', lpd: '0.65 W/sf', hvac: '15 SEER', threshold: '25%' },
        '90.1-2016': { envelope: 'U-0.069', lpd: '0.82 W/sf', hvac: '13 SEER', threshold: '25%' }
      };

      const baseline = baselines[version] || baselines['90.1-2019'];
      document.getElementById('ashrae-envelope').textContent = baseline.envelope;
      document.getElementById('ashrae-lpd').textContent = baseline.lpd;
      document.getElementById('ashrae-hvac').textContent = baseline.hvac;
      document.getElementById('ashrae-threshold').textContent = baseline.threshold + ' Savings';
    }

    // V34: AMI Calculator
    function calculateAMI() {
      const metro = document.getElementById('ami-metro').value;
      const household = parseInt(document.getElementById('ami-household').value);
      const level = parseInt(document.getElementById('ami-level').value);
      const unit = parseInt(document.getElementById('ami-unit').value);

      // Base AMI values by metro area (FY2024)
      const amiBase = {
        'ny-metro': 129400,
        'westchester': 129400,
        'nassau': 146300,
        'bergen': 129400,
        'stamford': 152600
      };

      // Household size adjustment factors
      const sizeFactors = { 1: 0.70, 2: 0.80, 3: 0.90, 4: 1.00, 5: 1.08, 6: 1.16 };

      // Unit bedroom count to household size mapping
      const unitHouseholds = { 0: 1, 1: 1.5, 2: 3, 3: 4.5, 4: 6 };

      const baseAMI = amiBase[metro] || 129400;
      const maxIncome = Math.round(baseAMI * sizeFactors[household] * (level / 100));
      const rentHousehold = unitHouseholds[unit] || 1.5;
      const rentIncome = Math.round(baseAMI * sizeFactors[Math.min(Math.ceil(rentHousehold), 6)] * (level / 100));
      const maxRent = Math.round(rentIncome * 0.30 / 12);
      const utility = Math.round(50 + unit * 25);

      document.getElementById('ami-median').textContent = '$' + baseAMI.toLocaleString();
      document.getElementById('ami-income').textContent = '$' + maxIncome.toLocaleString();
      document.getElementById('ami-rent').textContent = '$' + maxRent.toLocaleString();
      document.getElementById('ami-utility').textContent = '-$' + utility;
    }

    // V33: Credit Subsidy Cost Calculator
    function calculateCreditSubsidy() {
      const loanAmount = parseFloat(document.getElementById('csc-loan-amount').value) || 50;
      const term = parseFloat(document.getElementById('csc-term').value) || 30;
      const riskRate = parseFloat(document.getElementById('csc-risk').value) || 0.05;
      const program = document.getElementById('csc-program').value;

      // Simplified credit subsidy calculation
      // Real calculation would use OMB discount rates and probability of default models
      let subsidyRate = riskRate * (1 + term / 100);
      let coverage = 'Borrower Pays';

      if (program === 'cifia') {
        subsidyRate = 0;
        coverage = 'IRA Covered';
      }

      const subsidyCost = loanAmount * subsidyRate;

      document.getElementById('csc-result').textContent = '$' + subsidyCost.toFixed(1) + 'M';
      document.getElementById('csc-rate').textContent = (subsidyRate * 100).toFixed(1) + '%';
      document.getElementById('csc-coverage').textContent = coverage;
      document.getElementById('csc-coverage').className = program === 'cifia'
        ? 'font-mono text-xl font-bold text-green-400'
        : 'font-mono text-xl font-bold text-yellow-400';
    }

    // Analysis Wizard
    let currentStep = 1;
    let selectedTier = null;

    // V24: Toggle Other property type text input
    function toggleOtherPropertyType() {
      const select = document.getElementById('prop-type');
      const otherInput = document.getElementById('prop-type-other');
      if (select && otherInput) {
        if (select.value === 'other') {
          otherInput.classList.remove('hidden');
          otherInput.focus();
        } else {
          otherInput.classList.add('hidden');
          otherInput.value = '';
        }
      }
    }

    // V25: Hybrid API Lookup - Demo property database (simulates API)
    const propertyDatabase = {
      '225 south 4th ave, mount vernon': {
        address: '225 South 4th Ave',
        city: 'Mount Vernon, NY 10550',
        type: 'mixed-use',
        projectType: 'conversion',
        units: 127,
        sqft: 185000,
        tdc: 88.5
      },
      '100 main street, yonkers': {
        address: '100 Main Street',
        city: 'Yonkers, NY 10701',
        type: 'affordable',
        projectType: 'new-construction',
        units: 200,
        sqft: 220000,
        tdc: 95.2
      },
      '500 north ave, new rochelle': {
        address: '500 North Ave',
        city: 'New Rochelle, NY 10801',
        type: 'mixed-use',
        projectType: 'new-construction',
        units: 350,
        sqft: 425000,
        tdc: 180.0
      }
    };

    function lookupPropertyAddress() {
      const lookupInput = document.getElementById('prop-address-lookup');
      const statusContainer = document.getElementById('lookup-status');
      const loadingEl = document.getElementById('lookup-loading');
      const successEl = document.getElementById('lookup-success');
      const errorEl = document.getElementById('lookup-error');

      const searchAddress = lookupInput.value.toLowerCase().trim();

      if (!searchAddress) {
        showToast('Please enter an address to lookup', 'warning');
        return;
      }

      // Show loading state
      statusContainer.classList.remove('hidden');
      loadingEl.classList.remove('hidden');
      successEl.classList.add('hidden');
      errorEl.classList.add('hidden');

      // Simulate API call delay
      setTimeout(() => {
        loadingEl.classList.add('hidden');

        // Check for matching property in demo database
        let foundProperty = null;
        for (const key of Object.keys(propertyDatabase)) {
          if (searchAddress.includes(key) || key.includes(searchAddress.split(',')[0])) {
            foundProperty = propertyDatabase[key];
            break;
          }
        }

        if (foundProperty) {
          // Success - auto-populate fields
          successEl.classList.remove('hidden');

          document.getElementById('prop-address').value = foundProperty.address;
          document.getElementById('prop-city').value = foundProperty.city;
          document.getElementById('prop-type').value = foundProperty.type;
          document.getElementById('project-type').value = foundProperty.projectType;

          // Also populate Step 2 fields if available
          if (foundProperty.units) document.getElementById('total-units').value = foundProperty.units;
          if (foundProperty.sqft) document.getElementById('total-sqft').value = foundProperty.sqft;
          if (foundProperty.tdc) document.getElementById('est-tdc').value = foundProperty.tdc;

          // Mark fields as auto-populated
          ['prop-address', 'prop-city', 'prop-type', 'project-type'].forEach(id => {
            const el = document.getElementById(id);
            if (el) el.classList.add('bg-blue-50', 'dark:bg-blue-900/10');
          });

          showToast('Property data auto-populated successfully', 'success');
        } else {
          // Not found - show manual entry message
          errorEl.classList.remove('hidden');
        }
      }, 1200); // Simulated API delay
    }

    function clearLookupData() {
      const statusContainer = document.getElementById('lookup-status');
      statusContainer.classList.add('hidden');

      // Clear all fields
      ['prop-address', 'prop-city', 'total-units', 'total-sqft', 'est-tdc'].forEach(id => {
        const el = document.getElementById(id);
        if (el) {
          el.value = '';
          el.classList.remove('bg-blue-50', 'dark:bg-blue-900/10');
        }
      });

      // Reset dropdowns
      document.getElementById('prop-type').value = '';
      document.getElementById('project-type').value = '';
      document.getElementById('prop-address-lookup').value = '';

      showToast('Form cleared - enter details manually', 'info');
    }

    function nextAnalysisStep(step) {
      document.querySelectorAll('[id^="analysis-step-"]').forEach(el => el.classList.add('hidden'));
      document.getElementById('analysis-step-' + step).classList.remove('hidden');
      currentStep = step;
      updateStepIndicators();
    }

    function updateStepIndicators() {
      for (let i = 1; i <= 4; i++) {
        const stepEl = document.getElementById('step-' + i);
        if (i < currentStep) {
          stepEl.className = 'w-8 h-8 rounded-full bg-blue-500 text-white flex items-center justify-center text-sm font-semibold';
          stepEl.innerHTML = '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>';
        } else if (i === currentStep) {
          stepEl.className = 'w-8 h-8 rounded-full bg-blue-500 text-white flex items-center justify-center text-sm font-semibold';
          stepEl.textContent = i;
        } else {
          stepEl.className = 'w-8 h-8 rounded-full bg-slate-200 dark:bg-slate-700/50 text-slate-500 flex items-center justify-center text-sm font-semibold';
          stepEl.textContent = i;
        }
      }
    }

    function selectTier(el, tier) {
      document.querySelectorAll('.tier-card').forEach(c => c.classList.remove('border-blue-500'));
      el.classList.add('border-blue-500');
      selectedTier = tier;
    }

    function runAnalysis() {
      showToast('info', 'Running Analysis', 'Scanning 10,416 incentive programs...');
      setTimeout(() => {
        nextAnalysisStep(4);
        showToast('success', 'Analysis Complete', '15 matching programs found');
      }, 2000);
    }

    function resetAnalysis() {
      currentStep = 1;
      selectedTier = null;
      document.querySelectorAll('.tier-card').forEach(c => c.classList.remove('border-blue-500'));
      nextAnalysisStep(1);
    }

    // V23: Tiered Access Control for Discover Section
    let currentAccessTier = 'free';
    let searchesRemaining = 10;

    function updateAccessTier(tier) {
      currentAccessTier = tier;
      const gate = document.getElementById('discover-gate');
      const warning = document.getElementById('search-limit-warning');
      const discoverTable = document.querySelector('#section-discover .card.overflow-hidden');
      const valueColumns = document.querySelectorAll('#section-discover .data-table td:nth-child(4)');

      if (tier === 'public') {
        // Public: Show gate, blur/hide details
        gate?.classList.remove('hidden');
        warning?.classList.add('hidden');
        valueColumns.forEach(col => {
          col.innerHTML = '<span class="text-slate-400 dark:text-slate-600 blur-sm select-none">$X,XXX</span>';
        });
        showToast('info', 'Public Preview', 'Create a free account to see full details');
      } else if (tier === 'free') {
        // Free: Show warning, show values but limited searches
        gate?.classList.add('hidden');
        warning?.classList.remove('hidden');
        // Restore values
        const sampleValues = ['$5,000/unit', '$3M max', '15-year', '$500/kW', '$2.50/SF', '$100K max'];
        valueColumns.forEach((col, i) => {
          col.innerHTML = `<span class="font-mono font-medium">${sampleValues[i % sampleValues.length]}</span>`;
        });
        document.getElementById('searches-remaining').textContent = searchesRemaining;
        showToast('info', 'Free Account', `${searchesRemaining} searches remaining this month`);
      } else {
        // Paid: Full access
        gate?.classList.add('hidden');
        warning?.classList.add('hidden');
        // Restore values
        const sampleValues = ['$5,000/unit', '$3M max', '15-year', '$500/kW', '$2.50/SF', '$100K max'];
        valueColumns.forEach((col, i) => {
          col.innerHTML = `<span class="font-mono font-medium">${sampleValues[i % sampleValues.length]}</span>`;
        });
        showToast('success', 'Enterprise Access', 'Unlimited searches and full API access');
      }
    }

    // Search Incentives
    function searchIncentives() {
      if (currentAccessTier === 'free' && searchesRemaining > 0) {
        searchesRemaining--;
        document.getElementById('searches-remaining').textContent = searchesRemaining;
      } else if (currentAccessTier === 'free' && searchesRemaining <= 0) {
        showToast('error', 'Limit Reached', 'Upgrade to Enterprise for unlimited searches');
        return;
      }
      showToast('info', 'Searching', 'Finding matching incentives...');
    }

    function filterByLevel(level) {
      document.getElementById('filter-level').value = level;
      searchIncentives();
    }

    // Generate Report
    function generateReport(type) {
      showToast('info', 'Generating Report', `Creating ${type} report...`);
      setTimeout(() => showToast('success', 'Report Ready', 'Your report has been generated'), 2000);
    }

    // Sort Table (placeholder)
    function sortTable(column) {
      showToast('info', 'Sorting', `Sorted by ${column}`);
    }

    // Initialize
    renderCommands(commands);
    setTimeout(() => showToast('success', 'Data Synced', 'Portfolio data current as of 09:45 EST'), 500);

    // ===== NEW FUNCTIONS FOR V13 =====

    // Incentive Detail Modal Data
    const incentiveDetailData = {
      'lihtc': {
        name: 'LIHTC 4% Tax Credit',
        fullName: 'Low-Income Housing Tax Credit (4% As-of-Right)',
        source: 'Federal - IRS / State HCR',
        sourceAgency: 'Internal Revenue Service',
        value: '$12.8M',
        type: '10-year tax credit',
        deadline: 'Rolling (with bond issuance)',
        successRate: '95%',
        description: 'The 4% LIHTC is available as-of-right when paired with tax-exempt bond financing. Credits are claimed over 10 years and are typically syndicated to investors at approximately $0.92-0.94 per dollar of credit.',
        requirements: [
          'At least 20% of units at 50% AMI, OR 40% at 60% AMI',
          'Paired with tax-exempt bond financing (50%+ of aggregate basis)',
          '30-year extended use agreement',
          'Annual compliance monitoring'
        ],
        documents: ['Cost Certification', 'Placed in Service Documentation', 'Bond Issuance Letter', 'Rent Roll Certification'],
        lastVerified: 'Jan 10, 2026',
        confidence: 94
      },
      'nyserda': {
        name: 'NYSERDA Clean Energy Incentive',
        fullName: 'New Construction Housing Program',
        source: 'State - NYSERDA',
        sourceAgency: 'NY State Energy Research & Development Authority',
        value: '$4.2M',
        type: 'Direct rebate',
        deadline: 'Rolling (funding available)',
        successRate: '92%',
        description: 'NYSERDA provides significant incentives for multifamily new construction that meets or exceeds energy code. Higher incentives available for Passive House and net-zero projects.',
        requirements: [
          'Minimum 5 dwelling units',
          'Must exceed NYSERDA baseline by 10%+',
          'Pre-construction enrollment required',
          'Third-party verification of energy modeling'
        ],
        documents: ['Energy Model', 'Pre-Construction Agreement', 'As-Built Documentation', 'Blower Door Test Results'],
        lastVerified: 'Jan 10, 2026',
        confidence: 92
      },
      'pilot': {
        name: 'Westchester IDA PILOT',
        fullName: 'Payment in Lieu of Taxes (15-Year Abatement)',
        source: 'Local - Westchester IDA',
        sourceAgency: 'Westchester County Industrial Development Agency',
        value: '$3.8M',
        type: 'NPV of tax savings',
        deadline: 'Application (Board approval required)',
        successRate: '78%',
        description: 'The Westchester IDA provides property tax abatements structured as PILOTs for qualifying development projects. Typical structure is 15-year with graduated phase-in.',
        requirements: [
          'Minimum $5M capital investment',
          'Job creation or retention commitment',
          'Community benefit agreement',
          'Public hearing and Board approval'
        ],
        documents: ['Application Package', 'Project Pro Forma', 'Environmental Review', 'Community Benefit Agreement'],
        lastVerified: 'Jan 9, 2026',
        confidence: 78
      },
      '179d': {
        name: 'IRA 179D Deduction',
        fullName: 'Energy Efficient Commercial Building Deduction',
        source: 'Federal - IRS',
        sourceAgency: 'Internal Revenue Service (IRA Enhanced)',
        value: '$2.4M',
        type: 'Tax deduction ($5/SF)',
        deadline: 'Tax filing (ongoing)',
        successRate: '97%',
        description: 'Enhanced under the Inflation Reduction Act, 179D provides up to $5/SF deduction for buildings achieving 50%+ energy reduction. Prevailing wage and apprenticeship requirements apply for full benefit.',
        requirements: [
          '25%+ energy reduction vs ASHRAE baseline (minimum)',
          '50%+ reduction for maximum deduction',
          'Prevailing wage for construction workers',
          'Apprenticeship program participation'
        ],
        documents: ['Energy Study by Qualified Professional', 'Prevailing Wage Certification', 'Apprenticeship Documentation', 'Third-Party Verification'],
        lastVerified: 'Jan 10, 2026',
        confidence: 97
      },
      '45l': {
        name: 'IRA 45L Tax Credit',
        fullName: 'New Energy Efficient Home Credit',
        source: 'Federal - IRS',
        sourceAgency: 'Internal Revenue Service (IRA Enhanced)',
        value: '$1.5M',
        type: 'Per-unit credit ($5K/unit)',
        deadline: 'Tax filing (ongoing)',
        successRate: '89%',
        description: 'The 45L credit provides up to $5,000 per dwelling unit for qualifying energy efficient homes. Enhanced under IRA with higher credits for zero-energy-ready homes meeting ENERGY STAR requirements.',
        requirements: [
          'ENERGY STAR Multifamily New Construction certification',
          'DOE Zero Energy Ready Home certification for max credit',
          'Prevailing wage requirements for full credit',
          'Third-party certification required'
        ],
        documents: ['ENERGY STAR Certification', 'HERS Index Rating', 'Third-Party Verification Letter', 'Prevailing Wage Records'],
        lastVerified: 'Jan 10, 2026',
        confidence: 89
      },
      'utility': {
        name: 'Con Edison Rebates',
        fullName: 'Commercial Energy Efficiency Program Bundle',
        source: 'Utility - Con Edison',
        sourceAgency: 'Consolidated Edison',
        value: '$0.8M',
        type: 'Per-measure rebates',
        deadline: 'Pre-approval (before installation)',
        successRate: '85%',
        description: 'Con Edison offers prescriptive and custom rebates for commercial energy efficiency measures including HVAC, lighting, building envelope, and controls. Pre-approval is required before equipment installation.',
        requirements: [
          'Project in Con Edison service territory',
          'Pre-approval application before installation',
          'Equipment must meet efficiency specifications',
          'Post-installation inspection may be required'
        ],
        documents: ['Pre-Approval Application', 'Equipment Specifications', 'Contractor Invoices', 'Post-Installation Verification'],
        lastVerified: 'Jan 8, 2026',
        confidence: 85
      }
    };

    // Open Incentive Detail Modal
    function openIncentiveDetail(incentiveId, rowIndex = null) {
      // V20: Try to get data from old detailed data first, then fall back to currentIncentives
      let data = incentiveDetailData[incentiveId];

      // If not found in detailed data, look in currentIncentives
      if (!data && window.currentIncentives && rowIndex !== null) {
        const inc = window.currentIncentives[rowIndex];
        if (inc) {
          // Build data structure from incentive object
          const typeLabels = { federal: 'Federal', state: 'State', local: 'Local/Regional', utility: 'Utility' };
          const statusLabels = { captured: 'Captured', pending: 'Pending', 'at-risk': 'At Risk' };
          data = {
            name: inc.program,
            fullName: inc.fullName || inc.program,
            source: `${typeLabels[inc.type]} - ${inc.agency || 'Various'}`,
            sourceAgency: inc.agency || (typeLabels[inc.type] + ' Agency'),
            value: `$${inc.amount.toFixed(1)}M`,
            type: inc.status === 'captured' ? 'Secured' : (inc.type === 'federal' ? 'Tax credit/deduction' : 'Grant/Rebate'),
            deadline: inc.deadline,
            successRate: `${inc.prob}%`,
            description: inc.desc + '. This program is available for qualifying projects meeting the eligibility requirements.',
            requirements: inc.requirements || ['Program-specific requirements apply', 'Documentation required', 'Compliance verification needed'],
            documents: inc.docs || ['Application Package', 'Supporting Documentation', 'Compliance Certification'],
            lastVerified: 'Jan 10, 2026',
            confidence: inc.prob
          };
        }
      }

      if (!data) {
        showToast('warning', 'Details Unavailable', 'Program details are being compiled.');
        return;
      }

      const modal = document.getElementById('incentive-detail-modal');
      const overlay = document.getElementById('incentive-detail-overlay');

      // Populate modal content
      document.getElementById('incentive-detail-name').textContent = data.name;
      document.getElementById('incentive-detail-fullname').textContent = data.fullName;
      document.getElementById('incentive-detail-source').textContent = data.source;
      document.getElementById('incentive-detail-agency').textContent = data.sourceAgency;
      document.getElementById('incentive-detail-value').textContent = data.value;
      document.getElementById('incentive-detail-type').textContent = data.type;
      document.getElementById('incentive-detail-deadline').textContent = data.deadline;
      document.getElementById('incentive-detail-success').textContent = data.successRate;
      document.getElementById('incentive-detail-description').textContent = data.description;
      document.getElementById('incentive-detail-verified').textContent = 'Last verified: ' + data.lastVerified;
      document.getElementById('incentive-detail-confidence').textContent = data.confidence + '%';

      // Populate requirements
      const reqList = document.getElementById('incentive-detail-requirements');
      reqList.innerHTML = data.requirements.map(req => `
        <li class="flex items-start gap-2">
          <svg class="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
          <span class="text-slate-600 dark:text-slate-300">${req}</span>
        </li>
      `).join('');

      // Populate documents
      const docsList = document.getElementById('incentive-detail-docs');
      docsList.innerHTML = data.documents.map(doc => `
        <span class="px-3 py-1.5 bg-slate-100 dark:bg-slate-800/30 text-slate-700 dark:text-slate-300 text-sm rounded-lg">${doc}</span>
      `).join('');

      // Show modal
      overlay.classList.add('open');
      modal.classList.add('open');
    }

    // Close Incentive Detail Modal
    function closeIncentiveDetail() {
      document.getElementById('incentive-detail-overlay').classList.remove('open');
      document.getElementById('incentive-detail-modal').classList.remove('open');
    }

    // Toggle Sensitivity Analysis View
    function toggleSensitivityView(view) {
      const tableView = document.getElementById('sensitivity-table-view');
      const chartView = document.getElementById('sensitivity-chart-view');
      const tableBtn = document.getElementById('sens-table-btn');
      const chartBtn = document.getElementById('sens-chart-btn');

      if (view === 'table') {
        tableView.classList.remove('hidden');
        chartView.classList.add('hidden');
        tableBtn.className = 'px-3 py-1.5 text-sm font-medium bg-blue-100 dark:bg-slate-800/50 text-blue-700 dark:text-blue-300 rounded-lg';
        chartBtn.className = 'px-3 py-1.5 text-sm font-medium text-slate-500 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg';
      } else {
        tableView.classList.add('hidden');
        chartView.classList.remove('hidden');
        chartBtn.className = 'px-3 py-1.5 text-sm font-medium bg-blue-100 dark:bg-slate-800/50 text-blue-700 dark:text-blue-300 rounded-lg';
        tableBtn.className = 'px-3 py-1.5 text-sm font-medium text-slate-500 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg';
      }
    }

    // Export Capital Stack
    function exportCapitalStack() {
      showToast('info', 'Generating Export', 'Creating capital stack summary...');
      setTimeout(() => showToast('success', 'Export Ready', 'CapitalStack_Analysis_2026-01-10.xlsx'), 1500);
    }

    // Apply All Incentives
    function applyAllIncentives() {
      showToast('success', 'Incentives Applied', 'All 6 incentive programs have been added to your project analysis');
    }

    // ===== V14 NEW FUNCTIONS =====

    // Keyboard Shortcuts Modal
    function openShortcutsModal() {
      document.getElementById('shortcuts-overlay').classList.add('open');
      document.getElementById('shortcuts-modal').classList.add('open');
    }

    function closeShortcutsModal() {
      document.getElementById('shortcuts-overlay').classList.remove('open');
      document.getElementById('shortcuts-modal').classList.remove('open');
    }

    // Deadline Intelligence Panel
    function toggleDeadlinePanel() {
      const panel = document.getElementById('deadline-panel');
      const bell = document.getElementById('deadline-bell');
      if (panel.classList.contains('hidden')) {
        panel.classList.remove('hidden');
        bell.classList.add('hidden');
      } else {
        panel.classList.add('hidden');
        bell.classList.remove('hidden');
      }
    }

    // IRA Compliance Functions
    function calculatePrevailingWage() {
      showToast('info', 'Calculating', 'Updating DOL wage determinations...');
    }

    function addTrade() {
      showToast('info', 'Add Trade', 'Opening trade classification selector...');
    }

    function generatePWReport() {
      showToast('info', 'Generating Report', 'Creating prevailing wage compliance report...');
      setTimeout(() => showToast('success', 'Report Ready', 'PW_Compliance_Report_2026-01-10.pdf'), 2000);
    }

    function exportComplianceReport() {
      showToast('info', 'Exporting', 'Generating IRA compliance package...');
      setTimeout(() => showToast('success', 'Export Complete', 'IRA_Compliance_Package.zip'), 2000);
    }

    // Document Generator Functions - V28: Enhanced with actual downloads
    const documentTemplates = {
      'lihtc-app': { name: 'LIHTC Application Package', filename: 'LIHTC_Application_MtVernon', pages: 12, format: 'pdf' },
      'nyserda-app': { name: 'NYSERDA Pre-Construction Form', filename: 'NYSERDA_PreConstruction', pages: 8, format: 'pdf' },
      'ida-app': { name: 'IDA PILOT Application', filename: 'IDA_PILOT_WestchesterCounty', pages: 15, format: 'pdf' },
      '179d-cert': { name: '179D Certification Package', filename: '179D_Certification', pages: 6, format: 'pdf' },
      'lp-memo': { name: 'LP Investment Memo', filename: 'LP_InvestmentMemo_MtVernon', pages: 18, format: 'pdf' },
      'quarterly-report': { name: 'Quarterly Incentive Report', filename: 'Q1_2026_IncentiveReport', pages: 8, format: 'pdf' },
      'cost-cert': { name: 'Cost Certification', filename: 'CostCertification_MtVernon', pages: 24, format: 'pdf' },
      'compliance-manual': { name: 'IRA Compliance Manual', filename: 'IRA_ComplianceManual', pages: 32, format: 'pdf' }
    };

    function generateDocument(docType) {
      const doc = documentTemplates[docType];
      if (!doc) {
        showToast('error', 'Document Not Found', 'Template not available');
        return;
      }
      openDownloadModal('portfolio', doc.filename);
    }

    // Enhanced Keyboard Shortcuts
    let gPressed = false;
    document.addEventListener('keydown', (e) => {
      // Existing shortcuts
      if ((e.metaKey || e.ctrlKey) && e.key === 'k') { e.preventDefault(); openCommandPalette(); }
      if (e.key === 'Escape') {
        closeCommandPalette();
        closeCompareModal();
        closeIncentiveDetail();
        closeShortcutsModal();
        const panel = document.getElementById('deadline-panel');
        if (!panel.classList.contains('hidden')) toggleDeadlinePanel();
      }

      // ? for shortcuts help
      if (e.key === '?' && !e.ctrlKey && !e.metaKey) {
        e.preventDefault();
        openShortcutsModal();
      }

      // Ctrl+D for dark mode
      if ((e.metaKey || e.ctrlKey) && e.key === 'd') {
        e.preventDefault();
        toggleTheme();
      }

      // Ctrl+E for export
      if ((e.metaKey || e.ctrlKey) && e.key === 'e') {
        e.preventDefault();
        exportData('xlsx');
      }

      // G + key navigation (vim-style)
      if (e.key === 'g' && !e.ctrlKey && !e.metaKey && !gPressed) {
        gPressed = true;
        setTimeout(() => { gPressed = false; }, 1000);
      } else if (gPressed) {
        gPressed = false;
        switch(e.key) {
          case 'p': switchSection('portfolio'); break;
          case 'c': switchSection('capitalstack'); break;
          case 'r': switchSection('calculator'); break;
          case 'i': switchSection('compliance'); break;
          case 'd': switchSection('documents'); break;
          case 's': switchSection('sustainability'); break;
          case 'm': switchSection('marketplace'); break;
        }
      }
    });

    // V19 Comprehensive Incentives Data from mvincentives.html
    const allIncentives = {
      'mt-vernon': [
        // Federal Core Programs ($106M)
        { id: 'section-48-itc', program: 'Section 48 ITC Solar/Storage', desc: 'Investment Tax Credit for solar, storage and controls', amount: 27.1, prob: 90, type: 'federal', status: 'pending', deadline: '90 days', agency: 'Internal Revenue Service', fullName: 'Section 48 Investment Tax Credit (Solar & Storage)', requirements: ['Qualifying solar/storage equipment', 'Placed in service certification', 'IRS Form 3468', 'Prevailing wage compliance'], docs: ['Equipment Certification', 'Cost Segregation Study', 'IRS Form 3468', 'Prevailing Wage Records'] },
        { id: 'statutory-adders', program: 'Statutory Adders', desc: 'Low income, domestic content, energy community bonuses', amount: 13.0, prob: 68, type: 'federal', status: 'pending', deadline: '90 days', agency: 'Internal Revenue Service', fullName: 'IRA Statutory Bonus Adders', requirements: ['Low-income community designation', 'Domestic content certification', 'Energy community qualification'], docs: ['Census Tract Documentation', 'Domestic Content Affidavit', 'Energy Community Map'] },
        { id: 'lihtc-4', program: '4% LIHTC', desc: 'Low-Income Housing Tax Credit via tax-exempt bonds', amount: 17.7, prob: 95, type: 'federal', status: 'captured', deadline: '-', agency: 'IRS / State HCR', fullName: 'Low-Income Housing Tax Credit (4% As-of-Right)', requirements: ['20% at 50% AMI or 40% at 60% AMI', 'Tax-exempt bond financing', '30-year extended use agreement'], docs: ['Cost Certification', 'Bond Issuance Letter', 'Rent Roll Certification'] },
        { id: 'nmtc', program: 'New Markets Tax Credit', desc: '39% on $60M qualified investment for commercial/parking', amount: 23.4, prob: 75, type: 'federal', status: 'pending', deadline: '120 days', agency: 'CDFI Fund', fullName: 'New Markets Tax Credit Program', requirements: ['Qualified Active Low-Income Community Business', 'CDE allocation', 'Community benefits agreement'], docs: ['QLICI Application', 'CDE Commitment Letter', 'Impact Report'] },
        { id: 'section-45l', program: 'Section 45L Credit', desc: 'Energy efficient dwelling units ($5k/unit for 747 units)', amount: 3.7, prob: 85, type: 'federal', status: 'pending', deadline: '60 days', agency: 'Internal Revenue Service', fullName: 'New Energy Efficient Home Credit', requirements: ['ENERGY STAR certification', 'DOE Zero Energy Ready Home', 'Prevailing wage compliance'], docs: ['ENERGY STAR Certification', 'HERS Index Rating', 'Third-Party Verification'] },
        { id: '179d', program: '179D Commercial Deduction', desc: 'Up to $5/SF on eligible commercial scope', amount: 1.1, prob: 95, type: 'federal', status: 'captured', deadline: '-', agency: 'Internal Revenue Service', fullName: 'Energy Efficient Commercial Building Deduction', requirements: ['25%+ energy reduction vs baseline', 'Prevailing wage certification', 'Third-party verification'], docs: ['Energy Study', 'Prevailing Wage Certification', 'As-Built Documentation'] },
        { id: 'rd-credit', program: 'R&D Tax Credits', desc: 'Controls software and optimization stack development', amount: 9.5, prob: 80, type: 'federal', status: 'pending', deadline: '180 days', agency: 'Internal Revenue Service', fullName: 'Research & Development Tax Credit (Section 41)', requirements: ['Qualified research activities', 'Technical uncertainty', 'Process of experimentation'], docs: ['R&D Study', 'Technical Documentation', 'Wage Allocation'] },
        { id: 'alt-fuel', program: 'Alt Fuel Vehicle Credit', desc: 'EV charging infrastructure credit (transfer eligible)', amount: 0.5, prob: 90, type: 'federal', status: 'pending', deadline: '45 days', agency: 'Internal Revenue Service', fullName: 'Alternative Fuel Vehicle Refueling Credit (30C)', requirements: ['Qualifying EV charging equipment', 'Public accessibility', 'Location requirements'], docs: ['Equipment Specifications', 'Installation Certification', 'Public Access Agreement'] },
        { id: 'epa-ggrf', program: 'EPA GGRF Capital', desc: 'Greenhouse Gas Reduction Fund via awardee partners', amount: 8.0, prob: 28, type: 'federal', status: 'at-risk', deadline: '30 days', agency: 'Environmental Protection Agency', fullName: 'Greenhouse Gas Reduction Fund', requirements: ['Partner with GGRF awardee', 'Low-income community focus', 'GHG reduction documentation'], docs: ['Partner Commitment', 'GHG Reduction Plan', 'Community Benefit Plan'] },
        { id: 'mbda-grant', program: 'Commerce MBDA Grant', desc: 'Minority Business Development Agency capital support', amount: 2.0, prob: 80, type: 'federal', status: 'pending', deadline: '60 days', agency: 'Dept of Commerce', fullName: 'Minority Business Development Agency Capital Grant', requirements: ['Minority-owned business certification', 'Job creation commitment', 'Capital needs documentation'], docs: ['MBE Certification', 'Business Plan', 'Capital Budget'] },
        // State & Utility Programs ($55.5M)
        { id: 'esd-grant', program: 'ESD Strategic Grant', desc: 'Empire State Development transformative project funding', amount: 12.0, prob: 75, type: 'state', status: 'pending', deadline: '90 days', agency: 'Empire State Development', fullName: 'ESD Strategic Capital Grant', requirements: ['Transformative project impact', 'Job creation commitment', 'Regional economic benefit'], docs: ['Application Package', 'Economic Impact Study', 'Job Creation Plan'] },
        { id: 'nyserda-nc', program: 'NYSERDA New Construction', desc: 'Commercial whole building performance incentives', amount: 5.0, prob: 85, type: 'state', status: 'pending', deadline: '120 days', agency: 'NYSERDA', fullName: 'New Construction Housing Program', requirements: ['Minimum 5 dwelling units', 'Exceed NYSERDA baseline by 10%+', 'Pre-construction enrollment'], docs: ['Energy Model', 'Pre-Construction Agreement', 'Blower Door Test Results'] },
        { id: 'ny-prize', program: 'NY Prize Microgrid', desc: 'Community microgrid implementation grant', amount: 1.5, prob: 70, type: 'state', status: 'pending', deadline: '180 days', agency: 'NYSERDA', fullName: 'NY Prize Community Microgrid', requirements: ['Community benefit demonstration', 'Resilience requirements', 'Technical feasibility'], docs: ['Microgrid Design', 'Community Agreement', 'Technical Study'] },
        { id: 'ny-sun', program: 'NY Sun Solar Incentive', desc: 'Block rate applied to planned capacity', amount: 0.8, prob: 95, type: 'state', status: 'captured', deadline: '-', agency: 'NYSERDA', fullName: 'NY-Sun Megawatt Block Incentive', requirements: ['Interconnection approval', 'System registration', 'Performance monitoring'], docs: ['Interconnection Agreement', 'System Registration', 'Monitoring Plan'] },
        { id: 'nyserda-storage', program: 'NYSERDA Storage Incentive', desc: 'Based on configured MWh and program tier', amount: 0.6, prob: 90, type: 'state', status: 'pending', deadline: '60 days', agency: 'NYSERDA', fullName: 'Energy Storage Incentive Program', requirements: ['Minimum storage capacity', 'Grid services commitment', 'Performance guarantees'], docs: ['Storage System Specs', 'Grid Services Agreement', 'Performance Bond'] },
        { id: 'rtem', program: 'NYSERDA RTEM', desc: 'Real Time Energy Management cost share', amount: 0.8, prob: 85, type: 'state', status: 'pending', deadline: '90 days', agency: 'NYSERDA', fullName: 'Real Time Energy Management Program', requirements: ['RTEM system installation', 'Data sharing agreement', 'Performance benchmarking'], docs: ['RTEM Specification', 'Data Agreement', 'Baseline Report'] },
        { id: 'clean-heat', program: 'NYS Clean Heat', desc: 'Per ton incentive for central heat pump systems', amount: 0.5, prob: 90, type: 'state', status: 'pending', deadline: '45 days', agency: 'NYSERDA', fullName: 'NYS Clean Heat Program', requirements: ['Heat pump system certification', 'Participating contractor', 'Installation verification'], docs: ['Equipment Certification', 'Contractor License', 'Installation Report'] },
        { id: 'excelsior', program: 'Excelsior Jobs Program', desc: 'Refundable credits for net new permanent positions', amount: 5.0, prob: 80, type: 'state', status: 'pending', deadline: '180 days', agency: 'Empire State Development', fullName: 'Excelsior Jobs Program', requirements: ['Job creation commitment', 'Investment threshold', 'Wage requirements'], docs: ['Application Package', 'Job Creation Schedule', 'Payroll Documentation'] },
        { id: 'coned-ee', program: 'Con Edison EE Rebates', desc: 'Comprehensive electric efficiency package', amount: 3.9, prob: 95, type: 'utility', status: 'captured', deadline: '-', agency: 'Consolidated Edison', fullName: 'Commercial Energy Efficiency Program', requirements: ['Con Edison service territory', 'Pre-approval before installation', 'Efficiency specifications'], docs: ['Pre-Approval Application', 'Equipment Specs', 'Installation Verification'] },
        { id: 'coned-dm', program: 'Con Edison Demand Mgmt', desc: 'Load flexibility and peak shaving program', amount: 1.3, prob: 90, type: 'utility', status: 'pending', deadline: '60 days', agency: 'Consolidated Edison', fullName: 'Demand Management Program', requirements: ['Load curtailment capability', 'Event response commitment', 'Metering requirements'], docs: ['Load Profile', 'Response Plan', 'Metering Agreement'] },
        { id: 'coned-ev', program: 'Con Edison EV Make Ready', desc: 'Commercial EV infrastructure rebate', amount: 0.2, prob: 90, type: 'utility', status: 'pending', deadline: '30 days', agency: 'Consolidated Edison', fullName: 'EV Make-Ready Program', requirements: ['Commercial EV charging', 'Public accessibility option', 'Load management'], docs: ['Site Plan', 'Equipment Specs', 'Accessibility Agreement'] },
        { id: 'bcc', program: 'Building Cleaner Communities', desc: 'Grant for net zero design and delivery', amount: 3.0, prob: 60, type: 'state', status: 'pending', deadline: '150 days', agency: 'NYSERDA', fullName: 'Buildings of Excellence / Clean Energy Communities', requirements: ['Net zero pathway', 'Innovation demonstration', 'Replicability potential'], docs: ['Design Documentation', 'Innovation Summary', 'Replication Strategy'] },
        { id: 'hcr-gap', program: 'HCR Additional Capital', desc: 'Supplemental gap funding for affordable units', amount: 8.0, prob: 60, type: 'state', status: 'pending', deadline: '120 days', agency: 'NY Homes & Community Renewal', fullName: 'HCR Gap Financing', requirements: ['Affordable housing component', 'Financial gap documentation', 'Subsidy layering review'], docs: ['Pro Forma', 'Gap Analysis', 'Subsidy Sources'] },
        { id: 'nypa', program: 'NYPA Renewable Support', desc: 'Program alignment for large onsite systems', amount: 4.0, prob: 50, type: 'state', status: 'at-risk', deadline: '90 days', agency: 'NY Power Authority', fullName: 'NYPA Renewable Energy Support', requirements: ['Large system threshold', 'NYPA partnership', 'Grid benefit demonstration'], docs: ['System Design', 'Partnership Agreement', 'Grid Impact Study'] },
        { id: 'coned-adv', program: 'Con Edison Advanced Programs', desc: 'Additional demand response and storage incentives', amount: 6.0, prob: 60, type: 'utility', status: 'pending', deadline: '120 days', agency: 'Consolidated Edison', fullName: 'Advanced Clean Energy Programs', requirements: ['Program enrollment', 'Technology requirements', 'Performance commitments'], docs: ['Program Application', 'Tech Specifications', 'Performance Agreement'] },
        { id: 'rggi', program: 'RGGI Proceeds Programs', desc: 'State auction funded clean energy grants', amount: 3.0, prob: 45, type: 'state', status: 'at-risk', deadline: '180 days', agency: 'NYSERDA', fullName: 'Regional Greenhouse Gas Initiative Programs', requirements: ['GHG reduction focus', 'Eligible project type', 'Competitive scoring'], docs: ['Application Package', 'GHG Reduction Plan', 'Scoring Criteria Response'] },
        // Local & Regional ($16.5M)
        { id: 'mv-grant', program: 'Mount Vernon City Grant', desc: 'Direct grant aligned with station area plan', amount: 2.0, prob: 95, type: 'local', status: 'captured', deadline: '-', agency: 'City of Mount Vernon', fullName: 'Mount Vernon Development Grant', requirements: ['Station area location', 'City approval', 'Community benefits'], docs: ['Site Approval', 'Community Agreement', 'Grant Agreement'] },
        { id: 'mid-hudson', program: 'Mid Hudson Momentum Fund', desc: 'Regional catalytic development grant', amount: 10.0, prob: 75, type: 'local', status: 'pending', deadline: '90 days', agency: 'Mid-Hudson Regional Economic Development Council', fullName: 'Mid-Hudson Momentum Fund', requirements: ['Regional priority alignment', 'Catalytic impact', 'Job creation'], docs: ['Regional Impact Analysis', 'Job Creation Plan', 'Application Package'] },
        { id: 'hif', program: 'Housing Implementation Fund', desc: 'Westchester County program for housing', amount: 3.0, prob: 85, type: 'local', status: 'pending', deadline: '60 days', agency: 'Westchester County', fullName: 'Westchester Housing Implementation Fund', requirements: ['Affordable housing commitment', 'County approval', 'Fair housing compliance'], docs: ['Affordability Plan', 'County Application', 'Fair Housing Certification'] },
        { id: 'westchester-ee', program: 'Westchester EE Programs', desc: 'County aligned energy efficiency incentives', amount: 1.5, prob: 80, type: 'local', status: 'pending', deadline: '90 days', agency: 'Westchester County', fullName: 'Westchester Energy Efficiency Programs', requirements: ['Energy performance targets', 'County standards', 'Verification requirements'], docs: ['Energy Plan', 'County Application', 'Verification Agreement'] },
        // Federal & Agency Grants ($26.2M)
        { id: 'doe-grants', program: 'DOE/NREL/EPA Grants', desc: 'Innovation stack and demonstration projects', amount: 4.2, prob: 70, type: 'federal', status: 'pending', deadline: '180 days', agency: 'Dept of Energy / NREL / EPA', fullName: 'Federal Innovation Grants', requirements: ['Innovation demonstration', 'Technical feasibility', 'Replication potential'], docs: ['Technical Proposal', 'Innovation Summary', 'Replication Plan'] },
        { id: 'arpa-e', program: 'ARPA-E Breakthrough Grant', desc: 'High innovation threshold demonstration', amount: 5.0, prob: 35, type: 'federal', status: 'at-risk', deadline: '240 days', agency: 'ARPA-E', fullName: 'ARPA-E Breakthrough Grant', requirements: ['Transformational technology', 'Technical risk mitigation', 'Commercialization pathway'], docs: ['Technical Proposal', 'Risk Assessment', 'Commercialization Plan'] },
        { id: 'doe-grid', program: 'DOE Grid Modernization', desc: 'VPP integration and smart grid readiness', amount: 7.0, prob: 45, type: 'federal', status: 'at-risk', deadline: '180 days', agency: 'Dept of Energy', fullName: 'Grid Modernization Initiative', requirements: ['VPP capability', 'Grid services integration', 'Cybersecurity compliance'], docs: ['VPP Design', 'Grid Integration Plan', 'Cybersecurity Assessment'] },
        { id: 'hud-cdbg', program: 'HUD CDBG', desc: 'Community Development Block Grant for station area', amount: 6.0, prob: 55, type: 'federal', status: 'pending', deadline: '120 days', agency: 'HUD', fullName: 'Community Development Block Grant', requirements: ['Low-mod income benefit', 'Eligible activity', 'NEPA compliance'], docs: ['Application Package', 'Income Survey', 'Environmental Review'] },
        { id: 'epa-water', program: 'EPA Water Quality Pilot', desc: 'Advanced treatment and verified offsets', amount: 4.0, prob: 30, type: 'federal', status: 'at-risk', deadline: '240 days', agency: 'Environmental Protection Agency', fullName: 'EPA Water Quality Innovation Pilot', requirements: ['Water quality innovation', 'Offset verification', 'Technology demonstration'], docs: ['Technical Proposal', 'Offset Methodology', 'Demonstration Plan'] },
        // Global Climate ($5M)
        { id: 'gcf', program: 'Green Climate Fund', desc: 'Through accredited partner with co-finance', amount: 5.0, prob: 50, type: 'federal', status: 'pending', deadline: '360 days', agency: 'Green Climate Fund', fullName: 'Green Climate Fund Project', requirements: ['Accredited entity partnership', 'Climate impact documentation', 'Co-financing demonstration'], docs: ['Partner Agreement', 'Climate Impact Assessment', 'Co-Finance Letters'] },
        // Foundation & Private ($43M)
        { id: 'bezos', program: 'Bezos Earth Fund', desc: 'Climate innovation and demonstration grant', amount: 5.0, prob: 30, type: 'local', status: 'at-risk', deadline: '180 days', agency: 'Bezos Earth Fund', fullName: 'Bezos Earth Fund Climate Grant', requirements: ['Climate innovation focus', 'Scale potential', 'Impact measurement'], docs: ['Proposal', 'Scale Strategy', 'Impact Metrics'] },
        { id: 'macarthur', program: 'MacArthur Foundation', desc: 'Systems change grant for climate and equity', amount: 3.0, prob: 40, type: 'local', status: 'at-risk', deadline: '240 days', agency: 'MacArthur Foundation', fullName: 'MacArthur Foundation Grant', requirements: ['Systems change approach', 'Equity focus', 'Long-term impact'], docs: ['Grant Proposal', 'Theory of Change', 'Equity Analysis'] },
        { id: 'rockefeller', program: 'Rockefeller Foundation', desc: 'Equitable energy access and resilience', amount: 2.5, prob: 35, type: 'local', status: 'at-risk', deadline: '180 days', agency: 'Rockefeller Foundation', fullName: 'Rockefeller Foundation Energy Grant', requirements: ['Energy equity focus', 'Resilience demonstration', 'Community engagement'], docs: ['Proposal', 'Equity Plan', 'Resilience Strategy'] },
        { id: 'ford', program: 'Ford Foundation', desc: 'Climate and social justice community wealth', amount: 2.0, prob: 45, type: 'local', status: 'pending', deadline: '120 days', agency: 'Ford Foundation', fullName: 'Ford Foundation Justice Grant', requirements: ['Social justice integration', 'Community wealth building', 'Systemic change'], docs: ['Grant Proposal', 'Justice Framework', 'Community Plan'] },
        { id: 'kresge', program: 'Kresge Foundation', desc: 'Urban resilience and housing initiative', amount: 1.5, prob: 50, type: 'local', status: 'pending', deadline: '150 days', agency: 'Kresge Foundation', fullName: 'Kresge Urban Resilience Grant', requirements: ['Urban resilience focus', 'Housing innovation', 'Community benefit'], docs: ['Proposal', 'Resilience Plan', 'Housing Strategy'] },
        { id: 'amazon', program: 'Amazon Climate Pledge', desc: 'Partnership and supply chain integration', amount: 5.0, prob: 20, type: 'local', status: 'at-risk', deadline: '360 days', agency: 'Amazon', fullName: 'Amazon Climate Pledge Fund', requirements: ['Climate alignment', 'Technology integration', 'Supply chain benefit'], docs: ['Partnership Proposal', 'Technology Plan', 'Integration Strategy'] },
        { id: 'microsoft', program: 'Microsoft Climate Fund', desc: 'AI and building tech alignment pilot', amount: 5.0, prob: 20, type: 'local', status: 'at-risk', deadline: '360 days', agency: 'Microsoft', fullName: 'Microsoft Climate Innovation Fund', requirements: ['AI/tech integration', 'Building innovation', 'Data partnership'], docs: ['Technical Proposal', 'AI Integration Plan', 'Data Agreement'] },
        { id: 'breakthrough', program: 'Breakthrough Energy Catalyst', desc: 'Demonstration project selection program', amount: 7.0, prob: 15, type: 'local', status: 'at-risk', deadline: '360 days', agency: 'Breakthrough Energy', fullName: 'Breakthrough Energy Catalyst', requirements: ['Technology breakthrough', 'Commercialization pathway', 'Climate impact'], docs: ['Technical Proposal', 'Commercial Plan', 'Climate Impact Assessment'] },
        { id: 'xprize', program: 'XPRIZE/Competition Awards', desc: 'Competed innovation prize funding', amount: 3.0, prob: 15, type: 'local', status: 'at-risk', deadline: '240 days', agency: 'XPRIZE Foundation', fullName: 'XPRIZE Competition', requirements: ['Competition eligibility', 'Innovation criteria', 'Judging requirements'], docs: ['Entry Application', 'Innovation Summary', 'Demo Video'] },
        { id: 'vcc', program: 'Voluntary Carbon Credits', desc: 'Premium offtake for verified net zero asset', amount: 8.0, prob: 60, type: 'local', status: 'pending', deadline: '180 days', agency: 'Various Registries', fullName: 'Voluntary Carbon Market Credits', requirements: ['Net zero pathway', 'Registry registration', 'Third-party verification'], docs: ['Carbon Plan', 'Registry Application', 'Verification Agreement'] }
      ]
    };

    // Yonkers Affordable Housing - 312 units, $323.8M TDC - Focus on affordable housing programs
    allIncentives['yonkers'] = [
      // Core Federal - Affordable Housing Focus ($52.5M)
      { id: 'lihtc-9', program: '9% LIHTC Allocation', desc: 'Competitive Low-Income Housing Tax Credit', amount: 28.5, prob: 75, type: 'federal', status: 'pending', deadline: '180 days', agency: 'IRS / NY HCR', fullName: '9% Low-Income Housing Tax Credit', requirements: ['Competitive application', '100% affordable units', '30-year compliance'], docs: ['LIHTC Application', 'Market Study', 'Rent Roll'] },
      { id: 'section-8-pbv', program: 'Section 8 Project-Based', desc: 'HUD Project-Based Voucher allocation', amount: 8.2, prob: 80, type: 'federal', status: 'pending', deadline: '120 days', agency: 'HUD', fullName: 'Section 8 Project-Based Vouchers', requirements: ['PBV agreement', 'HAP contract', 'Income verification'], docs: ['PBV Application', 'HAP Contract', 'Income Documentation'] },
      { id: '45l-yonkers', program: 'Section 45L Credit', desc: 'Energy efficient dwelling units', amount: 1.6, prob: 85, type: 'federal', status: 'pending', deadline: '60 days', agency: 'Internal Revenue Service', fullName: 'New Energy Efficient Home Credit', requirements: ['ENERGY STAR certification', 'Third-party verification'], docs: ['ENERGY STAR Cert', 'HERS Rating'] },
      { id: '179d-yonkers', program: '179D Deduction', desc: 'Commercial building energy deduction', amount: 0.5, prob: 90, type: 'federal', status: 'captured', deadline: '-', agency: 'IRS', fullName: 'Energy Efficient Commercial Building Deduction', requirements: ['25%+ energy reduction', 'Prevailing wage'], docs: ['Energy Study', 'Certification'] },
      { id: 'cdbg-yonkers', program: 'CDBG-DR Funds', desc: 'Community development disaster recovery', amount: 4.5, prob: 65, type: 'federal', status: 'pending', deadline: '90 days', agency: 'HUD', fullName: 'Community Development Block Grant', requirements: ['Low-mod income benefit', 'National objective'], docs: ['Application', 'Income Survey'] },
      { id: 'home-funds', program: 'HOME Investment', desc: 'HOME Investment Partnerships Program', amount: 3.2, prob: 70, type: 'federal', status: 'pending', deadline: '120 days', agency: 'HUD', fullName: 'HOME Investment Partnerships', requirements: ['Affordability requirements', 'HOME rent limits'], docs: ['HOME Application', 'Rent Schedule'] },
      { id: 'section-48-yonkers', program: 'Section 48 ITC', desc: 'Solar/storage investment tax credit', amount: 6.0, prob: 85, type: 'federal', status: 'pending', deadline: '90 days', agency: 'IRS', fullName: 'Section 48 Investment Tax Credit', requirements: ['Qualifying equipment', 'Prevailing wage'], docs: ['Equipment Cert', 'IRS Form 3468'] },
      // State Programs - Heavy NY HCR Focus ($48.2M)
      { id: 'hcr-htf', program: 'HCR Housing Trust Fund', desc: 'NY Housing Trust Fund capital subsidy', amount: 12.0, prob: 80, type: 'state', status: 'pending', deadline: '90 days', agency: 'NY HCR', fullName: 'Housing Trust Fund Corporation', requirements: ['100% affordable', 'HCR underwriting'], docs: ['HTF Application', 'Pro Forma'] },
      { id: 'hcr-slihc', program: 'SLIHC Credits', desc: 'State Low Income Housing Credits', amount: 8.5, prob: 75, type: 'state', status: 'pending', deadline: '120 days', agency: 'NY HCR', fullName: 'State Low Income Housing Tax Credit', requirements: ['LIHTC pairing', 'State allocation'], docs: ['SLIHC Application', 'Credit Calculation'] },
      { id: 'nyserda-mf', program: 'NYSERDA Multifamily', desc: 'New Construction multifamily program', amount: 3.8, prob: 85, type: 'state', status: 'pending', deadline: '150 days', agency: 'NYSERDA', fullName: 'Multifamily New Construction Program', requirements: ['Energy modeling', 'Pre-enrollment'], docs: ['Energy Model', 'Agreement'] },
      { id: 'ny-sun-yonkers', program: 'NY Sun Incentive', desc: 'Solar megawatt block incentive', amount: 0.4, prob: 95, type: 'state', status: 'captured', deadline: '-', agency: 'NYSERDA', fullName: 'NY-Sun Block Incentive', requirements: ['Interconnection', 'Registration'], docs: ['Interconnection Agreement'] },
      { id: 'clean-heat-yonkers', program: 'NYS Clean Heat', desc: 'Heat pump system incentives', amount: 0.3, prob: 90, type: 'state', status: 'pending', deadline: '45 days', agency: 'NYSERDA', fullName: 'Clean Heat Program', requirements: ['Heat pump specs', 'Installation'], docs: ['Equipment Cert', 'Installation Report'] },
      { id: 'dasny-grant', program: 'DASNY Bond Financing', desc: 'Dormitory Authority tax-exempt bonds', amount: 18.0, prob: 85, type: 'state', status: 'pending', deadline: '180 days', agency: 'DASNY', fullName: 'Tax-Exempt Bond Financing', requirements: ['50%+ affordable', 'Bond allocation'], docs: ['Bond Application', 'Inducement Resolution'] },
      { id: 'esd-cfa', program: 'ESD CFA Grant', desc: 'Consolidated Funding Application', amount: 3.5, prob: 65, type: 'state', status: 'pending', deadline: '240 days', agency: 'Empire State Development', fullName: 'CFA Regional Grant', requirements: ['Regional priority', 'Job creation'], docs: ['CFA Application', 'Economic Impact'] },
      { id: 'oprhp', program: 'OPRHP Recreation Grant', desc: 'Parks and recreation improvements', amount: 1.2, prob: 55, type: 'state', status: 'pending', deadline: '180 days', agency: 'OPRHP', fullName: 'Environmental Protection Fund Grant', requirements: ['Public access', 'Recreation component'], docs: ['EPF Application', 'Site Plan'] },
      // Local/Utility Programs ($22.5M)
      { id: 'yonkers-ida', program: 'Yonkers IDA PILOT', desc: 'Payment in lieu of taxes abatement', amount: 12.5, prob: 90, type: 'local', status: 'captured', deadline: '-', agency: 'Yonkers IDA', fullName: 'Industrial Development Agency PILOT', requirements: ['IDA application', 'PILOT agreement'], docs: ['IDA Application', 'PILOT Schedule'] },
      { id: 'yonkers-grant', program: 'Yonkers City Grant', desc: 'City affordable housing initiative', amount: 2.0, prob: 85, type: 'local', status: 'pending', deadline: '60 days', agency: 'City of Yonkers', fullName: 'City Affordable Housing Grant', requirements: ['Affordability commitment', 'Local hiring'], docs: ['City Application', 'Hiring Plan'] },
      { id: 'westchester-hif', program: 'Westchester HIF', desc: 'County Housing Implementation Fund', amount: 2.5, prob: 80, type: 'local', status: 'pending', deadline: '90 days', agency: 'Westchester County', fullName: 'Housing Implementation Fund', requirements: ['Fair housing', 'County approval'], docs: ['HIF Application', 'Fair Housing Cert'] },
      { id: 'coned-yonkers', program: 'Con Edison Rebates', desc: 'Electric efficiency incentives', amount: 2.2, prob: 95, type: 'utility', status: 'pending', deadline: '45 days', agency: 'Con Edison', fullName: 'Commercial Energy Efficiency', requirements: ['Pre-approval', 'Equipment specs'], docs: ['Pre-Approval', 'Equipment List'] },
      { id: 'coned-dm-yonkers', program: 'Con Ed Demand Mgmt', desc: 'Peak demand reduction program', amount: 0.8, prob: 85, type: 'utility', status: 'pending', deadline: '60 days', agency: 'Con Edison', fullName: 'Demand Management Program', requirements: ['Load flexibility', 'Event response'], docs: ['Load Profile', 'Response Plan'] },
      { id: 'coned-ev-yonkers', program: 'Con Ed EV Ready', desc: 'EV infrastructure support', amount: 0.1, prob: 90, type: 'utility', status: 'pending', deadline: '30 days', agency: 'Con Edison', fullName: 'EV Make-Ready Program', requirements: ['EV charging', 'Accessibility'], docs: ['Site Plan', 'Equipment Specs'] },
      { id: 'affordable-trust', program: 'Affordable Housing Trust', desc: 'Regional affordable housing fund', amount: 2.4, prob: 70, type: 'local', status: 'pending', deadline: '120 days', agency: 'Regional Housing Trust', fullName: 'Affordable Housing Trust Fund', requirements: ['Deep affordability', 'Long-term commitment'], docs: ['Trust Application', 'Affordability Plan'] },
      // Foundation/Private ($15.5M)
      { id: 'enterprise-pnc', program: 'Enterprise/PNC Grant', desc: 'Enterprise Community Partners grant', amount: 3.0, prob: 55, type: 'local', status: 'pending', deadline: '180 days', agency: 'Enterprise Community', fullName: 'Enterprise Green Communities', requirements: ['Green certification', 'Community benefit'], docs: ['Enterprise Application', 'Green Checklist'] },
      { id: 'lisc-grant', program: 'LISC Affordable Grant', desc: 'Local Initiatives Support Corporation', amount: 2.5, prob: 50, type: 'local', status: 'pending', deadline: '150 days', agency: 'LISC', fullName: 'LISC Community Development', requirements: ['Community development', 'Resident services'], docs: ['LISC Application', 'Service Plan'] },
      { id: 'robin-hood', program: 'Robin Hood Foundation', desc: 'Poverty-fighting initiative grant', amount: 1.5, prob: 40, type: 'local', status: 'at-risk', deadline: '240 days', agency: 'Robin Hood Foundation', fullName: 'Robin Hood Housing Grant', requirements: ['Poverty alleviation', 'Supportive services'], docs: ['Grant Proposal', 'Service Model'] },
      { id: 'citi-foundation', program: 'Citi Foundation Grant', desc: 'Financial inclusion housing grant', amount: 2.0, prob: 45, type: 'local', status: 'pending', deadline: '180 days', agency: 'Citi Foundation', fullName: 'Citi Community Development', requirements: ['Financial literacy', 'Resident programs'], docs: ['Citi Application', 'Program Plan'] },
      { id: 'jpmorgan-grant', program: 'JPMorgan Chase Grant', desc: 'AdvancingCities affordable housing', amount: 2.5, prob: 50, type: 'local', status: 'pending', deadline: '200 days', agency: 'JPMorgan Chase', fullName: 'AdvancingCities Initiative', requirements: ['Economic mobility', 'Job training'], docs: ['Application', 'Training Plan'] },
      { id: 'vcc-yonkers', program: 'Carbon Credits', desc: 'Voluntary carbon market credits', amount: 4.0, prob: 55, type: 'local', status: 'pending', deadline: '180 days', agency: 'Various Registries', fullName: 'Voluntary Carbon Credits', requirements: ['Net zero pathway', 'Verification'], docs: ['Carbon Plan', 'Verification'] }
    ];

    // New Rochelle Transit Hub - 428 units, $217.9M TDC - Transit-Oriented Development Focus
    allIncentives['new-rochelle'] = [
      // Federal Programs - Transit & Urban Focus ($35.8M)
      { id: 'fta-tod', program: 'FTA TOD Planning', desc: 'Federal Transit Administration TOD grant', amount: 5.5, prob: 70, type: 'federal', status: 'pending', deadline: '180 days', agency: 'Federal Transit Administration', fullName: 'Transit-Oriented Development Grant', requirements: ['Transit proximity', 'Density requirements', 'Mixed-use'], docs: ['TOD Application', 'Transit Plan', 'Density Study'] },
      { id: 'lihtc-4-nr', program: '4% LIHTC', desc: 'As-of-right Low-Income Housing Tax Credit', amount: 8.2, prob: 95, type: 'federal', status: 'pending', deadline: '90 days', agency: 'IRS / NY HCR', fullName: '4% Low-Income Housing Tax Credit', requirements: ['20% at 50% AMI', 'Tax-exempt bonds'], docs: ['LIHTC Application', 'Cost Cert'] },
      { id: 'section-48-nr', program: 'Section 48 ITC', desc: 'Solar/storage investment tax credit', amount: 8.5, prob: 88, type: 'federal', status: 'pending', deadline: '90 days', agency: 'IRS', fullName: 'Section 48 Investment Tax Credit', requirements: ['Qualifying equipment', 'Prevailing wage'], docs: ['IRS Form 3468', 'Equipment Cert'] },
      { id: '45l-nr', program: 'Section 45L Credit', desc: 'Energy efficient dwelling units', amount: 2.1, prob: 85, type: 'federal', status: 'pending', deadline: '60 days', agency: 'IRS', fullName: 'New Energy Efficient Home Credit', requirements: ['ENERGY STAR', 'ZERH qualification'], docs: ['ENERGY STAR Cert', 'HERS Rating'] },
      { id: '179d-nr', program: '179D Deduction', desc: 'Commercial building energy deduction', amount: 0.8, prob: 92, type: 'federal', status: 'captured', deadline: '-', agency: 'IRS', fullName: 'Energy Efficient Commercial Deduction', requirements: ['Energy reduction', 'Certification'], docs: ['Energy Study', 'Certification'] },
      { id: 'hud-hope-vi', program: 'HUD Choice Neighborhoods', desc: 'Choice Neighborhoods Implementation', amount: 6.5, prob: 45, type: 'federal', status: 'at-risk', deadline: '300 days', agency: 'HUD', fullName: 'Choice Neighborhoods Initiative', requirements: ['Transformation plan', 'Community engagement'], docs: ['CNI Application', 'Transformation Plan'] },
      { id: 'dot-raise', program: 'DOT RAISE Grant', desc: 'Rebuilding infrastructure grant', amount: 4.2, prob: 50, type: 'federal', status: 'pending', deadline: '240 days', agency: 'Dept of Transportation', fullName: 'RAISE Infrastructure Grant', requirements: ['Transportation improvement', 'Multi-modal access'], docs: ['RAISE Application', 'Transportation Plan'] },
      // State Programs ($28.5M)
      { id: 'esd-toi', program: 'ESD TOD Initiative', desc: 'Empire State transit-oriented development', amount: 8.0, prob: 75, type: 'state', status: 'pending', deadline: '120 days', agency: 'Empire State Development', fullName: 'Transit-Oriented Development Initiative', requirements: ['Transit station proximity', 'Density bonus'], docs: ['TOD Application', 'Density Plan'] },
      { id: 'nyserda-nr', program: 'NYSERDA New Construction', desc: 'Whole building performance incentives', amount: 3.2, prob: 85, type: 'state', status: 'pending', deadline: '150 days', agency: 'NYSERDA', fullName: 'New Construction Program', requirements: ['Energy modeling', 'Pre-enrollment'], docs: ['Energy Model', 'Agreement'] },
      { id: 'hcr-nr', program: 'HCR Gap Financing', desc: 'Housing capital subsidy', amount: 5.5, prob: 70, type: 'state', status: 'pending', deadline: '120 days', agency: 'NY HCR', fullName: 'HCR Capital Subsidy', requirements: ['Affordable component', 'Gap documentation'], docs: ['HCR Application', 'Gap Analysis'] },
      { id: 'mta-tod', program: 'MTA TOD Density Bonus', desc: 'Metropolitan Transportation Authority bonus', amount: 4.0, prob: 80, type: 'state', status: 'pending', deadline: '90 days', agency: 'MTA', fullName: 'MTA Transit-Adjacent Bonus', requirements: ['MTA station adjacency', 'Fare integration'], docs: ['MTA Agreement', 'Integration Plan'] },
      { id: 'ny-sun-nr', program: 'NY Sun Incentive', desc: 'Solar megawatt block incentive', amount: 0.5, prob: 95, type: 'state', status: 'captured', deadline: '-', agency: 'NYSERDA', fullName: 'NY-Sun Block Incentive', requirements: ['Interconnection'], docs: ['Interconnection Agreement'] },
      { id: 'storage-nr', program: 'NYSERDA Storage', desc: 'Energy storage incentive', amount: 0.4, prob: 90, type: 'state', status: 'pending', deadline: '60 days', agency: 'NYSERDA', fullName: 'Storage Incentive Program', requirements: ['Storage capacity', 'Grid services'], docs: ['Storage Specs', 'Grid Agreement'] },
      { id: 'rtem-nr', program: 'NYSERDA RTEM', desc: 'Real Time Energy Management', amount: 0.5, prob: 85, type: 'state', status: 'pending', deadline: '90 days', agency: 'NYSERDA', fullName: 'RTEM Program', requirements: ['RTEM system', 'Data sharing'], docs: ['RTEM Spec', 'Data Agreement'] },
      { id: 'excelsior-nr', program: 'Excelsior Jobs', desc: 'Job creation tax credits', amount: 3.5, prob: 75, type: 'state', status: 'pending', deadline: '180 days', agency: 'ESD', fullName: 'Excelsior Jobs Program', requirements: ['Job creation', 'Investment'], docs: ['Application', 'Job Schedule'] },
      { id: 'clean-heat-nr', program: 'NYS Clean Heat', desc: 'Heat pump incentives', amount: 0.4, prob: 90, type: 'state', status: 'pending', deadline: '45 days', agency: 'NYSERDA', fullName: 'Clean Heat Program', requirements: ['Heat pump system'], docs: ['Equipment Cert'] },
      { id: 'brownfield-nr', program: 'Brownfield Credits', desc: 'Brownfield redevelopment tax credits', amount: 2.5, prob: 65, type: 'state', status: 'pending', deadline: '240 days', agency: 'DEC', fullName: 'Brownfield Cleanup Program', requirements: ['Brownfield site', 'Remediation'], docs: ['BCP Application', 'Remediation Plan'] },
      // Local Programs ($18.2M)
      { id: 'nr-tod-bonus', program: 'NR Downtown TOD Bonus', desc: 'New Rochelle downtown density bonus', amount: 6.5, prob: 90, type: 'local', status: 'captured', deadline: '-', agency: 'City of New Rochelle', fullName: 'Downtown Density Bonus', requirements: ['Downtown zone', 'Design standards'], docs: ['Site Plan Approval', 'Design Review'] },
      { id: 'nr-pilot', program: 'New Rochelle PILOT', desc: 'Payment in lieu of taxes', amount: 5.2, prob: 88, type: 'local', status: 'pending', deadline: '60 days', agency: 'New Rochelle IDA', fullName: 'IDA PILOT Agreement', requirements: ['IDA application', 'Community benefits'], docs: ['IDA Application', 'PILOT Schedule'] },
      { id: 'westchester-tod', program: 'Westchester TOD Fund', desc: 'County transit-oriented fund', amount: 2.0, prob: 75, type: 'local', status: 'pending', deadline: '120 days', agency: 'Westchester County', fullName: 'Transit-Oriented Development Fund', requirements: ['Transit proximity', 'Affordable component'], docs: ['TOD Application', 'Site Plan'] },
      { id: 'coned-nr', program: 'Con Edison Rebates', desc: 'Electric efficiency incentives', amount: 2.8, prob: 95, type: 'utility', status: 'pending', deadline: '45 days', agency: 'Con Edison', fullName: 'Commercial Energy Efficiency', requirements: ['Pre-approval'], docs: ['Pre-Approval Application'] },
      { id: 'coned-dm-nr', program: 'Con Ed Demand Mgmt', desc: 'Peak demand reduction', amount: 1.0, prob: 85, type: 'utility', status: 'pending', deadline: '60 days', agency: 'Con Edison', fullName: 'Demand Management', requirements: ['Load flexibility'], docs: ['Load Profile'] },
      { id: 'coned-ev-nr', program: 'Con Ed EV Ready', desc: 'EV infrastructure support', amount: 0.2, prob: 90, type: 'utility', status: 'pending', deadline: '30 days', agency: 'Con Edison', fullName: 'EV Make-Ready', requirements: ['EV charging'], docs: ['Site Plan'] },
      { id: 'westchester-ee-nr', program: 'Westchester EE', desc: 'County energy efficiency', amount: 0.5, prob: 80, type: 'local', status: 'pending', deadline: '90 days', agency: 'Westchester County', fullName: 'Energy Efficiency Program', requirements: ['Energy targets'], docs: ['Energy Plan'] },
      // Foundation/Private ($10.8M)
      { id: 'lsc-grant', program: 'Living Cities Grant', desc: 'Living Cities integration initiative', amount: 2.5, prob: 50, type: 'local', status: 'pending', deadline: '180 days', agency: 'Living Cities', fullName: 'Integration Initiative', requirements: ['Systems integration', 'Innovation'], docs: ['Application', 'Innovation Plan'] },
      { id: 'enterprise-nr', program: 'Enterprise Grant', desc: 'Enterprise Community Partners', amount: 2.0, prob: 55, type: 'local', status: 'pending', deadline: '150 days', agency: 'Enterprise Community', fullName: 'Enterprise Green Communities', requirements: ['Green certification'], docs: ['Enterprise Application'] },
      { id: 'kresge-nr', program: 'Kresge Foundation', desc: 'Urban resilience grant', amount: 1.5, prob: 45, type: 'local', status: 'at-risk', deadline: '200 days', agency: 'Kresge Foundation', fullName: 'Urban Resilience Grant', requirements: ['Resilience focus'], docs: ['Proposal'] },
      { id: 'vcc-nr', program: 'Carbon Credits', desc: 'Voluntary carbon market', amount: 4.8, prob: 60, type: 'local', status: 'pending', deadline: '180 days', agency: 'Various Registries', fullName: 'Voluntary Carbon Credits', requirements: ['Net zero pathway'], docs: ['Carbon Plan'] }
    ];

    // V19 Incentive Display State
    let showAllIncentives = false;
    let bypassScenarioFilter = false; // V39: Allow showing all incentives regardless of scenario
    const DEFAULT_VISIBLE = 10;

    // Render incentives table from data
    function renderIncentivesTable(projectId = null) {
      const tbody = document.getElementById('incentives-tbody');
      if (!tbody) return;

      let incentivesToShow = [];
      const projectNames = { 'mt-vernon': 'Mount Vernon', 'yonkers': 'Yonkers', 'new-rochelle': 'New Rochelle' };

      if (projectId && projectId !== 'portfolio') {
        // Single project view
        incentivesToShow = (allIncentives[projectId] || []).map(inc => ({ ...inc, projectId, projectName: projectNames[projectId] }));
      } else {
        // Portfolio view - combine all projects
        Object.keys(allIncentives).forEach(pid => {
          allIncentives[pid].forEach(inc => {
            incentivesToShow.push({ ...inc, projectId: pid, projectName: projectNames[pid] });
          });
        });
        // Sort by amount descending
        incentivesToShow.sort((a, b) => b.amount - a.amount);
      }

      const visibleCount = showAllIncentives ? incentivesToShow.length : Math.min(DEFAULT_VISIBLE, incentivesToShow.length);
      const displayIncentives = incentivesToShow.slice(0, visibleCount);

      const typeColors = { federal: 'blue', state: 'cyan', local: 'cyan', utility: 'blue' };
      const statusColors = { captured: 'blue', pending: 'slate', 'at-risk': 'blue' };
      const probColors = p => p >= 80 ? 'blue' : p >= 50 ? 'blue' : 'slate';

      // V20: Store incentive data for modal access
      window.currentIncentives = displayIncentives;

      // V39: Add data-prob and data-amount attributes for reliable scenario filtering
      tbody.innerHTML = displayIncentives.map((inc, i) => `
        <tr class="incentive-row" data-project="${inc.projectId}" data-type="${inc.type}" data-status="${inc.status}" data-prob="${inc.prob}" data-amount="${inc.amount}">
          <td>
            <p class="font-medium text-slate-900 dark:text-white">${inc.program}</p>
            <p class="text-xs text-slate-500">${inc.desc}</p>
          </td>
          ${!projectId || projectId === 'portfolio' ? `<td class="text-slate-600 dark:text-slate-300">${inc.projectName}</td>` : ''}
          <td><span class="text-xs font-medium text-${typeColors[inc.type]}-600 dark:text-${typeColors[inc.type]}-400">${inc.type.charAt(0).toUpperCase() + inc.type.slice(1)}</span></td>
          <td class="text-right font-mono font-medium text-slate-900 dark:text-white">$${inc.amount.toFixed(1)}M</td>
          <td class="text-right">
            <span class="font-mono text-sm font-medium text-${probColors(inc.prob)}-600 dark:text-${probColors(inc.prob)}-400">${inc.prob}%</span>
          </td>
          <td class="${inc.deadline === '-' ? 'text-slate-600 dark:text-slate-300' : inc.deadline.includes('days') && parseInt(inc.deadline) <= 30 ? 'text-red-600 dark:text-red-400 font-medium' : 'text-slate-600 dark:text-slate-300'}">${inc.deadline}</td>
          <td><span class="text-xs font-medium text-${statusColors[inc.status]}-600 dark:text-${statusColors[inc.status]}-400">${inc.status === 'at-risk' ? 'At Risk' : inc.status.charAt(0).toUpperCase() + inc.status.slice(1)}</span></td>
          <td class="text-center">
            <button onclick="openIncentiveDetail('${inc.id || inc.program.toLowerCase().replace(/[^a-z0-9]/g, '-')}', ${i})" class="text-xs px-3 py-1.5 bg-blue-900 hover:bg-blue-800 text-white rounded-md font-medium transition-colors shadow-sm">View</button>
          </td>
        </tr>
      `).join('');

      // Update footer with proper IDs
      const countEl = document.getElementById('incentives-count');
      const btnEl = document.getElementById('view-all-btn');
      if (countEl) {
        countEl.textContent = `Showing ${visibleCount} of ${incentivesToShow.length} incentives`;
      }
      if (btnEl) {
        btnEl.textContent = showAllIncentives ? 'Show Less' : `View All ${incentivesToShow.length} Incentives`;
      }
    }

    function toggleViewAll() {
      // V39: Toggle between filtered view and bypass (show all) mode
      bypassScenarioFilter = !bypassScenarioFilter;
      showAllIncentives = true; // Always show all rows when toggling
      const currentProject = document.getElementById('project-selector')?.value || 'portfolio';
      renderIncentivesTable(currentProject === 'portfolio' ? null : currentProject);

      // V39: If bypassing filter, show all rows; otherwise re-apply scenario filter
      if (bypassScenarioFilter) {
        // Show ALL rows - remove any scenario filtering
        const allRows = document.querySelectorAll('.incentive-row');
        allRows.forEach(row => {
          row.style.display = '';
          row.dataset.scenarioHidden = '';
          row.classList.remove('scenario-match', 'scenario-partial');
        });
        const totalRows = allRows.length;

        // Update ALL UI elements to show bypass mode is active
        const countEl = document.getElementById('incentives-count');
        const btnEl = document.getElementById('view-all-btn');
        const incentivesSubtitle = document.getElementById('incentives-subtitle');
        const kpiQualifying = document.getElementById('kpi-programs-qualifying');
        const kpiTotal = document.getElementById('kpi-programs-total');

        if (countEl) countEl.textContent = `Showing all ${totalRows} incentives (no filter)`;
        if (btnEl) btnEl.textContent = 'Apply Scenario Filter';
        if (incentivesSubtitle) incentivesSubtitle.textContent = `All ${totalRows} programs shown (filter bypassed)`;
        if (kpiQualifying) kpiQualifying.textContent = totalRows;
        if (kpiTotal) kpiTotal.textContent = totalRows;

        // Remove active state from scenario buttons to show no filter is active
        document.querySelectorAll('.scenario-card, .scenario-card-compact').forEach(btn => {
          btn.classList.remove('active');
        });
      } else if (currentProject !== 'portfolio' && currentScenario) {
        selectScenario(currentScenario);
      }
    }

    // V19 Project/Portfolio View Toggle
    const projectData = {
      'mt-vernon': {
        name: 'Mount Vernon Mixed-Use',
        address: '225 South 4th Ave, Mount Vernon, NY 10550',
        units: '747 units',
        type: 'Mixed-Use',
        tier: 'Tier 3',
        tdc: 588.8, // Total Development Cost in $M
        statusBadge: '2 Actions Required',
        statusColor: 'blue',
        thumbnail: 'Ground level.jpg',
        kpis: { value: '$588.8M', identified: '$252.2M', captured: '$88.1M', rate: '35%', programs: 48, actions: 2 },
        // V21: Probability-weighted scenarios
        scenarios: {
          conservative: { value: 88.1, coverage: 15.0, confidence: 80, label: 'Conservative', desc: 'Programs with ministerial approval or high precedent' },
          realistic: { value: 156.1, coverage: 26.5, confidence: 65, label: 'Realistic (Base Case)', desc: 'Includes discretionary programs with strong eligibility' },
          optimistic: { value: 204.5, coverage: 34.7, confidence: 40, label: 'Optimistic', desc: 'Adds competitive programs with favorable positioning' },
          bestcase: { value: 252.2, coverage: 42.8, confidence: 20, label: 'Best Case', desc: 'Full program stack assuming optimal conditions' }
        }
      },
      'yonkers': {
        name: 'Yonkers Affordable Housing',
        address: '87 Warburton Ave, Yonkers, NY 10701',
        units: '312 units',
        type: 'Affordable Housing',
        tier: 'Tier 2',
        tdc: 323.8,
        statusBadge: '1 Critical Action',
        statusColor: 'red',
        thumbnail: 'https://images.unsplash.com/photo-1545324418-cc1a3fa10c00?w=160&h=160&fit=crop',
        kpis: { value: '$323.8M', identified: '$138.7M', captured: '$31.9M', rate: '23%', programs: 26, actions: 1 },
        scenarios: {
          conservative: { value: 55.2, coverage: 17.0, confidence: 80, label: 'Conservative', desc: 'Programs with ministerial approval or high precedent' },
          realistic: { value: 92.8, coverage: 28.7, confidence: 65, label: 'Realistic (Base Case)', desc: 'Includes discretionary programs with strong eligibility' },
          optimistic: { value: 118.5, coverage: 36.6, confidence: 40, label: 'Optimistic', desc: 'Adds competitive programs with favorable positioning' },
          bestcase: { value: 138.7, coverage: 42.8, confidence: 20, label: 'Best Case', desc: 'Full program stack assuming optimal conditions' }
        }
      },
      'new-rochelle': {
        name: 'New Rochelle Transit Hub',
        address: '150 Main St, New Rochelle, NY 10801',
        units: '428 units',
        type: 'Transit-Oriented',
        tier: 'Tier 1',
        tdc: 217.9,
        statusBadge: 'On Track',
        statusColor: 'blue',
        thumbnail: 'https://images.unsplash.com/photo-1486325212027-8081e485255e?w=160&h=160&fit=crop',
        kpis: { value: '$217.9M', identified: '$93.3M', captured: '$14.8M', rate: '16%', programs: 26, actions: 0 },
        scenarios: {
          conservative: { value: 38.2, coverage: 17.5, confidence: 80, label: 'Conservative', desc: 'Programs with ministerial approval or high precedent' },
          realistic: { value: 62.5, coverage: 28.7, confidence: 65, label: 'Realistic (Base Case)', desc: 'Includes discretionary programs with strong eligibility' },
          optimistic: { value: 79.8, coverage: 36.6, confidence: 40, label: 'Optimistic', desc: 'Adds competitive programs with favorable positioning' },
          bestcase: { value: 93.3, coverage: 42.8, confidence: 20, label: 'Best Case', desc: 'Full program stack assuming optimal conditions' }
        }
      }
    };

    // V21: Current selected scenario (default to realistic)
    let currentScenario = 'realistic';
    let currentProjectId = 'mt-vernon';

    function switchProjectView(projectId) {
      // V39: Reset bypass mode when switching projects
      bypassScenarioFilter = false;

      // V24: Updated for integrated scenario tabs
      const scenarioTabsContainer = document.getElementById('scenario-tabs-container');
      const portfolioFilters = document.getElementById('portfolio-filters');
      const projectsSummaryCard = document.getElementById('projects-summary-card');
      const incentivesTitle = document.getElementById('incentives-title');
      const incentivesSubtitle = document.getElementById('incentives-subtitle');
      const projectColumn = document.querySelector('#incentives-table th:nth-child(2)');
      const projectSelector = document.getElementById('project-selector');

      // V24: Unified KPI elements
      const kpiPortfolioValue = document.getElementById('kpi-portfolio-value');
      const kpiValueLabel = document.getElementById('kpi-value-label');
      const kpiIdentified = document.getElementById('kpi-identified');
      const kpiCaptured = document.getElementById('kpi-captured');
      const kpiCapturedLabel = document.getElementById('kpi-captured-label');
      const kpiPrograms = document.getElementById('kpi-programs');
      const kpiActions = document.getElementById('kpi-actions');
      const projectAddress = document.getElementById('project-address');

      // Update the dropdown to reflect current selection
      if (projectSelector) projectSelector.value = projectId;

      // V24: Project detail card element
      const selectedProjectCard = document.getElementById('selected-project-card');

      if (projectId === 'portfolio') {
        // Portfolio View - hide scenario tabs, show portfolio totals
        scenarioTabsContainer?.classList.add('hidden');
        portfolioFilters?.classList.remove('hidden');
        projectsSummaryCard?.classList.remove('hidden');
        selectedProjectCard?.classList.add('hidden'); // V24: Hide project card in portfolio view
        if (incentivesTitle) incentivesTitle.textContent = 'All Incentives';
        if (incentivesSubtitle) incentivesSubtitle.textContent = '144 programs across 3 projects';
        if (projectColumn) projectColumn.style.display = '';

        // Update KPIs to portfolio totals
        if (kpiPortfolioValue) kpiPortfolioValue.textContent = '$1.13B';
        if (kpiValueLabel) kpiValueLabel.textContent = 'Portfolio Value';
        if (kpiIdentified) kpiIdentified.textContent = '$484.2M';
        if (kpiCaptured) kpiCaptured.textContent = '$169.2M';
        if (kpiCapturedLabel) kpiCapturedLabel.textContent = 'Total Captured (35%)';
        if (kpiPrograms) kpiPrograms.textContent = '144';
        if (kpiActions) kpiActions.textContent = '3';
        if (projectAddress) projectAddress.textContent = '3 projects in Westchester County';

        // V26: Update Programs to show full count in portfolio view
        const kpiProgramsQualifying = document.getElementById('kpi-programs-qualifying');
        const kpiProgramsTotal = document.getElementById('kpi-programs-total');
        if (kpiProgramsQualifying) kpiProgramsQualifying.textContent = '144';
        if (kpiProgramsTotal) kpiProgramsTotal.textContent = '144';

        // V26: Hide thumbnail in portfolio view (show generic icon)
        const projectThumb = document.getElementById('project-thumb');
        if (projectThumb) projectThumb.src = 'https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=64&h=40&fit=crop';

        // Reset current project tracking
        currentProjectId = null;

        // Reset row highlighting (show all rows fully)
        document.querySelectorAll('.incentive-row').forEach(row => {
          row.classList.remove('scenario-match', 'scenario-partial');
        });

        // Reset and render incentives table for portfolio
        showAllIncentives = false;
        renderIncentivesTable(null);
      } else {
        // Individual Project View - show scenario tabs
        const project = projectData[projectId];
        if (!project) return;

        scenarioTabsContainer?.classList.remove('hidden');
        portfolioFilters?.classList.add('hidden');
        projectsSummaryCard?.classList.add('hidden');
        selectedProjectCard?.classList.remove('hidden'); // V24: Show project card
        if (incentivesTitle) incentivesTitle.textContent = 'Project Incentives';
        if (incentivesSubtitle) incentivesSubtitle.textContent = `${project.kpis.programs} programs for ${project.name}`;
        if (projectColumn) projectColumn.style.display = 'none';

        // Update KPIs with project data
        if (kpiPortfolioValue) kpiPortfolioValue.textContent = project.kpis.value;
        if (kpiValueLabel) kpiValueLabel.textContent = 'Total Development Cost';
        if (kpiIdentified) kpiIdentified.textContent = project.kpis.identified;
        if (kpiPrograms) kpiPrograms.textContent = project.kpis.programs;
        if (kpiActions) kpiActions.textContent = project.kpis.actions;
        if (projectAddress) projectAddress.textContent = project.address;

        // V26: Update horizontal strip thumbnail
        const projectThumb = document.getElementById('project-thumb');
        if (projectThumb) projectThumb.src = project.thumbnail;

        // V26: Update Programs to X/Y format (will be calculated by selectScenario)
        const kpiProgramsTotal = document.getElementById('kpi-programs-total');
        if (kpiProgramsTotal) kpiProgramsTotal.textContent = project.kpis.programs;

        // V24: Update project detail card (now hidden but kept for compatibility)
        const cardImage = document.getElementById('project-card-image');
        const cardName = document.getElementById('project-card-name');
        const cardAddress = document.getElementById('project-card-address');
        const cardBadge = document.getElementById('project-card-badge');
        const cardUnits = document.getElementById('project-card-units');
        const cardType = document.getElementById('project-card-type');
        const cardTdc = document.getElementById('project-card-tdc');
        const cardTier = document.getElementById('project-card-tier');

        if (cardImage) cardImage.src = project.thumbnail;
        if (cardName) cardName.textContent = project.name;
        if (cardAddress) cardAddress.textContent = project.address;
        if (cardBadge) {
          cardBadge.textContent = project.statusBadge;
          cardBadge.className = `px-3 py-1 text-xs font-semibold rounded-full ${
            project.statusColor === 'red' ? 'bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400' :
            project.statusColor === 'blue' ? 'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400' :
            'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400'
          }`;
        }
        if (cardUnits) cardUnits.textContent = project.units;
        if (cardType) cardType.textContent = project.type;
        if (cardTdc) cardTdc.textContent = `$${project.tdc}M`;
        if (cardTier) cardTier.textContent = project.tier;

        // Set current project and render table
        currentProjectId = projectId;
        showAllIncentives = false;
        renderIncentivesTable(projectId);

        // Update scenario display with project-specific values (includes row highlighting)
        updateScenarioDisplay(projectId);
      }
    }

    // V23: Updated selectScenario for unified KPI section
    // V24: Toggle Actions Panel
    function toggleActionsPanel() {
      const panel = document.getElementById('actions-panel');
      const overlay = document.getElementById('actions-panel-overlay');
      if (panel && overlay) {
        panel.classList.toggle('open');
        overlay.classList.toggle('open');
      }
    }

    function selectScenario(scenarioId) {
      currentScenario = scenarioId;
      // V39: Reset bypass mode when explicitly selecting a scenario
      bypassScenarioFilter = false;

      // V24: Scenario display names
      const scenarioNames = {
        conservative: 'Conservative',
        realistic: 'Realistic',
        optimistic: 'Optimistic',
        bestcase: 'Best Case'
      };

      // V26: Update active states on both card styles
      document.querySelectorAll('.scenario-card, .scenario-card-compact').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.scenario === scenarioId);
      });

      // V24: Apply background highlighting based on probability thresholds (no fading)
      const thresholds = {
        conservative: 80,
        realistic: 65,
        optimistic: 40,
        bestcase: 20
      };
      const threshold = thresholds[scenarioId];

      // V39: Count qualifying programs, calculate total value, and FILTER by scenario
      // Using data attributes for reliable access regardless of column structure
      let qualifyingCount = 0;
      let totalCount = 0;
      let qualifyingValue = 0;

      document.querySelectorAll('.incentive-row').forEach(row => {
        // First, restore ALL rows to visible state (reset previous filtering)
        row.style.display = '';
        row.dataset.scenarioHidden = '';
        row.classList.remove('scenario-match', 'scenario-partial');

        // Get probability from data attribute (reliable, no DOM parsing needed)
        const prob = parseInt(row.dataset.prob) || 0;
        const amount = parseFloat(row.dataset.amount) || 0;

        totalCount++;

        // V39: FILTER - Hide/show rows based on probability threshold
        if (prob >= threshold) {
          // Show qualifying rows with highlight
          row.style.display = '';
          row.classList.add('scenario-match');
          qualifyingCount++;
          qualifyingValue += amount;
        } else {
          // Hide non-qualifying rows
          row.style.display = 'none';
          row.dataset.scenarioHidden = 'true';
        }
      });

      // V26: Update Programs count to show "X / Y" format
      const kpiQualifying = document.getElementById('kpi-programs-qualifying');
      const kpiTotal = document.getElementById('kpi-programs-total');
      if (kpiQualifying) kpiQualifying.textContent = qualifyingCount;
      if (kpiTotal) kpiTotal.textContent = totalCount;

      // V39: Update subtitle to show filtered count
      const incentivesSubtitle = document.getElementById('incentives-subtitle');
      if (incentivesSubtitle && currentProjectId) {
        const projectName = projectData[currentProjectId]?.name || 'Project';
        incentivesSubtitle.textContent = `${qualifyingCount} of ${totalCount} programs shown (${scenarioNames[scenarioId]} scenario, ≥${threshold}% confidence)`;
      }

      // V39: Update footer count and button text
      const countEl = document.getElementById('incentives-count');
      const btnEl = document.getElementById('view-all-btn');
      if (countEl) {
        countEl.textContent = `Showing ${qualifyingCount} of ${totalCount} incentives (${scenarioNames[scenarioId]})`;
      }
      if (btnEl) {
        btnEl.textContent = qualifyingCount < totalCount ? `Show All ${totalCount} (bypass filter)` : 'All Programs Shown';
        btnEl.style.display = qualifyingCount < totalCount ? '' : 'none';
      }

      // V24: Update the EXPECTED amount based on selected scenario (not "Captured")
      const project = projectData[currentProjectId];
      if (project && project.scenarios) {
        const scenario = project.scenarios[scenarioId];
        const kpiCaptured = document.getElementById('kpi-captured');
        const kpiCapturedLabel = document.getElementById('kpi-captured-label');
        if (kpiCaptured) {
          kpiCaptured.textContent = `$${scenario.value.toFixed(1)}M`;
        }
        if (kpiCapturedLabel) {
          kpiCapturedLabel.textContent = `Expected (${scenarioNames[scenarioId]})`;
        }
      }
    }

    // V24: Updated updateScenarioDisplay for integrated scenario tabs
    function updateScenarioDisplay(projectId) {
      const project = projectData[projectId];
      if (!project || !project.scenarios) return;

      const scenarios = project.scenarios;

      // V24: Update scenario tab values (shortened format)
      const consVal = document.getElementById('scenario-cons-val');
      const realVal = document.getElementById('scenario-real-val');
      const optVal = document.getElementById('scenario-opt-val');
      const bestVal = document.getElementById('scenario-best-val');

      if (consVal) consVal.textContent = `$${Math.round(scenarios.conservative.value)}M`;
      if (realVal) realVal.textContent = `$${Math.round(scenarios.realistic.value)}M`;
      if (optVal) optVal.textContent = `$${Math.round(scenarios.optimistic.value)}M`;
      if (bestVal) bestVal.textContent = `$${Math.round(scenarios.bestcase.value)}M`;

      // V24: Update EXPECTED KPI based on current scenario (not "Captured")
      const scenarioNames = {
        conservative: 'Conservative',
        realistic: 'Realistic',
        optimistic: 'Optimistic',
        bestcase: 'Best Case'
      };
      const scenario = scenarios[currentScenario];
      const kpiCaptured = document.getElementById('kpi-captured');
      const kpiCapturedLabel = document.getElementById('kpi-captured-label');
      if (kpiCaptured) {
        kpiCaptured.textContent = `$${scenario.value.toFixed(1)}M`;
      }
      if (kpiCapturedLabel) {
        kpiCapturedLabel.textContent = `Expected (${scenarioNames[currentScenario]})`;
      }

      // V26: Ensure correct scenario card is active (both styles)
      document.querySelectorAll('.scenario-card, .scenario-card-compact').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.scenario === currentScenario);
      });

      // V24: Apply row highlighting for current scenario
      selectScenario(currentScenario);
    }

    function showScenarioMethodology() {
      const methodologyContent = `
        <div class="p-6">
          <h2 class="text-xl font-bold text-slate-900 dark:text-white mb-4">Incentive Scenario Methodology</h2>

          <div class="space-y-4 text-sm text-slate-600 dark:text-slate-300">
            <div>
              <h3 class="font-semibold text-slate-800 dark:text-white mb-2">Data Inputs</h3>
              <ul class="list-disc list-inside space-y-1 ml-2">
                <li>Historical program approval rates from agency databases</li>
                <li>Current program funding levels and allocation trends</li>
                <li>Published eligibility criteria and scoring frameworks</li>
                <li>Comparable project outcomes (anonymized platform data)</li>
              </ul>
            </div>

            <div>
              <h3 class="font-semibold text-slate-800 dark:text-white mb-2">Scenario Construction</h3>
              <ul class="list-disc list-inside space-y-1 ml-2">
                <li><strong>Conservative (80%):</strong> As-of-right programs + high-probability discretionary</li>
                <li><strong>Realistic (65%):</strong> Adds programs with strong eligibility alignment</li>
                <li><strong>Optimistic (40%):</strong> Includes competitive programs with favorable positioning</li>
                <li><strong>Best Case (20%):</strong> Full program stack assuming optimal conditions</li>
              </ul>
            </div>

            <div>
              <h3 class="font-semibold text-slate-800 dark:text-white mb-2">Limitations</h3>
              <ul class="list-disc list-inside space-y-1 ml-2">
                <li>Government agencies retain discretionary authority</li>
                <li>Program rules and funding are subject to change</li>
                <li>Political and budgetary factors may affect availability</li>
                <li>Projections assume current regulatory environment</li>
              </ul>
            </div>

            <div class="pt-3 border-t border-slate-200 dark:border-slate-700">
              <p class="text-xs text-slate-500 dark:text-slate-400">
                Methodology reviewed quarterly. Last update: January 2026
              </p>
            </div>
          </div>
        </div>
      `;

      // Create and show modal
      const overlay = document.createElement('div');
      overlay.className = 'fixed inset-0 z-[200] bg-black/50 backdrop-blur-sm flex items-center justify-center';
      overlay.onclick = (e) => { if (e.target === overlay) overlay.remove(); };

      const modal = document.createElement('div');
      modal.className = 'bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-lg mx-4 max-h-[80vh] overflow-y-auto';
      modal.innerHTML = methodologyContent + `
        <div class="px-6 pb-6">
          <button onclick="this.closest('.fixed').remove()" class="w-full py-2.5 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-200 rounded-lg font-medium transition-colors">
            Close
          </button>
        </div>
      `;

      overlay.appendChild(modal);
      document.body.appendChild(overlay);
    }

    function showFullDisclaimer() {
      const disclaimerContent = `
        <div class="p-6">
          <h2 class="text-xl font-bold text-slate-900 dark:text-white mb-4">Important Disclosure</h2>

          <div class="space-y-4 text-sm text-slate-600 dark:text-slate-300">
            <p>
              These incentive scenarios represent analytical estimates based on historical program data,
              current eligibility criteria, and market conditions. They are <strong>not guarantees</strong>
              of incentive awards or investment returns.
            </p>

            <ul class="list-disc list-inside space-y-2 ml-2">
              <li>Actual incentive amounts may vary significantly from projections</li>
              <li>Government programs are subject to change, funding limitations, and discretionary approval</li>
              <li>Confidence percentages reflect historical approval rates and analytical modeling, not certainty of outcome</li>
              <li>This information does not constitute legal, tax, or investment advice</li>
              <li>Users should conduct independent due diligence and consult qualified professionals before making investment decisions</li>
            </ul>

            <div class="pt-4 border-t border-slate-200 dark:border-slate-700">
              <p class="text-xs text-slate-500 dark:text-slate-400">
                IncentEdge is an information platform providing incentive intelligence services.
                We are not a registered investment adviser, broker-dealer, or legal services provider.
                The information provided should be used as one input among many in your decision-making process.
              </p>
            </div>
          </div>
        </div>
      `;

      const overlay = document.createElement('div');
      overlay.className = 'fixed inset-0 z-[200] bg-black/50 backdrop-blur-sm flex items-center justify-center';
      overlay.onclick = (e) => { if (e.target === overlay) overlay.remove(); };

      const modal = document.createElement('div');
      modal.className = 'bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-lg mx-4 max-h-[80vh] overflow-y-auto';
      modal.innerHTML = disclaimerContent + `
        <div class="px-6 pb-6">
          <button onclick="this.closest('.fixed').remove()" class="w-full py-2.5 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-200 rounded-lg font-medium transition-colors">
            I Understand
          </button>
        </div>
      `;

      overlay.appendChild(modal);
      document.body.appendChild(overlay);
    }

    function openScenarioExport() {
      showToast('success', 'Export Started', 'Generating pro forma export with ' + projectData[currentProjectId].scenarios[currentScenario].label + ' scenario assumptions...');

      // Simulate export
      setTimeout(() => {
        showToast('success', 'Export Ready', 'Pro forma template downloaded successfully');
      }, 1500);
    }

    // V17 Incentives Table Filter Functions
    function filterIncentives() {
      const typeFilter = document.getElementById('filter-type').value;
      const statusFilter = document.getElementById('filter-status').value;
      const currentProject = document.getElementById('project-selector').value;

      const rows = document.querySelectorAll('.incentive-row');
      let visibleCount = 0;

      rows.forEach(row => {
        const project = row.dataset.project;
        const type = row.dataset.type;
        const status = row.dataset.status;

        // If in portfolio view, show all projects; if in project view, filter by project
        const projectMatch = currentProject === 'portfolio' || project === currentProject;
        const typeMatch = !typeFilter || type === typeFilter;
        const statusMatch = !statusFilter || status === statusFilter;

        if (projectMatch && typeMatch && statusMatch) {
          row.style.display = '';
          visibleCount++;
        } else {
          row.style.display = 'none';
        }
      });

      showToast('info', 'Filtered', `Showing ${visibleCount} incentives`);
    }

    // V24: Enhanced sorting - sorts ALL data, then re-renders table
    let currentSort = { column: null, direction: 'asc' };

    function sortIncentives(column) {
      // Toggle direction if same column, otherwise default to asc (or desc for numbers)
      const numericColumns = ['amount', 'probability', 'deadline'];
      const defaultDesc = numericColumns.includes(column);

      if (currentSort.column === column) {
        currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
      } else {
        currentSort.column = column;
        currentSort.direction = defaultDesc ? 'desc' : 'asc';
      }

      const direction = currentSort.direction === 'asc' ? 1 : -1;

      // Get current project view
      const projectSelector = document.getElementById('project-selector');
      const currentProjectView = projectSelector?.value || 'portfolio';
      const projectNames = { 'mt-vernon': 'Mount Vernon', 'yonkers': 'Yonkers', 'new-rochelle': 'New Rochelle' };

      // Build full dataset to sort
      let dataToSort = [];
      if (currentProjectView === 'portfolio') {
        // Portfolio view - combine all projects
        Object.keys(allIncentives).forEach(pid => {
          allIncentives[pid].forEach(inc => {
            dataToSort.push({ ...inc, projectId: pid, projectName: projectNames[pid] });
          });
        });
      } else {
        // Single project view
        dataToSort = (allIncentives[currentProjectView] || []).map(inc => ({
          ...inc, projectId: currentProjectView, projectName: projectNames[currentProjectView]
        }));
      }

      // Sort the data array based on column
      dataToSort.sort((a, b) => {
        let aVal, bVal;
        switch(column) {
          case 'program':
            aVal = a.program.toLowerCase();
            bVal = b.program.toLowerCase();
            return direction * aVal.localeCompare(bVal);
          case 'project':
            aVal = (a.projectName || '').toLowerCase();
            bVal = (b.projectName || '').toLowerCase();
            return direction * aVal.localeCompare(bVal);
          case 'type':
            aVal = a.type || '';
            bVal = b.type || '';
            return direction * aVal.localeCompare(bVal);
          case 'amount':
            aVal = a.amount || 0;
            bVal = b.amount || 0;
            return direction * (aVal - bVal);
          case 'probability':
            aVal = a.prob || 0;
            bVal = b.prob || 0;
            return direction * (aVal - bVal);
          case 'deadline':
            // Parse deadline - handle "X days" format and "-" for no deadline
            aVal = a.deadline === '-' ? 9999 : parseInt(a.deadline) || 9999;
            bVal = b.deadline === '-' ? 9999 : parseInt(b.deadline) || 9999;
            return direction * (aVal - bVal);
          case 'status':
            // Order: at-risk, pending, captured
            const statusOrder = { 'at-risk': 0, 'pending': 1, 'captured': 2 };
            aVal = statusOrder[a.status] ?? 1;
            bVal = statusOrder[b.status] ?? 1;
            return direction * (aVal - bVal);
          default:
            return 0;
        }
      });

      // Re-render table with sorted data
      renderIncentivesTableSorted(dataToSort, currentProjectView);

      // Update sort header visual indicators
      document.querySelectorAll('.sort-header').forEach(th => {
        th.classList.remove('sort-asc', 'sort-desc');
      });
      const activeHeader = document.querySelector(`.sort-header[data-sort="${column}"]`);
      if (activeHeader) {
        activeHeader.classList.add(currentSort.direction === 'asc' ? 'sort-asc' : 'sort-desc');
      }

      // Re-apply scenario fading after sort
      if (currentScenario) {
        selectScenario(currentScenario);
      }
    }

    // V24: Render table from pre-sorted data
    function renderIncentivesTableSorted(sortedData, projectView) {
      const tbody = document.getElementById('incentives-tbody');
      if (!tbody) return;

      const visibleCount = showAllIncentives ? sortedData.length : Math.min(DEFAULT_VISIBLE, sortedData.length);
      const displayIncentives = sortedData.slice(0, visibleCount);

      const typeColors = { federal: 'blue', state: 'cyan', local: 'cyan', utility: 'blue' };
      const statusColors = { captured: 'blue', pending: 'slate', 'at-risk': 'blue' };
      const probColors = p => p >= 80 ? 'blue' : p >= 50 ? 'blue' : 'slate';

      // Store for modal access
      window.currentIncentives = displayIncentives;

      // V39: Add data-prob and data-amount attributes for reliable scenario filtering
      tbody.innerHTML = displayIncentives.map((inc, i) => `
        <tr class="incentive-row" data-project="${inc.projectId}" data-type="${inc.type}" data-status="${inc.status}" data-prob="${inc.prob}" data-amount="${inc.amount}">
          <td>
            <p class="font-medium text-slate-900 dark:text-white">${inc.program}</p>
            <p class="text-xs text-slate-500">${inc.desc}</p>
          </td>
          ${projectView === 'portfolio' ? `<td class="text-slate-600 dark:text-slate-300">${inc.projectName}</td>` : ''}
          <td><span class="text-xs font-medium text-${typeColors[inc.type]}-600 dark:text-${typeColors[inc.type]}-400">${inc.type.charAt(0).toUpperCase() + inc.type.slice(1)}</span></td>
          <td class="text-right font-mono font-medium text-slate-900 dark:text-white">$${inc.amount.toFixed(1)}M</td>
          <td class="text-right">
            <span class="font-mono text-sm font-medium text-${probColors(inc.prob)}-600 dark:text-${probColors(inc.prob)}-400">${inc.prob}%</span>
          </td>
          <td class="${inc.deadline === '-' ? 'text-slate-600 dark:text-slate-300' : inc.deadline.includes('days') && parseInt(inc.deadline) <= 30 ? 'text-red-600 dark:text-red-400 font-medium' : 'text-slate-600 dark:text-slate-300'}">${inc.deadline}</td>
          <td><span class="text-xs font-medium text-${statusColors[inc.status]}-600 dark:text-${statusColors[inc.status]}-400">${inc.status === 'at-risk' ? 'At Risk' : inc.status.charAt(0).toUpperCase() + inc.status.slice(1)}</span></td>
          <td class="text-center">
            <button onclick="openIncentiveDetail('${inc.id || inc.program.toLowerCase().replace(/[^a-z0-9]/g, '-')}', ${i})" class="text-xs px-3 py-1.5 bg-blue-900 hover:bg-blue-800 text-white rounded-md font-medium transition-colors shadow-sm">View</button>
          </td>
        </tr>
      `).join('');

      // Update footer
      const countEl = document.getElementById('incentives-count');
      const btnEl = document.getElementById('view-all-btn');
      if (countEl) {
        countEl.textContent = `Showing ${visibleCount} of ${sortedData.length} incentives`;
      }
      if (btnEl) {
        btnEl.textContent = showAllIncentives ? 'Show Less' : `View All ${sortedData.length} Incentives`;
      }
    }

    // Update Command Palette with new sections
    commands.push(
      { group: 'Navigation', title: 'Go to IRA Compliance', action: () => { switchSection('compliance'); closeCommandPalette(); } },
      { group: 'Navigation', title: 'Go to Doc Generator', action: () => { switchSection('documents'); closeCommandPalette(); } },
      { group: 'Actions', title: 'Show Keyboard Shortcuts', action: () => { closeCommandPalette(); openShortcutsModal(); } },
      { group: 'Actions', title: 'Show Deadline Alerts', action: () => { closeCommandPalette(); toggleDeadlinePanel(); } }
    );

    // ==========================================
    // V28: IMAGE IMPORT & LIGHTBOX SYSTEM
    // ==========================================
    let previousImageSrc = null;
    let currentImageSrc = null;

    function openImageLightbox() {
      const thumb = document.getElementById('project-thumb');
      const lightbox = document.getElementById('image-lightbox-overlay');
      const lightboxImg = document.getElementById('lightbox-image');

      // Use original source (not thumbnail) - check for high-res version
      const src = thumb.src.replace(/\?.*$/, ''); // Remove any query params
      lightboxImg.src = src;

      lightbox.classList.remove('hidden');
      lightbox.classList.add('flex');

      // Show/hide undo button based on history
      const undoBtn = document.getElementById('lightbox-undo-btn');
      undoBtn.classList.toggle('hidden', !previousImageSrc);
    }

    function closeImageLightbox() {
      const lightbox = document.getElementById('image-lightbox-overlay');
      lightbox.classList.add('hidden');
      lightbox.classList.remove('flex');
    }

    function triggerImageUpload() {
      document.getElementById('image-upload-input').click();
    }

    function handleImageUpload(event) {
      const file = event.target.files[0];
      if (file && file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = function(e) {
          updateProjectImage(e.target.result);
        };
        reader.readAsDataURL(file);
      }
      event.target.value = ''; // Reset input
    }

    function handleImageDragOver(event) {
      event.preventDefault();
      event.stopPropagation();
      document.getElementById('drag-overlay').classList.remove('hidden');
      document.getElementById('drag-overlay').classList.add('flex');
    }

    function handleImageDragLeave(event) {
      event.preventDefault();
      event.stopPropagation();
      document.getElementById('drag-overlay').classList.add('hidden');
      document.getElementById('drag-overlay').classList.remove('flex');
    }

    function handleImageDrop(event) {
      event.preventDefault();
      event.stopPropagation();
      document.getElementById('drag-overlay').classList.add('hidden');
      document.getElementById('drag-overlay').classList.remove('flex');

      const files = event.dataTransfer.files;
      if (files.length > 0 && files[0].type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = function(e) {
          updateProjectImage(e.target.result);
        };
        reader.readAsDataURL(files[0]);
      }
    }

    function updateProjectImage(newSrc) {
      const thumb = document.getElementById('project-thumb');
      previousImageSrc = thumb.src;
      currentImageSrc = newSrc;
      thumb.src = newSrc;

      // Show undo buttons
      document.getElementById('undo-image-btn').classList.remove('hidden');
      document.getElementById('lightbox-undo-btn')?.classList.remove('hidden');

      showToast('success', 'Image Updated', 'Project image has been changed');
    }

    function undoImageChange() {
      if (previousImageSrc) {
        const thumb = document.getElementById('project-thumb');
        thumb.src = previousImageSrc;
        previousImageSrc = null;

        // Hide undo buttons
        document.getElementById('undo-image-btn').classList.add('hidden');
        document.getElementById('lightbox-undo-btn')?.classList.add('hidden');

        showToast('info', 'Image Restored', 'Previous image has been restored');
      }
    }

    // ==========================================
    // V28: AUTOCOMPLETE / TYPEAHEAD SEARCH
    // ==========================================
    // V29: COMPREHENSIVE INCENTIVE DATABASE - Simulates 24,000+ incentives
    // This is a curated sample - real production connects to Supabase with full 24,000 records
    const searchableItems = [
      // ============================================================================
      // FEDERAL TAX CREDITS (IRA & Legacy Programs)
      // ============================================================================
      { type: 'incentive', name: 'Section 48 Investment Tax Credit (ITC) - Solar', category: 'Federal Tax Credit', value: '30%', state: 'Federal' },
      { type: 'incentive', name: 'Section 48 ITC - Battery Storage', category: 'Federal Tax Credit', value: '30%', state: 'Federal' },
      { type: 'incentive', name: 'Section 48 ITC - Geothermal', category: 'Federal Tax Credit', value: '30%', state: 'Federal' },
      { type: 'incentive', name: 'Section 48 ITC - Wind (Small)', category: 'Federal Tax Credit', value: '30%', state: 'Federal' },
      { type: 'incentive', name: 'Section 48 ITC - Fuel Cells', category: 'Federal Tax Credit', value: '30%', state: 'Federal' },
      { type: 'incentive', name: 'Section 45 Production Tax Credit (PTC)', category: 'Federal Tax Credit', value: '$0.028/kWh', state: 'Federal' },
      { type: 'incentive', name: 'Section 45L New Energy Efficient Home Credit', category: 'Federal Tax Credit', value: '$5,000/unit', state: 'Federal' },
      { type: 'incentive', name: 'Section 179D Commercial Building Deduction', category: 'Federal Deduction', value: '$5.00/sf', state: 'Federal' },
      { type: 'incentive', name: '4% LIHTC - Low-Income Housing Tax Credit', category: 'Federal Tax Credit', value: '~30% PV', state: 'Federal' },
      { type: 'incentive', name: '9% LIHTC - Competitive Housing Credit', category: 'Federal Tax Credit', value: '~70% PV', state: 'Federal' },
      { type: 'incentive', name: 'New Markets Tax Credit (NMTC)', category: 'Federal Tax Credit', value: '39%', state: 'Federal' },
      { type: 'incentive', name: 'Historic Rehabilitation Tax Credit (HTC)', category: 'Federal Tax Credit', value: '20%', state: 'Federal' },
      { type: 'incentive', name: 'Opportunity Zone Capital Gains Deferral', category: 'Federal Tax Benefit', value: 'Up to 100%', state: 'Federal' },
      { type: 'incentive', name: 'R&D Tax Credit - Section 41', category: 'Federal Tax Credit', value: '20%', state: 'Federal' },
      { type: 'incentive', name: 'Energy Community Bonus Credit', category: 'Federal Adder', value: '+10%', state: 'Federal' },
      { type: 'incentive', name: 'Domestic Content Bonus Credit', category: 'Federal Adder', value: '+10%', state: 'Federal' },
      { type: 'incentive', name: 'Low-Income Community Bonus (Residential)', category: 'Federal Adder', value: '+10%', state: 'Federal' },
      { type: 'incentive', name: 'Low-Income Community Bonus (Economic Benefit)', category: 'Federal Adder', value: '+20%', state: 'Federal' },
      { type: 'incentive', name: 'Section 48C Advanced Energy Project Credit', category: 'Federal Tax Credit', value: '30%', state: 'Federal' },
      { type: 'incentive', name: 'Clean Hydrogen Production Credit (45V)', category: 'Federal Tax Credit', value: '$3.00/kg', state: 'Federal' },
      { type: 'incentive', name: 'Carbon Capture Credit (45Q)', category: 'Federal Tax Credit', value: '$85/ton', state: 'Federal' },
      { type: 'incentive', name: 'Clean Vehicle Credit (30D)', category: 'Federal Tax Credit', value: '$7,500', state: 'Federal' },
      { type: 'incentive', name: 'Commercial Clean Vehicle Credit (45W)', category: 'Federal Tax Credit', value: '$40,000', state: 'Federal' },
      { type: 'incentive', name: 'Alternative Fuel Vehicle Refueling Credit (30C)', category: 'Federal Tax Credit', value: '$100,000', state: 'Federal' },
      { type: 'incentive', name: 'Clean Electricity Production Credit (45Y)', category: 'Federal Tax Credit', value: '$0.028/kWh', state: 'Federal' },
      { type: 'incentive', name: 'Clean Electricity Investment Credit (48E)', category: 'Federal Tax Credit', value: '30%', state: 'Federal' },
      // Federal Grants & Loans
      { type: 'incentive', name: 'EPA Greenhouse Gas Reduction Fund (GGRF)', category: 'Federal Grant', value: '$27B Total', state: 'Federal' },
      { type: 'incentive', name: 'DOE Loan Programs Office (LPO)', category: 'Federal Loan', value: 'Up to $400B', state: 'Federal' },
      { type: 'incentive', name: 'USDA Rural Energy for America (REAP)', category: 'Federal Grant', value: '50% Cost', state: 'Federal' },
      { type: 'incentive', name: 'HUD Community Development Block Grant (CDBG)', category: 'Federal Grant', value: 'Varies', state: 'Federal' },
      { type: 'incentive', name: 'EPA Clean School Bus Program', category: 'Federal Grant', value: '$5B Total', state: 'Federal' },
      { type: 'incentive', name: 'DOE Energy Efficiency Revolving Loan Fund', category: 'Federal Loan', value: 'State Allocation', state: 'Federal' },
      { type: 'incentive', name: 'FEMA Building Resilient Infrastructure (BRIC)', category: 'Federal Grant', value: 'Up to $50M', state: 'Federal' },

      // ============================================================================
      // NEW YORK STATE PROGRAMS
      // ============================================================================
      { type: 'incentive', name: 'NYSERDA Clean Energy Communities', category: 'NY State Grant', value: 'Up to $250K', state: 'NY' },
      { type: 'incentive', name: 'NYSERDA NY-Sun Commercial/Industrial', category: 'NY State Incentive', value: '$0.20/W', state: 'NY' },
      { type: 'incentive', name: 'NYSERDA Multifamily Performance Program', category: 'NY State Incentive', value: '$1,000/unit', state: 'NY' },
      { type: 'incentive', name: 'NYSERDA New Construction Program', category: 'NY State Incentive', value: 'Up to $2M', state: 'NY' },
      { type: 'incentive', name: 'NYSERDA Real Time Energy Management', category: 'NY State Incentive', value: '$50K/building', state: 'NY' },
      { type: 'incentive', name: 'NYSERDA FlexTech Program', category: 'NY State Incentive', value: '50% Cost', state: 'NY' },
      { type: 'incentive', name: 'NY Green Bank C-PACE Financing', category: 'NY State Financing', value: 'Low Interest', state: 'NY' },
      { type: 'incentive', name: 'NY Affordable Housing Tax Credit (SLIHC)', category: 'NY State Credit', value: '~20% PV', state: 'NY' },
      { type: 'incentive', name: 'NY Brownfield Cleanup Tax Credit', category: 'NY State Credit', value: 'Up to 24%', state: 'NY' },
      { type: 'incentive', name: 'NY Historic Preservation Tax Credit', category: 'NY State Credit', value: '20%', state: 'NY' },
      { type: 'incentive', name: 'NY Empire State Development Grant', category: 'NY State Grant', value: 'Up to $14M', state: 'NY' },
      { type: 'incentive', name: 'NY Excelsior Jobs Program', category: 'NY State Credit', value: 'Up to 10%', state: 'NY' },
      { type: 'incentive', name: 'NY START-UP Tax Exemption', category: 'NY State Exemption', value: '10-Year', state: 'NY' },
      { type: 'incentive', name: 'NY Investment Tax Credit', category: 'NY State Credit', value: '5-10%', state: 'NY' },
      { type: 'incentive', name: 'NY Industrial Development Agency (IDA) PILOT', category: 'NY Local Abatement', value: 'Up to 100%', state: 'NY' },
      { type: 'incentive', name: 'NY Sales Tax Exemption - Manufacturing', category: 'NY State Exemption', value: '100%', state: 'NY' },
      { type: 'incentive', name: 'NY Build Now-NY Program', category: 'NY State Incentive', value: 'Fast-Track', state: 'NY' },
      { type: 'incentive', name: 'Con Edison Demand Response', category: 'NY Utility Rebate', value: 'Up to $25/kW', state: 'NY' },
      { type: 'incentive', name: 'Con Edison Commercial & Industrial EE', category: 'NY Utility Rebate', value: 'Varies', state: 'NY' },
      { type: 'incentive', name: 'Con Edison Electric Vehicle Make-Ready', category: 'NY Utility Rebate', value: '100% Infra', state: 'NY' },
      { type: 'incentive', name: 'National Grid C&I Energy Efficiency', category: 'NY Utility Rebate', value: 'Custom', state: 'NY' },
      { type: 'incentive', name: 'PSEG Long Island Solar Rebate', category: 'NY Utility Rebate', value: '$0.20/W', state: 'NY' },

      // ============================================================================
      // CALIFORNIA PROGRAMS
      // ============================================================================
      { type: 'incentive', name: 'CA Self-Generation Incentive Program (SGIP)', category: 'CA State Incentive', value: '$1.00/Wh', state: 'CA' },
      { type: 'incentive', name: 'CA Solar on Multifamily Affordable Housing', category: 'CA State Incentive', value: '$3.00/W', state: 'CA' },
      { type: 'incentive', name: 'CA Low-Income Weatherization Program', category: 'CA State Grant', value: '100% Cost', state: 'CA' },
      { type: 'incentive', name: 'CA New Solar Homes Partnership', category: 'CA State Incentive', value: '$0.75/W', state: 'CA' },
      { type: 'incentive', name: 'CA Property Tax Exclusion - Active Solar', category: 'CA State Exemption', value: '100%', state: 'CA' },
      { type: 'incentive', name: 'CA CalHFA Accessory Dwelling Unit Grant', category: 'CA State Grant', value: '$40,000', state: 'CA' },
      { type: 'incentive', name: 'CA California Competes Tax Credit', category: 'CA State Credit', value: 'Negotiated', state: 'CA' },
      { type: 'incentive', name: 'CA Film & TV Tax Credit', category: 'CA State Credit', value: '20-25%', state: 'CA' },
      { type: 'incentive', name: 'CA Enterprise Zone Tax Credit', category: 'CA State Credit', value: 'Up to $37K', state: 'CA' },
      { type: 'incentive', name: 'CA Clean Vehicle Rebate Project', category: 'CA State Rebate', value: '$7,000', state: 'CA' },
      { type: 'incentive', name: 'CA TECH Clean California Program', category: 'CA State Incentive', value: 'Up to $4,000', state: 'CA' },
      { type: 'incentive', name: 'PG&E Business Energy Efficiency', category: 'CA Utility Rebate', value: 'Custom', state: 'CA' },
      { type: 'incentive', name: 'SCE Commercial Energy Efficiency', category: 'CA Utility Rebate', value: 'Custom', state: 'CA' },
      { type: 'incentive', name: 'SDG&E Energy Efficiency Rebates', category: 'CA Utility Rebate', value: 'Custom', state: 'CA' },
      { type: 'incentive', name: 'LADWP Commercial Lighting Efficiency', category: 'CA Utility Rebate', value: '$0.20/kWh', state: 'CA' },

      // ============================================================================
      // TEXAS PROGRAMS
      // ============================================================================
      { type: 'incentive', name: 'TX Property Tax Exemption - Renewable Energy', category: 'TX State Exemption', value: '100%', state: 'TX' },
      { type: 'incentive', name: 'TX Franchise Tax Exemption', category: 'TX State Exemption', value: '100%', state: 'TX' },
      { type: 'incentive', name: 'TX Solar & Wind Sales Tax Exemption', category: 'TX State Exemption', value: '100%', state: 'TX' },
      { type: 'incentive', name: 'TX Enterprise Zone Program', category: 'TX State Refund', value: 'Sales Tax', state: 'TX' },
      { type: 'incentive', name: 'TX Property Redevelopment Tax Abatement', category: 'TX Local Abatement', value: 'Up to 100%', state: 'TX' },
      { type: 'incentive', name: 'TX Texas Enterprise Fund', category: 'TX State Grant', value: 'Negotiated', state: 'TX' },
      { type: 'incentive', name: 'TX Skills Development Fund', category: 'TX State Grant', value: 'Training', state: 'TX' },
      { type: 'incentive', name: 'Austin Energy Solar Rebate', category: 'TX Utility Rebate', value: '$2,500', state: 'TX' },
      { type: 'incentive', name: 'CPS Energy Solar Rebate (San Antonio)', category: 'TX Utility Rebate', value: '$1,250', state: 'TX' },
      { type: 'incentive', name: 'Oncor Take A Load Off Texas', category: 'TX Utility Rebate', value: 'Varies', state: 'TX' },

      // ============================================================================
      // FLORIDA PROGRAMS
      // ============================================================================
      { type: 'incentive', name: 'FL Property Tax Exemption - Renewable Energy', category: 'FL State Exemption', value: '100%', state: 'FL' },
      { type: 'incentive', name: 'FL Sales Tax Exemption - Solar Equipment', category: 'FL State Exemption', value: '100%', state: 'FL' },
      { type: 'incentive', name: 'FL Qualified Target Industry Tax Refund', category: 'FL State Refund', value: '$3K-$6K/job', state: 'FL' },
      { type: 'incentive', name: 'FL High Impact Performance Incentive', category: 'FL State Grant', value: 'Negotiated', state: 'FL' },
      { type: 'incentive', name: 'FL Quick Action Closing Fund', category: 'FL State Grant', value: 'Negotiated', state: 'FL' },
      { type: 'incentive', name: 'FL Capital Investment Tax Credit', category: 'FL State Credit', value: '5%', state: 'FL' },
      { type: 'incentive', name: 'FL Rural Job Tax Credit', category: 'FL State Credit', value: '$1K-$2K/job', state: 'FL' },
      { type: 'incentive', name: 'FPL Business Energy Evaluation', category: 'FL Utility Rebate', value: 'Free Audit', state: 'FL' },
      { type: 'incentive', name: 'Duke Energy FL Business Rebates', category: 'FL Utility Rebate', value: 'Custom', state: 'FL' },
      { type: 'incentive', name: 'Tampa Electric Commercial Rebates', category: 'FL Utility Rebate', value: 'Custom', state: 'FL' },

      // ============================================================================
      // ILLINOIS PROGRAMS
      // ============================================================================
      { type: 'incentive', name: 'IL Adjustable Block Program Solar', category: 'IL State Incentive', value: 'REC Value', state: 'IL' },
      { type: 'incentive', name: 'IL Solar for All Program', category: 'IL State Incentive', value: 'Up to 100%', state: 'IL' },
      { type: 'incentive', name: 'IL Illinois Shines Incentive', category: 'IL State Incentive', value: 'Varies', state: 'IL' },
      { type: 'incentive', name: 'IL Property Tax Abatement - Solar', category: 'IL State Exemption', value: 'Up to 100%', state: 'IL' },
      { type: 'incentive', name: 'IL EDGE Tax Credit', category: 'IL State Credit', value: 'Up to 100%', state: 'IL' },
      { type: 'incentive', name: 'IL Enterprise Zone Investment Credit', category: 'IL State Credit', value: '0.5%', state: 'IL' },
      { type: 'incentive', name: 'IL High Impact Business Designation', category: 'IL State Exemption', value: 'Sales Tax', state: 'IL' },
      { type: 'incentive', name: 'ComEd Energy Efficiency Rebates', category: 'IL Utility Rebate', value: 'Custom', state: 'IL' },
      { type: 'incentive', name: 'Ameren Illinois Business EE', category: 'IL Utility Rebate', value: 'Custom', state: 'IL' },

      // ============================================================================
      // NEW JERSEY PROGRAMS
      // ============================================================================
      { type: 'incentive', name: 'NJ Successor Solar Incentive (SuSI)', category: 'NJ State Incentive', value: '$90/MWh', state: 'NJ' },
      { type: 'incentive', name: 'NJ Clean Energy Program Rebates', category: 'NJ State Rebate', value: 'Varies', state: 'NJ' },
      { type: 'incentive', name: 'NJ Economic Recovery Fund', category: 'NJ State Grant', value: 'Up to $10M', state: 'NJ' },
      { type: 'incentive', name: 'NJ Grow NJ Tax Credit', category: 'NJ State Credit', value: 'Per Job', state: 'NJ' },
      { type: 'incentive', name: 'NJ Sales Tax Exemption - Solar', category: 'NJ State Exemption', value: '100%', state: 'NJ' },
      { type: 'incentive', name: 'NJ Property Tax Exemption - Renewable', category: 'NJ State Exemption', value: '100%', state: 'NJ' },
      { type: 'incentive', name: 'NJ Historic Preservation Tax Credit', category: 'NJ State Credit', value: '25%', state: 'NJ' },
      { type: 'incentive', name: 'NJ Affordable Housing Trust Fund', category: 'NJ State Grant', value: 'Per Unit', state: 'NJ' },
      { type: 'incentive', name: 'PSEG Commercial Efficiency', category: 'NJ Utility Rebate', value: 'Custom', state: 'NJ' },
      { type: 'incentive', name: 'JCP&L Energy Efficiency', category: 'NJ Utility Rebate', value: 'Custom', state: 'NJ' },

      // ============================================================================
      // MASSACHUSETTS PROGRAMS
      // ============================================================================
      { type: 'incentive', name: 'MA SMART Solar Incentive', category: 'MA State Incentive', value: '$0.14/kWh', state: 'MA' },
      { type: 'incentive', name: 'MA Alternative Energy Portfolio Standard', category: 'MA State Incentive', value: 'AEC Value', state: 'MA' },
      { type: 'incentive', name: 'MA Clean Peak Energy Standard', category: 'MA State Incentive', value: 'CPEC Value', state: 'MA' },
      { type: 'incentive', name: 'MA Mass Save Commercial Rebates', category: 'MA Utility Rebate', value: 'Custom', state: 'MA' },
      { type: 'incentive', name: 'MA Historic Rehabilitation Tax Credit', category: 'MA State Credit', value: '20%', state: 'MA' },
      { type: 'incentive', name: 'MA Investment Tax Credit', category: 'MA State Credit', value: '3%', state: 'MA' },
      { type: 'incentive', name: 'MA LIHTC Program', category: 'MA State Credit', value: 'Per Unit', state: 'MA' },
      { type: 'incentive', name: 'MA Brownfields Tax Credit', category: 'MA State Credit', value: 'Up to 50%', state: 'MA' },
      { type: 'incentive', name: 'MassCEC Clean Heating & Cooling', category: 'MA State Rebate', value: '$10K-$100K', state: 'MA' },
      { type: 'incentive', name: 'National Grid MA Commercial EE', category: 'MA Utility Rebate', value: 'Custom', state: 'MA' },

      // ============================================================================
      // CONNECTICUT PROGRAMS
      // ============================================================================
      { type: 'incentive', name: 'CT Green Bank C-PACE Financing', category: 'CT State Financing', value: 'Low Rate', state: 'CT' },
      { type: 'incentive', name: 'CT Residential Solar Investment Program', category: 'CT State Incentive', value: '$0.46/W', state: 'CT' },
      { type: 'incentive', name: 'CT Zero Emission Renewable Energy Credit', category: 'CT State Incentive', value: 'ZREC Value', state: 'CT' },
      { type: 'incentive', name: 'CT Sales Tax Exemption - Solar', category: 'CT State Exemption', value: '100%', state: 'CT' },
      { type: 'incentive', name: 'CT Historic Preservation Tax Credit', category: 'CT State Credit', value: '25%', state: 'CT' },
      { type: 'incentive', name: 'CT Enterprise Zone Program', category: 'CT State Credit', value: '80% Abatement', state: 'CT' },
      { type: 'incentive', name: 'CT Urban & Industrial Site Reinvestment', category: 'CT State Credit', value: 'Up to 100%', state: 'CT' },
      { type: 'incentive', name: 'Eversource CT Business Solutions', category: 'CT Utility Rebate', value: 'Custom', state: 'CT' },
      { type: 'incentive', name: 'UI Energize CT Business Rebates', category: 'CT Utility Rebate', value: 'Custom', state: 'CT' },

      // ============================================================================
      // PENNSYLVANIA PROGRAMS
      // ============================================================================
      { type: 'incentive', name: 'PA Keystone Innovation Zone Tax Credit', category: 'PA State Credit', value: 'Up to $100K', state: 'PA' },
      { type: 'incentive', name: 'PA Historic Preservation Tax Credit', category: 'PA State Credit', value: '25%', state: 'PA' },
      { type: 'incentive', name: 'PA Resource Enhancement & Protection Credit', category: 'PA State Credit', value: '50-75%', state: 'PA' },
      { type: 'incentive', name: 'PA Alternative Energy Investment Act', category: 'PA State Grant', value: 'Varies', state: 'PA' },
      { type: 'incentive', name: 'PA Redevelopment Assistance Capital Program', category: 'PA State Grant', value: 'Up to $20M', state: 'PA' },
      { type: 'incentive', name: 'PA Solar Alternative Energy Credits', category: 'PA State Incentive', value: 'SAEC Value', state: 'PA' },
      { type: 'incentive', name: 'PECO Smart Ideas for Business', category: 'PA Utility Rebate', value: 'Custom', state: 'PA' },
      { type: 'incentive', name: 'PPL Business Energy Efficiency', category: 'PA Utility Rebate', value: 'Custom', state: 'PA' },

      // ============================================================================
      // COLORADO PROGRAMS
      // ============================================================================
      { type: 'incentive', name: 'CO Enterprise Zone Investment Tax Credit', category: 'CO State Credit', value: '3%', state: 'CO' },
      { type: 'incentive', name: 'CO Job Training Tax Credit', category: 'CO State Credit', value: '12%', state: 'CO' },
      { type: 'incentive', name: 'CO Commercial Property Tax Exemption', category: 'CO State Exemption', value: 'Renewable', state: 'CO' },
      { type: 'incentive', name: 'CO Sales Tax Exemption - Renewable', category: 'CO State Exemption', value: '100%', state: 'CO' },
      { type: 'incentive', name: 'CO Historic Preservation Tax Credit', category: 'CO State Credit', value: '25%', state: 'CO' },
      { type: 'incentive', name: 'CO Affordable Housing Tax Credit', category: 'CO State Credit', value: 'Per Unit', state: 'CO' },
      { type: 'incentive', name: 'Xcel Energy CO Business Rebates', category: 'CO Utility Rebate', value: 'Custom', state: 'CO' },
      { type: 'incentive', name: 'Black Hills Energy CO Rebates', category: 'CO Utility Rebate', value: 'Custom', state: 'CO' },

      // ============================================================================
      // ARIZONA PROGRAMS
      // ============================================================================
      { type: 'incentive', name: 'AZ Quality Jobs Tax Credit', category: 'AZ State Credit', value: '$9K/job', state: 'AZ' },
      { type: 'incentive', name: 'AZ Research & Development Tax Credit', category: 'AZ State Credit', value: '24%', state: 'AZ' },
      { type: 'incentive', name: 'AZ Property Tax Exemption - Renewable', category: 'AZ State Exemption', value: '100%', state: 'AZ' },
      { type: 'incentive', name: 'AZ Sales Tax Exemption - Solar', category: 'AZ State Exemption', value: '100%', state: 'AZ' },
      { type: 'incentive', name: 'AZ Historic Preservation Tax Credit', category: 'AZ State Credit', value: '25%', state: 'AZ' },
      { type: 'incentive', name: 'APS Commercial Energy Efficiency', category: 'AZ Utility Rebate', value: 'Custom', state: 'AZ' },
      { type: 'incentive', name: 'SRP Commercial Rebates', category: 'AZ Utility Rebate', value: 'Custom', state: 'AZ' },
      { type: 'incentive', name: 'TEP Business Energy Solutions', category: 'AZ Utility Rebate', value: 'Custom', state: 'AZ' },

      // ============================================================================
      // WASHINGTON STATE PROGRAMS
      // ============================================================================
      { type: 'incentive', name: 'WA Sales Tax Exemption - Solar', category: 'WA State Exemption', value: '100%', state: 'WA' },
      { type: 'incentive', name: 'WA High Technology B&O Tax Credit', category: 'WA State Credit', value: '1.5%', state: 'WA' },
      { type: 'incentive', name: 'WA Data Center Sales Tax Exemption', category: 'WA State Exemption', value: '100%', state: 'WA' },
      { type: 'incentive', name: 'WA Job Skills Program', category: 'WA State Grant', value: 'Training', state: 'WA' },
      { type: 'incentive', name: 'PSE Business Energy Management', category: 'WA Utility Rebate', value: 'Custom', state: 'WA' },
      { type: 'incentive', name: 'Seattle City Light Commercial EE', category: 'WA Utility Rebate', value: 'Custom', state: 'WA' },
      { type: 'incentive', name: 'Avista Commercial Rebates', category: 'WA Utility Rebate', value: 'Custom', state: 'WA' },

      // ============================================================================
      // GEORGIA PROGRAMS
      // ============================================================================
      { type: 'incentive', name: 'GA Job Tax Credit', category: 'GA State Credit', value: 'Up to $4K/job', state: 'GA' },
      { type: 'incentive', name: 'GA Investment Tax Credit', category: 'GA State Credit', value: '1-8%', state: 'GA' },
      { type: 'incentive', name: 'GA R&D Tax Credit', category: 'GA State Credit', value: '10%', state: 'GA' },
      { type: 'incentive', name: 'GA Quality Jobs Tax Credit', category: 'GA State Credit', value: '$5K/job', state: 'GA' },
      { type: 'incentive', name: 'GA Mega Project Tax Credit', category: 'GA State Credit', value: '5.25%', state: 'GA' },
      { type: 'incentive', name: 'GA Historic Preservation Tax Credit', category: 'GA State Credit', value: '25%', state: 'GA' },
      { type: 'incentive', name: 'Georgia Power Commercial EE', category: 'GA Utility Rebate', value: 'Custom', state: 'GA' },
      { type: 'incentive', name: 'GA Natural Gas Commercial Rebates', category: 'GA Utility Rebate', value: 'Custom', state: 'GA' },

      // ============================================================================
      // OHIO PROGRAMS
      // ============================================================================
      { type: 'incentive', name: 'OH Job Creation Tax Credit', category: 'OH State Credit', value: 'Up to 15%', state: 'OH' },
      { type: 'incentive', name: 'OH Historic Preservation Tax Credit', category: 'OH State Credit', value: '25%', state: 'OH' },
      { type: 'incentive', name: 'OH Opportunity Zone Tax Credit', category: 'OH State Credit', value: '10%', state: 'OH' },
      { type: 'incentive', name: 'OH Data Center Tax Exemption', category: 'OH State Exemption', value: '100%', state: 'OH' },
      { type: 'incentive', name: 'OH Community Reinvestment Area', category: 'OH Local Abatement', value: 'Up to 100%', state: 'OH' },
      { type: 'incentive', name: 'OH Enterprise Zone Program', category: 'OH Local Abatement', value: 'Up to 100%', state: 'OH' },
      { type: 'incentive', name: 'Duke Energy OH Business Rebates', category: 'OH Utility Rebate', value: 'Custom', state: 'OH' },
      { type: 'incentive', name: 'AEP Ohio Business Efficiency', category: 'OH Utility Rebate', value: 'Custom', state: 'OH' },

      // ============================================================================
      // MICHIGAN PROGRAMS
      // ============================================================================
      { type: 'incentive', name: 'MI Good Jobs for Michigan', category: 'MI State Credit', value: '100% Withholding', state: 'MI' },
      { type: 'incentive', name: 'MI Renaissance Zone', category: 'MI State Exemption', value: 'Up to 100%', state: 'MI' },
      { type: 'incentive', name: 'MI Historic Preservation Tax Credit', category: 'MI State Credit', value: '25%', state: 'MI' },
      { type: 'incentive', name: 'MI Strategic Site Readiness Program', category: 'MI State Grant', value: 'Varies', state: 'MI' },
      { type: 'incentive', name: 'MI Community Development Block Grant', category: 'MI State Grant', value: 'Varies', state: 'MI' },
      { type: 'incentive', name: 'DTE Energy Business Rebates', category: 'MI Utility Rebate', value: 'Custom', state: 'MI' },
      { type: 'incentive', name: 'Consumers Energy Business EE', category: 'MI Utility Rebate', value: 'Custom', state: 'MI' },

      // ============================================================================
      // NORTH CAROLINA PROGRAMS
      // ============================================================================
      { type: 'incentive', name: 'NC Job Development Investment Grant', category: 'NC State Grant', value: 'Up to 25%', state: 'NC' },
      { type: 'incentive', name: 'NC One NC Fund', category: 'NC State Grant', value: 'Varies', state: 'NC' },
      { type: 'incentive', name: 'NC Historic Preservation Tax Credit', category: 'NC State Credit', value: '15-25%', state: 'NC' },
      { type: 'incentive', name: 'NC Mill Rehabilitation Tax Credit', category: 'NC State Credit', value: '40%', state: 'NC' },
      { type: 'incentive', name: 'NC Renewable Energy Tax Credit', category: 'NC State Credit', value: '35%', state: 'NC' },
      { type: 'incentive', name: 'Duke Energy NC Business Rebates', category: 'NC Utility Rebate', value: 'Custom', state: 'NC' },
      { type: 'incentive', name: 'Dominion NC Commercial EE', category: 'NC Utility Rebate', value: 'Custom', state: 'NC' },

      // ============================================================================
      // VIRGINIA PROGRAMS
      // ============================================================================
      { type: 'incentive', name: 'VA Major Business Facility Job Tax Credit', category: 'VA State Credit', value: '$1K/job', state: 'VA' },
      { type: 'incentive', name: 'VA Data Center Sales Tax Exemption', category: 'VA State Exemption', value: '100%', state: 'VA' },
      { type: 'incentive', name: 'VA Historic Rehabilitation Tax Credit', category: 'VA State Credit', value: '25%', state: 'VA' },
      { type: 'incentive', name: 'VA Opportunity Fund', category: 'VA State Grant', value: 'Varies', state: 'VA' },
      { type: 'incentive', name: 'VA Clean Energy Manufacturing Incentive', category: 'VA State Grant', value: 'Per MW', state: 'VA' },
      { type: 'incentive', name: 'Dominion VA Business Rebates', category: 'VA Utility Rebate', value: 'Custom', state: 'VA' },
      { type: 'incentive', name: 'Appalachian Power VA Rebates', category: 'VA Utility Rebate', value: 'Custom', state: 'VA' },

      // ============================================================================
      // MARYLAND PROGRAMS
      // ============================================================================
      { type: 'incentive', name: 'MD Clean Energy Grant Program', category: 'MD State Grant', value: 'Up to $1M', state: 'MD' },
      { type: 'incentive', name: 'MD Job Creation Tax Credit', category: 'MD State Credit', value: '$1K-$5K/job', state: 'MD' },
      { type: 'incentive', name: 'MD Historic Preservation Tax Credit', category: 'MD State Credit', value: '20%', state: 'MD' },
      { type: 'incentive', name: 'MD Enterprise Zone Tax Credit', category: 'MD State Credit', value: 'Up to $3K/job', state: 'MD' },
      { type: 'incentive', name: 'MD More Jobs for Marylanders', category: 'MD State Credit', value: 'Up to 5.75%', state: 'MD' },
      { type: 'incentive', name: 'MD Commercial Clean Energy Rebate', category: 'MD State Rebate', value: '$1,000/kW', state: 'MD' },
      { type: 'incentive', name: 'BGE Smart Energy Savers Business', category: 'MD Utility Rebate', value: 'Custom', state: 'MD' },
      { type: 'incentive', name: 'Pepco MD Commercial Rebates', category: 'MD Utility Rebate', value: 'Custom', state: 'MD' },

      // ============================================================================
      // MINNESOTA PROGRAMS
      // ============================================================================
      { type: 'incentive', name: 'MN Job Creation Fund', category: 'MN State Grant', value: 'Up to $2M', state: 'MN' },
      { type: 'incentive', name: 'MN Greater MN Job Expansion Program', category: 'MN State Credit', value: 'Varies', state: 'MN' },
      { type: 'incentive', name: 'MN Historic Structure Rehabilitation Credit', category: 'MN State Credit', value: '20%', state: 'MN' },
      { type: 'incentive', name: 'MN Solar Energy Production Incentive', category: 'MN State Incentive', value: '$0.08/kWh', state: 'MN' },
      { type: 'incentive', name: 'MN Made in Minnesota Solar Incentive', category: 'MN State Incentive', value: 'Bonus', state: 'MN' },
      { type: 'incentive', name: 'Xcel Energy MN Commercial Rebates', category: 'MN Utility Rebate', value: 'Custom', state: 'MN' },
      { type: 'incentive', name: 'MN Power Commercial EE', category: 'MN Utility Rebate', value: 'Custom', state: 'MN' },

      // ============================================================================
      // OREGON PROGRAMS
      // ============================================================================
      { type: 'incentive', name: 'OR Business Energy Tax Credit', category: 'OR State Credit', value: '35-50%', state: 'OR' },
      { type: 'incentive', name: 'OR Solar + Storage Rebate Program', category: 'OR State Rebate', value: '$5,000', state: 'OR' },
      { type: 'incentive', name: 'OR Strategic Investment Program', category: 'OR State Exemption', value: 'Partial', state: 'OR' },
      { type: 'incentive', name: 'OR Enterprise Zone Exemption', category: 'OR Local Abatement', value: '3-5 Years', state: 'OR' },
      { type: 'incentive', name: 'OR Historic Preservation Tax Credit', category: 'OR State Credit', value: '25%', state: 'OR' },
      { type: 'incentive', name: 'PGE Commercial Energy Efficiency', category: 'OR Utility Rebate', value: 'Custom', state: 'OR' },
      { type: 'incentive', name: 'Pacific Power OR Business Rebates', category: 'OR Utility Rebate', value: 'Custom', state: 'OR' },

      // ============================================================================
      // NEVADA PROGRAMS
      // ============================================================================
      { type: 'incentive', name: 'NV Sales Tax Abatement', category: 'NV State Exemption', value: 'Up to 50%', state: 'NV' },
      { type: 'incentive', name: 'NV Property Tax Abatement', category: 'NV State Exemption', value: 'Up to 50%', state: 'NV' },
      { type: 'incentive', name: 'NV Renewable Energy Tax Abatement', category: 'NV State Exemption', value: '75%', state: 'NV' },
      { type: 'incentive', name: 'NV Data Center Tax Abatement', category: 'NV State Exemption', value: '75%', state: 'NV' },
      { type: 'incentive', name: 'NV Film Tax Credit', category: 'NV State Credit', value: '25%', state: 'NV' },
      { type: 'incentive', name: 'NV Energy PowerShift', category: 'NV Utility Rebate', value: 'Custom', state: 'NV' },
      { type: 'incentive', name: 'NV Energy Commercial Solar', category: 'NV Utility Rebate', value: '$0.15/W', state: 'NV' },

      // ============================================================================
      // PROJECTS (User's Portfolio)
      // ============================================================================
      { type: 'project', name: 'Mount Vernon Mixed-Use Development', category: 'Westchester County', value: '747 units', state: 'NY' },
      { type: 'project', name: 'Yonkers Affordable Housing', category: 'Westchester County', value: '425 units', state: 'NY' },
      { type: 'project', name: 'New Rochelle Transit-Oriented Hub', category: 'Westchester County', value: '312 units', state: 'NY' },
      { type: 'project', name: 'White Plains Office Conversion', category: 'Westchester County', value: '186 units', state: 'NY' },
      { type: 'project', name: 'Bronx Logistics Center', category: 'New York City', value: '450K SF', state: 'NY' },
      { type: 'project', name: 'Brooklyn Navy Yard Expansion', category: 'New York City', value: '750K SF', state: 'NY' },
      { type: 'project', name: 'Jersey City Waterfront', category: 'Hudson County', value: '520 units', state: 'NJ' },
      { type: 'project', name: 'Newark Opportunity Zone', category: 'Essex County', value: '380 units', state: 'NJ' },

      // ============================================================================
      // LOCATIONS (Searchable Zones)
      // ============================================================================
      { type: 'location', name: 'Mount Vernon, NY', category: 'Opportunity Zone', value: 'Census Tract 36119000800', state: 'NY' },
      { type: 'location', name: 'Yonkers, NY', category: 'Energy Community', value: 'Former Industrial Site', state: 'NY' },
      { type: 'location', name: 'New Rochelle, NY', category: 'Transit-Oriented', value: 'TOD District', state: 'NY' },
      { type: 'location', name: 'White Plains, NY', category: 'Central Business District', value: 'Urban Renewal', state: 'NY' },
      { type: 'location', name: 'Newark, NJ', category: 'Opportunity Zone', value: 'Multiple Tracts', state: 'NJ' },
      { type: 'location', name: 'Jersey City, NJ', category: 'Waterfront Development', value: 'PILOT Zone', state: 'NJ' },
    ];

    // V29: Total incentives counter (simulates full database)
    const totalIncentivesInDatabase = 24127;

    let autocompleteTimeout = null;

    function initAutocomplete() {
      const searchInput = document.getElementById('incentive-search');
      if (!searchInput) return;

      // Create autocomplete dropdown
      const wrapper = searchInput.parentElement;
      wrapper.style.position = 'relative';

      const dropdown = document.createElement('div');
      dropdown.id = 'autocomplete-dropdown';
      dropdown.className = 'absolute top-full left-0 right-0 mt-1 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg shadow-lg z-50 hidden max-h-80 overflow-y-auto';
      wrapper.appendChild(dropdown);

      searchInput.addEventListener('input', function() {
        clearTimeout(autocompleteTimeout);
        autocompleteTimeout = setTimeout(() => {
          performAutocomplete(this.value);
        }, 150);
      });

      searchInput.addEventListener('focus', function() {
        if (this.value.length >= 1) {
          performAutocomplete(this.value);
        }
      });

      searchInput.addEventListener('blur', function() {
        setTimeout(() => {
          dropdown.classList.add('hidden');
        }, 200);
      });

      searchInput.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          dropdown.classList.add('hidden');
        }
      });
    }

    function performAutocomplete(query) {
      const dropdown = document.getElementById('autocomplete-dropdown');
      if (!dropdown) return;

      if (query.length < 1) {
        dropdown.classList.add('hidden');
        return;
      }

      // V29: Enhanced search - also searches by state
      const matches = searchableItems.filter(item =>
        item.name.toLowerCase().includes(query.toLowerCase()) ||
        item.category.toLowerCase().includes(query.toLowerCase()) ||
        (item.state && item.state.toLowerCase().includes(query.toLowerCase()))
      ).slice(0, 10);

      if (matches.length === 0) {
        dropdown.innerHTML = `
          <div class="px-4 py-3 text-center text-slate-500 dark:text-slate-400">
            <p class="text-sm">No matches found for "${query}"</p>
            <p class="text-xs mt-1">Searching ${totalIncentivesInDatabase.toLocaleString()} incentives...</p>
          </div>
        `;
        dropdown.classList.remove('hidden');
        return;
      }

      // V29: Enhanced display with state badges
      dropdown.innerHTML = matches.map(item => `
        <div class="px-4 py-3 hover:bg-slate-50 dark:hover:bg-slate-700/50 cursor-pointer border-b border-slate-100 dark:border-slate-700/50 last:border-0" onclick="selectAutocompleteItem('${item.name.replace(/'/g, "\\'")}')">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <span class="w-6 h-6 rounded flex items-center justify-center text-xs font-bold ${
                item.type === 'incentive' ? 'bg-blue-100 dark:bg-blue-900/30 text-blue-600' :
                item.type === 'project' ? 'bg-cyan-100 dark:bg-cyan-900/30 text-cyan-600' :
                'bg-slate-100 dark:bg-slate-700 text-slate-600'
              }">${item.type === 'incentive' ? '$' : item.type === 'project' ? 'P' : 'L'}</span>
              <div>
                <p class="font-medium text-slate-900 dark:text-white text-sm">${highlightMatch(item.name, query)}</p>
                <p class="text-xs text-slate-500 dark:text-slate-400">${item.category}${item.state ? ' • <span class="text-blue-500 dark:text-blue-400">' + item.state + '</span>' : ''}</p>
              </div>
            </div>
            <span class="text-xs font-mono text-slate-600 dark:text-slate-300">${item.value}</span>
          </div>
        </div>
      `).join('') + `
        <div class="px-4 py-2 bg-slate-50 dark:bg-slate-900/50 border-t border-slate-200 dark:border-slate-700">
          <p class="text-xs text-slate-500 dark:text-slate-400 text-center">
            Showing ${matches.length} of <span class="font-mono text-blue-600 dark:text-blue-400">${totalIncentivesInDatabase.toLocaleString()}</span> incentives in database
          </p>
        </div>
      `;

      dropdown.classList.remove('hidden');
    }

    function highlightMatch(text, query) {
      const regex = new RegExp(`(${query})`, 'gi');
      return text.replace(regex, '<mark class="bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300 rounded px-0.5">$1</mark>');
    }

    function selectAutocompleteItem(name) {
      const searchInput = document.getElementById('incentive-search');
      searchInput.value = name;
      document.getElementById('autocomplete-dropdown').classList.add('hidden');
      searchIncentives();
    }

    // ==========================================
    // V28: DOWNLOAD SYSTEM WITH FILE PICKER
    // ==========================================
    let currentDownloadType = 'portfolio';
    let currentDownloadFormat = 'pdf';

    // Synthetic data for reports
    const syntheticReportData = {
      portfolio: {
        title: 'Portfolio Analysis Report',
        filename: 'IncentEdge_Portfolio_Analysis',
        data: {
          totalValue: '$88,500,000',
          projects: 3,
          incentives: 47,
          captured: '$42,800,000',
          pending: '$32,200,000',
          atRisk: '$13,500,000'
        }
      },
      incentive: {
        title: 'Incentive Summary Report',
        filename: 'IncentEdge_Incentive_Summary',
        data: {
          programs: 47,
          federal: 15,
          state: 18,
          local: 8,
          utility: 6,
          totalValue: '$252,200,000'
        }
      },
      compliance: {
        title: 'IRA Compliance Report',
        filename: 'IncentEdge_IRA_Compliance',
        data: {
          prevailingWage: 'Compliant',
          apprenticeship: '13.8%',
          domesticContent: '42%',
          energyCommunity: 'Yes',
          creditTier: 'Maximum'
        }
      }
    };

    function openDownloadModal(type, defaultFilename) {
      currentDownloadType = type || 'portfolio';
      const reportData = syntheticReportData[currentDownloadType] || syntheticReportData.portfolio;

      document.getElementById('download-modal-subtitle').textContent = reportData.title;
      document.getElementById('download-filename').value = defaultFilename || reportData.filename;

      updateDownloadPreview();

      document.getElementById('download-modal-overlay').classList.add('open');
      document.getElementById('download-modal').classList.add('open');
    }

    function closeDownloadModal() {
      document.getElementById('download-modal-overlay').classList.remove('open');
      document.getElementById('download-modal').classList.remove('open');
    }

    function selectDownloadFormat(format) {
      currentDownloadFormat = format;

      // Update button states
      document.querySelectorAll('.download-format-btn').forEach(btn => {
        btn.classList.remove('active', 'border-blue-500', 'bg-blue-50', 'dark:bg-blue-900/20');
        btn.classList.add('border-slate-200', 'dark:border-slate-700');
      });

      const activeBtn = document.getElementById('format-' + format);
      activeBtn.classList.add('active', 'border-blue-500', 'bg-blue-50', 'dark:bg-blue-900/20');
      activeBtn.classList.remove('border-slate-200', 'dark:border-slate-700');

      updateDownloadPreview();
    }

    function updateDownloadPreview() {
      const filename = document.getElementById('download-filename').value;
      const ext = currentDownloadFormat === 'xlsx' ? 'xlsx' : currentDownloadFormat;

      document.getElementById('download-preview-name').textContent = `${filename}.${ext}`;

      // Update icon color based on format
      const iconContainer = document.getElementById('download-preview-icon');
      const sizes = { pdf: '~245 KB', xlsx: '~128 KB', csv: '~42 KB' };
      document.getElementById('download-preview-size').textContent = sizes[currentDownloadFormat];

      iconContainer.className = `w-12 h-12 rounded-lg flex items-center justify-center ${
        currentDownloadFormat === 'pdf' ? 'bg-red-100 dark:bg-red-900/30' :
        currentDownloadFormat === 'xlsx' ? 'bg-green-100 dark:bg-green-900/30' :
        'bg-blue-100 dark:bg-blue-900/30'
      }`;
    }

    function executeDownload() {
      const filename = document.getElementById('download-filename').value;
      const ext = currentDownloadFormat === 'xlsx' ? 'xlsx' : currentDownloadFormat;
      const fullFilename = `${filename}.${ext}`;

      showToast('info', 'Generating File', `Creating ${fullFilename}...`);

      setTimeout(() => {
        // Generate synthetic file based on format
        let content, mimeType;

        if (currentDownloadFormat === 'csv') {
          content = generateCSVContent();
          mimeType = 'text/csv';
        } else if (currentDownloadFormat === 'xlsx') {
          content = generateExcelContent();
          mimeType = 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet';
        } else {
          content = generatePDFContent();
          mimeType = 'application/pdf';
        }

        // Create and trigger download
        const blob = new Blob([content], { type: mimeType });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = fullFilename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        closeDownloadModal();
        showToast('success', 'Download Complete', `${fullFilename} has been downloaded`);
      }, 1000);
    }

    function generateCSVContent() {
      const reportData = syntheticReportData[currentDownloadType];
      let csv = 'IncentEdge Report\n';
      csv += `Generated: ${new Date().toISOString()}\n\n`;
      csv += 'Program,Type,Value,Probability,Status,Deadline\n';

      // Add incentive data
      const incentives = allIncentives['mt-vernon'] || [];
      incentives.forEach(inc => {
        csv += `"${inc.program}","${inc.type}","$${inc.amount}M","${inc.prob}%","${inc.status}","${inc.deadline}"\n`;
      });

      return csv;
    }

    function generateExcelContent() {
      // Generate XML-based Excel format
      let xml = '<?xml version="1.0"?>\n';
      xml += '<Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet">\n';
      xml += '<Worksheet ss:Name="Incentives">\n<Table>\n';
      xml += '<Row><Cell><Data ss:Type="String">Program</Data></Cell><Cell><Data ss:Type="String">Type</Data></Cell><Cell><Data ss:Type="String">Value</Data></Cell><Cell><Data ss:Type="String">Probability</Data></Cell><Cell><Data ss:Type="String">Status</Data></Cell></Row>\n';

      const incentives = allIncentives['mt-vernon'] || [];
      incentives.forEach(inc => {
        xml += `<Row><Cell><Data ss:Type="String">${inc.program}</Data></Cell><Cell><Data ss:Type="String">${inc.type}</Data></Cell><Cell><Data ss:Type="Number">${inc.amount}</Data></Cell><Cell><Data ss:Type="Number">${inc.prob}</Data></Cell><Cell><Data ss:Type="String">${inc.status}</Data></Cell></Row>\n`;
      });

      xml += '</Table>\n</Worksheet>\n</Workbook>';
      return xml;
    }

    function generatePDFContent() {
      // Generate text-based PDF placeholder
      let text = 'IncentEdge Portfolio Analysis Report\n';
      text += '=====================================\n\n';
      text += `Generated: ${new Date().toLocaleString()}\n`;
      text += `Project: Mount Vernon Mixed-Use Development\n`;
      text += `Address: 225 South 4th Ave, Mount Vernon, NY\n\n`;
      text += 'EXECUTIVE SUMMARY\n';
      text += '-----------------\n';
      text += 'Total Incentive Value: $252.2M (Best Case)\n';
      text += 'Realistic Scenario: $156.1M\n';
      text += 'Programs Identified: 47\n\n';
      text += 'INCENTIVE BREAKDOWN\n';
      text += '-------------------\n';

      const incentives = allIncentives['mt-vernon'] || [];
      incentives.slice(0, 10).forEach(inc => {
        text += `• ${inc.program}: $${inc.amount}M (${inc.prob}% probability)\n`;
      });

      return text;
    }

    // Override export functions to use new modal
    function exportData(format) {
      openDownloadModal('portfolio', 'IncentEdge_Portfolio_Export');
      selectDownloadFormat(format);
    }

    function generateReport(type) {
      const filenames = {
        portfolio: 'IncentEdge_Portfolio_Report',
        incentive: 'IncentEdge_Incentive_Analysis',
        compliance: 'IncentEdge_Compliance_Report'
      };
      openDownloadModal(type, filenames[type] || 'IncentEdge_Report');
    }

    function exportCapitalStack() {
      openDownloadModal('portfolio', 'IncentEdge_CapitalStack_Analysis');
    }

    function exportSustainabilityReport() {
      openDownloadModal('compliance', 'IncentEdge_Sustainability_Report');
    }

    function exportComplianceReport() {
      openDownloadModal('compliance', 'IncentEdge_IRA_Compliance_Report');
    }

    // ==========================================
    // V28: DOCUMENT DOWNLOADS
    // ==========================================
    function downloadDocument(docName, docType) {
      const filename = docName.replace(/\s+/g, '_');
      openDownloadModal('portfolio', filename);
    }

    // ==========================================
    // V28: PROJECT FILE IMPORT
    // ==========================================
    function handleProjectDragOver(event) {
      event.preventDefault();
      event.stopPropagation();
      const dropzone = document.getElementById('project-import-dropzone');
      dropzone.classList.add('border-blue-500', 'bg-blue-50', 'dark:bg-blue-900/20');
    }

    function handleProjectDragLeave(event) {
      event.preventDefault();
      event.stopPropagation();
      const dropzone = document.getElementById('project-import-dropzone');
      dropzone.classList.remove('border-blue-500', 'bg-blue-50', 'dark:bg-blue-900/20');
    }

    function handleProjectDrop(event) {
      event.preventDefault();
      event.stopPropagation();
      const dropzone = document.getElementById('project-import-dropzone');
      dropzone.classList.remove('border-blue-500', 'bg-blue-50', 'dark:bg-blue-900/20');

      const files = event.dataTransfer.files;
      if (files.length > 0) {
        processProjectFile(files[0]);
      }
    }

    function handleProjectFileUpload(event) {
      const file = event.target.files[0];
      if (file) {
        processProjectFile(file);
      }
      event.target.value = ''; // Reset input
    }

    function processProjectFile(file) {
      const validTypes = ['.xlsx', '.xls', '.csv', '.pdf'];
      const ext = '.' + file.name.split('.').pop().toLowerCase();

      if (!validTypes.includes(ext)) {
        showToast('error', 'Invalid File', 'Please upload Excel, CSV, or PDF files');
        return;
      }

      // Show progress
      const progress = document.getElementById('import-progress');
      const bar = document.getElementById('import-bar');
      const filename = document.getElementById('import-filename');
      const status = document.getElementById('import-status');

      progress.classList.remove('hidden');
      filename.textContent = file.name;
      status.textContent = 'Processing...';
      bar.style.width = '0%';

      // Simulate processing with progress
      let percent = 0;
      const interval = setInterval(() => {
        percent += Math.random() * 20;
        if (percent >= 100) {
          percent = 100;
          clearInterval(interval);
          status.textContent = 'Complete!';
          status.classList.remove('text-blue-600');
          status.classList.add('text-green-600');

          setTimeout(() => {
            progress.classList.add('hidden');
            status.classList.remove('text-green-600');
            status.classList.add('text-blue-600');
            addImportedFile(file.name);
            showToast('success', 'Import Complete', `${file.name} has been processed. 47 incentives identified.`);
          }, 1000);
        }
        bar.style.width = percent + '%';
      }, 200);
    }

    function addImportedFile(filename) {
      const container = document.getElementById('recent-imports');
      const existingFiles = container.querySelectorAll('.flex.items-center.gap-3.p-2');

      // Add new file to top
      const newFile = document.createElement('div');
      newFile.className = 'flex items-center gap-3 p-2 bg-slate-50 dark:bg-slate-800/50 rounded-lg';
      newFile.innerHTML = `
        <svg class="w-5 h-5 text-green-500 flex-shrink-0" fill="currentColor" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6z"/></svg>
        <div class="flex-1 min-w-0">
          <p class="text-sm font-medium text-slate-700 dark:text-slate-300 truncate">${filename}</p>
          <p class="text-xs text-slate-500">Imported just now</p>
        </div>
        <span class="px-2 py-0.5 bg-green-100 text-green-700 text-xs rounded">Processed</span>
      `;

      // Insert after the header
      const header = container.querySelector('p.text-xs');
      if (header.nextSibling) {
        header.parentNode.insertBefore(newFile, header.nextSibling);
      } else {
        container.appendChild(newFile);
      }

      // Limit to 3 recent files
      const allFiles = container.querySelectorAll('.flex.items-center.gap-3.p-2');
      if (allFiles.length > 3) {
        allFiles[allFiles.length - 1].remove();
      }
    }

    // V30: INSTITUTIONAL LOGO ANIMATION
    // 3-second refined fade-in with subtle shimmer completion effect
    // Logo link to homepage is preserved - no click override

    // ==========================================
    // V31: GUIDED ONBOARDING FLOW
    // ==========================================
    let onboardingStep = 1;
    const onboardingData = {
      role: null,
      projectType: [],
      region: [],
      goals: []
    };

    function showOnboarding() {
      document.getElementById('onboarding-overlay').classList.add('active');
    }

    function hideOnboarding() {
      document.getElementById('onboarding-overlay').classList.remove('active');
      localStorage.setItem('incentedge-onboarding-complete', 'true');
    }

    function skipOnboarding() {
      hideOnboarding();
      showToast('info', 'Onboarding Skipped', 'You can restart onboarding from Settings anytime');
    }

    function selectOnboardingOption(el, field, value) {
      // Single select - deselect others first
      el.parentElement.querySelectorAll('.onboarding-option').forEach(opt => {
        opt.classList.remove('selected');
      });
      el.classList.add('selected');
      onboardingData[field] = value;
      updateOnboardingButtons();
    }

    function toggleOnboardingMulti(el, field, value) {
      // Multi select - toggle this option
      el.classList.toggle('selected');

      if (el.classList.contains('selected')) {
        if (!onboardingData[field].includes(value)) {
          onboardingData[field].push(value);
        }
      } else {
        onboardingData[field] = onboardingData[field].filter(v => v !== value);
      }
      updateOnboardingButtons();
    }

    function updateOnboardingButtons() {
      const nextBtn = document.getElementById('onboarding-next');
      const backBtn = document.getElementById('onboarding-back');

      // Show/hide back button
      if (onboardingStep > 1) {
        backBtn.classList.remove('hidden');
      } else {
        backBtn.classList.add('hidden');
      }

      // Enable/disable next button based on current step selection
      let isValid = false;
      switch(onboardingStep) {
        case 1:
          isValid = onboardingData.role !== null;
          break;
        case 2:
          isValid = onboardingData.projectType.length > 0;
          break;
        case 3:
          isValid = onboardingData.region.length > 0;
          break;
        case 4:
          isValid = onboardingData.goals.length > 0;
          nextBtn.textContent = 'Get Started';
          break;
      }

      nextBtn.disabled = !isValid;
    }

    function updateOnboardingProgress() {
      document.querySelectorAll('.onboarding-progress-step').forEach((step, index) => {
        const stepNum = index + 1;
        step.classList.remove('active', 'completed');
        if (stepNum < onboardingStep) {
          step.classList.add('completed');
        } else if (stepNum === onboardingStep) {
          step.classList.add('active');
        }
      });
    }

    function showOnboardingStep(step) {
      document.querySelectorAll('.onboarding-step').forEach(s => {
        s.classList.remove('active');
      });
      document.querySelector(`.onboarding-step[data-step="${step}"]`).classList.add('active');
      updateOnboardingProgress();
      updateOnboardingButtons();
    }

    function onboardingNext() {
      if (onboardingStep < 4) {
        onboardingStep++;
        showOnboardingStep(onboardingStep);
      } else {
        // Complete onboarding
        completeOnboarding();
      }
    }

    function onboardingBack() {
      if (onboardingStep > 1) {
        onboardingStep--;
        showOnboardingStep(onboardingStep);
        document.getElementById('onboarding-next').textContent = 'Continue';
      }
    }

    function completeOnboarding() {
      hideOnboarding();

      // Store preferences
      localStorage.setItem('incentedge-user-preferences', JSON.stringify(onboardingData));

      // Show personalized welcome
      const roleNames = {
        developer: 'Real Estate Developer',
        investor: 'Institutional Investor',
        consultant: 'Tax/Energy Consultant',
        government: 'Government/EDA'
      };

      showToast('success', 'Welcome to IncentEdge!',
        `Your dashboard is now personalized for ${roleNames[onboardingData.role] || 'your role'}`);

      // Highlight relevant section based on role
      setTimeout(() => {
        if (onboardingData.role === 'developer') {
          highlightFeature('portfolio');
        } else if (onboardingData.role === 'investor') {
          highlightFeature('analysis');
        } else if (onboardingData.role === 'consultant') {
          highlightFeature('discover');
        }
      }, 1500);
    }

    function highlightFeature(section) {
      // Brief pulse on the nav item
      const navItem = document.querySelector(`[data-section="${section}"]`);
      if (navItem) {
        navItem.style.animation = 'pulse 0.5s ease 3';
        setTimeout(() => {
          navItem.style.animation = '';
        }, 1500);
      }
    }

    function restartOnboarding() {
      onboardingStep = 1;
      onboardingData.role = null;
      onboardingData.projectType = [];
      onboardingData.region = [];
      onboardingData.goals = [];

      // Reset UI state
      document.querySelectorAll('.onboarding-option').forEach(opt => {
        opt.classList.remove('selected');
      });
      document.getElementById('onboarding-next').textContent = 'Continue';

      showOnboardingStep(1);
      showOnboarding();
    }

    // ==========================================
    // V31: SKELETON LOADING UTILITIES
    // ==========================================
    function showSkeleton(containerId) {
      const container = document.getElementById(containerId);
      if (container) {
        container.classList.add('loading');
      }
    }

    function hideSkeleton(containerId) {
      const container = document.getElementById(containerId);
      if (container) {
        container.classList.remove('loading');
      }
    }

    function simulateLoading(containerId, duration = 1500) {
      showSkeleton(containerId);
      setTimeout(() => {
        hideSkeleton(containerId);
        // Trigger transition animation
        const content = document.querySelector(`#${containerId} .content-container`);
        if (content) {
          content.classList.add('section-transition');
          setTimeout(() => content.classList.add('visible'), 50);
        }
      }, duration);
    }

    // ==========================================
    // V31: EMPTY & ERROR STATE UTILITIES
    // ==========================================
    function showEmptyState(sectionId) {
      const emptyState = document.getElementById(sectionId + '-empty-state');
      const table = document.querySelector(`#${sectionId} .data-table`);
      if (emptyState) {
        emptyState.classList.remove('hidden');
        if (table) table.parentElement.classList.add('hidden');
      }
    }

    function hideEmptyState(sectionId) {
      const emptyState = document.getElementById(sectionId + '-empty-state');
      const table = document.querySelector(`#${sectionId} .data-table`);
      if (emptyState) {
        emptyState.classList.add('hidden');
        if (table) table.parentElement.classList.remove('hidden');
      }
    }

    function showErrorState(sectionId) {
      const errorState = document.getElementById(sectionId + '-error-state');
      const table = document.querySelector(`#${sectionId} .data-table`);
      if (errorState) {
        errorState.classList.remove('hidden');
        if (table) table.parentElement.classList.add('hidden');
      }
    }

    function hideErrorState(sectionId) {
      const errorState = document.getElementById(sectionId + '-error-state');
      const table = document.querySelector(`#${sectionId} .data-table`);
      if (errorState) {
        errorState.classList.add('hidden');
        if (table) table.parentElement.classList.remove('hidden');
      }
    }

    function clearIncentiveSearch() {
      document.getElementById('incentive-search').value = '';
      document.getElementById('filter-level').value = '';
      document.getElementById('filter-type').value = '';
      hideEmptyState('discover');
      hideErrorState('discover');
    }

    function retryIncentiveLoad() {
      hideErrorState('discover');
      document.getElementById('discover-skeleton').classList.remove('hidden');
      setTimeout(() => {
        document.getElementById('discover-skeleton').classList.add('hidden');
        // Success - show table
        const table = document.querySelector('#section-discover .data-table');
        if (table) table.parentElement.classList.remove('hidden');
        showToast('success', 'Connection Restored', 'Incentive data loaded successfully');
      }, 1500);
    }

    // ==========================================
    // V31: ADDRESS AUTOCOMPLETE (Google Places style)
    // ==========================================
    const sampleAddresses = [
      { street: '225 South 4th Avenue', city: 'Mount Vernon', state: 'NY', zip: '10550', type: 'Commercial', verified: true },
      { street: '100 Main Street', city: 'Yonkers', state: 'NY', zip: '10701', type: 'Mixed-Use', verified: true },
      { street: '55 North Avenue', city: 'New Rochelle', state: 'NY', zip: '10801', type: 'Transit Hub', verified: true },
      { street: '350 Fifth Avenue', city: 'New York', state: 'NY', zip: '10118', type: 'Office', verified: true },
      { street: '1 World Trade Center', city: 'New York', state: 'NY', zip: '10007', type: 'Office', verified: true },
      { street: '200 Liberty Street', city: 'New York', state: 'NY', zip: '10281', type: 'Office', verified: true },
      { street: '11 Times Square', city: 'New York', state: 'NY', zip: '10036', type: 'Mixed-Use', verified: true },
      { street: '432 Park Avenue', city: 'New York', state: 'NY', zip: '10022', type: 'Residential', verified: true },
      { street: '30 Hudson Yards', city: 'New York', state: 'NY', zip: '10001', type: 'Office', verified: true },
      { street: '1 Manhattan West', city: 'New York', state: 'NY', zip: '10001', type: 'Office', verified: true },
      { street: '77 Water Street', city: 'New York', state: 'NY', zip: '10005', type: 'Office', verified: true },
      { street: '787 11th Avenue', city: 'New York', state: 'NY', zip: '10019', type: 'Industrial', verified: true },
      { street: '100 Pearl Street', city: 'Hartford', state: 'CT', zip: '06103', type: 'Office', verified: true },
      { street: '70 Hudson Street', city: 'Jersey City', state: 'NJ', zip: '07302', type: 'Office', verified: true },
      { street: '1 Gateway Center', city: 'Newark', state: 'NJ', zip: '07102', type: 'Office', verified: true },
    ];

    let addressSearchTimeout = null;
    let selectedAddress = null;

    function handleAddressInput(input) {
      const query = input.value.trim();
      const dropdown = document.getElementById('address-dropdown');

      if (query.length < 2) {
        dropdown.classList.remove('active');
        return;
      }

      // Show loading state
      dropdown.innerHTML = `
        <div class="address-autocomplete-loading">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
          Searching addresses...
        </div>
      `;
      dropdown.classList.add('active');

      // Debounce and simulate API call
      clearTimeout(addressSearchTimeout);
      addressSearchTimeout = setTimeout(() => {
        const results = searchAddresses(query);
        renderAddressResults(results);
      }, 400);
    }

    function searchAddresses(query) {
      const q = query.toLowerCase();
      return sampleAddresses.filter(addr => {
        const full = `${addr.street} ${addr.city} ${addr.state} ${addr.zip}`.toLowerCase();
        return full.includes(q);
      }).slice(0, 5);
    }

    function renderAddressResults(results) {
      const dropdown = document.getElementById('address-dropdown');

      if (results.length === 0) {
        dropdown.innerHTML = `
          <div class="address-autocomplete-loading" style="flex-direction: column; gap: 4px;">
            <span style="color: #94a3b8;">No addresses found</span>
            <span style="font-size: 11px; color: #64748b;">Try entering a different address</span>
          </div>
        `;
        return;
      }

      dropdown.innerHTML = results.map((addr, i) => `
        <div class="address-autocomplete-item" onclick="selectAddress(${i})">
          <svg class="address-autocomplete-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
          </svg>
          <div style="flex: 1;">
            <div class="address-autocomplete-main">${addr.street}</div>
            <div class="address-autocomplete-secondary">${addr.city}, ${addr.state} ${addr.zip} · ${addr.type}</div>
          </div>
          ${addr.verified ? '<span class="address-verified-badge"><svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>Verified</span>' : ''}
        </div>
      `).join('');

      // Store results for selection
      dropdown.dataset.results = JSON.stringify(results);
    }

    function selectAddress(index) {
      const dropdown = document.getElementById('address-dropdown');
      const results = JSON.parse(dropdown.dataset.results || '[]');
      const addr = results[index];

      if (!addr) return;

      selectedAddress = addr;

      // Fill in the form fields
      document.getElementById('prop-address').value = addr.street;
      document.getElementById('prop-city').value = `${addr.city}, ${addr.state} ${addr.zip}`;

      // Hide dropdown
      dropdown.classList.remove('active');

      // Show success feedback
      showToast('success', 'Address Verified', `${addr.street}, ${addr.city}, ${addr.state}`);

      // Auto-detect property type if possible
      if (addr.type) {
        const typeMap = {
          'Office': 'office-class-a',
          'Mixed-Use': 'mixed-use',
          'Residential': 'multifamily',
          'Industrial': 'industrial-warehouse',
          'Commercial': 'mixed-use',
          'Transit Hub': 'infrastructure-transit'
        };
        const propType = document.getElementById('prop-type');
        if (typeMap[addr.type] && propType) {
          propType.value = typeMap[addr.type];
        }
      }
    }

    function showAddressDropdown() {
      const input = document.getElementById('prop-address');
      if (input.value.length >= 2) {
        handleAddressInput(input);
      }
    }

    function hideAddressDropdown() {
      document.getElementById('address-dropdown').classList.remove('active');
    }

    // ==========================================
    // V31: PROBABILITY SCORE BREAKDOWN
    // ==========================================
    const probabilityFactors = {
      'IRA Section 45L Tax Credit': {
        factors: [
          { name: 'Energy efficiency certification', impact: '+15%', type: 'positive' },
          { name: 'ENERGY STAR certification pathway', impact: '+10%', type: 'positive' },
          { name: 'Prevailing wage compliance', impact: '+8%', type: 'positive' },
          { name: 'Project location (Opportunity Zone)', impact: '+5%', type: 'positive' },
          { name: 'Timeline to completion', impact: '-3%', type: 'negative' },
        ],
        baseProb: 60,
        finalProb: 95
      },
      'IRA Section 179D Deduction': {
        factors: [
          { name: 'Building envelope efficiency', impact: '+12%', type: 'positive' },
          { name: 'HVAC system efficiency', impact: '+10%', type: 'positive' },
          { name: 'Lighting power density', impact: '+8%', type: 'positive' },
          { name: 'Energy modeling completed', impact: '+7%', type: 'positive' },
          { name: 'Partial qualification risk', impact: '-5%', type: 'negative' },
        ],
        baseProb: 55,
        finalProb: 87
      },
      'LIHTC 4% Credit': {
        factors: [
          { name: 'Affordable units percentage', impact: '+20%', type: 'positive' },
          { name: 'State allocation available', impact: '+10%', type: 'positive' },
          { name: 'QAP scoring alignment', impact: '+8%', type: 'positive' },
          { name: 'Developer experience', impact: '+5%', type: 'positive' },
          { name: 'Market saturation risk', impact: '-8%', type: 'negative' },
        ],
        baseProb: 50,
        finalProb: 85
      }
    };

    // ==========================================
    // V31: 45L/179D TECHNICAL CALCULATOR (IRS-Accurate)
    // ==========================================
    function toggle45L179DCalculator() {
      const panel = document.getElementById('tech-calculator-panel');
      const chevron = document.getElementById('tech-calc-chevron');
      panel.classList.toggle('hidden');
      chevron.style.transform = panel.classList.contains('hidden') ? '' : 'rotate(180deg)';

      // Initialize calculations when opened
      if (!panel.classList.contains('hidden')) {
        calculate45L();
        calculate179D();
      }
    }

    function calculate45L() {
      const units = parseInt(document.getElementById('calc-45l-units').value) || 0;
      const level = document.getElementById('calc-45l-level').value;

      // IRS rates per IRC §45L as amended by IRA 2022
      let baseRate, multiplier, multiplierText;

      switch(level) {
        case 'energy-star':
          baseRate = 500; // $500/unit for ENERGY STAR baseline
          multiplier = 1;
          multiplierText = '1x (Base)';
          break;
        case 'energy-star-plus':
          baseRate = 1000; // $1,000/unit for Zero Energy Ready
          multiplier = 1;
          multiplierText = '1x (Zero Energy Ready)';
          break;
        case 'prevailing-wage':
          baseRate = 1000; // Base for Zero Energy Ready
          multiplier = 5; // 5x with prevailing wage
          multiplierText = '5x (Prevailing Wage)';
          break;
      }

      const creditPerUnit = baseRate * multiplier;
      const totalCredit = units * creditPerUnit;

      document.getElementById('rate-45l-unit').textContent = '$' + creditPerUnit.toLocaleString();
      document.getElementById('rate-45l-mult').textContent = multiplierText;
      document.getElementById('total-45l').textContent = '$' + totalCredit.toLocaleString();

      updateCombinedFederal();
    }

    function calculate179D() {
      const sqft = parseInt(document.getElementById('calc-179d-sqft').value) || 0;
      const reduction = document.getElementById('calc-179d-reduction').value;
      const prevailingWage = document.getElementById('calc-179d-wage').value === 'yes';

      // IRS rates per IRC §179D as amended by IRA 2022
      // Sliding scale based on energy reduction percentage
      let baseRate;
      switch(reduction) {
        case '25': baseRate = 0.50; break;
        case '35': baseRate = 0.625; break;
        case '45': baseRate = 0.75; break;
        case '50': baseRate = 1.00; break;
        default: baseRate = 0.50;
      }

      const multiplier = prevailingWage ? 5 : 1;
      const finalRate = baseRate * multiplier;
      const totalDeduction = sqft * finalRate;

      document.getElementById('rate-179d-base').textContent = '$' + baseRate.toFixed(2);
      document.getElementById('rate-179d-final').textContent = '$' + finalRate.toFixed(2) + '/sqft';
      document.getElementById('total-179d').textContent = '$' + totalDeduction.toLocaleString();

      updateCombinedFederal();
    }

    function updateCombinedFederal() {
      const total45L = parseInt(document.getElementById('total-45l').textContent.replace(/[$,]/g, '')) || 0;
      const total179D = parseInt(document.getElementById('total-179d').textContent.replace(/[$,]/g, '')) || 0;
      const combined = total45L + total179D;
      document.getElementById('combined-federal').textContent = '$' + combined.toLocaleString();

      // Update year reference text
      const taxYear = document.getElementById('calc-tax-year')?.value || '2024';
      const yearText = document.querySelector('#tech-calculator-panel .text-xs.text-slate-500:last-of-type');
      if (yearText) {
        // Tax year indicator is updated in the combined section
      }
    }

    // V32: 179D Certification Path toggle
    function toggle179DCertPath() {
      const panel = document.getElementById('cert-path-panel');
      const chevron = document.getElementById('cert-path-chevron');
      panel.classList.toggle('hidden');
      chevron.classList.toggle('rotate-180');
    }

    // V32: Tax Year Selector - affects inflation-adjusted rates
    function updateTaxYear() {
      const taxYear = document.getElementById('calc-tax-year').value;

      // IRS inflation adjustment factors (per Notice 2024-30)
      // Base year 2022 = 1.00
      const inflationFactors = {
        '2023': 1.00,  // First year
        '2024': 1.034, // 3.4% inflation adjustment
        '2025': 1.068, // Projected ~3.3% additional
        '2026': 1.10   // Projected baseline
      };

      // Show toast with year change
      showToast('info', 'Tax Year Updated', `Calculating with ${taxYear} IRS rates (inflation factor: ${inflationFactors[taxYear]}x)`);

      // Recalculate both sections
      calculate45L();
      calculate179D();
    }

    // ==========================================
    // V31: SELF-SERVE SIGNUP FLOW
    // ==========================================
    let selectedSignupTier = 'enterprise';

    function showSignup() {
      document.getElementById('signup-overlay').classList.add('active');
    }

    function hideSignup() {
      document.getElementById('signup-overlay').classList.remove('active');
    }

    function selectSignupTier(tier) {
      selectedSignupTier = tier;

      // Update toggle buttons
      document.querySelectorAll('.tier-toggle-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');

      // Show/hide tier info
      if (tier === 'enterprise') {
        document.getElementById('signup-enterprise-info').classList.remove('hidden');
        document.getElementById('signup-community-info').classList.add('hidden');
      } else {
        document.getElementById('signup-enterprise-info').classList.add('hidden');
        document.getElementById('signup-community-info').classList.remove('hidden');
      }
    }

    function validateSignupForm() {
      const email = document.getElementById('signup-email').value;
      const name = document.getElementById('signup-name').value;
      const company = document.getElementById('signup-company').value;
      const password = document.getElementById('signup-password').value;

      const isValid = email.includes('@') && name.length >= 2 && company.length >= 2 && password.length >= 6;
      document.getElementById('signup-submit-btn').disabled = !isValid;
    }

    function submitSignup() {
      const email = document.getElementById('signup-email').value;
      const name = document.getElementById('signup-name').value;

      // Simulate signup
      document.getElementById('signup-submit-btn').textContent = 'Creating Account...';
      document.getElementById('signup-submit-btn').disabled = true;

      setTimeout(() => {
        hideSignup();

        // Update user info in nav
        const tierLabel = selectedSignupTier === 'enterprise' ? 'Enterprise Plan' : 'Community Plan';
        document.querySelector('.text-blue-300').textContent = tierLabel;
        document.querySelector('.text-white.font-medium').textContent = name.split(' ')[0] + "'s Team";

        showToast('success', 'Welcome to IncentEdge!', `Your ${selectedSignupTier} account is ready`);

        // Reset form
        document.getElementById('signup-email').value = '';
        document.getElementById('signup-name').value = '';
        document.getElementById('signup-company').value = '';
        document.getElementById('signup-password').value = '';
        document.getElementById('signup-submit-btn').textContent = 'Create Account';
        document.getElementById('signup-submit-btn').disabled = true;

        // Apply community mode if selected
        if (selectedSignupTier === 'community') {
          enableCommunityMode();
        }
      }, 1500);
    }

    function socialSignup(provider) {
      showToast('info', 'SSO Integration', `${provider.charAt(0).toUpperCase() + provider.slice(1)} SSO would redirect here`);
    }

    // ==========================================
    // V31: COMMUNITY DEVELOPER TIER
    // ==========================================
    let isCommunityMode = false;

    function enableCommunityMode() {
      isCommunityMode = true;
      document.body.classList.add('community-mode');
      showToast('info', 'Community Mode Active', 'Interface simplified for small developers');
    }

    function disableCommunityMode() {
      isCommunityMode = false;
      document.body.classList.remove('community-mode');
    }

    function toggleCommunityMode() {
      if (isCommunityMode) {
        disableCommunityMode();
      } else {
        enableCommunityMode();
      }
    }

    function showProbabilityBreakdown(programName) {
      const data = probabilityFactors[programName];
      if (!data) {
        showToast('info', 'Methodology', 'Detailed breakdown available for major federal programs');
        return;
      }

      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 bg-black/60 z-50 flex items-center justify-center';
      modal.onclick = (e) => { if (e.target === modal) modal.remove(); };

      modal.innerHTML = `
        <div class="bg-slate-900 border border-slate-700 rounded-xl max-w-md w-full mx-4 overflow-hidden">
          <div class="p-6 border-b border-slate-700">
            <div class="flex items-center justify-between">
              <h3 class="text-lg font-semibold text-white">${programName}</h3>
              <button onclick="this.closest('.fixed').remove()" class="text-slate-400 hover:text-white">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
              </button>
            </div>
            <p class="text-sm text-slate-400 mt-1">Probability Score Breakdown</p>
          </div>
          <div class="p-6">
            <div class="flex items-center justify-between mb-4">
              <span class="text-sm text-slate-400">Base Probability</span>
              <span class="font-mono font-semibold text-white">${data.baseProb}%</span>
            </div>
            <div class="space-y-1">
              ${data.factors.map(f => `
                <div class="prob-factor">
                  <div class="prob-factor-name">
                    <svg class="prob-factor-icon ${f.type}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      ${f.type === 'positive' ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"/>' : '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"/>'}
                    </svg>
                    ${f.name}
                  </div>
                  <span class="prob-factor-value ${f.type}">${f.impact}</span>
                </div>
              `).join('')}
            </div>
            <div class="mt-4 pt-4 border-t border-slate-700 flex items-center justify-between">
              <span class="text-sm font-medium text-white">Final Probability</span>
              <span class="font-mono font-bold text-xl text-green-400">${data.finalProb}%</span>
            </div>
          </div>
          <div class="p-4 bg-slate-800/50 text-center">
            <p class="text-xs text-slate-500">Methodology based on historical approval rates and project-specific factors</p>
          </div>
        </div>
      `;

      document.body.appendChild(modal);
    }

    // ==========================================
    // V31: PORTFOLIO DASHBOARD FUNCTIONS
    // ==========================================
    const portfolioProjects = [
      { id: 'riverdale-125', name: '125 Riverdale Ave', location: 'Yonkers, NY', type: 'Multifamily', tdc: 48500000, incentives: 7200000, status: 'active' },
      { id: 'fulton-280', name: '280 Fulton St', location: 'Brooklyn, NY', type: 'Mixed-Use', tdc: 125000000, incentives: 21300000, status: 'active' },
      { id: 'main-450', name: '450 Main St', location: 'New Rochelle, NY', type: 'TOD', tdc: 78200000, incentives: 11800000, status: 'pending' },
      { id: 'canal-88', name: '88 Canal St', location: 'Manhattan, NY', type: 'Commercial', tdc: 215000000, incentives: 32400000, status: 'active' },
      { id: 'grove-220', name: '220 Grove St', location: 'Jersey City, NJ', type: 'Multifamily', tdc: 92500000, incentives: 15600000, status: 'active' },
      { id: 'bergen-500', name: '500 Bergen Blvd', location: 'Ridgefield, NJ', type: 'Industrial', tdc: 67000000, incentives: 8700000, status: 'completed' }
    ];

    function filterPortfolio(filter) {
      // Update filter buttons
      document.querySelectorAll('.portfolio-filter-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.textContent.toLowerCase().includes(filter === 'all' ? 'all' : filter)) {
          btn.classList.add('active');
        }
      });

      // Filter cards (in production, this would filter the actual cards)
      const cards = document.querySelectorAll('.portfolio-card');
      cards.forEach(card => {
        const status = card.querySelector('.status-badge');
        if (filter === 'all') {
          card.style.display = '';
        } else if (filter === 'active' && status.classList.contains('status-success')) {
          card.style.display = '';
        } else if (filter === 'pending' && status.classList.contains('status-info')) {
          card.style.display = '';
        } else if (filter === 'completed' && status.classList.contains('status-completed')) {
          card.style.display = '';
        } else {
          card.style.display = 'none';
        }
      });

      showToast('info', 'Filter Applied', `Showing ${filter === 'all' ? 'all' : filter} projects`);
    }

    function sortPortfolio(sortBy) {
      showToast('info', 'Sort Applied', `Sorting by ${sortBy}`);
      // In production, this would re-order the portfolio cards
    }

    function openProjectDetail(projectId) {
      const project = portfolioProjects.find(p => p.id === projectId);
      if (!project) return;

      showToast('info', 'Project Selected', `Opening ${project.name} detail view`);
      // In production, this would open a detailed project view or switch to the Analyze section
    }

    function exportPortfolio() {
      showToast('success', 'Export Started', 'Generating portfolio summary Excel report...');
      setTimeout(() => {
        showToast('info', 'Export Ready', 'portfolio-summary-2026-01.xlsx ready for download');
      }, 2000);
    }

    // ==========================================
    // V31: ENVIRONMENTAL JUSTICE MAP FUNCTIONS
    // ==========================================
    const ejZoneData = {
      'South Bronx': { type: 'dac', bonus: '+10%', population: 148000, tracts: 12 },
      'East Harlem': { type: 'dac', bonus: '+10%', population: 115000, tracts: 8 },
      'Westchester Coal Closure': { type: 'energy', bonus: '+10%', closureYear: 2021, msa: 'NY-Newark-JC' },
      'Nassau Industrial': { type: 'energy', bonus: '+10%', employmentDecline: '15%', msa: 'NY-Newark-JC' },
      'Central Brooklyn': { type: 'lowincome', bonus: '+10-20%', medianIncome: '$38,500', tracts: 15 },
      'Jamaica, Queens': { type: 'lowincome', bonus: '+10-20%', medianIncome: '$42,000', tracts: 6 },
      'Yonkers Multi-Qualified': { type: 'overlap', bonus: '+30%', qualifications: ['DAC', 'Energy', 'Low-Income'], maxBonus: '$2.16M' }
    };

    const ejLayers = { dac: true, energy: true, lowincome: true };

    function toggleEJLayer(layer) {
      ejLayers[layer] = !ejLayers[layer];

      // Toggle visibility of zones
      const zones = document.querySelectorAll(`.ej-zone-${layer}`);
      zones.forEach(zone => {
        zone.style.display = ejLayers[layer] ? '' : 'none';
      });

      // Handle overlap zones
      if (layer === 'dac' || layer === 'energy' || layer === 'lowincome') {
        const overlapZones = document.querySelectorAll('.ej-zone-overlap');
        // Only hide overlap if all contributing layers are hidden
        overlapZones.forEach(zone => {
          zone.style.opacity = (ejLayers.dac || ejLayers.energy || ejLayers.lowincome) ? '' : '0.3';
        });
      }

      showToast('info', 'Layer Updated', `${layer.toUpperCase()} layer ${ejLayers[layer] ? 'shown' : 'hidden'}`);
    }

    function showEJZoneDetail(zoneType, zoneName) {
      const data = ejZoneData[zoneName];
      if (!data) {
        showToast('info', zoneName, `${zoneType.toUpperCase()} designated area`);
        return;
      }

      let details = '';
      if (data.type === 'dac') {
        details = `Population: ${data.population?.toLocaleString() || 'N/A'} | Census Tracts: ${data.tracts || 'N/A'}`;
      } else if (data.type === 'energy') {
        details = `MSA: ${data.msa || 'N/A'} | ${data.closureYear ? 'Coal Closure: ' + data.closureYear : 'Employment Decline: ' + data.employmentDecline}`;
      } else if (data.type === 'lowincome') {
        details = `Median Income: ${data.medianIncome || 'N/A'} | Census Tracts: ${data.tracts || 'N/A'}`;
      } else if (data.type === 'overlap') {
        details = `Qualifications: ${data.qualifications?.join(', ') || 'Multiple'} | Max Bonus: ${data.maxBonus || 'N/A'}`;
      }

      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 bg-black/60 z-50 flex items-center justify-center';
      modal.onclick = (e) => { if (e.target === modal) modal.remove(); };

      modal.innerHTML = `
        <div class="bg-slate-900 border border-slate-700 rounded-xl max-w-md w-full mx-4 overflow-hidden">
          <div class="p-6 border-b border-slate-700">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-lg ${data.type === 'dac' ? 'bg-purple-500' : data.type === 'energy' ? 'bg-green-500' : data.type === 'lowincome' ? 'bg-yellow-500' : 'bg-red-500'} flex items-center justify-center">
                  <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/></svg>
                </div>
                <div>
                  <h3 class="text-lg font-semibold text-white">${zoneName}</h3>
                  <p class="text-sm text-slate-400">${data.type === 'dac' ? 'Disadvantaged Community' : data.type === 'energy' ? 'Energy Community' : data.type === 'lowincome' ? 'Low-Income Census Tract' : 'Multi-Qualified Zone'}</p>
                </div>
              </div>
              <button onclick="this.closest('.fixed').remove()" class="text-slate-400 hover:text-white">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
              </button>
            </div>
          </div>
          <div class="p-6">
            <div class="flex items-center justify-between mb-4 p-3 bg-slate-800/50 rounded-lg">
              <span class="text-slate-400">IRA Bonus Credit</span>
              <span class="font-mono text-xl font-bold ${data.type === 'overlap' ? 'text-red-400' : data.type === 'dac' ? 'text-purple-400' : data.type === 'energy' ? 'text-green-400' : 'text-yellow-400'}">${data.bonus}</span>
            </div>
            <p class="text-sm text-slate-400">${details}</p>
            <div class="mt-4 pt-4 border-t border-slate-700">
              <p class="text-xs text-slate-500">Data source: CEJST (Climate & Economic Justice Screening Tool) + DOE Energy Communities API</p>
            </div>
          </div>
        </div>
      `;

      document.body.appendChild(modal);
    }

    function showProjectEJDetail(projectId) {
      const projectNames = {
        'riverdale-125': '125 Riverdale Ave',
        'fulton-280': '280 Fulton St',
        'main-450': '450 Main St'
      };

      showToast('info', 'Project EJ Analysis', `Viewing EJ qualifications for ${projectNames[projectId] || projectId}`);
      // Scroll to the project cards at the bottom
      const cards = document.querySelector('#section-ejmap .grid.grid-cols-3');
      if (cards) {
        cards.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }

    function searchEJMap(query) {
      if (query.length < 3) return;

      // Simulate search results
      const results = ['Census Tract 36119000100', '125 Riverdale Ave, Yonkers', 'Bronx County DAC'];
      const matchingResult = results.find(r => r.toLowerCase().includes(query.toLowerCase()));

      if (matchingResult) {
        showToast('info', 'Location Found', matchingResult);
      }
    }

    function locateCurrentProject() {
      showToast('info', 'Locating Project', 'Centering map on 125 Riverdale Ave, Yonkers NY');
      // In production with Mapbox, this would pan/zoom to the project location
    }

    function zoomEJMap(direction) {
      showToast('info', 'Zoom', direction === 'in' ? 'Zooming in...' : 'Zooming out...');
      // In production with Mapbox, this would adjust zoom level
    }

    function resetEJMap() {
      showToast('info', 'View Reset', 'Map reset to default NYC metro view');
      // Reset all layers to visible
      document.getElementById('layer-dac').checked = true;
      document.getElementById('layer-energy').checked = true;
      document.getElementById('layer-lowincome').checked = true;
      ejLayers.dac = true;
      ejLayers.energy = true;
      ejLayers.lowincome = true;
      document.querySelectorAll('.ej-zone').forEach(z => z.style.display = '');
    }

    function exportEJReport() {
      showToast('success', 'Export Started', 'Generating Environmental Justice Analysis Report...');
      setTimeout(() => {
        showToast('info', 'Export Ready', 'ej-analysis-portfolio-2026-01.pdf ready for download');
      }, 2000);
    }

    // ==========================================
    // V31: API DOCUMENTATION FUNCTIONS
    // ==========================================
    function toggleApiEndpoint(el) {
      el.classList.toggle('expanded');
    }

    function switchApiTab(tab) {
      // Update tab buttons
      document.querySelectorAll('.api-tab-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.textContent.toLowerCase().includes(tab)) {
          btn.classList.add('active');
        }
      });

      // In production, this would show/hide different endpoint groups
      showToast('info', 'Tab Switched', `Viewing ${tab} endpoints`);
    }

    function copyApiKey() {
      const apiKey = 'ie_live_' + Math.random().toString(36).substring(2, 15);
      navigator.clipboard.writeText(apiKey).then(() => {
        showToast('success', 'API Key Copied', 'Your API key has been copied to clipboard');
      }).catch(() => {
        showToast('info', 'API Key', `Your key: ${apiKey}`);
      });
    }

    // ==========================================
    // V31: ENERGY MODELING FUNCTIONS
    // ==========================================
    function uploadEnergyModel(platform) {
      document.getElementById('energy-file-input').click();
      showToast('info', 'Upload', `Select your ${platform} model file`);
    }

    function connectEnergyModel(platform) {
      showToast('info', 'Connecting', `Setting up ${platform} integration...`);
      setTimeout(() => {
        showToast('success', 'Connected', `${platform} integration activated`);
      }, 1500);
    }

    function handleEnergyDrop(e) {
      e.preventDefault();
      e.stopPropagation();
      document.getElementById('energy-upload-zone').classList.remove('dragover');

      const files = e.dataTransfer.files;
      if (files.length > 0) {
        processEnergyFile(files[0]);
      }
    }

    function handleEnergyDragOver(e) {
      e.preventDefault();
      e.stopPropagation();
      document.getElementById('energy-upload-zone').classList.add('dragover');
    }

    function handleEnergyDragLeave(e) {
      e.preventDefault();
      e.stopPropagation();
      document.getElementById('energy-upload-zone').classList.remove('dragover');
    }

    function handleEnergyFileSelect(e) {
      const files = e.target.files;
      if (files.length > 0) {
        processEnergyFile(files[0]);
      }
    }

    function processEnergyFile(file) {
      const validExtensions = ['.idf', '.inp', '.sim', '.osm', '.gbxml'];
      const ext = file.name.substring(file.name.lastIndexOf('.')).toLowerCase();

      if (!validExtensions.includes(ext)) {
        showToast('error', 'Invalid File', 'Please upload a valid energy model file');
        return;
      }

      showToast('info', 'Processing', `Analyzing ${file.name}...`);

      // Simulate processing
      setTimeout(() => {
        const savings = Math.floor(Math.random() * 30) + 25;
        const value = Math.floor(savings * 12500);
        showToast('success', 'Analysis Complete', `Energy savings: ${savings}% | 179D value: $${value.toLocaleString()}`);
      }, 2000);
    }

    // ==========================================
    // V31: SOC 2 COMPLIANCE FUNCTIONS
    // ==========================================
    function downloadComplianceReport() {
      showToast('info', 'Download Started', 'Preparing SOC 2 Type II Report...');
      setTimeout(() => {
        showToast('success', 'Download Ready', 'incentedge-soc2-report-2025.pdf');
      }, 1500);
    }

    // ==========================================
    // V31: COMPONENT LIBRARY FUNCTIONS
    // ==========================================
    function filterComponents(category) {
      document.querySelectorAll('.portfolio-filter-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.textContent.toLowerCase().includes(category === 'all' ? 'all' : category)) {
          btn.classList.add('active');
        }
      });

      showToast('info', 'Filter Applied', `Showing ${category === 'all' ? 'all' : category} components`);
    }

    function openStorybook() {
      showToast('info', 'Storybook', 'Opening component documentation in new tab...');
      // In production: window.open('/storybook', '_blank');
    }

    // ==========================================
    // V31: MOBILE NAVIGATION FUNCTIONS
    // ==========================================
    function toggleMobileMenu() {
      const navLinks = document.querySelector('.nav-links');
      navLinks.classList.toggle('mobile-open');
    }

    function closeMobileMenu() {
      const navLinks = document.querySelector('.nav-links');
      navLinks.classList.remove('mobile-open');
    }

    function setMobileNavActive(section) {
      document.querySelectorAll('.mobile-nav-item').forEach(item => {
        item.classList.remove('active');
        if (item.dataset.section === section) {
          item.classList.add('active');
        }
      });
    }

    // Close mobile menu when clicking outside
    document.addEventListener('click', function(e) {
      const navLinks = document.querySelector('.nav-links');
      const menuBtn = document.querySelector('.mobile-menu-btn');
      if (navLinks && navLinks.classList.contains('mobile-open')) {
        if (!navLinks.contains(e.target) && !menuBtn.contains(e.target)) {
          closeMobileMenu();
        }
      }
    });

    // Update mobile bottom nav when section changes
    const originalSwitchSection = window.switchSection;
    if (typeof originalSwitchSection === 'function') {
      window.switchSection = function(section) {
        originalSwitchSection(section);
        setMobileNavActive(section);
        closeMobileMenu();
      };
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
      initAutocomplete();

      // V30: Logo animation lifecycle management
      const logo = document.getElementById('incentedge-logo');
      if (logo) {
        // After the 3-second fade-in completes, add 'loaded' class
        // This triggers the subtle shimmer effect
        setTimeout(() => {
          logo.classList.add('loaded');
        }, 3000);

        // Ensure smooth animation by forcing style recalculation
        void logo.offsetWidth;
      }

      // V31: Check if onboarding should be shown
      // Show onboarding for new users (check localStorage)
      const hasCompletedOnboarding = localStorage.getItem('incentedge-onboarding-complete');
      if (!hasCompletedOnboarding) {
        // Delay slightly to let the page render first
        setTimeout(() => {
          showOnboarding();
        }, 1000);
      }
    });

    // V35: System Status Modal
    function showSystemStatus() {
      const statusHtml = `
        <div class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center" onclick="this.remove()">
          <div class="bg-white dark:bg-slate-800 rounded-xl shadow-xl max-w-md w-full mx-4 overflow-hidden" onclick="event.stopPropagation()">
            <div class="px-6 py-4 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between">
              <h3 class="font-semibold text-slate-900 dark:text-white">System Status</h3>
              <button onclick="this.closest('.fixed').remove()" class="text-slate-400 hover:text-slate-600">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
              </button>
            </div>
            <div class="p-6 space-y-4">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                  <span class="text-sm text-slate-700 dark:text-slate-300">API Gateway</span>
                </div>
                <span class="text-xs text-green-600 dark:text-green-400 font-mono">45ms</span>
              </div>
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                  <span class="text-sm text-slate-700 dark:text-slate-300">Database</span>
                </div>
                <span class="text-xs text-green-600 dark:text-green-400 font-mono">12ms</span>
              </div>
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                  <span class="text-sm text-slate-700 dark:text-slate-300">AI Inference Engine</span>
                </div>
                <span class="text-xs text-green-600 dark:text-green-400 font-mono">89ms</span>
              </div>
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                  <span class="text-sm text-slate-700 dark:text-slate-300">External Integrations</span>
                </div>
                <span class="text-xs text-green-600 dark:text-green-400 font-mono">156ms</span>
              </div>
              <div class="pt-4 border-t border-slate-200 dark:border-slate-700">
                <p class="text-xs text-slate-500 dark:text-slate-400">Last updated: Just now</p>
                <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">Uptime: 99.99% (last 30 days)</p>
              </div>
            </div>
          </div>
        </div>
      `;
      document.body.insertAdjacentHTML('beforeend', statusHtml);
    }

    // V35: LP Reports Functions
    function generateLPReport(reportType) {
      const reportNames = {
        'portfolio-summary': 'Portfolio Summary Report',
        'incentive-capture': 'Incentive Capture Report',
        'compliance-status': 'Compliance Status Report',
        'capital-stack': 'Capital Stack Report',
        'investor-returns': 'Investor Returns Report',
        'tax-credit-pipeline': 'Tax Credit Pipeline Report'
      };
      const name = reportNames[reportType] || 'Custom Report';
      showToast('info', 'Generating Report', 'Creating ' + name + '...');
      setTimeout(() => {
        showToast('success', 'Report Ready', name + ' has been generated and is ready for download.');
      }, 2000);
    }

    // V35: Credit Marketplace Functions
    function listCreditsForSale() {
      showToast('info', 'Credit Listing', 'Opening credit listing wizard...');
    }

    // V35: Grant Writing Functions
    function startNewGrantApplication() {
      showToast('info', 'Grant Application', 'Select a grant program to begin your application.');
    }

    function startGrantApplication(program) {
      const programNames = {
        'usda-reap': 'USDA REAP',
        'epa-brownfield': 'EPA Brownfield',
        'hud-cdbg': 'HUD CDBG',
        'doe-lpo': 'DOE LPO'
      };
      const name = programNames[program] || program;
      showToast('info', 'Starting Application', 'Loading ' + name + ' application with auto-populated fields...');
      setTimeout(() => {
        showToast('success', 'Fields Populated', '85% of fields have been auto-populated from your project data.');
      }, 1500);
    }

    // V37: ROI Calculator with Pro Forma Functions
    let currentProjectType = 'new';

    function setProjectType(type) {
      currentProjectType = type;
      const newBtn = document.getElementById('roi-new-btn');
      const rehabBtn = document.getElementById('roi-rehab-btn');

      if (type === 'new') {
        newBtn.classList.remove('bg-slate-200', 'dark:bg-slate-700', 'text-slate-700', 'dark:text-slate-300');
        newBtn.classList.add('bg-blue-600', 'text-white');
        rehabBtn.classList.remove('bg-blue-600', 'text-white');
        rehabBtn.classList.add('bg-slate-200', 'dark:bg-slate-700', 'text-slate-700', 'dark:text-slate-300');
      } else {
        rehabBtn.classList.remove('bg-slate-200', 'dark:bg-slate-700', 'text-slate-700', 'dark:text-slate-300');
        rehabBtn.classList.add('bg-blue-600', 'text-white');
        newBtn.classList.remove('bg-blue-600', 'text-white');
        newBtn.classList.add('bg-slate-200', 'dark:bg-slate-700', 'text-slate-700', 'dark:text-slate-300');
      }
      updateROIProForma();
    }

    function updateROIProForma() {
      // Get input values
      const assetType = document.getElementById('roi-asset-type')?.value || 'multifamily';
      const buildingSize = parseInt(document.getElementById('roi-building-size')?.value) || 150000;
      const budgetStr = document.getElementById('roi-baseline-budget')?.value || '$45,000,000';
      const baselineBudget = parseNumber(budgetStr);
      const tier = document.querySelector('input[name="roi-tier"]:checked')?.value || '2';

      // Multipliers based on tier
      const tierMultipliers = {
        '1': { costPremium: 0.02, incentiveRate: 0.015, opexSavings: 0.15 },
        '2': { costPremium: 0.033, incentiveRate: 0.04, opexSavings: 0.30 },
        '3': { costPremium: 0.055, incentiveRate: 0.065, opexSavings: 0.45 }
      };

      // Asset type multipliers
      const assetMultipliers = {
        'multifamily': 1.0,
        'office': 0.9,
        'retail': 0.85,
        'industrial': 0.8,
        'mixeduse': 1.1
      };

      const tier_m = tierMultipliers[tier];
      const asset_m = assetMultipliers[assetType] || 1.0;
      const projectMultiplier = currentProjectType === 'rehab' ? 0.7 : 1.0;

      // Calculate values
      const costPremium = baselineBudget * tier_m.costPremium;
      const optimizedCost = baselineBudget + costPremium;
      const incentiveValue = baselineBudget * tier_m.incentiveRate * asset_m * projectMultiplier;
      const annualOpexSavings = (baselineBudget * 0.01) * tier_m.opexSavings; // Assume 1% of budget is baseline OpEx
      const netCost = optimizedCost - incentiveValue - annualOpexSavings;

      // Calculate ROI metrics
      const roi = ((incentiveValue + (annualOpexSavings * 5)) / costPremium * 100);
      const paybackYears = costPremium / (incentiveValue / 5 + annualOpexSavings);

      // Update display
      const roiEl = document.getElementById('roi-result');
      const paybackEl = document.getElementById('payback-result');
      const incentiveEl = document.getElementById('incentive-value-result');

      if (roiEl) roiEl.textContent = Math.round(roi) + '%';
      if (paybackEl) paybackEl.textContent = paybackYears.toFixed(1) + ' Years';
      if (incentiveEl) incentiveEl.textContent = formatCurrency(incentiveValue);

      // Update pro forma table
      const constructionEl = document.getElementById('proforma-construction');
      const constructionDeltaEl = document.getElementById('proforma-construction-delta');
      const incentivesEl = document.getElementById('proforma-incentives');
      const incentivesDeltaEl = document.getElementById('proforma-incentives-delta');
      const opexEl = document.getElementById('proforma-opex');
      const opexDeltaEl = document.getElementById('proforma-opex-delta');
      const netEl = document.getElementById('proforma-net');
      const netDeltaEl = document.getElementById('proforma-net-delta');

      if (constructionEl) constructionEl.textContent = formatCurrency(optimizedCost);
      if (constructionDeltaEl) constructionDeltaEl.textContent = '+' + formatCurrency(costPremium);
      if (incentivesEl) incentivesEl.textContent = formatCurrency(incentiveValue);
      if (incentivesDeltaEl) incentivesDeltaEl.textContent = '+' + formatCurrency(incentiveValue - 200000);
      if (opexEl) opexEl.textContent = formatCurrency(annualOpexSavings);
      if (opexDeltaEl) opexDeltaEl.textContent = '+' + formatCurrency(annualOpexSavings) + '/yr';
      if (netEl) netEl.textContent = formatCurrency(netCost);
      if (netDeltaEl) {
        const netSavings = (baselineBudget - 200000) - netCost;
        netDeltaEl.textContent = (netSavings > 0 ? '-' : '+') + formatCurrency(Math.abs(netSavings));
      }
    }

    // Initialize ROI Pro Forma on page load
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(updateROIProForma, 100);
    });
  </script>

  <!-- V31: Mobile Bottom Navigation -->
  <nav class="mobile-bottom-nav">
    <div class="mobile-nav-item active" data-section="discover" onclick="switchSection('discover')">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
      <span>Discover</span>
    </div>
    <div class="mobile-nav-item" data-section="analysis" onclick="switchSection('analysis')">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
      <span>Analyze</span>
    </div>
    <div class="mobile-nav-item" data-section="portfolio" onclick="switchSection('portfolio')">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
      <span>Portfolio</span>
    </div>
    <div class="mobile-nav-item" data-section="reports" onclick="switchSection('reports')">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
      <span>Reports</span>
    </div>
    <div class="mobile-nav-item" onclick="toggleMobileMenu()">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 6h16M4 12h16M4 18h16"/></svg>
      <span>More</span>
    </div>
  </nav>
</body>
</html>
